import {
    Component,
    Input,
    OnInit,
    ViewChild,
    AfterViewInit,
  } from '@angular/core';
  import { FormControl, FormGroup, Validators } from '@angular/forms';
  import { Store } from '@ngrx/store';
  import { BsModalRef } from 'ngx-bootstrap/modal';
  import * as PIXI from 'pixi.js';
  import { firstValueFrom } from 'rxjs';
  import { AppState } from 'src/app/reducer/rootReducer';
  import { IDropdown } from 'src/app/shared/models/IDropdown';
  import { IPositionTypeBin } from 'src/app/shared/models/IPositionTypeBin';
  import { WarehouseService } from 'src/app/warehouse/warehouse.service';
  import { SetCurrentPositionTypeBin } from '../warehouse-redux/warehouseAction';
  
  @Component({
    selector: 'app-modal-address-selected',
    templateUrl: './modal-address-selected.component.html',
    styleUrls: ['./modal-address-selected.component.scss'],
  })
  export class ModalAddressSelectedComponent implements OnInit, AfterViewInit {
    @Input() title: string = '';
    @Input() gameInstance: any;
    @ViewChild('pixiContainer', { static: true }) pixiContainer: any;
    typeForm!: FormGroup;
  
    positionTypeBins: IPositionTypeBin[] = [];
    positionTypeDropDown: IDropdown[] = [];
  
    positionTypeSelected: IPositionTypeBin | undefined = undefined;
  
    accessSideDropdown: IDropdown[] = [
      {
        text: 'Up',
        value: 0,
      },
      {
        text: 'Right',
        value: 1,
      },
      {
        text: 'Down',
        value: 2,
      },
      {
        text: 'Left',
        value: 3,
      },
    ];
  
    private app: PIXI.Application = new PIXI.Application({
      width: 350,
      height: 350,
      backgroundColor: 0xececec,
      antialias: true,
    });
  
    constructor(
      public bsModalRef: BsModalRef,
      private warehouseService: WarehouseService,
      private store: Store<AppState>
    ) {}
  
    ngAfterViewInit(): void {
      this.pixiContainer.nativeElement.appendChild(this.app.view as any);
    }
    ngOnInit(): void {
      // this.loadPositionTypeBins();
      // this.createTypeForm();
    }
  
    // onSubmit(): void {
    //   if (!this.positionTypeSelected) return;
  
    //   const value = this.typeForm.value as IPositionTypeBin;
    //   value.totalDepth = this.positionTypeSelected.totalDepth;
    //   value.totalFront = this.positionTypeSelected.totalFront;
  
    //   this.store.dispatch(SetCurrentPositionTypeBin(value));
    //   this.gameInstance.SendMessage(
    //     'JavaScriptMessager',
    //     'HandleSpawnMode',
    //     'true'
    //   );
    //   this.closeModal();
    // }
  
    closeModal(): void {
      this.bsModalRef.hide();
    }
  
    // drawPreview(): void {
    //   if (!this.positionTypeSelected) return;
    //   this.app.stage.removeChildren();
  
    //   let width = this.positionTypeSelected.totalFront * 100.0;
    //   let height = this.positionTypeSelected.totalDepth * 100.0;
    //   for (let i = 1; i <= 5; i++) {
    //     if (width >= this.app.view.width || height >= this.app.view.height) {
    //       width /= i;
    //       height /= i;
    //     } else break;
    //   }
  
    //   const position = [
    //     this.app.view.width / 2.0 - width / 2.0,
    //     this.app.view.height / 2.0 - height / 2.0,
    //   ];
    //   const graphics = new PIXI.Graphics();
    //   graphics.lineStyle(2, 0x00, 1);
    //   graphics.beginFill(0xfad985);
    //   graphics.drawRect(position[0], position[1], width, height);
    //   graphics.endFill();
  
    //   this.app.stage.addChild(graphics);
    // }
  
    // createTypeForm(): void {
    //   this.typeForm = new FormGroup({
    //     positionTypeDescription: new FormControl('', [Validators.required]),
    //     pickingAccess: new FormControl('0', [Validators.required]),
    //     rowCount: new FormControl('1', [Validators.required]),
    //     columnCount: new FormControl('1', [
    //       Validators.required,
    //       Validators.min(1),
    //     ]),
    //     stepByColumn: new FormControl('1', [
    //       Validators.required,
    //       Validators.min(1),
    //     ]),
    //     stepByRow: new FormControl('1', [Validators.required, Validators.min(1)]),
    //     stepByRowSize: new FormControl('0', [
    //       Validators.required,
    //       Validators.min(0),
    //     ]),
    //     stepByColumnSize: new FormControl('0', [
    //       Validators.required,
    //       Validators.min(0),
    //     ]),
    //   });
  
    //   this.typeForm
    //     .get('positionTypeDescription')
    //     ?.valueChanges.subscribe((selectedValue) => {
    //       this.positionTypeSelected = this.positionTypeBins.find(
    //         (x) => x.positionTypeDescription === selectedValue
    //       );
    //       this.drawPreview();
    //     });
    // }
  
    // async loadPositionTypeBins(): Promise<void> {
    //   try {
    //     this.positionTypeBins = await firstValueFrom(
    //       this.warehouseService.loadPositionTypeBins()
    //     );
    //     this.positionTypeBins.forEach((item) => {
    //       this.positionTypeDropDown.push({
    //         text: item.positionTypeDescription,
    //         value: item.positionTypeDescription,
    //       });
    //     });
    //     this.positionTypeSelected = this.positionTypeBins[0];
    //     this.drawPreview();
    //     this.typeForm
    //       .get('positionTypeDescription')
    //       ?.setValue(this.positionTypeDropDown[0].value);
    //   } catch (error) {
    //     console.error(error);
    //   }
    // }
  }
  