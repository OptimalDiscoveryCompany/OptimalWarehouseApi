import {
  Component,
  Input,
  OnInit,
  ViewChild,
  AfterViewInit,
} from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { BsModalRef } from 'ngx-bootstrap/modal';
import * as PIXI from 'pixi.js';
import { firstValueFrom } from 'rxjs';
import { IDropdown } from 'src/app/shared/models/IDropdown';
import { IPositionTypeBin } from 'src/app/shared/models/IPositionTypeBin';
import { WarehouseService } from 'src/app/warehouse.service';

@Component({
  selector: 'app-modal-select-type-address',
  templateUrl: './modal-select-type-address.component.html',
  styleUrls: ['./modal-select-type-address.component.scss'],
})
export class ModalSelectTypeAddressComponent implements OnInit, AfterViewInit {
  @Input() title: string = '';
  @ViewChild('pixiContainer', { static: true }) pixiContainer: any;
  typeForm!: FormGroup;

  private positionTypeBins: IPositionTypeBin[] = [];
  positionTypeDropDown: IDropdown[] = [];

  private app: PIXI.Application = new PIXI.Application({
    width: 350,
    height: 600,
    backgroundColor: 0xececec,
  });

  constructor(
    public bsModalRef: BsModalRef,
    private warehouseService: WarehouseService
  ) {}

  ngAfterViewInit(): void {
    this.pixiContainer.nativeElement.appendChild(this.app.view as any);
  }
  ngOnInit(): void {
    this.createTypeForm();
    this.loadPositionTypeBins();
  }

  onSubmit(): void {
    console.log('Submit');
  }

  closeModal(): void {
    this.bsModalRef.hide();
  }

  createTypeForm(): void {
    this.typeForm = new FormGroup({
      positionTypeDescription: new FormControl('OptimalPicking', [
        Validators.required,
      ]),
      pickingAccess: new FormControl('', [Validators.required]),
      rowCount: new FormControl('1', [Validators.required, Validators.min(1)]),
      columnCount: new FormControl('1', [
        Validators.required,
        Validators.min(1),
      ]),
      stepByColumn: new FormControl('1', [
        Validators.required,
        Validators.min(1),
      ]),
      stepByRow: new FormControl('1', [Validators.required, Validators.min(1)]),
      stepByRowSize: new FormControl('0', [Validators.required]),
      stepByColumnSize: new FormControl('0', [Validators.required]),
    });
  }

  async loadPositionTypeBins(): Promise<void> {
    try {
      this.positionTypeBins =
        await firstValueFrom(this.warehouseService.loadPositionTypeBins());
      this.positionTypeBins.forEach((item) => {
        this.positionTypeDropDown.push({
          text: item.positionTypeDescription,
          value: item.positionTypeDescription,
        });
      });
      console.log('LOAD');
      console.log(this.positionTypeBins);
    } catch (error) {
      console.error(error);
    }
  }
}
