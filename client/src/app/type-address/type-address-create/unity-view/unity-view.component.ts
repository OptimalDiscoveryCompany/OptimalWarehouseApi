import {
  Component,
  EventEmitter,
  OnDestroy,
  OnInit,
  Output,
} from '@angular/core';

@Component({
  selector: 'app-unity-view',
  templateUrl: './unity-view.component.html',
  styleUrls: ['./unity-view.component.scss'],
})
export class UnityViewComponent implements OnInit, OnDestroy {
  unityInstance: any;
  isReady = false;
  @Output() gameInstanceEvent = new EventEmitter<{ gameInstance: any }>();
  localGameInstance: any;

  constructor() {}
  ngOnDestroy(): void {
    this.unityInstance.Quit();
    this.unityInstance = null;
  }

  ngOnInit(): void {
    const loader = (window as any).UnityLoader;
    this.unityInstance = loader.instantiate(
      'unityContainer',
      `assets/positionType/Build/positionType.json`,
      {
        onProgress: (gameInstance: any, progress: number) => {
          this.isReady = true;
          this.localGameInstance = gameInstance;
          this.gameInstanceEvent.emit({
            gameInstance: this.localGameInstance,
          });
          this.localGameInstance.SendMessage(
            'EventManager',
            'HandleKeyboard',
            'false'
          );
        },
      }
    );
  }
}
