(self.webpackChunkclient=self.webpackChunkclient||[]).push([[195],{9195:(pi,ve,st)=>{"use strict";st.r(ve),st.d(ve,{TooltipOptions:()=>v0,WarehouseModule:()=>L2});var le=st(6895),ai=st(5588),_=st(4650),mt=st(4006),ye=st(4004),me=st(7579),oe=st(6063);class jt extends me.x{constructor(t=1/0,e=1/0,i=oe.l){super(),this._bufferSize=t,this._windowTime=e,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,e)}next(t){const{isStopped:e,_buffer:i,_infiniteTimeWindow:s,_timestampProvider:r,_windowTime:o}=this;e||(i.push(t),!s&&i.push(r.now()+o)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(t),{_infiniteTimeWindow:i,_buffer:s}=this,r=s.slice();for(let o=0;o<r.length&&!t.closed;o+=i?1:2)t.next(r[o]);return this._checkFinalizedStatuses(t),e}_trimBuffer(){const{_bufferSize:t,_timestampProvider:e,_buffer:i,_infiniteTimeWindow:s}=this,r=(s?1:2)*t;if(t<1/0&&r<i.length&&i.splice(0,i.length-r),!s){const o=e.now();let a=0;for(let l=1;l<i.length&&i[l]<=o;l+=2)a=l;a&&i.splice(0,a+1)}}}var fe=st(3099),We=st(262),Ce=st(9646),Ke=st(4128),Jt=st(9751),Nt=st(5861);const z=100,Wi=1001,xi=1003,vi=1006,Gs=1008,zs=1009,Hs=1014,xs=1015,Po=1016,Cr=1020,gn=1023,Ws=1026,Ir=1027,Vs=3e3,ii=3001,Hn="srgb",Do="srgb-linear";class Ys{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const s=this._listeners[t];if(void 0!==s){const r=s.indexOf(e);-1!==r&&s.splice(r,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const i=this._listeners[t.type];if(void 0!==i){t.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,t);t.target=null}}}const Gi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Zs=Math.PI/180,Lo=180/Math.PI;function sn(){const n=4294967295*Math.random()|0,t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Gi[255&n]+Gi[n>>8&255]+Gi[n>>16&255]+Gi[n>>24&255]+"-"+Gi[255&t]+Gi[t>>8&255]+"-"+Gi[t>>16&15|64]+Gi[t>>24&255]+"-"+Gi[63&e|128]+Gi[e>>8&255]+"-"+Gi[e>>16&255]+Gi[e>>24&255]+Gi[255&i]+Gi[i>>8&255]+Gi[i>>16&255]+Gi[i>>24&255]).toLowerCase()}function mi(n,t,e){return Math.max(t,Math.min(e,n))}function Oo(n,t,e){return(1-e)*n+e*t}function Qh(n){return 0==(n&n-1)&&0!==n}function Ga(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function ts(n,t){switch(t.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function ti(n,t){switch(t.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}class ft{constructor(t=0,e=0){ft.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*s+t.x,this.y=r*s+o*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ji{constructor(){Ji.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,s,r,o,a,l,h){const c=this.elements;return c[0]=t,c[1]=s,c[2]=a,c[3]=e,c[4]=r,c[5]=l,c[6]=i,c[7]=o,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,o=i[0],a=i[3],l=i[6],h=i[1],c=i[4],u=i[7],d=i[2],f=i[5],p=i[8],m=s[0],g=s[3],x=s[6],v=s[1],y=s[4],b=s[7],M=s[2],S=s[5],A=s[8];return r[0]=o*m+a*v+l*M,r[3]=o*g+a*y+l*S,r[6]=o*x+a*b+l*A,r[1]=h*m+c*v+u*M,r[4]=h*g+c*y+u*S,r[7]=h*x+c*b+u*A,r[2]=d*m+f*v+p*M,r[5]=d*g+f*y+p*S,r[8]=d*x+f*b+p*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8];return e*o*c-e*a*h-i*r*c+i*a*l+s*r*h-s*o*l}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=c*o-a*h,d=a*l-c*r,f=h*r-o*l,p=e*u+i*d+s*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=u*m,t[1]=(s*h-c*i)*m,t[2]=(a*i-s*o)*m,t[3]=d*m,t[4]=(c*e-s*l)*m,t[5]=(s*r-a*e)*m,t[6]=f*m,t[7]=(i*l-h*e)*m,t[8]=(o*e-i*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,o,a){const l=Math.cos(r),h=Math.sin(r);return this.set(i*l,i*h,-i*(l*o+h*a)+o+t,-s*h,s*l,-s*(-h*o+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(tc.makeScale(t,e)),this}rotate(t){return this.premultiply(tc.makeRotation(-t)),this}translate(t,e){return this.premultiply(tc.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const tc=new Ji;function yf(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Bo(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function $s(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function za(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const ec={[Hn]:{[Do]:$s},[Do]:{[Hn]:za}},Vi={legacyMode:!0,get workingColorSpace(){return Do},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,t,e){if(this.legacyMode||t===e||!t||!e)return n;if(ec[t]&&void 0!==ec[t][e]){const i=ec[t][e];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,t){return this.convert(n,this.workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this.workingColorSpace)}},xf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ei={r:0,g:0,b:0},Sn={h:0,s:0,l:0},Ha={h:0,s:0,l:0};function ic(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+6*(t-n)*e:e<.5?t:e<2/3?n+6*(t-n)*(2/3-e):n}function Wa(n,t){return t.r=n.r,t.g=n.g,t.b=n.b,t}let Lr,Gt=(()=>{class n{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===i&&void 0===s?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Hn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Vi.toWorkingColorSpace(this,i),this}setRGB(e,i,s,r=Vi.workingColorSpace){return this.r=e,this.g=i,this.b=s,Vi.toWorkingColorSpace(this,r),this}setHSL(e,i,s,r=Vi.workingColorSpace){if(e=function Kh(n,t){return(n%t+t)%t}(e,1),i=mi(i,0,1),s=mi(s,0,1),0===i)this.r=this.g=this.b=s;else{const o=s<=.5?s*(1+i):s+i-s*i,a=2*s-o;this.r=ic(a,o,e+1/3),this.g=ic(a,o,e),this.b=ic(a,o,e-1/3)}return Vi.toWorkingColorSpace(this,r),this}setStyle(e,i=Hn){function s(o){void 0!==o&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o;const l=r[2];switch(r[1]){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Vi.toWorkingColorSpace(this,i),s(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Vi.toWorkingColorSpace(this,i),s(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const h=parseFloat(o[1])/360,c=parseFloat(o[2])/100,u=parseFloat(o[3])/100;return s(o[4]),this.setHSL(h,c,u,i)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],a=o.length;if(3===a)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Vi.toWorkingColorSpace(this,i),this;if(6===a)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Vi.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i=Hn){const s=xf[e.toLowerCase()];return void 0!==s?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=$s(e.r),this.g=$s(e.g),this.b=$s(e.b),this}copyLinearToSRGB(e){return this.r=za(e.r),this.g=za(e.g),this.b=za(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Hn){return Vi.fromWorkingColorSpace(Wa(this,Ei),e),mi(255*Ei.r,0,255)<<16^mi(255*Ei.g,0,255)<<8^mi(255*Ei.b,0,255)<<0}getHexString(e=Hn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Vi.workingColorSpace){Vi.fromWorkingColorSpace(Wa(this,Ei),i);const s=Ei.r,r=Ei.g,o=Ei.b,a=Math.max(s,r,o),l=Math.min(s,r,o);let h,c;const u=(l+a)/2;if(l===a)h=0,c=0;else{const d=a-l;switch(c=u<=.5?d/(a+l):d/(2-a-l),a){case s:h=(r-o)/d+(r<o?6:0);break;case r:h=(o-s)/d+2;break;case o:h=(s-r)/d+4}h/=6}return e.h=h,e.s=c,e.l=u,e}getRGB(e,i=Vi.workingColorSpace){return Vi.fromWorkingColorSpace(Wa(this,Ei),i),e.r=Ei.r,e.g=Ei.g,e.b=Ei.b,e}getStyle(e=Hn){return Vi.fromWorkingColorSpace(Wa(this,Ei),e),e!==Hn?`color(${e} ${Ei.r} ${Ei.g} ${Ei.b})`:`rgb(${255*Ei.r|0},${255*Ei.g|0},${255*Ei.b|0})`}offsetHSL(e,i,s){return this.getHSL(Sn),Sn.h+=e,Sn.s+=i,Sn.l+=s,this.setHSL(Sn.h,Sn.s,Sn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Sn),e.getHSL(Ha);const s=Oo(Sn.h,Ha.h,i),r=Oo(Sn.s,Ha.s,i),o=Oo(Sn.l,Ha.l,i);return this.setHSL(s,r,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}return n.NAMES=xf,n})();class vf{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Lr&&(Lr=Bo("canvas")),Lr.width=t.width,Lr.height=t.height;const i=Lr.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Lr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Bo("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=255*$s(r[o]/255);return i.putImageData(s,0,0),e}if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e[i]=e instanceof Uint8Array||e instanceof Uint8ClampedArray?Math.floor(255*$s(e[i]/255)):$s(e[i]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Or{constructor(t=null){this.isSource=!0,this.uuid=sn(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(null!==s){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)r.push(nc(s[o].isDataTexture?s[o].image:s[o]))}else r=nc(s);i.url=r}return e||(t.images[this.uuid]=i),i}}function nc(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?vf.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gy=0,Tn=(()=>{class n extends Ys{constructor(e=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,s=Wi,r=Wi,o=vi,a=Gs,l=gn,h=zs,c=n.DEFAULT_ANISOTROPY,u=Vs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gy++}),this.uuid=sn(),this.name="",this.source=new Or(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=c,this.format=l,this.internalFormat=null,this.type=h,this.offset=new ft(0,0),this.repeat=new ft(1,1),this.center=new ft(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ji,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case Wi:e.x=e.x<0?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case Wi:e.y=e.y<0?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class qe{constructor(t=0,e=0,i=0,s=1){qe.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,r;const l=t.elements,h=l[0],c=l[4],u=l[8],d=l[1],f=l[5],p=l[9],m=l[2],g=l[6],x=l[10];if(Math.abs(c-d)<.01&&Math.abs(u-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(u+m)<.1&&Math.abs(p+g)<.1&&Math.abs(h+f+x-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const y=(h+1)/2,b=(f+1)/2,M=(x+1)/2,S=(c+d)/4,A=(u+m)/4,w=(p+g)/4;return y>b&&y>M?y<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(y),s=S/i,r=A/i):b>M?b<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(b),i=S/s,r=w/s):M<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(M),i=A/r,s=w/r),this.set(i,s,r,e),this}let v=Math.sqrt((g-p)*(g-p)+(u-m)*(u-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(g-p)/v,this.y=(u-m)/v,this.z=(d-c)/v,this.w=Math.acos((h+f+x-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class qs extends Ys{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new qe(0,0,t,e),this.scissorTest=!1,this.viewport=new qe(0,0,t,e),this.texture=new Tn({width:t,height:e,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:vi,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Or(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class sc extends Tn{constructor(t=null,e=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=xi,this.minFilter=xi,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bf extends Tn{constructor(t=null,e=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=xi,this.minFilter=xi,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Xi{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,o,a){let l=i[s+0],h=i[s+1],c=i[s+2],u=i[s+3];const d=r[o+0],f=r[o+1],p=r[o+2],m=r[o+3];if(0===a)return t[e+0]=l,t[e+1]=h,t[e+2]=c,void(t[e+3]=u);if(1===a)return t[e+0]=d,t[e+1]=f,t[e+2]=p,void(t[e+3]=m);if(u!==m||l!==d||h!==f||c!==p){let g=1-a;const x=l*d+h*f+c*p+u*m,v=x>=0?1:-1,y=1-x*x;if(y>Number.EPSILON){const M=Math.sqrt(y),S=Math.atan2(M,x*v);g=Math.sin(g*S)/M,a=Math.sin(a*S)/M}const b=a*v;if(l=l*g+d*b,h=h*g+f*b,c=c*g+p*b,u=u*g+m*b,g===1-a){const M=1/Math.sqrt(l*l+h*h+c*c+u*u);l*=M,h*=M,c*=M,u*=M}}t[e]=l,t[e+1]=h,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,s,r,o){const a=i[s],l=i[s+1],h=i[s+2],c=i[s+3],u=r[o],d=r[o+1],f=r[o+2],p=r[o+3];return t[e]=a*p+c*u+l*f-h*d,t[e+1]=l*p+c*d+h*u-a*f,t[e+2]=h*p+c*f+a*d-l*u,t[e+3]=c*p-a*u-l*d-h*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,s=t._y,r=t._z,o=t._order,a=Math.cos,l=Math.sin,h=a(i/2),c=a(s/2),u=a(r/2),d=l(i/2),f=l(s/2),p=l(r/2);switch(o){case"XYZ":this._x=d*c*u+h*f*p,this._y=h*f*u-d*c*p,this._z=h*c*p+d*f*u,this._w=h*c*u-d*f*p;break;case"YXZ":this._x=d*c*u+h*f*p,this._y=h*f*u-d*c*p,this._z=h*c*p-d*f*u,this._w=h*c*u+d*f*p;break;case"ZXY":this._x=d*c*u-h*f*p,this._y=h*f*u+d*c*p,this._z=h*c*p+d*f*u,this._w=h*c*u-d*f*p;break;case"ZYX":this._x=d*c*u-h*f*p,this._y=h*f*u+d*c*p,this._z=h*c*p-d*f*u,this._w=h*c*u+d*f*p;break;case"YZX":this._x=d*c*u+h*f*p,this._y=h*f*u+d*c*p,this._z=h*c*p-d*f*u,this._w=h*c*u-d*f*p;break;case"XZY":this._x=d*c*u-h*f*p,this._y=h*f*u-d*c*p,this._z=h*c*p+d*f*u,this._w=h*c*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],o=e[1],a=e[5],l=e[9],h=e[2],c=e[6],u=e[10],d=i+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(r-h)*f,this._z=(o-s)*f}else if(i>a&&i>u){const f=2*Math.sqrt(1+i-a-u);this._w=(c-l)/f,this._x=.25*f,this._y=(s+o)/f,this._z=(r+h)/f}else if(a>u){const f=2*Math.sqrt(1+a-i-u);this._w=(r-h)/f,this._x=(s+o)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+u-i-a);this._w=(o-s)/f,this._x=(r+h)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(mi(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,o=t._w,a=e._x,l=e._y,h=e._z,c=e._w;return this._x=i*c+o*a+s*h-r*l,this._y=s*c+o*l+r*a-i*h,this._z=r*c+o*h+i*l-s*a,this._w=o*c-i*a-s*l-r*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*t._w+i*t._x+s*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*i+e*this._x,this._y=f*s+e*this._y,this._z=f*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),c=Math.atan2(h,a),u=Math.sin((1-e)*c)/h,d=Math.sin(e*c)/h;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class P{constructor(t=0,e=0,i=0){P.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(wf.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(wf.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,o=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,o=t.y,a=t.z,l=t.w,h=l*e+o*s-a*i,c=l*i+a*e-r*s,u=l*s+r*i-o*e,d=-r*e-o*i-a*s;return this.x=h*l+d*-r+c*-a-u*-o,this.y=c*l+d*-o+u*-r-h*-a,this.z=u*l+d*-a+h*-o-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,o=e.x,a=e.y,l=e.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return rc.copy(this).projectOnVector(t),this.sub(rc)}reflect(t){return this.sub(rc.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(mi(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rc=new P,wf=new Xi;class Br{constructor(t=new P(1/0,1/0,1/0),e=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,h=t.length;l<h;l+=3){const c=t[l],u=t[l+1],d=t[l+2];c<e&&(e=c),u<i&&(i=u),d<s&&(s=d),c>r&&(r=c),u>o&&(o=u),d>a&&(a=d)}return this.min.set(e,i,s),this.max.set(r,o,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,h=t.count;l<h;l++){const c=t.getX(l),u=t.getY(l),d=t.getZ(l);c<e&&(e=c),u<i&&(i=u),d<s&&(s=d),c>r&&(r=c),u>o&&(o=u),d>a&&(a=d)}return this.min.set(e,i,s),this.max.set(r,o,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=js.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const r=i.attributes.position;for(let o=0,a=r.count;o<a;o++)js.fromBufferAttribute(r,o).applyMatrix4(t.matrixWorld),this.expandByPoint(js)}else null===i.boundingBox&&i.computeBoundingBox(),oc.copy(i.boundingBox),oc.applyMatrix4(t.matrixWorld),this.union(oc);const s=t.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,js),js.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Fo),Va.subVectors(this.max,Fo),Fr.subVectors(t.a,Fo),Nr.subVectors(t.b,Fo),Ur.subVectors(t.c,Fo),vs.subVectors(Nr,Fr),bs.subVectors(Ur,Nr),Js.subVectors(Fr,Ur);let e=[0,-vs.z,vs.y,0,-bs.z,bs.y,0,-Js.z,Js.y,vs.z,0,-vs.x,bs.z,0,-bs.x,Js.z,0,-Js.x,-vs.y,vs.x,0,-bs.y,bs.x,0,-Js.y,Js.x,0];return!(!ac(e,Fr,Nr,Ur,Va)||(e=[1,0,0,0,1,0,0,0,1],!ac(e,Fr,Nr,Ur,Va)))&&(Xa.crossVectors(vs,bs),e=[Xa.x,Xa.y,Xa.z],ac(e,Fr,Nr,Ur,Va))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return js.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(js).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(es[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),es[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),es[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),es[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),es[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),es[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),es[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),es[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(es)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const es=[new P,new P,new P,new P,new P,new P,new P,new P],js=new P,oc=new Br,Fr=new P,Nr=new P,Ur=new P,vs=new P,bs=new P,Js=new P,Fo=new P,Va=new P,Xa=new P,Ks=new P;function ac(n,t,e,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){Ks.fromArray(n,r);const a=s.x*Math.abs(Ks.x)+s.y*Math.abs(Ks.y)+s.z*Math.abs(Ks.z),l=t.dot(Ks),h=e.dot(Ks),c=i.dot(Ks);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>a)return!1}return!0}const _y=new Br,No=new P,lc=new P;class kr{constructor(t=new P,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):_y.setFromPoints(t).getCenter(i);let s=0;for(let r=0,o=t.length;r<o;r++)s=Math.max(s,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;No.subVectors(t,this.center);const e=No.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=.5*(i-this.radius);this.center.addScaledVector(No,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(lc.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(No.copy(t.center).add(lc)),this.expandByPoint(No.copy(t.center).sub(lc))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const is=new P,hc=new P,Ya=new P,ws=new P,cc=new P,Za=new P,uc=new P;class $a{constructor(t=new P,e=new P(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,is)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=is.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(is.copy(this.direction).multiplyScalar(e).add(this.origin),is.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){hc.copy(t).add(e).multiplyScalar(.5),Ya.copy(e).sub(t).normalize(),ws.copy(this.origin).sub(hc);const r=.5*t.distanceTo(e),o=-this.direction.dot(Ya),a=ws.dot(this.direction),l=-ws.dot(Ya),h=ws.lengthSq(),c=Math.abs(1-o*o);let u,d,f,p;if(c>0)if(u=o*l-a,d=o*a-l,p=r*c,u>=0)if(d>=-p)if(d<=p){const m=1/c;u*=m,d*=m,f=u*(u+o*d+2*a)+d*(o*u+d+2*l)+h}else d=r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+h;else d=-r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+h;else d<=-p?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+h):d<=p?(u=0,d=Math.min(Math.max(-r,-l),r),f=d*(d+2*l)+h):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+h);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+h;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),s&&s.copy(Ya).multiplyScalar(d).add(hc),f}intersectSphere(t,e){is.subVectors(t.center,this.origin);const i=is.dot(this.direction),s=is.dot(is)-i*i,r=t.radius*t.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return a<0&&l<0?null:this.at(a<0?l:a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,r,o,a,l;const h=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return h>=0?(i=(t.min.x-d.x)*h,s=(t.max.x-d.x)*h):(i=(t.max.x-d.x)*h,s=(t.min.x-d.x)*h),c>=0?(r=(t.min.y-d.y)*c,o=(t.max.y-d.y)*c):(r=(t.max.y-d.y)*c,o=(t.min.y-d.y)*c),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),u>=0?(a=(t.min.z-d.z)*u,l=(t.max.z-d.z)*u):(a=(t.max.z-d.z)*u,l=(t.min.z-d.z)*u),i>l||a>s)||((a>i||i!=i)&&(i=a),(l<s||s!=s)&&(s=l),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return null!==this.intersectBox(t,is)}intersectTriangle(t,e,i,s,r){cc.subVectors(e,t),Za.subVectors(i,t),uc.crossVectors(cc,Za);let a,o=this.direction.dot(uc);if(o>0){if(s)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}ws.subVectors(this.origin,t);const l=a*this.direction.dot(Za.crossVectors(ws,Za));if(l<0)return null;const h=a*this.direction.dot(cc.cross(ws));if(h<0||l+h>o)return null;const c=-a*ws.dot(uc);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Me{constructor(){Me.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,s,r,o,a,l,h,c,u,d,f,p,m,g){const x=this.elements;return x[0]=t,x[4]=e,x[8]=i,x[12]=s,x[1]=r,x[5]=o,x[9]=a,x[13]=l,x[2]=h,x[6]=c,x[10]=u,x[14]=d,x[3]=f,x[7]=p,x[11]=m,x[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Me).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/Gr.setFromMatrixColumn(t,0).length(),r=1/Gr.setFromMatrixColumn(t,1).length(),o=1/Gr.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,r=t.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),h=Math.sin(s),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const d=o*c,f=o*u,p=a*c,m=a*u;e[0]=l*c,e[4]=-l*u,e[8]=h,e[1]=f+p*h,e[5]=d-m*h,e[9]=-a*l,e[2]=m-d*h,e[6]=p+f*h,e[10]=o*l}else if("YXZ"===t.order){const d=l*c,f=l*u,p=h*c,m=h*u;e[0]=d+m*a,e[4]=p*a-f,e[8]=o*h,e[1]=o*u,e[5]=o*c,e[9]=-a,e[2]=f*a-p,e[6]=m+d*a,e[10]=o*l}else if("ZXY"===t.order){const d=l*c,f=l*u,p=h*c,m=h*u;e[0]=d-m*a,e[4]=-o*u,e[8]=p+f*a,e[1]=f+p*a,e[5]=o*c,e[9]=m-d*a,e[2]=-o*h,e[6]=a,e[10]=o*l}else if("ZYX"===t.order){const d=o*c,f=o*u,p=a*c,m=a*u;e[0]=l*c,e[4]=p*h-f,e[8]=d*h+m,e[1]=l*u,e[5]=m*h+d,e[9]=f*h-p,e[2]=-h,e[6]=a*l,e[10]=o*l}else if("YZX"===t.order){const d=o*l,f=o*h,p=a*l,m=a*h;e[0]=l*c,e[4]=m-d*u,e[8]=p*u+f,e[1]=u,e[5]=o*c,e[9]=-a*c,e[2]=-h*c,e[6]=f*u+p,e[10]=d-m*u}else if("XZY"===t.order){const d=o*l,f=o*h,p=a*l,m=a*h;e[0]=l*c,e[4]=-u,e[8]=h*c,e[1]=d*u+m,e[5]=o*c,e[9]=f*u-p,e[2]=p*u-f,e[6]=a*c,e[10]=m*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(yy,t,xy)}lookAt(t,e,i){const s=this.elements;return rn.subVectors(t,e),0===rn.lengthSq()&&(rn.z=1),rn.normalize(),Ms.crossVectors(i,rn),0===Ms.lengthSq()&&(1===Math.abs(i.z)?rn.x+=1e-4:rn.z+=1e-4,rn.normalize(),Ms.crossVectors(i,rn)),Ms.normalize(),qa.crossVectors(rn,Ms),s[0]=Ms.x,s[4]=qa.x,s[8]=rn.x,s[1]=Ms.y,s[5]=qa.y,s[9]=rn.y,s[2]=Ms.z,s[6]=qa.z,s[10]=rn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,o=i[0],a=i[4],l=i[8],h=i[12],c=i[1],u=i[5],d=i[9],f=i[13],p=i[2],m=i[6],g=i[10],x=i[14],v=i[3],y=i[7],b=i[11],M=i[15],S=s[0],A=s[4],w=s[8],T=s[12],C=s[1],F=s[5],Y=s[9],O=s[13],D=s[2],V=s[6],X=s[10],j=s[14],$=s[3],et=s[7],pt=s[11],J=s[15];return r[0]=o*S+a*C+l*D+h*$,r[4]=o*A+a*F+l*V+h*et,r[8]=o*w+a*Y+l*X+h*pt,r[12]=o*T+a*O+l*j+h*J,r[1]=c*S+u*C+d*D+f*$,r[5]=c*A+u*F+d*V+f*et,r[9]=c*w+u*Y+d*X+f*pt,r[13]=c*T+u*O+d*j+f*J,r[2]=p*S+m*C+g*D+x*$,r[6]=p*A+m*F+g*V+x*et,r[10]=p*w+m*Y+g*X+x*pt,r[14]=p*T+m*O+g*j+x*J,r[3]=v*S+y*C+b*D+M*$,r[7]=v*A+y*F+b*V+M*et,r[11]=v*w+y*Y+b*X+M*pt,r[15]=v*T+y*O+b*j+M*J,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],o=t[1],a=t[5],l=t[9],h=t[13],c=t[2],u=t[6],d=t[10],f=t[14];return t[3]*(+r*l*u-s*h*u-r*a*d+i*h*d+s*a*f-i*l*f)+t[7]*(+e*l*f-e*h*d+r*o*d-s*o*f+s*h*c-r*l*c)+t[11]*(+e*h*u-e*a*f-r*o*u+i*o*f+r*a*c-i*h*c)+t[15]*(-s*a*c-e*l*u+e*a*d+s*o*u-i*o*d+i*l*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],x=t[15],v=u*g*h-m*d*h+m*l*f-a*g*f-u*l*x+a*d*x,y=p*d*h-c*g*h-p*l*f+o*g*f+c*l*x-o*d*x,b=c*m*h-p*u*h+p*a*f-o*m*f-c*a*x+o*u*x,M=p*u*l-c*m*l-p*a*d+o*m*d+c*a*g-o*u*g,S=e*v+i*y+s*b+r*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/S;return t[0]=v*A,t[1]=(m*d*r-u*g*r-m*s*f+i*g*f+u*s*x-i*d*x)*A,t[2]=(a*g*r-m*l*r+m*s*h-i*g*h-a*s*x+i*l*x)*A,t[3]=(u*l*r-a*d*r-u*s*h+i*d*h+a*s*f-i*l*f)*A,t[4]=y*A,t[5]=(c*g*r-p*d*r+p*s*f-e*g*f-c*s*x+e*d*x)*A,t[6]=(p*l*r-o*g*r-p*s*h+e*g*h+o*s*x-e*l*x)*A,t[7]=(o*d*r-c*l*r+c*s*h-e*d*h-o*s*f+e*l*f)*A,t[8]=b*A,t[9]=(p*u*r-c*m*r-p*i*f+e*m*f+c*i*x-e*u*x)*A,t[10]=(o*m*r-p*a*r+p*i*h-e*m*h-o*i*x+e*a*x)*A,t[11]=(c*a*r-o*u*r-c*i*h+e*u*h+o*i*f-e*a*f)*A,t[12]=M*A,t[13]=(c*m*s-p*u*s+p*i*d-e*m*d-c*i*g+e*u*g)*A,t[14]=(p*a*s-o*m*s-p*i*l+e*m*l+o*i*g-e*a*g)*A,t[15]=(o*u*s-c*a*s+c*i*l-e*u*l-o*i*d+e*a*d)*A,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,o=t.x,a=t.y,l=t.z,h=r*o,c=r*a;return this.set(h*o+i,h*a-s*l,h*l+s*a,0,h*a+s*l,c*a+i,c*l-s*o,0,h*l-s*a,c*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,o){return this.set(1,i,r,0,t,1,o,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,o=e._y,a=e._z,l=e._w,h=r+r,c=o+o,u=a+a,d=r*h,f=r*c,p=r*u,m=o*c,g=o*u,x=a*u,v=l*h,y=l*c,b=l*u,M=i.x,S=i.y,A=i.z;return s[0]=(1-(m+x))*M,s[1]=(f+b)*M,s[2]=(p-y)*M,s[3]=0,s[4]=(f-b)*S,s[5]=(1-(d+x))*S,s[6]=(g+v)*S,s[7]=0,s[8]=(p+y)*A,s[9]=(g-v)*A,s[10]=(1-(d+m))*A,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=Gr.set(s[0],s[1],s[2]).length();const o=Gr.set(s[4],s[5],s[6]).length(),a=Gr.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],En.copy(this);const h=1/r,c=1/o,u=1/a;return En.elements[0]*=h,En.elements[1]*=h,En.elements[2]*=h,En.elements[4]*=c,En.elements[5]*=c,En.elements[6]*=c,En.elements[8]*=u,En.elements[9]*=u,En.elements[10]*=u,e.setFromRotationMatrix(En),i.x=r,i.y=o,i.z=a,this}makePerspective(t,e,i,s,r,o){const a=this.elements,h=2*r/(i-s),c=(e+t)/(e-t),u=(i+s)/(i-s),d=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=2*r/(e-t),a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=h,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,s,r,o){const a=this.elements,l=1/(e-t),h=1/(i-s),c=1/(o-r),u=(e+t)*l,d=(i+s)*h,f=(o+r)*c;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const Gr=new P,En=new Me,yy=new P(0,0,0),xy=new P(1,1,1),Ms=new P,qa=new P,rn=new P,Mf=new Me,Sf=new Xi;let vy=(()=>{class n{constructor(e=0,i=0,s=0,r=n.DefaultOrder){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,o=r[0],a=r[4],l=r[8],h=r[1],c=r[5],u=r[9],d=r[2],f=r[6],p=r[10];switch(i){case"XYZ":this._y=Math.asin(mi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-mi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(mi(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(h,o));break;case"ZYX":this._y=Math.asin(-mi(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(mi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-mi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===s&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return Mf.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mf,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return Sf.setFromEuler(this),this.setFromQuaternion(Sf,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}return n.DefaultOrder="XYZ",n.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n})();class dc{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let by=0;const Tf=new P,zr=new Xi,ns=new Me,ja=new P,Uo=new P,wy=new P,My=new Xi,Ef=new P(1,0,0),Af=new P(0,1,0),Cf=new P(0,0,1),Sy={type:"added"},If={type:"removed"};let _n=(()=>{class n extends Ys{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:by++}),this.uuid=sn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DefaultUp.clone();const e=new P,i=new vy,s=new Xi,r=new P(1,1,1);i._onChange(function o(){s.setFromEuler(i,!1)}),s._onChange(function a(){i.setFromQuaternion(s,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Me},normalMatrix:{value:new Ji}}),this.matrix=new Me,this.matrixWorld=new Me,this.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DefaultMatrixWorldAutoUpdate,this.layers=new dc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return zr.setFromAxisAngle(e,i),this.quaternion.multiply(zr),this}rotateOnWorldAxis(e,i){return zr.setFromAxisAngle(e,i),this.quaternion.premultiply(zr),this}rotateX(e){return this.rotateOnAxis(Ef,e)}rotateY(e){return this.rotateOnAxis(Af,e)}rotateZ(e){return this.rotateOnAxis(Cf,e)}translateOnAxis(e,i){return Tf.copy(e).applyQuaternion(this.quaternion),this.position.add(Tf.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(Ef,e)}translateY(e){return this.translateOnAxis(Af,e)}translateZ(e){return this.translateOnAxis(Cf,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ns.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?ja.copy(e):ja.set(e,i,s);const r=this.parent;this.updateWorldMatrix(!0,!1),Uo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ns.lookAt(Uo,ja,this.up):ns.lookAt(ja,Uo,this.up),this.quaternion.setFromRotationMatrix(ns),r&&(ns.extractRotation(r.matrixWorld),zr.setFromRotationMatrix(ns),this.quaternion.premultiply(zr.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Sy)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return-1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(If)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const i=this.children[e];i.parent=null,i.dispatchEvent(If)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ns.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ns.multiply(e.parent.matrixWorld)),e.applyMatrix4(ns),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,r=this.children.length;s<r;s++){const a=this.children[s].getObjectByProperty(e,i);if(void 0!==a)return a}}getObjectsByProperty(e,i){let s=[];this[e]===i&&s.push(this);for(let r=0,o=this.children.length;r<o;r++){const a=this.children[r].getObjectsByProperty(e,i);a.length>0&&(s=s.concat(a))}return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uo,e,wy),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uo,My,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;null!==i&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,r=i.length;s<r;s++){const o=i[s];(!0===o.matrixWorldAutoUpdate||!0===e)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const s=this.parent;if(!0===e&&null!==s&&!0===s.matrixWorldAutoUpdate&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const r=this.children;for(let o=0,a=r.length;o<a;o++){const l=r[o];!0===l.matrixWorldAutoUpdate&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=void 0===e||"string"==typeof e,s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function o(l,h){return void 0===l[h.uuid]&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const h=l.shapes;if(Array.isArray(h))for(let c=0,u=h.length;c<u;c++)o(e.shapes,h[c]);else o(e.shapes,h)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let h=0,c=this.material.length;h<c;h++)l.push(o(e.materials,this.material[h]));r.material=l}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++)r.animations.push(o(e.animations,this.animations[l]))}if(i){const l=a(e.geometries),h=a(e.materials),c=a(e.textures),u=a(e.images),d=a(e.shapes),f=a(e.skeletons),p=a(e.animations),m=a(e.nodes);l.length>0&&(s.geometries=l),h.length>0&&(s.materials=h),c.length>0&&(s.textures=c),u.length>0&&(s.images=u),d.length>0&&(s.shapes=d),f.length>0&&(s.skeletons=f),p.length>0&&(s.animations=p),m.length>0&&(s.nodes=m)}return s.object=r,s;function a(l){const h=[];for(const c in l){const u=l[c];delete u.metadata,h.push(u)}return h}}clone(e){return(new this.constructor).copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===i)for(let s=0;s<e.children.length;s++)this.add(e.children[s].clone());return this}}return n.DefaultUp=new P(0,1,0),n.DefaultMatrixAutoUpdate=!0,n.DefaultMatrixWorldAutoUpdate=!0,n})();const An=new P,ss=new P,fc=new P,rs=new P,Hr=new P,Wr=new P,Rf=new P,pc=new P,mc=new P,gc=new P;class Cn{constructor(t=new P,e=new P,i=new P){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),An.subVectors(t,e),s.cross(An);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,i,s,r){An.subVectors(s,e),ss.subVectors(i,e),fc.subVectors(t,e);const o=An.dot(An),a=An.dot(ss),l=An.dot(fc),h=ss.dot(ss),c=ss.dot(fc),u=o*h-a*a;if(0===u)return r.set(-2,-1,-1);const d=1/u,f=(h*l-a*c)*d,p=(o*c-a*l)*d;return r.set(1-f-p,p,f)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,rs),rs.x>=0&&rs.y>=0&&rs.x+rs.y<=1}static getUV(t,e,i,s,r,o,a,l){return this.getBarycoord(t,e,i,s,rs),l.set(0,0),l.addScaledVector(r,rs.x),l.addScaledVector(o,rs.y),l.addScaledVector(a,rs.z),l}static isFrontFacing(t,e,i,s){return An.subVectors(i,e),ss.subVectors(t,e),An.cross(ss).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return An.subVectors(this.c,this.b),ss.subVectors(this.a,this.b),.5*An.cross(ss).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Cn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Cn.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,s,r){return Cn.getUV(t,this.a,this.b,this.c,e,i,s,r)}containsPoint(t){return Cn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Cn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,r=this.c;let o,a;Hr.subVectors(s,i),Wr.subVectors(r,i),pc.subVectors(t,i);const l=Hr.dot(pc),h=Wr.dot(pc);if(l<=0&&h<=0)return e.copy(i);mc.subVectors(t,s);const c=Hr.dot(mc),u=Wr.dot(mc);if(c>=0&&u<=c)return e.copy(s);const d=l*u-c*h;if(d<=0&&l>=0&&c<=0)return o=l/(l-c),e.copy(i).addScaledVector(Hr,o);gc.subVectors(t,r);const f=Hr.dot(gc),p=Wr.dot(gc);if(p>=0&&f<=p)return e.copy(r);const m=f*h-l*p;if(m<=0&&h>=0&&p<=0)return a=h/(h-p),e.copy(i).addScaledVector(Wr,a);const g=c*p-f*u;if(g<=0&&u-c>=0&&f-p>=0)return Rf.subVectors(r,s),a=(u-c)/(u-c+(f-p)),e.copy(s).addScaledVector(Rf,a);const x=1/(g+m+d);return o=m*x,a=d*x,e.copy(i).addScaledVector(Hr,o).addScaledVector(Wr,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Ty=0;class ko extends Ys{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ty++}),this.uuid=sn(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=z,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}const s=this[e];void 0!==s?s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const r=s(t.textures),o=s(t.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Ki extends ko{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Gt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const bi=new P,Ja=new ft;class Pi{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Ja.fromBufferAttribute(this,e),Ja.applyMatrix3(t),this.setXY(e,Ja.x,Ja.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)bi.fromBufferAttribute(this,e),bi.applyMatrix3(t),this.setXYZ(e,bi.x,bi.y,bi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)bi.fromBufferAttribute(this,e),bi.applyMatrix4(t),this.setXYZ(e,bi.x,bi.y,bi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)bi.fromBufferAttribute(this,e),bi.applyNormalMatrix(t),this.setXYZ(e,bi.x,bi.y,bi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)bi.fromBufferAttribute(this,e),bi.transformDirection(t),this.setXYZ(e,bi.x,bi.y,bi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ts(e,this.array)),e}setX(t,e){return this.normalized&&(e=ti(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ts(e,this.array)),e}setY(t,e){return this.normalized&&(e=ti(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ts(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ti(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ts(e,this.array)),e}setW(t,e){return this.normalized&&(e=ti(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=ti(e,this.array),i=ti(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=ti(e,this.array),i=ti(i,this.array),s=ti(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t*=this.itemSize,this.normalized&&(e=ti(e,this.array),i=ti(i,this.array),s=ti(s,this.array),r=ti(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Pf extends Pi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Df extends Pi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ht extends Pi{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Ey=0;const yn=new Me,_c=new _n,Vr=new P,on=new Br,Go=new Br,Di=new P;class Ie extends Ys{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ey++}),this.uuid=sn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return this.index=Array.isArray(t)?new(yf(t)?Df:Pf)(t,1):t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const r=(new Ji).getNormalMatrix(t);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(t),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return yn.makeRotationFromQuaternion(t),this.applyMatrix4(yn),this}rotateX(t){return yn.makeRotationX(t),this.applyMatrix4(yn),this}rotateY(t){return yn.makeRotationY(t),this.applyMatrix4(yn),this}rotateZ(t){return yn.makeRotationZ(t),this.applyMatrix4(yn),this}translate(t,e,i){return yn.makeTranslation(t,e,i),this.applyMatrix4(yn),this}scale(t,e,i){return yn.makeScale(t,e,i),this.applyMatrix4(yn),this}lookAt(t){return _c.lookAt(t),_c.updateMatrix(),this.applyMatrix4(_c.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vr).negate(),this.translate(Vr.x,Vr.y,Vr.z),this}setFromPoints(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ht(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Br);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++)on.setFromBufferAttribute(e[i]),this.morphTargetsRelative?(Di.addVectors(this.boundingBox.min,on.min),this.boundingBox.expandByPoint(Di),Di.addVectors(this.boundingBox.max,on.max),this.boundingBox.expandByPoint(Di)):(this.boundingBox.expandByPoint(on.min),this.boundingBox.expandByPoint(on.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new kr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new P,1/0);if(t){const i=this.boundingSphere.center;if(on.setFromBufferAttribute(t),e)for(let r=0,o=e.length;r<o;r++)Go.setFromBufferAttribute(e[r]),this.morphTargetsRelative?(Di.addVectors(on.min,Go.min),on.expandByPoint(Di),Di.addVectors(on.max,Go.max),on.expandByPoint(Di)):(on.expandByPoint(Go.min),on.expandByPoint(Go.max));on.getCenter(i);let s=0;for(let r=0,o=t.count;r<o;r++)Di.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(Di));if(e)for(let r=0,o=e.length;r<o;r++){const a=e[r],l=this.morphTargetsRelative;for(let h=0,c=a.count;h<c;h++)Di.fromBufferAttribute(a,h),l&&(Vr.fromBufferAttribute(t,h),Di.add(Vr)),s=Math.max(s,i.distanceToSquared(Di))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,s=e.position.array,r=e.normal.array,o=e.uv.array,a=s.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Pi(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,h=[],c=[];for(let C=0;C<a;C++)h[C]=new P,c[C]=new P;const u=new P,d=new P,f=new P,p=new ft,m=new ft,g=new ft,x=new P,v=new P;function y(C,F,Y){u.fromArray(s,3*C),d.fromArray(s,3*F),f.fromArray(s,3*Y),p.fromArray(o,2*C),m.fromArray(o,2*F),g.fromArray(o,2*Y),d.sub(u),f.sub(u),m.sub(p),g.sub(p);const O=1/(m.x*g.y-g.x*m.y);!isFinite(O)||(x.copy(d).multiplyScalar(g.y).addScaledVector(f,-m.y).multiplyScalar(O),v.copy(f).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(O),h[C].add(x),h[F].add(x),h[Y].add(x),c[C].add(v),c[F].add(v),c[Y].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let C=0,F=b.length;C<F;++C){const Y=b[C],O=Y.start;for(let V=O,X=O+Y.count;V<X;V+=3)y(i[V+0],i[V+1],i[V+2])}const M=new P,S=new P,A=new P,w=new P;function T(C){A.fromArray(r,3*C),w.copy(A);const F=h[C];M.copy(F),M.sub(A.multiplyScalar(A.dot(F))).normalize(),S.crossVectors(w,F);const O=S.dot(c[C])<0?-1:1;l[4*C]=M.x,l[4*C+1]=M.y,l[4*C+2]=M.z,l[4*C+3]=O}for(let C=0,F=b.length;C<F;++C){const Y=b[C],O=Y.start;for(let V=O,X=O+Y.count;V<X;V+=3)T(i[V+0]),T(i[V+1]),T(i[V+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Pi(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const s=new P,r=new P,o=new P,a=new P,l=new P,h=new P,c=new P,u=new P;if(t)for(let d=0,f=t.count;d<f;d+=3){const p=t.getX(d+0),m=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),o.fromBufferAttribute(e,g),c.subVectors(o,r),u.subVectors(s,r),c.cross(u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),h.fromBufferAttribute(i,g),a.add(c),l.add(c),h.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(g,h.x,h.y,h.z)}else for(let d=0,f=e.count;d<f;d+=3)s.fromBufferAttribute(e,d+0),r.fromBufferAttribute(e,d+1),o.fromBufferAttribute(e,d+2),c.subVectors(o,r),u.subVectors(s,r),c.cross(u),i.setXYZ(d+0,c.x,c.y,c.z),i.setXYZ(d+1,c.x,c.y,c.z),i.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Di.fromBufferAttribute(t,e),Di.normalize(),t.setXYZ(e,Di.x,Di.y,Di.z)}toNonIndexed(){function t(a,l){const h=a.array,c=a.itemSize,u=a.normalized,d=new h.constructor(l.length*c);let f=0,p=0;for(let m=0,g=l.length;m<g;m++){f=a.isInterleavedBufferAttribute?l[m]*a.data.stride+a.offset:l[m]*c;for(let x=0;x<c;x++)d[p++]=h[f++]}return new Pi(d,c,u)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ie,i=this.index.array,s=this.attributes;for(const a in s){const h=t(s[a],i);e.setAttribute(a,h)}const r=this.morphAttributes;for(const a in r){const l=[],h=r[a];for(let c=0,u=h.length;c<u;c++){const f=t(h[c],i);l.push(f)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const h=o[a];e.addGroup(h.start,h.count,h.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const h in l)void 0!==l[h]&&(t[h]=l[h]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const l in i)t.data.attributes[l]=i[l].toJSON(t.data);const s={};let r=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],c=[];for(let u=0,d=h.length;u<d;u++)c.push(h[u].toJSON(t.data));c.length>0&&(s[l]=c,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const s=t.attributes;for(const h in s)this.setAttribute(h,s[h].clone(e));const r=t.morphAttributes;for(const h in r){const c=[],u=r[h];for(let d=0,f=u.length;d<f;d++)c.push(u[d].clone(e));this.morphAttributes[h]=c}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let h=0,c=o.length;h<c;h++){const u=o[h];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=t.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Lf=new Me,Xr=new $a,yc=new kr,zo=new P,Ho=new P,Wo=new P,xc=new P,Ka=new P,Qa=new ft,tl=new ft,el=new ft,vc=new P,il=new P;class Yi extends _n{constructor(t=new Ie,e=new Ki){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(t,e){const i=this.geometry,r=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(i.attributes.position,t);const a=this.morphTargetInfluences;if(r&&a){Ka.set(0,0,0);for(let l=0,h=r.length;l<h;l++){const c=a[l],u=r[l];0!==c&&(xc.fromBufferAttribute(u,t),Ka.addScaledVector(o?xc:xc.sub(e),c))}e.add(Ka)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){const i=this.geometry,s=this.material,r=this.matrixWorld;if(void 0===s||(null===i.boundingSphere&&i.computeBoundingSphere(),yc.copy(i.boundingSphere),yc.applyMatrix4(r),!1===t.ray.intersectsSphere(yc))||(Lf.copy(r).invert(),Xr.copy(t.ray).applyMatrix4(Lf),null!==i.boundingBox&&!1===Xr.intersectsBox(i.boundingBox)))return;let o;const a=i.index,l=i.attributes.position,h=i.attributes.uv,c=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==a)if(Array.isArray(s))for(let f=0,p=u.length;f<p;f++){const m=u[f],g=s[m.materialIndex];for(let y=Math.max(m.start,d.start),b=Math.min(a.count,Math.min(m.start+m.count,d.start+d.count));y<b;y+=3){const M=a.getX(y),S=a.getX(y+1),A=a.getX(y+2);o=nl(this,g,t,Xr,h,c,M,S,A),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=m.materialIndex,e.push(o))}}else for(let m=Math.max(0,d.start),g=Math.min(a.count,d.start+d.count);m<g;m+=3){const x=a.getX(m),v=a.getX(m+1),y=a.getX(m+2);o=nl(this,s,t,Xr,h,c,x,v,y),o&&(o.faceIndex=Math.floor(m/3),e.push(o))}else if(void 0!==l)if(Array.isArray(s))for(let f=0,p=u.length;f<p;f++){const m=u[f],g=s[m.materialIndex];for(let y=Math.max(m.start,d.start),b=Math.min(l.count,Math.min(m.start+m.count,d.start+d.count));y<b;y+=3)o=nl(this,g,t,Xr,h,c,y,y+1,y+2),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=m.materialIndex,e.push(o))}else for(let m=Math.max(0,d.start),g=Math.min(l.count,d.start+d.count);m<g;m+=3)o=nl(this,s,t,Xr,h,c,m,m+1,m+2),o&&(o.faceIndex=Math.floor(m/3),e.push(o))}}function nl(n,t,e,i,s,r,o,a,l){n.getVertexPosition(o,zo),n.getVertexPosition(a,Ho),n.getVertexPosition(l,Wo);const h=function Ay(n,t,e,i,s,r,o,a){let l;if(l=1===t.side?i.intersectTriangle(o,r,s,!0,a):i.intersectTriangle(s,r,o,0===t.side,a),null===l)return null;il.copy(a),il.applyMatrix4(n.matrixWorld);const h=e.ray.origin.distanceTo(il);return h<e.near||h>e.far?null:{distance:h,point:il.clone(),object:n}}(n,t,e,i,zo,Ho,Wo,vc);if(h){s&&(Qa.fromBufferAttribute(s,o),tl.fromBufferAttribute(s,a),el.fromBufferAttribute(s,l),h.uv=Cn.getUV(vc,zo,Ho,Wo,Qa,tl,el,new ft)),r&&(Qa.fromBufferAttribute(r,o),tl.fromBufferAttribute(r,a),el.fromBufferAttribute(r,l),h.uv2=Cn.getUV(vc,zo,Ho,Wo,Qa,tl,el,new ft));const c={a:o,b:a,c:l,normal:new P,materialIndex:0};Cn.getNormal(zo,Ho,Wo,c.normal),h.face=c}return h}class Ss extends Ie{constructor(t=1,e=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],h=[],c=[],u=[];let d=0,f=0;function p(m,g,x,v,y,b,M,S,A,w,T){const C=b/A,F=M/w,Y=b/2,O=M/2,D=S/2,V=A+1,X=w+1;let j=0,$=0;const et=new P;for(let pt=0;pt<X;pt++){const J=pt*F-O;for(let Q=0;Q<V;Q++)et[m]=(Q*C-Y)*v,et[g]=J*y,et[x]=D,h.push(et.x,et.y,et.z),et[m]=0,et[g]=0,et[x]=S>0?1:-1,c.push(et.x,et.y,et.z),u.push(Q/A),u.push(1-pt/w),j+=1}for(let pt=0;pt<w;pt++)for(let J=0;J<A;J++){const bt=d+J+V*(pt+1),gt=d+(J+1)+V*(pt+1),At=d+(J+1)+V*pt;l.push(d+J+V*pt,bt,At),l.push(bt,gt,At),$+=6}a.addGroup(f,$,T),f+=$,d+=j}p("z","y","x",-1,-1,i,e,t,o,r,0),p("z","y","x",1,-1,i,e,-t,o,r,1),p("x","z","y",1,1,t,i,e,s,o,2),p("x","z","y",1,-1,t,i,-e,s,o,3),p("x","y","z",1,-1,t,e,i,s,r,4),p("x","y","z",-1,-1,t,e,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new Ht(h,3)),this.setAttribute("normal",new Ht(c,3)),this.setAttribute("uv",new Ht(u,2))}static fromJSON(t){return new Ss(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Yr(n){const t={};for(const e in n){t[e]={};for(const i in n[e]){const s=n[e][i];t[e][i]=s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.clone():Array.isArray(s)?s.slice():s}}return t}function Zi(n){const t={};for(let e=0;e<n.length;e++){const i=Yr(n[e]);for(const s in i)t[s]=i[s]}return t}function Of(n){return null===n.getRenderTarget()&&n.outputEncoding===ii?Hn:Do}const Iy={clone:Yr,merge:Zi};class Ts extends ko{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Yr(t.uniforms),this.uniformsGroups=function Cy(n){const t=[];for(let e=0;e<n.length;e++)t.push(n[e].clone());return t}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;e.uniforms[s]=o&&o.isTexture?{type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const s in this.extensions)!0===this.extensions[s]&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class bc extends _n{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Me,this.projectionMatrix=new Me,this.projectionMatrixInverse=new Me}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Bi extends bc{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Lo*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Zs*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Lo*Math.atan(Math.tan(.5*Zs*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,r,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Zs*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,h=o.fullHeight;r+=o.offsetX*s/l,e-=o.offsetY*i/h,s*=o.width/l,i*=o.height/h}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class Dy extends _n{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;const s=new Bi(-90,1,t,e);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(1,0,0),this.add(s);const r=new Bi(-90,1,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const o=new Bi(-90,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);const a=new Bi(-90,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const l=new Bi(-90,1,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const h=new Bi(-90,1,t,e);h.layers=this.layers,h.up.set(0,1,0),h.lookAt(0,0,-1),this.add(h)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[s,r,o,a,l,h]=this.children,c=t.getRenderTarget(),u=t.toneMapping,d=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,s),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,o),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,l),i.texture.generateMipmaps=f,t.setRenderTarget(i,5),t.render(e,h),t.setRenderTarget(c),t.toneMapping=u,t.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}class sl extends Tn{constructor(t,e,i,s,r,o,a,l,h,c){super(t=void 0!==t?t:[],e=void 0!==e?e:301,i,s,r,o,a,l,h,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Ly extends qs{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1};this.texture=new sl([i,i,i,i,i,i],e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:vi}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Ss(5,5,5),r=new Ts({name:"CubemapFromEquirect",uniforms:Yr(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const o=new Yi(s,r),a=e.minFilter;return e.minFilter===Gs&&(e.minFilter=vi),new Dy(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,i,s){const r=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,i,s);t.setRenderTarget(r)}}const wc=new P,Oy=new P,By=new Ji;class Qs{constructor(t=new P(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=wc.subVectors(i,e).cross(Oy.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(wc),s=this.normal.dot(i);if(0===s)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||By.getNormalMatrix(t),s=this.coplanarPoint(wc).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const qr=new kr,rl=new P;class Mc{constructor(t=new Qs,e=new Qs,i=new Qs,s=new Qs,r=new Qs,o=new Qs){this.planes=[t,e,i,s,r,o]}set(t,e,i,s,r,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,s=i[0],r=i[1],o=i[2],a=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],f=i[9],p=i[10],m=i[11],g=i[12],x=i[13],v=i[14],y=i[15];return e[0].setComponents(a-s,u-l,m-d,y-g).normalize(),e[1].setComponents(a+s,u+l,m+d,y+g).normalize(),e[2].setComponents(a+r,u+h,m+f,y+x).normalize(),e[3].setComponents(a-r,u-h,m-f,y-x).normalize(),e[4].setComponents(a-o,u-c,m-p,y-v).normalize(),e[5].setComponents(a+o,u+c,m+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),qr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(qr)}intersectsSprite(t){return qr.center.set(0,0,0),qr.radius=.7071067811865476,qr.applyMatrix4(t.matrixWorld),this.intersectsSphere(qr)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(rl.x=s.normal.x>0?t.max.x:t.min.x,rl.y=s.normal.y>0?t.max.y:t.min.y,rl.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(rl)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Bf(){let n=null,t=!1,e=null,i=null;function s(r,o){e(r,o),i=n.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==e&&(i=n.requestAnimationFrame(s),t=!0)},stop:function(){n.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(r){e=r},setContext:function(r){n=r}}}function Fy(n,t){const e=t.isWebGL2,i=new WeakMap;return{get:function o(h){return h.isInterleavedBufferAttribute&&(h=h.data),i.get(h)},remove:function a(h){h.isInterleavedBufferAttribute&&(h=h.data);const c=i.get(h);c&&(n.deleteBuffer(c.buffer),i.delete(h))},update:function l(h,c){if(h.isGLBufferAttribute){const d=i.get(h);return void((!d||d.version<h.version)&&i.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version}))}h.isInterleavedBufferAttribute&&(h=h.data);const u=i.get(h);void 0===u?i.set(h,function s(h,c){const u=h.array,d=h.usage,f=n.createBuffer();let p;if(n.bindBuffer(c,f),n.bufferData(c,u,d),h.onUploadCallback(),u instanceof Float32Array)p=5126;else if(u instanceof Uint16Array)if(h.isFloat16BufferAttribute){if(!e)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=5131}else p=5123;else if(u instanceof Int16Array)p=5122;else if(u instanceof Uint32Array)p=5125;else if(u instanceof Int32Array)p=5124;else if(u instanceof Int8Array)p=5120;else if(u instanceof Uint8Array)p=5121;else{if(!(u instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);p=5121}return{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:h.version}}(h,c)):u.version<h.version&&(function r(h,c,u){const d=c.array,f=c.updateRange;n.bindBuffer(u,h),-1===f.count?n.bufferSubData(u,0,d):(e?n.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):n.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),c.onUploadCallback()}(u.buffer,h,c),u.version=h.version)}}}class ol extends Ie{constructor(t=1,e=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:s};const r=t/2,o=e/2,a=Math.floor(i),l=Math.floor(s),h=a+1,c=l+1,u=t/a,d=e/l,f=[],p=[],m=[],g=[];for(let x=0;x<c;x++){const v=x*d-o;for(let y=0;y<h;y++)p.push(y*u-r,-v,0),m.push(0,0,1),g.push(y/a),g.push(1-x/l)}for(let x=0;x<l;x++)for(let v=0;v<a;v++){const b=v+h*(x+1),M=v+1+h*(x+1),S=v+1+h*x;f.push(v+h*x,b,S),f.push(b,M,S)}this.setIndex(f),this.setAttribute("position",new Ht(p,3)),this.setAttribute("normal",new Ht(m,3)),this.setAttribute("uv",new Ht(g,2))}static fromJSON(t){return new ol(t.width,t.height,t.widthSegments,t.heightSegments)}}const Te={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},It={common:{diffuse:{value:new Gt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ji},uv2Transform:{value:new Ji},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ft(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Gt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ji}},sprite:{diffuse:{value:new Gt(16777215)},opacity:{value:1},center:{value:new ft(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ji}}},Wn={basic:{uniforms:Zi([It.common,It.specularmap,It.envmap,It.aomap,It.lightmap,It.fog]),vertexShader:Te.meshbasic_vert,fragmentShader:Te.meshbasic_frag},lambert:{uniforms:Zi([It.common,It.specularmap,It.envmap,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.fog,It.lights,{emissive:{value:new Gt(0)}}]),vertexShader:Te.meshlambert_vert,fragmentShader:Te.meshlambert_frag},phong:{uniforms:Zi([It.common,It.specularmap,It.envmap,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.fog,It.lights,{emissive:{value:new Gt(0)},specular:{value:new Gt(1118481)},shininess:{value:30}}]),vertexShader:Te.meshphong_vert,fragmentShader:Te.meshphong_frag},standard:{uniforms:Zi([It.common,It.envmap,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.roughnessmap,It.metalnessmap,It.fog,It.lights,{emissive:{value:new Gt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Te.meshphysical_vert,fragmentShader:Te.meshphysical_frag},toon:{uniforms:Zi([It.common,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.gradientmap,It.fog,It.lights,{emissive:{value:new Gt(0)}}]),vertexShader:Te.meshtoon_vert,fragmentShader:Te.meshtoon_frag},matcap:{uniforms:Zi([It.common,It.bumpmap,It.normalmap,It.displacementmap,It.fog,{matcap:{value:null}}]),vertexShader:Te.meshmatcap_vert,fragmentShader:Te.meshmatcap_frag},points:{uniforms:Zi([It.points,It.fog]),vertexShader:Te.points_vert,fragmentShader:Te.points_frag},dashed:{uniforms:Zi([It.common,It.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Te.linedashed_vert,fragmentShader:Te.linedashed_frag},depth:{uniforms:Zi([It.common,It.displacementmap]),vertexShader:Te.depth_vert,fragmentShader:Te.depth_frag},normal:{uniforms:Zi([It.common,It.bumpmap,It.normalmap,It.displacementmap,{opacity:{value:1}}]),vertexShader:Te.meshnormal_vert,fragmentShader:Te.meshnormal_frag},sprite:{uniforms:Zi([It.sprite,It.fog]),vertexShader:Te.sprite_vert,fragmentShader:Te.sprite_frag},background:{uniforms:{uvTransform:{value:new Ji},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Te.background_vert,fragmentShader:Te.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Te.backgroundCube_vert,fragmentShader:Te.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Te.cube_vert,fragmentShader:Te.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Te.equirect_vert,fragmentShader:Te.equirect_frag},distanceRGBA:{uniforms:Zi([It.common,It.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Te.distanceRGBA_vert,fragmentShader:Te.distanceRGBA_frag},shadow:{uniforms:Zi([It.lights,It.fog,{color:{value:new Gt(0)},opacity:{value:1}}]),vertexShader:Te.shadow_vert,fragmentShader:Te.shadow_frag}};Wn.physical={uniforms:Zi([Wn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ft(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Gt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ft},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Gt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Gt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Te.meshphysical_vert,fragmentShader:Te.meshphysical_frag};const al={r:0,b:0,g:0};function Bv(n,t,e,i,s,r,o){const a=new Gt(0);let h,c,l=!0===r?0:1,u=null,d=0,f=null;function m(g,x){g.getRGB(al,Of(n)),i.buffers.color.setClear(al.r,al.g,al.b,x,o)}return{getClearColor:function(){return a},setClearColor:function(g,x=1){a.set(g),l=x,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(a,l)},render:function p(g,x){let v=!1,y=!0===x.isScene?x.background:null;y&&y.isTexture&&(y=(x.backgroundBlurriness>0?e:t).get(y));const b=n.xr,M=b.getSession&&b.getSession();M&&"additive"===M.environmentBlendMode&&(y=null),null===y?m(a,l):y&&y.isColor&&(m(y,1),v=!0),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),y&&(y.isCubeTexture||306===y.mapping)?(void 0===c&&(c=new Yi(new Ss(1,1,1),new Ts({name:"BackgroundCubeMaterial",uniforms:Yr(Wn.backgroundCube.uniforms),vertexShader:Wn.backgroundCube.vertexShader,fragmentShader:Wn.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(S,A,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=y.encoding!==ii,(u!==y||d!==y.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,u=y,d=y.version,f=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(void 0===h&&(h=new Yi(new ol(2,2),new Ts({name:"BackgroundMaterial",uniforms:Yr(Wn.background.uniforms),vertexShader:Wn.background.vertexShader,fragmentShader:Wn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=y,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.toneMapped=y.encoding!==ii,!0===y.matrixAutoUpdate&&y.updateMatrix(),h.material.uniforms.uvTransform.value.copy(y.matrix),(u!==y||d!==y.version||f!==n.toneMapping)&&(h.material.needsUpdate=!0,u=y,d=y.version,f=n.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null))}}}function Fv(n,t,e,i){const s=n.getParameter(34921),r=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==r,a={},l=g(null);let h=l,c=!1;function f(D){return i.isWebGL2?n.bindVertexArray(D):r.bindVertexArrayOES(D)}function p(D){return i.isWebGL2?n.deleteVertexArray(D):r.deleteVertexArrayOES(D)}function g(D){const V=[],X=[],j=[];for(let $=0;$<s;$++)V[$]=0,X[$]=0,j[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:X,attributeDivisors:j,object:D,attributes:{},index:null}}function y(){const D=h.newAttributes;for(let V=0,X=D.length;V<X;V++)D[V]=0}function b(D){M(D,0)}function M(D,V){const j=h.enabledAttributes,$=h.attributeDivisors;h.newAttributes[D]=1,0===j[D]&&(n.enableVertexAttribArray(D),j[D]=1),$[D]!==V&&((i.isWebGL2?n:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,V),$[D]=V)}function S(){const D=h.newAttributes,V=h.enabledAttributes;for(let X=0,j=V.length;X<j;X++)V[X]!==D[X]&&(n.disableVertexAttribArray(X),V[X]=0)}function A(D,V,X,j,$,et){!0!==i.isWebGL2||5124!==X&&5125!==X?n.vertexAttribPointer(D,V,X,j,$,et):n.vertexAttribIPointer(D,V,X,$,et)}function Y(){O(),c=!0,h!==l&&(h=l,f(h.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function u(D,V,X,j,$){let et=!1;if(o){const pt=function m(D,V,X){const j=!0===X.wireframe;let $=a[D.id];void 0===$&&($={},a[D.id]=$);let et=$[V.id];void 0===et&&(et={},$[V.id]=et);let pt=et[j];return void 0===pt&&(pt=g(function d(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}()),et[j]=pt),pt}(j,X,V);h!==pt&&(h=pt,f(h.object)),et=function x(D,V,X,j){const $=h.attributes,et=V.attributes;let pt=0;const J=X.getAttributes();for(const Q in J)if(J[Q].location>=0){const gt=$[Q];let At=et[Q];if(void 0===At&&("instanceMatrix"===Q&&D.instanceMatrix&&(At=D.instanceMatrix),"instanceColor"===Q&&D.instanceColor&&(At=D.instanceColor)),void 0===gt||gt.attribute!==At||At&&gt.data!==At.data)return!0;pt++}return h.attributesNum!==pt||h.index!==j}(D,j,X,$),et&&function v(D,V,X,j){const $={},et=V.attributes;let pt=0;const J=X.getAttributes();for(const Q in J)if(J[Q].location>=0){let gt=et[Q];void 0===gt&&("instanceMatrix"===Q&&D.instanceMatrix&&(gt=D.instanceMatrix),"instanceColor"===Q&&D.instanceColor&&(gt=D.instanceColor));const At={};At.attribute=gt,gt&&gt.data&&(At.data=gt.data),$[Q]=At,pt++}h.attributes=$,h.attributesNum=pt,h.index=j}(D,j,X,$)}else{const pt=!0===V.wireframe;(h.geometry!==j.id||h.program!==X.id||h.wireframe!==pt)&&(h.geometry=j.id,h.program=X.id,h.wireframe=pt,et=!0)}null!==$&&e.update($,34963),(et||c)&&(c=!1,function w(D,V,X,j){if(!1===i.isWebGL2&&(D.isInstancedMesh||j.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;y();const $=j.attributes,et=X.getAttributes(),pt=V.defaultAttributeValues;for(const J in et){const Q=et[J];if(Q.location>=0){let bt=$[J];if(void 0===bt&&("instanceMatrix"===J&&D.instanceMatrix&&(bt=D.instanceMatrix),"instanceColor"===J&&D.instanceColor&&(bt=D.instanceColor)),void 0!==bt){const gt=bt.normalized,At=bt.itemSize,nt=e.get(bt);if(void 0===nt)continue;const te=nt.buffer,Lt=nt.type,Kt=nt.bytesPerElement;if(bt.isInterleavedBufferAttribute){const Tt=bt.data,he=Tt.stride,ht=bt.offset;if(Tt.isInstancedInterleavedBuffer){for(let ot=0;ot<Q.locationSize;ot++)M(Q.location+ot,Tt.meshPerAttribute);!0!==D.isInstancedMesh&&void 0===j._maxInstanceCount&&(j._maxInstanceCount=Tt.meshPerAttribute*Tt.count)}else for(let ot=0;ot<Q.locationSize;ot++)b(Q.location+ot);n.bindBuffer(34962,te);for(let ot=0;ot<Q.locationSize;ot++)A(Q.location+ot,At/Q.locationSize,Lt,gt,he*Kt,(ht+At/Q.locationSize*ot)*Kt)}else{if(bt.isInstancedBufferAttribute){for(let Tt=0;Tt<Q.locationSize;Tt++)M(Q.location+Tt,bt.meshPerAttribute);!0!==D.isInstancedMesh&&void 0===j._maxInstanceCount&&(j._maxInstanceCount=bt.meshPerAttribute*bt.count)}else for(let Tt=0;Tt<Q.locationSize;Tt++)b(Q.location+Tt);n.bindBuffer(34962,te);for(let Tt=0;Tt<Q.locationSize;Tt++)A(Q.location+Tt,At/Q.locationSize,Lt,gt,At*Kt,At/Q.locationSize*Tt*Kt)}}else if(void 0!==pt){const gt=pt[J];if(void 0!==gt)switch(gt.length){case 2:n.vertexAttrib2fv(Q.location,gt);break;case 3:n.vertexAttrib3fv(Q.location,gt);break;case 4:n.vertexAttrib4fv(Q.location,gt);break;default:n.vertexAttrib1fv(Q.location,gt)}}}}S()}(D,V,X,j),null!==$&&n.bindBuffer(34963,e.get($).buffer))},reset:Y,resetDefaultState:O,dispose:function T(){Y();for(const D in a){const V=a[D];for(const X in V){const j=V[X];for(const $ in j)p(j[$].object),delete j[$];delete V[X]}delete a[D]}},releaseStatesOfGeometry:function C(D){if(void 0===a[D.id])return;const V=a[D.id];for(const X in V){const j=V[X];for(const $ in j)p(j[$].object),delete j[$];delete V[X]}delete a[D.id]},releaseStatesOfProgram:function F(D){for(const V in a){const X=a[V];if(void 0===X[D.id])continue;const j=X[D.id];for(const $ in j)p(j[$].object),delete j[$];delete X[D.id]}},initAttributes:y,enableAttribute:b,disableUnusedAttributes:S}}function Nv(n,t,e,i){const s=i.isWebGL2;let r;this.setMode=function o(h){r=h},this.render=function a(h,c){n.drawArrays(r,h,c),e.update(c,r,1)},this.renderInstances=function l(h,c,u){if(0===u)return;let d,f;if(s)d=n,f="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===d)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[f](r,h,c,u),e.update(c,r,u)}}function Uv(n,t,e){let i;function r(A){if("highp"===A){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return"mediump"===A&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&n instanceof WebGL2ComputeRenderingContext;let a=void 0!==e.precision?e.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const h=o||t.has("WEBGL_draw_buffers"),c=!0===e.logarithmicDepthBuffer,u=n.getParameter(34930),d=n.getParameter(35660),f=n.getParameter(3379),p=n.getParameter(34076),m=n.getParameter(34921),g=n.getParameter(36347),x=n.getParameter(36348),v=n.getParameter(36349),y=d>0,b=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:h,getMaxAnisotropy:function s(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const A=t.get("EXT_texture_filter_anisotropic");i=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:g,maxVaryings:x,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:o?n.getParameter(36183):0}}function kv(n){const t=this;let e=null,i=0,s=!1,r=!1;const o=new Qs,a=new Ji,l={value:null,needsUpdate:!1};function h(){l.value!==e&&(l.value=e,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(u,d,f,p){const m=null!==u?u.length:0;let g=null;if(0!==m){if(g=l.value,!0!==p||null===g){const x=f+4*m,v=d.matrixWorldInverse;a.getNormalMatrix(v),(null===g||g.length<x)&&(g=new Float32Array(x));for(let y=0,b=f;y!==m;++y,b+=4)o.copy(u[y]).applyMatrix4(v,a),o.normal.toArray(g,b),g[b+3]=o.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d,f){const p=0!==u.length||d||0!==i||s;return s=d,e=c(u,f,0),i=u.length,p},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,h()},this.setState=function(u,d,f){const p=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,x=n.get(u);if(!s||null===p||0===p.length||r&&!g)r?c(null):h();else{const v=r?0:i,y=4*v;let b=x.clippingState||null;l.value=b,b=c(p,d,y,f);for(let M=0;M!==y;++M)b[M]=e[M];x.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=v}}}function Gv(n){let t=new WeakMap;function e(o,a){return 303===a?o.mapping=301:304===a&&(o.mapping=302),o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=t.get(a);void 0!==l&&(t.delete(a),l.dispose())}return{get:function i(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(t.has(o))return e(t.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const h=new Ly(l.height/2);return h.fromEquirectangularTexture(n,o),t.set(o,h),o.addEventListener("dispose",s),e(h.texture,o.mapping)}return null}}}return o},dispose:function r(){t=new WeakMap}}}class Sc extends bc{constructor(t=-1,e=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,o=i+t,a=s+e,l=s-e;if(null!==this.view&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=h*this.view.offsetX,o=r+h*this.view.width,a-=c*this.view.offsetY,l=a-c*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Ff=[.125,.215,.35,.446,.526,.582],Tc=new Sc,Nf=new Gt;let Ec=null;const er=(1+Math.sqrt(5))/2,Jr=1/er,Uf=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,er,Jr),new P(0,er,-Jr),new P(Jr,0,er),new P(-Jr,0,er),new P(er,Jr,0),new P(-er,Jr,0)];class kf{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,s=100){Ec=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Hf(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=zf(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ec),t.scissorTest=!1,ll(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSize(301===t.mapping||302===t.mapping?0===t.image.length?16:t.image[0].width||t.image[0].image.width:t.image.width/4),Ec=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:Po,format:gn,encoding:Vs,depthBuffer:!1},s=Gf(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Gf(t,e,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function zv(n){const t=[],e=[],i=[];let s=n;const r=n-4+1+Ff.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);e.push(a);let l=1/a;o>n-4?l=Ff[o-n+4-1]:0===o&&(l=0),i.push(l);const h=1/(a-2),c=-h,u=1+h,d=[c,c,u,c,u,u,c,c,u,u,c,u],f=6,p=6,m=3,g=2,x=1,v=new Float32Array(m*p*f),y=new Float32Array(g*p*f),b=new Float32Array(x*p*f);for(let S=0;S<f;S++){const A=S%3*2/3-1,w=S>2?0:-1;v.set([A,w,0,A+2/3,w,0,A+2/3,w+1,0,A,w,0,A+2/3,w+1,0,A,w+1,0],m*p*S),y.set(d,g*p*S),b.set([S,S,S,S,S,S],x*p*S)}const M=new Ie;M.setAttribute("position",new Pi(v,m)),M.setAttribute("uv",new Pi(y,g)),M.setAttribute("faceIndex",new Pi(b,x)),t.push(M),s>4&&s--}return{lodPlanes:t,sizeLods:e,sigmas:i}}(r)),this._blurMaterial=function Hv(n,t,e){const i=new Float32Array(20),s=new P(0,1,0);return new Ts({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,t,e)}return s}_compileMaterial(t){const e=new Yi(this._lodPlanes[0],t);this._renderer.compile(e,Tc)}_sceneToCubeUV(t,e,i,s){const a=new Bi(90,1,e,i),l=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],c=this._renderer,u=c.autoClear,d=c.toneMapping;c.getClearColor(Nf),c.toneMapping=0,c.autoClear=!1;const f=new Ki({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new Yi(new Ss,f);let m=!1;const g=t.background;g?g.isColor&&(f.color.copy(g),t.background=null,m=!0):(f.color.copy(Nf),m=!0);for(let x=0;x<6;x++){const v=x%3;0===v?(a.up.set(0,l[x],0),a.lookAt(h[x],0,0)):1===v?(a.up.set(0,0,l[x]),a.lookAt(0,h[x],0)):(a.up.set(0,l[x],0),a.lookAt(0,0,h[x]));const y=this._cubeSize;ll(s,v*y,x>2?y:0,y,y),c.setRenderTarget(s),m&&c.render(p,a),c.render(t,a)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=d,c.autoClear=u,t.background=g}_textureToCubeUV(t,e){const i=this._renderer,s=301===t.mapping||302===t.mapping;s?(null===this._cubemapMaterial&&(this._cubemapMaterial=Hf()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=zf());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new Yi(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const l=this._cubeSize;ll(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(o,Tc)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]);this._blur(t,s-1,s,r,Uf[(s-1)%Uf.length])}e.autoClear=i}_blur(t,e,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,i,s,"latitudinal",r),this._halfBlur(o,t,i,i,s,"longitudinal",r)}_halfBlur(t,e,i,s,r,o,a){const l=this._renderer,h=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new Yi(this._lodPlanes[s],h),d=h.uniforms,f=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/39,m=r/p,g=isFinite(r)?1+Math.floor(3*m):20;g>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const x=[];let v=0;for(let A=0;A<20;++A){const w=A/m,T=Math.exp(-w*w/2);x.push(T),0===A?v+=T:A<g&&(v+=2*T)}for(let A=0;A<x.length;A++)x[A]=x[A]/v;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=x,d.latitudinal.value="latitudinal"===o,a&&(d.poleAxis.value=a);const{_lodMax:y}=this;d.dTheta.value=p,d.mipInt.value=y-i;const b=this._sizeLods[s];ll(e,3*b*(s>y-4?s-y+4:0),4*(this._cubeSize-b),3*b,2*b),l.setRenderTarget(e),l.render(u,Tc)}}function Gf(n,t,e){const i=new qs(n,t,e);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ll(n,t,e,i,s){n.viewport.set(t,e,i,s),n.scissor.set(t,e,i,s)}function zf(){return new Ts({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Hf(){return new Ts({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Wv(n){let t=new WeakMap,e=null;function r(a){const l=a.target;l.removeEventListener("dispose",r);const h=t.get(l);void 0!==h&&(t.delete(l),h.dispose())}return{get:function i(a){if(a&&a.isTexture){const l=a.mapping,h=303===l||304===l,c=301===l||302===l;if(h||c){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let u=t.get(a);return null===e&&(e=new kf(n)),u=h?e.fromEquirectangular(a,u):e.fromCubemap(a,u),t.set(a,u),u.texture}if(t.has(a))return t.get(a).texture;{const u=a.image;if(h&&u&&u.height>0||c&&u&&function s(a){let l=0;for(let c=0;c<6;c++)void 0!==a[c]&&l++;return 6===l}(u)){null===e&&(e=new kf(n));const d=h?e.fromEquirectangular(a):e.fromCubemap(a);return t.set(a,d),a.addEventListener("dispose",r),d.texture}return null}}}return a},dispose:function o(){t=new WeakMap,null!==e&&(e.dispose(),e=null)}}}function Vv(n){const t={};function e(i){if(void 0!==t[i])return t[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return t[i]=s,s}return{has:function(i){return null!==e(i)},init:function(i){i.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(i){const s=e(i);return null===s&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function Xv(n,t,e,i){const s={},r=new WeakMap;function o(u){const d=u.target;null!==d.index&&t.remove(d.index);for(const p in d.attributes)t.remove(d.attributes[p]);d.removeEventListener("dispose",o),delete s[d.id];const f=r.get(d);f&&(t.remove(f),r.delete(d)),i.releaseStatesOfGeometry(d),!0===d.isInstancedBufferGeometry&&delete d._maxInstanceCount,e.memory.geometries--}function h(u){const d=[],f=u.index,p=u.attributes.position;let m=0;if(null!==f){const v=f.array;m=f.version;for(let y=0,b=v.length;y<b;y+=3){const M=v[y+0],S=v[y+1],A=v[y+2];d.push(M,S,S,A,A,M)}}else{m=p.version;for(let y=0,b=p.array.length/3-1;y<b;y+=3){const M=y+0,S=y+1,A=y+2;d.push(M,S,S,A,A,M)}}const g=new(yf(d)?Df:Pf)(d,1);g.version=m;const x=r.get(u);x&&t.remove(x),r.set(u,g)}return{get:function a(u,d){return!0===s[d.id]||(d.addEventListener("dispose",o),s[d.id]=!0,e.memory.geometries++),d},update:function l(u){const d=u.attributes;for(const p in d)t.update(d[p],34962);const f=u.morphAttributes;for(const p in f){const m=f[p];for(let g=0,x=m.length;g<x;g++)t.update(m[g],34962)}},getWireframeAttribute:function c(u){const d=r.get(u);if(d){const f=u.index;null!==f&&d.version<f.version&&h(u)}else h(u);return r.get(u)}}}function Yv(n,t,e,i){const s=i.isWebGL2;let r,a,l;this.setMode=function o(d){r=d},this.setIndex=function h(d){a=d.type,l=d.bytesPerElement},this.render=function c(d,f){n.drawElements(r,f,a,d*l),e.update(f,r,1)},this.renderInstances=function u(d,f,p){if(0===p)return;let m,g;if(s)m=n,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===m)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m[g](r,f,a,d*l,p),e.update(f,r,p)}}function Zv(n){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function s(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function i(r,o,a){switch(e.calls++,o){case 4:e.triangles+=a*(r/3);break;case 1:e.lines+=a*(r/2);break;case 3:e.lines+=a*(r-1);break;case 2:e.lines+=a*r;break;case 0:e.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function $v(n,t){return n[0]-t[0]}function qv(n,t){return Math.abs(t[1])-Math.abs(n[1])}function jv(n,t,e){const i={},s=new Float32Array(8),r=new WeakMap,o=new qe,a=[];for(let h=0;h<8;h++)a[h]=[h,0];return{update:function l(h,c,u,d){const f=h.morphTargetInfluences;if(!0===t.isWebGL2){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,m=void 0!==p?p.length:0;let g=r.get(c);if(void 0===g||g.count!==m){let V=function(){O.dispose(),r.delete(c),c.removeEventListener("dispose",V)};void 0!==g&&g.texture.dispose();const y=void 0!==c.morphAttributes.position,b=void 0!==c.morphAttributes.normal,M=void 0!==c.morphAttributes.color,S=c.morphAttributes.position||[],A=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let T=0;!0===y&&(T=1),!0===b&&(T=2),!0===M&&(T=3);let C=c.attributes.position.count*T,F=1;C>t.maxTextureSize&&(F=Math.ceil(C/t.maxTextureSize),C=t.maxTextureSize);const Y=new Float32Array(C*F*4*m),O=new sc(Y,C,F,m);O.type=xs,O.needsUpdate=!0;const D=4*T;for(let X=0;X<m;X++){const j=S[X],$=A[X],et=w[X],pt=C*F*4*X;for(let J=0;J<j.count;J++){const Q=J*D;!0===y&&(o.fromBufferAttribute(j,J),Y[pt+Q+0]=o.x,Y[pt+Q+1]=o.y,Y[pt+Q+2]=o.z,Y[pt+Q+3]=0),!0===b&&(o.fromBufferAttribute($,J),Y[pt+Q+4]=o.x,Y[pt+Q+5]=o.y,Y[pt+Q+6]=o.z,Y[pt+Q+7]=0),!0===M&&(o.fromBufferAttribute(et,J),Y[pt+Q+8]=o.x,Y[pt+Q+9]=o.y,Y[pt+Q+10]=o.z,Y[pt+Q+11]=4===et.itemSize?o.w:1)}}g={count:m,texture:O,size:new ft(C,F)},r.set(c,g),c.addEventListener("dispose",V)}let x=0;for(let y=0;y<f.length;y++)x+=f[y];const v=c.morphTargetsRelative?1:1-x;d.getUniforms().setValue(n,"morphTargetBaseInfluence",v),d.getUniforms().setValue(n,"morphTargetInfluences",f),d.getUniforms().setValue(n,"morphTargetsTexture",g.texture,e),d.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const p=void 0===f?0:f.length;let m=i[c.id];if(void 0===m||m.length!==p){m=[];for(let b=0;b<p;b++)m[b]=[b,0];i[c.id]=m}for(let b=0;b<p;b++){const M=m[b];M[0]=b,M[1]=f[b]}m.sort(qv);for(let b=0;b<8;b++)b<p&&m[b][1]?(a[b][0]=m[b][0],a[b][1]=m[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort($v);const g=c.morphAttributes.position,x=c.morphAttributes.normal;let v=0;for(let b=0;b<8;b++){const M=a[b],S=M[0],A=M[1];S!==Number.MAX_SAFE_INTEGER&&A?(g&&c.getAttribute("morphTarget"+b)!==g[S]&&c.setAttribute("morphTarget"+b,g[S]),x&&c.getAttribute("morphNormal"+b)!==x[S]&&c.setAttribute("morphNormal"+b,x[S]),s[b]=A,v+=A):(g&&!0===c.hasAttribute("morphTarget"+b)&&c.deleteAttribute("morphTarget"+b),x&&!0===c.hasAttribute("morphNormal"+b)&&c.deleteAttribute("morphNormal"+b),s[b]=0)}const y=c.morphTargetsRelative?1:1-v;d.getUniforms().setValue(n,"morphTargetBaseInfluence",y),d.getUniforms().setValue(n,"morphTargetInfluences",s)}}}}function Jv(n,t,e,i){let s=new WeakMap;function a(l){const h=l.target;h.removeEventListener("dispose",a),e.remove(h.instanceMatrix),null!==h.instanceColor&&e.remove(h.instanceColor)}return{update:function r(l){const h=i.render.frame,u=t.get(l,l.geometry);return s.get(u)!==h&&(t.update(u),s.set(u,h)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),e.update(l.instanceMatrix,34962),null!==l.instanceColor&&e.update(l.instanceColor,34962)),u},dispose:function o(){s=new WeakMap}}}const Wf=new Tn,Vf=new sc,Xf=new bf,Yf=new sl,Zf=[],$f=[],qf=new Float32Array(16),jf=new Float32Array(9),Jf=new Float32Array(4);function Kr(n,t,e){const i=n[0];if(i<=0||i>0)return n;const s=t*e;let r=Zf[s];if(void 0===r&&(r=new Float32Array(s),Zf[s]=r),0!==t){i.toArray(r,0);for(let o=1,a=0;o!==t;++o)a+=e,n[o].toArray(r,a)}return r}function Ai(n,t){if(n.length!==t.length)return!1;for(let e=0,i=n.length;e<i;e++)if(n[e]!==t[e])return!1;return!0}function Ci(n,t){for(let e=0,i=t.length;e<i;e++)n[e]=t[e]}function hl(n,t){let e=$f[t];void 0===e&&(e=new Int32Array(t),$f[t]=e);for(let i=0;i!==t;++i)e[i]=n.allocateTextureUnit();return e}function Kv(n,t){const e=this.cache;e[0]!==t&&(n.uniform1f(this.addr,t),e[0]=t)}function Qv(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Ai(e,t))return;n.uniform2fv(this.addr,t),Ci(e,t)}}function tb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(void 0!==t.r)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(Ai(e,t))return;n.uniform3fv(this.addr,t),Ci(e,t)}}function eb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Ai(e,t))return;n.uniform4fv(this.addr,t),Ci(e,t)}}function ib(n,t){const e=this.cache,i=t.elements;if(void 0===i){if(Ai(e,t))return;n.uniformMatrix2fv(this.addr,!1,t),Ci(e,t)}else{if(Ai(e,i))return;Jf.set(i),n.uniformMatrix2fv(this.addr,!1,Jf),Ci(e,i)}}function nb(n,t){const e=this.cache,i=t.elements;if(void 0===i){if(Ai(e,t))return;n.uniformMatrix3fv(this.addr,!1,t),Ci(e,t)}else{if(Ai(e,i))return;jf.set(i),n.uniformMatrix3fv(this.addr,!1,jf),Ci(e,i)}}function sb(n,t){const e=this.cache,i=t.elements;if(void 0===i){if(Ai(e,t))return;n.uniformMatrix4fv(this.addr,!1,t),Ci(e,t)}else{if(Ai(e,i))return;qf.set(i),n.uniformMatrix4fv(this.addr,!1,qf),Ci(e,i)}}function rb(n,t){const e=this.cache;e[0]!==t&&(n.uniform1i(this.addr,t),e[0]=t)}function ob(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Ai(e,t))return;n.uniform2iv(this.addr,t),Ci(e,t)}}function ab(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Ai(e,t))return;n.uniform3iv(this.addr,t),Ci(e,t)}}function lb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Ai(e,t))return;n.uniform4iv(this.addr,t),Ci(e,t)}}function hb(n,t){const e=this.cache;e[0]!==t&&(n.uniform1ui(this.addr,t),e[0]=t)}function cb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Ai(e,t))return;n.uniform2uiv(this.addr,t),Ci(e,t)}}function ub(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Ai(e,t))return;n.uniform3uiv(this.addr,t),Ci(e,t)}}function db(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Ai(e,t))return;n.uniform4uiv(this.addr,t),Ci(e,t)}}function fb(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture2D(t||Wf,s)}function pb(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture3D(t||Xf,s)}function mb(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTextureCube(t||Yf,s)}function gb(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture2DArray(t||Vf,s)}function yb(n,t){n.uniform1fv(this.addr,t)}function xb(n,t){const e=Kr(t,this.size,2);n.uniform2fv(this.addr,e)}function vb(n,t){const e=Kr(t,this.size,3);n.uniform3fv(this.addr,e)}function bb(n,t){const e=Kr(t,this.size,4);n.uniform4fv(this.addr,e)}function wb(n,t){const e=Kr(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,e)}function Mb(n,t){const e=Kr(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,e)}function Sb(n,t){const e=Kr(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,e)}function Tb(n,t){n.uniform1iv(this.addr,t)}function Eb(n,t){n.uniform2iv(this.addr,t)}function Ab(n,t){n.uniform3iv(this.addr,t)}function Cb(n,t){n.uniform4iv(this.addr,t)}function Ib(n,t){n.uniform1uiv(this.addr,t)}function Rb(n,t){n.uniform2uiv(this.addr,t)}function Pb(n,t){n.uniform3uiv(this.addr,t)}function Db(n,t){n.uniform4uiv(this.addr,t)}function Lb(n,t,e){const i=this.cache,s=t.length,r=hl(e,s);Ai(i,r)||(n.uniform1iv(this.addr,r),Ci(i,r));for(let o=0;o!==s;++o)e.setTexture2D(t[o]||Wf,r[o])}function Ob(n,t,e){const i=this.cache,s=t.length,r=hl(e,s);Ai(i,r)||(n.uniform1iv(this.addr,r),Ci(i,r));for(let o=0;o!==s;++o)e.setTexture3D(t[o]||Xf,r[o])}function Bb(n,t,e){const i=this.cache,s=t.length,r=hl(e,s);Ai(i,r)||(n.uniform1iv(this.addr,r),Ci(i,r));for(let o=0;o!==s;++o)e.setTextureCube(t[o]||Yf,r[o])}function Fb(n,t,e){const i=this.cache,s=t.length,r=hl(e,s);Ai(i,r)||(n.uniform1iv(this.addr,r),Ci(i,r));for(let o=0;o!==s;++o)e.setTexture2DArray(t[o]||Vf,r[o])}class Ub{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function _b(n){switch(n){case 5126:return Kv;case 35664:return Qv;case 35665:return tb;case 35666:return eb;case 35674:return ib;case 35675:return nb;case 35676:return sb;case 5124:case 35670:return rb;case 35667:case 35671:return ob;case 35668:case 35672:return ab;case 35669:case 35673:return lb;case 5125:return hb;case 36294:return cb;case 36295:return ub;case 36296:return db;case 35678:case 36198:case 36298:case 36306:case 35682:return fb;case 35679:case 36299:case 36307:return pb;case 35680:case 36300:case 36308:case 36293:return mb;case 36289:case 36303:case 36311:case 36292:return gb}}(e.type)}}class kb{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function Nb(n){switch(n){case 5126:return yb;case 35664:return xb;case 35665:return vb;case 35666:return bb;case 35674:return wb;case 35675:return Mb;case 35676:return Sb;case 5124:case 35670:return Tb;case 35667:case 35671:return Eb;case 35668:case 35672:return Ab;case 35669:case 35673:return Cb;case 5125:return Ib;case 36294:return Rb;case 36295:return Pb;case 36296:return Db;case 35678:case 36198:case 36298:case 36306:case 35682:return Lb;case 35679:case 36299:case 36307:return Ob;case 35680:case 36300:case 36308:case 36293:return Bb;case 36289:case 36303:case 36311:case 36292:return Fb}}(e.type)}}class Gb{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(t,e[a.id],i)}}}const Cc=/(\w+)(\])?(\[|\.)?/g;function Kf(n,t){n.seq.push(t),n.map[t.id]=t}function zb(n,t,e){const i=n.name,s=i.length;for(Cc.lastIndex=0;;){const r=Cc.exec(i),o=Cc.lastIndex;let a=r[1];const h=r[3];if("]"===r[2]&&(a|=0),void 0===h||"["===h&&o+2===s){Kf(e,void 0===h?new Ub(a,n,t):new kb(a,n,t));break}{let u=e.map[a];void 0===u&&(u=new Gb(a),Kf(e,u)),e=u}}}class cl{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let s=0;s<i;++s){const r=t.getActiveUniform(e,s);zb(r,t.getUniformLocation(e,r.name),this)}}setValue(t,e,i,s){const r=this.map[e];void 0!==r&&r.setValue(t,i,s)}setOptional(t,e,i){const s=e[i];void 0!==s&&this.setValue(t,i,s)}static upload(t,e,i,s){for(let r=0,o=e.length;r!==o;++r){const a=e[r],l=i[a.id];!1!==l.needsUpdate&&a.setValue(t,l.value,s)}}static seqWithValue(t,e){const i=[];for(let s=0,r=t.length;s!==r;++s){const o=t[s];o.id in e&&i.push(o)}return i}}function Qf(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}let Hb=0;function tp(n,t,e){const i=n.getShaderParameter(t,35713),s=n.getShaderInfoLog(t).trim();if(i&&""===s)return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return e.toUpperCase()+"\n\n"+s+"\n\n"+function Wb(n,t){const e=n.split("\n"),i=[],s=Math.max(t-6,0),r=Math.min(t+6,e.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===t?">":" "} ${a}: ${e[o]}`)}return i.join("\n")}(n.getShaderSource(t),o)}return s}function Xb(n,t){const e=function Vb(n){switch(n){case Vs:return["Linear","( value )"];case ii:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(t);return"vec4 "+n+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function Yb(n,t){let e;switch(t){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="OptimizedCineon";break;case 4:e="ACESFilmic";break;case 5:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+n+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function Vo(n){return""!==n}function ep(n,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ip(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const jb=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ic(n){return n.replace(jb,Jb)}function Jb(n,t){const e=Te[t];if(void 0===e)throw new Error("Can not resolve #include <"+t+">");return Ic(e)}const Kb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function np(n){return n.replace(Kb,Qb)}function Qb(n,t,e,i){let s="";for(let r=parseInt(t);r<parseInt(e);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function sp(n){let t="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?t+="\n#define HIGH_PRECISION":"mediump"===n.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(t+="\n#define LOW_PRECISION"),t}function rw(n,t,e,i){const s=n.getContext(),r=e.defines;let o=e.vertexShader,a=e.fragmentShader;const l=function tw(n){let t="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(e),h=function ew(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:t="ENVMAP_TYPE_CUBE_UV"}return t}(e),c=function iw(n){let t="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(t="ENVMAP_MODE_REFRACTION"),t}(e),u=function nw(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(e),d=function sw(n){const t=n.envMapCubeUVHeight;if(null===t)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:i,maxMip:e}}(e),f=e.isWebGL2?"":function Zb(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vo).join("\n")}(e),p=function $b(n){const t=[];for(const e in n){const i=n[e];!1!==i&&t.push("#define "+e+" "+i)}return t.join("\n")}(r),m=s.createProgram();let g,x,v=e.glslVersion?"#version "+e.glslVersion+"\n":"";e.isRawShaderMaterial?(g=[p].filter(Vo).join("\n"),g.length>0&&(g+="\n"),x=[f,p].filter(Vo).join("\n"),x.length>0&&(x+="\n")):(g=[sp(e),"#define SHADER_NAME "+e.shaderName,p,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Vo).join("\n"),x=[f,sp(e),"#define SHADER_NAME "+e.shaderName,p,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.envMap?"#define "+c:"",e.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==e.toneMapping?"#define TONE_MAPPING":"",0!==e.toneMapping?Te.tonemapping_pars_fragment:"",0!==e.toneMapping?Yb("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Te.encodings_pars_fragment,Xb("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"","\n"].filter(Vo).join("\n")),o=Ic(o),o=ep(o,e),o=ip(o,e),a=Ic(a),a=ep(a,e),a=ip(a,e),o=np(o),a=np(a),e.isWebGL2&&!0!==e.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,x=["#define varying in","300 es"===e.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===e.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const b=v+x+a,M=Qf(s,35633,v+g+o),S=Qf(s,35632,b);if(s.attachShader(m,M),s.attachShader(m,S),void 0!==e.index0AttributeName?s.bindAttribLocation(m,0,e.index0AttributeName):!0===e.morphTargets&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),n.debug.checkShaderErrors){const T=s.getProgramInfoLog(m).trim(),C=s.getShaderInfoLog(M).trim(),F=s.getShaderInfoLog(S).trim();let Y=!0,O=!0;if(!1===s.getProgramParameter(m,35714)){Y=!1;const D=tp(s,M,"vertex"),V=tp(s,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+T+"\n"+D+"\n"+V)}else""!==T?console.warn("THREE.WebGLProgram: Program Info Log:",T):(""===C||""===F)&&(O=!1);O&&(this.diagnostics={runnable:Y,programLog:T,vertexShader:{log:C,prefix:g},fragmentShader:{log:F,prefix:x}})}let A,w;return s.deleteShader(M),s.deleteShader(S),this.getUniforms=function(){return void 0===A&&(A=new cl(s,m)),A},this.getAttributes=function(){return void 0===w&&(w=function qb(n,t){const e={},i=n.getProgramParameter(t,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(t,s),o=r.name;let a=1;35674===r.type&&(a=2),35675===r.type&&(a=3),35676===r.type&&(a=4),e[o]={type:r.type,location:n.getAttribLocation(t,o),locationSize:a}}return e}(s,m)),w},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=e.shaderName,this.id=Hb++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=M,this.fragmentShader=S,this}let ow=0;class aw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.fragmentShader,s=this._getShaderStage(t.vertexShader),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(t);return!1===o.has(s)&&(o.add(s),s.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new lw(t),e.set(t,i)),i}}class lw{constructor(t){this.id=ow++,this.code=t,this.usedTimes=0}}function hw(n,t,e,i,s,r,o){const a=new dc,l=new aw,h=[],c=s.isWebGL2,u=s.logarithmicDepthBuffer,d=s.vertexTextures;let f=s.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function m(w,T,C,F,Y){const O=F.fog,D=Y.geometry,X=(w.isMeshStandardMaterial?e:t).get(w.envMap||(w.isMeshStandardMaterial?F.environment:null)),j=X&&306===X.mapping?X.image.height:null,$=p[w.type];null!==w.precision&&(f=s.getMaxPrecision(w.precision),f!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",f,"instead."));const et=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,pt=void 0!==et?et.length:0;let Q,bt,gt,At,J=0;if(void 0!==D.morphAttributes.position&&(J=1),void 0!==D.morphAttributes.normal&&(J=2),void 0!==D.morphAttributes.color&&(J=3),$){const he=Wn[$];Q=he.vertexShader,bt=he.fragmentShader}else Q=w.vertexShader,bt=w.fragmentShader,l.update(w),gt=l.getVertexShaderID(w),At=l.getFragmentShaderID(w);const nt=n.getRenderTarget(),Lt=w.clearcoat>0,Kt=w.iridescence>0;return{isWebGL2:c,shaderID:$,shaderName:w.type,vertexShader:Q,fragmentShader:bt,defines:w.defines,customVertexShaderID:gt,customFragmentShaderID:At,isRawShaderMaterial:!0===w.isRawShaderMaterial,glslVersion:w.glslVersion,precision:f,instancing:!0===Y.isInstancedMesh,instancingColor:!0===Y.isInstancedMesh&&null!==Y.instanceColor,supportsVertexTextures:d,outputEncoding:null===nt?n.outputEncoding:!0===nt.isXRRenderTarget?nt.texture.encoding:Vs,map:!!w.map,matcap:!!w.matcap,envMap:!!X,envMapMode:X&&X.mapping,envMapCubeUVHeight:j,lightMap:!!w.lightMap,aoMap:!!w.aoMap,emissiveMap:!!w.emissiveMap,bumpMap:!!w.bumpMap,normalMap:!!w.normalMap,objectSpaceNormalMap:1===w.normalMapType,tangentSpaceNormalMap:0===w.normalMapType,decodeVideoTexture:!!w.map&&!0===w.map.isVideoTexture&&w.map.encoding===ii,clearcoat:Lt,clearcoatMap:Lt&&!!w.clearcoatMap,clearcoatRoughnessMap:Lt&&!!w.clearcoatRoughnessMap,clearcoatNormalMap:Lt&&!!w.clearcoatNormalMap,iridescence:Kt,iridescenceMap:Kt&&!!w.iridescenceMap,iridescenceThicknessMap:Kt&&!!w.iridescenceThicknessMap,displacementMap:!!w.displacementMap,roughnessMap:!!w.roughnessMap,metalnessMap:!!w.metalnessMap,specularMap:!!w.specularMap,specularIntensityMap:!!w.specularIntensityMap,specularColorMap:!!w.specularColorMap,opaque:!1===w.transparent&&1===w.blending,alphaMap:!!w.alphaMap,alphaTest:w.alphaTest>0,gradientMap:!!w.gradientMap,sheen:w.sheen>0,sheenColorMap:!!w.sheenColorMap,sheenRoughnessMap:!!w.sheenRoughnessMap,transmission:w.transmission>0,transmissionMap:!!w.transmissionMap,thicknessMap:!!w.thicknessMap,combine:w.combine,vertexTangents:!!w.normalMap&&!!D.attributes.tangent,vertexColors:w.vertexColors,vertexAlphas:!0===w.vertexColors&&!!D.attributes.color&&4===D.attributes.color.itemSize,vertexUvs:!!(w.map||w.bumpMap||w.normalMap||w.specularMap||w.alphaMap||w.emissiveMap||w.roughnessMap||w.metalnessMap||w.clearcoatMap||w.clearcoatRoughnessMap||w.clearcoatNormalMap||w.iridescenceMap||w.iridescenceThicknessMap||w.displacementMap||w.transmissionMap||w.thicknessMap||w.specularIntensityMap||w.specularColorMap||w.sheenColorMap||w.sheenRoughnessMap),uvsVertexOnly:!(w.map||w.bumpMap||w.normalMap||w.specularMap||w.alphaMap||w.emissiveMap||w.roughnessMap||w.metalnessMap||w.clearcoatNormalMap||w.iridescenceMap||w.iridescenceThicknessMap||w.transmission>0||w.transmissionMap||w.thicknessMap||w.specularIntensityMap||w.specularColorMap||w.sheen>0||w.sheenColorMap||w.sheenRoughnessMap||!w.displacementMap),fog:!!O,useFog:!0===w.fog,fogExp2:O&&O.isFogExp2,flatShading:!!w.flatShading,sizeAttenuation:w.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===Y.isSkinnedMesh,morphTargets:void 0!==D.morphAttributes.position,morphNormals:void 0!==D.morphAttributes.normal,morphColors:void 0!==D.morphAttributes.color,morphTargetsCount:pt,morphTextureStride:J,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:w.dithering,shadowMapEnabled:n.shadowMap.enabled&&C.length>0,shadowMapType:n.shadowMap.type,toneMapping:w.toneMapped?n.toneMapping:0,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:w.premultipliedAlpha,doubleSided:2===w.side,flipSided:1===w.side,useDepthPacking:!!w.depthPacking,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionDerivatives:w.extensions&&w.extensions.derivatives,extensionFragDepth:w.extensions&&w.extensions.fragDepth,extensionDrawBuffers:w.extensions&&w.extensions.drawBuffers,extensionShaderTextureLOD:w.extensions&&w.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:w.customProgramCacheKey()}},getProgramCacheKey:function g(w){const T=[];if(w.shaderID?T.push(w.shaderID):(T.push(w.customVertexShaderID),T.push(w.customFragmentShaderID)),void 0!==w.defines)for(const C in w.defines)T.push(C),T.push(w.defines[C]);return!1===w.isRawShaderMaterial&&(function x(w,T){w.push(T.precision),w.push(T.outputEncoding),w.push(T.envMapMode),w.push(T.envMapCubeUVHeight),w.push(T.combine),w.push(T.vertexUvs),w.push(T.fogExp2),w.push(T.sizeAttenuation),w.push(T.morphTargetsCount),w.push(T.morphAttributeCount),w.push(T.numDirLights),w.push(T.numPointLights),w.push(T.numSpotLights),w.push(T.numSpotLightMaps),w.push(T.numHemiLights),w.push(T.numRectAreaLights),w.push(T.numDirLightShadows),w.push(T.numPointLightShadows),w.push(T.numSpotLightShadows),w.push(T.numSpotLightShadowsWithMaps),w.push(T.shadowMapType),w.push(T.toneMapping),w.push(T.numClippingPlanes),w.push(T.numClipIntersection),w.push(T.depthPacking)}(T,w),function v(w,T){a.disableAll(),T.isWebGL2&&a.enable(0),T.supportsVertexTextures&&a.enable(1),T.instancing&&a.enable(2),T.instancingColor&&a.enable(3),T.map&&a.enable(4),T.matcap&&a.enable(5),T.envMap&&a.enable(6),T.lightMap&&a.enable(7),T.aoMap&&a.enable(8),T.emissiveMap&&a.enable(9),T.bumpMap&&a.enable(10),T.normalMap&&a.enable(11),T.objectSpaceNormalMap&&a.enable(12),T.tangentSpaceNormalMap&&a.enable(13),T.clearcoat&&a.enable(14),T.clearcoatMap&&a.enable(15),T.clearcoatRoughnessMap&&a.enable(16),T.clearcoatNormalMap&&a.enable(17),T.iridescence&&a.enable(18),T.iridescenceMap&&a.enable(19),T.iridescenceThicknessMap&&a.enable(20),T.displacementMap&&a.enable(21),T.specularMap&&a.enable(22),T.roughnessMap&&a.enable(23),T.metalnessMap&&a.enable(24),T.gradientMap&&a.enable(25),T.alphaMap&&a.enable(26),T.alphaTest&&a.enable(27),T.vertexColors&&a.enable(28),T.vertexAlphas&&a.enable(29),T.vertexUvs&&a.enable(30),T.vertexTangents&&a.enable(31),T.uvsVertexOnly&&a.enable(32),w.push(a.mask),a.disableAll(),T.fog&&a.enable(0),T.useFog&&a.enable(1),T.flatShading&&a.enable(2),T.logarithmicDepthBuffer&&a.enable(3),T.skinning&&a.enable(4),T.morphTargets&&a.enable(5),T.morphNormals&&a.enable(6),T.morphColors&&a.enable(7),T.premultipliedAlpha&&a.enable(8),T.shadowMapEnabled&&a.enable(9),T.physicallyCorrectLights&&a.enable(10),T.doubleSided&&a.enable(11),T.flipSided&&a.enable(12),T.useDepthPacking&&a.enable(13),T.dithering&&a.enable(14),T.specularIntensityMap&&a.enable(15),T.specularColorMap&&a.enable(16),T.transmission&&a.enable(17),T.transmissionMap&&a.enable(18),T.thicknessMap&&a.enable(19),T.sheen&&a.enable(20),T.sheenColorMap&&a.enable(21),T.sheenRoughnessMap&&a.enable(22),T.decodeVideoTexture&&a.enable(23),T.opaque&&a.enable(24),w.push(a.mask)}(T,w),T.push(n.outputEncoding)),T.push(w.customProgramCacheKey),T.join()},getUniforms:function y(w){const T=p[w.type];let C;return C=T?Iy.clone(Wn[T].uniforms):w.uniforms,C},acquireProgram:function b(w,T){let C;for(let F=0,Y=h.length;F<Y;F++){const O=h[F];if(O.cacheKey===T){C=O,++C.usedTimes;break}}return void 0===C&&(C=new rw(n,T,w,r),h.push(C)),C},releaseProgram:function M(w){if(0==--w.usedTimes){const T=h.indexOf(w);h[T]=h[h.length-1],h.pop(),w.destroy()}},releaseShaderCache:function S(w){l.remove(w)},programs:h,dispose:function A(){l.dispose()}}}function cw(){let n=new WeakMap;return{get:function t(r){let o=n.get(r);return void 0===o&&(o={},n.set(r,o)),o},remove:function e(r){n.delete(r)},update:function i(r,o,a){n.get(r)[o]=a},dispose:function s(){n=new WeakMap}}}function uw(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function rp(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function op(){const n=[];let t=0;const e=[],i=[],s=[];function o(u,d,f,p,m,g){let x=n[t];return void 0===x?(x={id:u.id,object:u,geometry:d,material:f,groupOrder:p,renderOrder:u.renderOrder,z:m,group:g},n[t]=x):(x.id=u.id,x.object=u,x.geometry=d,x.material=f,x.groupOrder=p,x.renderOrder=u.renderOrder,x.z=m,x.group=g),t++,x}return{opaque:e,transmissive:i,transparent:s,init:function r(){t=0,e.length=0,i.length=0,s.length=0},push:function a(u,d,f,p,m,g){const x=o(u,d,f,p,m,g);f.transmission>0?i.push(x):!0===f.transparent?s.push(x):e.push(x)},unshift:function l(u,d,f,p,m,g){const x=o(u,d,f,p,m,g);f.transmission>0?i.unshift(x):!0===f.transparent?s.unshift(x):e.unshift(x)},finish:function c(){for(let u=t,d=n.length;u<d;u++){const f=n[u];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function h(u,d){e.length>1&&e.sort(u||uw),i.length>1&&i.sort(d||rp),s.length>1&&s.sort(d||rp)}}}function dw(){let n=new WeakMap;return{get:function t(i,s){const r=n.get(i);let o;return void 0===r?(o=new op,n.set(i,[o])):s>=r.length?(o=new op,r.push(o)):o=r[s],o},dispose:function e(){n=new WeakMap}}}function fw(){const n={};return{get:function(t){if(void 0!==n[t.id])return n[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new P,color:new Gt};break;case"SpotLight":e={position:new P,direction:new P,color:new Gt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new P,color:new Gt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new P,skyColor:new Gt,groundColor:new Gt};break;case"RectAreaLight":e={color:new Gt,position:new P,halfWidth:new P,halfHeight:new P}}return n[t.id]=e,e}}}let mw=0;function gw(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function _w(n,t){const e=new fw,i=function pw(){const n={};return{get:function(t){if(void 0!==n[t.id])return n[t.id];let e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ft};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ft,shadowCameraNear:1,shadowCameraFar:1e3}}return n[t.id]=e,e}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)s.probe.push(new P);const r=new P,o=new Me,a=new Me;return{setup:function l(c,u){let d=0,f=0,p=0;for(let F=0;F<9;F++)s.probe[F].set(0,0,0);let m=0,g=0,x=0,v=0,y=0,b=0,M=0,S=0,A=0,w=0;c.sort(gw);const T=!0!==u?Math.PI:1;for(let F=0,Y=c.length;F<Y;F++){const O=c[F],D=O.color,V=O.intensity,X=O.distance,j=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)d+=D.r*V*T,f+=D.g*V*T,p+=D.b*V*T;else if(O.isLightProbe)for(let $=0;$<9;$++)s.probe[$].addScaledVector(O.sh.coefficients[$],V);else if(O.isDirectionalLight){const $=e.get(O);if($.color.copy(O.color).multiplyScalar(O.intensity*T),O.castShadow){const et=O.shadow,pt=i.get(O);pt.shadowBias=et.bias,pt.shadowNormalBias=et.normalBias,pt.shadowRadius=et.radius,pt.shadowMapSize=et.mapSize,s.directionalShadow[m]=pt,s.directionalShadowMap[m]=j,s.directionalShadowMatrix[m]=O.shadow.matrix,b++}s.directional[m]=$,m++}else if(O.isSpotLight){const $=e.get(O);$.position.setFromMatrixPosition(O.matrixWorld),$.color.copy(D).multiplyScalar(V*T),$.distance=X,$.coneCos=Math.cos(O.angle),$.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),$.decay=O.decay,s.spot[x]=$;const et=O.shadow;if(O.map&&(s.spotLightMap[A]=O.map,A++,et.updateMatrices(O),O.castShadow&&w++),s.spotLightMatrix[x]=et.matrix,O.castShadow){const pt=i.get(O);pt.shadowBias=et.bias,pt.shadowNormalBias=et.normalBias,pt.shadowRadius=et.radius,pt.shadowMapSize=et.mapSize,s.spotShadow[x]=pt,s.spotShadowMap[x]=j,S++}x++}else if(O.isRectAreaLight){const $=e.get(O);$.color.copy(D).multiplyScalar(V),$.halfWidth.set(.5*O.width,0,0),$.halfHeight.set(0,.5*O.height,0),s.rectArea[v]=$,v++}else if(O.isPointLight){const $=e.get(O);if($.color.copy(O.color).multiplyScalar(O.intensity*T),$.distance=O.distance,$.decay=O.decay,O.castShadow){const et=O.shadow,pt=i.get(O);pt.shadowBias=et.bias,pt.shadowNormalBias=et.normalBias,pt.shadowRadius=et.radius,pt.shadowMapSize=et.mapSize,pt.shadowCameraNear=et.camera.near,pt.shadowCameraFar=et.camera.far,s.pointShadow[g]=pt,s.pointShadowMap[g]=j,s.pointShadowMatrix[g]=O.shadow.matrix,M++}s.point[g]=$,g++}else if(O.isHemisphereLight){const $=e.get(O);$.skyColor.copy(O.color).multiplyScalar(V*T),$.groundColor.copy(O.groundColor).multiplyScalar(V*T),s.hemi[y]=$,y++}}v>0&&(t.isWebGL2||!0===n.has("OES_texture_float_linear")?(s.rectAreaLTC1=It.LTC_FLOAT_1,s.rectAreaLTC2=It.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=It.LTC_HALF_1,s.rectAreaLTC2=It.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=d,s.ambient[1]=f,s.ambient[2]=p;const C=s.hash;(C.directionalLength!==m||C.pointLength!==g||C.spotLength!==x||C.rectAreaLength!==v||C.hemiLength!==y||C.numDirectionalShadows!==b||C.numPointShadows!==M||C.numSpotShadows!==S||C.numSpotMaps!==A)&&(s.directional.length=m,s.spot.length=x,s.rectArea.length=v,s.point.length=g,s.hemi.length=y,s.directionalShadow.length=b,s.directionalShadowMap.length=b,s.pointShadow.length=M,s.pointShadowMap.length=M,s.spotShadow.length=S,s.spotShadowMap.length=S,s.directionalShadowMatrix.length=b,s.pointShadowMatrix.length=M,s.spotLightMatrix.length=S+A-w,s.spotLightMap.length=A,s.numSpotLightShadowsWithMaps=w,C.directionalLength=m,C.pointLength=g,C.spotLength=x,C.rectAreaLength=v,C.hemiLength=y,C.numDirectionalShadows=b,C.numPointShadows=M,C.numSpotShadows=S,C.numSpotMaps=A,s.version=mw++)},setupView:function h(c,u){let d=0,f=0,p=0,m=0,g=0;const x=u.matrixWorldInverse;for(let v=0,y=c.length;v<y;v++){const b=c[v];if(b.isDirectionalLight){const M=s.directional[d];M.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(x),d++}else if(b.isSpotLight){const M=s.spot[p];M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(x),M.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(x),p++}else if(b.isRectAreaLight){const M=s.rectArea[m];M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(x),a.identity(),o.copy(b.matrixWorld),o.premultiply(x),a.extractRotation(o),M.halfWidth.set(.5*b.width,0,0),M.halfHeight.set(0,.5*b.height,0),M.halfWidth.applyMatrix4(a),M.halfHeight.applyMatrix4(a),m++}else if(b.isPointLight){const M=s.point[f];M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(x),f++}else if(b.isHemisphereLight){const M=s.hemi[g];M.direction.setFromMatrixPosition(b.matrixWorld),M.direction.transformDirection(x),g++}}},state:s}}function ap(n,t){const e=new _w(n,t),i=[],s=[];return{init:function r(){i.length=0,s.length=0},state:{lightsArray:i,shadowsArray:s,lights:e},setupLights:function l(u){e.setup(i,u)},setupLightsView:function h(u){e.setupView(i,u)},pushLight:function o(u){i.push(u)},pushShadow:function a(u){s.push(u)}}}function yw(n,t){let e=new WeakMap;return{get:function i(r,o=0){const a=e.get(r);let l;return void 0===a?(l=new ap(n,t),e.set(r,[l])):o>=a.length?(l=new ap(n,t),a.push(l)):l=a[o],l},dispose:function s(){e=new WeakMap}}}class lp extends ko{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class hp extends ko{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new P,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function bw(n,t,e){let i=new Mc;const s=new ft,r=new ft,o=new qe,a=new lp({depthPacking:3201}),l=new hp,h={},c=e.maxTextureSize,u={0:1,1:0,2:2},d=new Ts({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ft},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Ie;p.setAttribute("position",new Pi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Yi(p,d),g=this;function x(b,M){const S=t.update(m);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,f.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===b.mapPass&&(b.mapPass=new qs(s.x,s.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,n.setRenderTarget(b.mapPass),n.clear(),n.renderBufferDirect(M,null,S,d,m,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,n.setRenderTarget(b.map),n.clear(),n.renderBufferDirect(M,null,S,f,m,null)}function v(b,M,S,A,w,T){let C=null;const F=!0===S.isPointLight?b.customDistanceMaterial:b.customDepthMaterial;if(void 0!==F)C=F;else if(C=!0===S.isPointLight?l:a,n.localClippingEnabled&&!0===M.clipShadows&&Array.isArray(M.clippingPlanes)&&0!==M.clippingPlanes.length||M.displacementMap&&0!==M.displacementScale||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const Y=C.uuid,O=M.uuid;let D=h[Y];void 0===D&&(D={},h[Y]=D);let V=D[O];void 0===V&&(V=C.clone(),D[O]=V),C=V}return C.visible=M.visible,C.wireframe=M.wireframe,C.side=3===T?null!==M.shadowSide?M.shadowSide:M.side:null!==M.shadowSide?M.shadowSide:u[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,!0===S.isPointLight&&!0===C.isMeshDistanceMaterial&&(C.referencePosition.setFromMatrixPosition(S.matrixWorld),C.nearDistance=A,C.farDistance=w),C}function y(b,M,S,A,w){if(!1===b.visible)return;if(b.layers.test(M.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&3===w)&&(!b.frustumCulled||i.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,b.matrixWorld);const F=t.update(b),Y=b.material;if(Array.isArray(Y)){const O=F.groups;for(let D=0,V=O.length;D<V;D++){const X=O[D],j=Y[X.materialIndex];if(j&&j.visible){const $=v(b,j,A,S.near,S.far,w);n.renderBufferDirect(S,null,F,$,b,X)}}}else if(Y.visible){const O=v(b,Y,A,S.near,S.far,w);n.renderBufferDirect(S,null,F,O,b,null)}}const C=b.children;for(let F=0,Y=C.length;F<Y;F++)y(C[F],M,S,A,w)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(b,M,S){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===b.length)return;const A=n.getRenderTarget(),w=n.getActiveCubeFace(),T=n.getActiveMipmapLevel(),C=n.state;C.setBlending(0),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let F=0,Y=b.length;F<Y;F++){const O=b[F],D=O.shadow;if(void 0===D){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(!1===D.autoUpdate&&!1===D.needsUpdate)continue;s.copy(D.mapSize);const V=D.getFrameExtents();s.multiply(V),r.copy(D.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(r.x=Math.floor(c/V.x),s.x=r.x*V.x,D.mapSize.x=r.x),s.y>c&&(r.y=Math.floor(c/V.y),s.y=r.y*V.y,D.mapSize.y=r.y)),null===D.map&&(D.map=new qs(s.x,s.y,3!==this.type?{minFilter:xi,magFilter:xi}:{}),D.map.texture.name=O.name+".shadowMap",D.camera.updateProjectionMatrix()),n.setRenderTarget(D.map),n.clear();const X=D.getViewportCount();for(let j=0;j<X;j++){const $=D.getViewport(j);o.set(r.x*$.x,r.y*$.y,r.x*$.z,r.y*$.w),C.viewport(o),D.updateMatrices(O,j),i=D.getFrustum(),y(M,S,D.camera,O,this.type)}!0!==D.isPointLightShadow&&3===this.type&&x(D,S),D.needsUpdate=!1}g.needsUpdate=!1,n.setRenderTarget(A,w,T)}}function ww(n,t,e){const i=e.isWebGL2,a=new function s(){let U=!1;const rt=new qe;let yt=null;const kt=new qe(0,0,0,0);return{setMask:function(qt){yt!==qt&&!U&&(n.colorMask(qt,qt,qt,qt),yt=qt)},setLocked:function(qt){U=qt},setClear:function(qt,Ye,Li,zi,Sr){!0===Sr&&(qt*=zi,Ye*=zi,Li*=zi),rt.set(qt,Ye,Li,zi),!1===kt.equals(rt)&&(n.clearColor(qt,Ye,Li,zi),kt.copy(rt))},reset:function(){U=!1,yt=null,kt.set(-1,0,0,0)}}},l=new function r(){let U=!1,rt=null,yt=null,kt=null;return{setTest:function(qt){qt?te(2929):Lt(2929)},setMask:function(qt){rt!==qt&&!U&&(n.depthMask(qt),rt=qt)},setFunc:function(qt){if(yt!==qt){switch(qt){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}yt=qt}},setLocked:function(qt){U=qt},setClear:function(qt){kt!==qt&&(n.clearDepth(qt),kt=qt)},reset:function(){U=!1,rt=null,yt=null,kt=null}}},h=new function o(){let U=!1,rt=null,yt=null,kt=null,qt=null,Ye=null,Li=null,zi=null,Sr=null;return{setTest:function(oi){U||(oi?te(2960):Lt(2960))},setMask:function(oi){rt!==oi&&!U&&(n.stencilMask(oi),rt=oi)},setFunc:function(oi,gs,Mn){(yt!==oi||kt!==gs||qt!==Mn)&&(n.stencilFunc(oi,gs,Mn),yt=oi,kt=gs,qt=Mn)},setOp:function(oi,gs,Mn){(Ye!==oi||Li!==gs||zi!==Mn)&&(n.stencilOp(oi,gs,Mn),Ye=oi,Li=gs,zi=Mn)},setLocked:function(oi){U=oi},setClear:function(oi){Sr!==oi&&(n.clearStencil(oi),Sr=oi)},reset:function(){U=!1,rt=null,yt=null,kt=null,qt=null,Ye=null,Li=null,zi=null,Sr=null}}},c=new WeakMap,u=new WeakMap;let d={},f={},p=new WeakMap,m=[],g=null,x=!1,v=null,y=null,b=null,M=null,S=null,A=null,w=null,T=!1,C=null,F=null,Y=null,O=null,D=null;const V=n.getParameter(35661);let X=!1,j=0;const $=n.getParameter(7938);-1!==$.indexOf("WebGL")?(j=parseFloat(/^WebGL (\d)/.exec($)[1]),X=j>=1):-1!==$.indexOf("OpenGL ES")&&(j=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),X=j>=2);let et=null,pt={};const J=n.getParameter(3088),Q=n.getParameter(2978),bt=(new qe).fromArray(J),gt=(new qe).fromArray(Q);function At(U,rt,yt){const kt=new Uint8Array(4),qt=n.createTexture();n.bindTexture(U,qt),n.texParameteri(U,10241,9728),n.texParameteri(U,10240,9728);for(let Ye=0;Ye<yt;Ye++)n.texImage2D(rt+Ye,0,6408,1,1,0,6408,5121,kt);return qt}const nt={};function te(U){!0!==d[U]&&(n.enable(U),d[U]=!0)}function Lt(U){!1!==d[U]&&(n.disable(U),d[U]=!1)}nt[3553]=At(3553,3553,1),nt[34067]=At(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),h.setClear(0),te(2929),l.setFunc(3),Et(!1),pe(1),te(2884),Mt(0);const ht={[z]:32774,101:32778,102:32779};if(i)ht[103]=32775,ht[104]=32776;else{const U=t.get("EXT_blend_minmax");null!==U&&(ht[103]=U.MIN_EXT,ht[104]=U.MAX_EXT)}const ot={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function Mt(U,rt,yt,kt,qt,Ye,Li,zi){if(0!==U){if(!1===x&&(te(3042),x=!0),5===U)qt=qt||rt,Ye=Ye||yt,Li=Li||kt,(rt!==y||qt!==S)&&(n.blendEquationSeparate(ht[rt],ht[qt]),y=rt,S=qt),(yt!==b||kt!==M||Ye!==A||Li!==w)&&(n.blendFuncSeparate(ot[yt],ot[kt],ot[Ye],ot[Li]),b=yt,M=kt,A=Ye,w=Li),v=U,T=!1;else if(U!==v||zi!==T){if((y!==z||S!==z)&&(n.blendEquation(32774),y=z,S=z),zi)switch(U){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",U)}else switch(U){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",U)}b=null,M=null,A=null,w=null,v=U,T=zi}}else!0===x&&(Lt(3042),x=!1)}function Et(U){C!==U&&(n.frontFace(U?2304:2305),C=U)}function pe(U){0!==U?(te(2884),U!==F&&n.cullFace(1===U?1029:2===U?1028:1032)):Lt(2884),F=U}function ee(U,rt,yt){U?(te(32823),(O!==rt||D!==yt)&&(n.polygonOffset(rt,yt),O=rt,D=yt)):Lt(32823)}return{buffers:{color:a,depth:l,stencil:h},enable:te,disable:Lt,bindFramebuffer:function Kt(U,rt){return f[U]!==rt&&(n.bindFramebuffer(U,rt),f[U]=rt,i&&(36009===U&&(f[36160]=rt),36160===U&&(f[36009]=rt)),!0)},drawBuffers:function Tt(U,rt){let yt=m,kt=!1;if(U)if(yt=p.get(rt),void 0===yt&&(yt=[],p.set(rt,yt)),U.isWebGLMultipleRenderTargets){const qt=U.texture;if(yt.length!==qt.length||36064!==yt[0]){for(let Ye=0,Li=qt.length;Ye<Li;Ye++)yt[Ye]=36064+Ye;yt.length=qt.length,kt=!0}}else 36064!==yt[0]&&(yt[0]=36064,kt=!0);else 1029!==yt[0]&&(yt[0]=1029,kt=!0);kt&&(e.isWebGL2?n.drawBuffers(yt):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(yt))},useProgram:function he(U){return g!==U&&(n.useProgram(U),g=U,!0)},setBlending:Mt,setMaterial:function Ft(U,rt){2===U.side?Lt(2884):te(2884);let yt=1===U.side;rt&&(yt=!yt),Et(yt),1===U.blending&&!1===U.transparent?Mt(0):Mt(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.premultipliedAlpha),l.setFunc(U.depthFunc),l.setTest(U.depthTest),l.setMask(U.depthWrite),a.setMask(U.colorWrite);const kt=U.stencilWrite;h.setTest(kt),kt&&(h.setMask(U.stencilWriteMask),h.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),h.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),ee(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),!0===U.alphaToCoverage?te(32926):Lt(32926)},setFlipSided:Et,setCullFace:pe,setLineWidth:function se(U){U!==Y&&(X&&n.lineWidth(U),Y=U)},setPolygonOffset:ee,setScissorTest:function je(U){U?te(3089):Lt(3089)},activeTexture:function ze(U){void 0===U&&(U=33984+V-1),et!==U&&(n.activeTexture(U),et=U)},bindTexture:function L(U,rt,yt){void 0===yt&&(yt=null===et?33984+V-1:et);let kt=pt[yt];void 0===kt&&(kt={type:void 0,texture:void 0},pt[yt]=kt),(kt.type!==U||kt.texture!==rt)&&(et!==yt&&(n.activeTexture(yt),et=yt),n.bindTexture(U,rt||nt[U]),kt.type=U,kt.texture=rt)},unbindTexture:function E(){const U=pt[et];void 0!==U&&void 0!==U.type&&(n.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)},compressedTexImage2D:function K(){try{n.compressedTexImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},compressedTexImage3D:function _t(){try{n.compressedTexImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texImage2D:function zt(){try{n.texImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texImage3D:function Ot(){try{n.texImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},updateUBOMapping:function Oe(U,rt){let yt=u.get(rt);void 0===yt&&(yt=new WeakMap,u.set(rt,yt));let kt=yt.get(U);void 0===kt&&(kt=n.getUniformBlockIndex(rt,U.name),yt.set(U,kt))},uniformBlockBinding:function Fe(U,rt){const kt=u.get(rt).get(U);c.get(rt)!==kt&&(n.uniformBlockBinding(rt,kt,U.__bindingPointIndex),c.set(rt,kt))},texStorage2D:function H(){try{n.texStorage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texStorage3D:function Dt(){try{n.texStorage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texSubImage2D:function wt(){try{n.texSubImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texSubImage3D:function Rt(){try{n.texSubImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},compressedTexSubImage2D:function ce(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},compressedTexSubImage3D:function B(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},scissor:function Zt(U){!1===bt.equals(U)&&(n.scissor(U.x,U.y,U.z,U.w),bt.copy(U))},viewport:function Yt(U){!1===gt.equals(U)&&(n.viewport(U.x,U.y,U.z,U.w),gt.copy(U))},reset:function Je(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),d={},et=null,pt={},f={},p=new WeakMap,m=[],g=null,x=!1,v=null,y=null,b=null,M=null,S=null,A=null,w=null,T=!1,C=null,F=null,Y=null,O=null,D=null,bt.set(0,0,n.canvas.width,n.canvas.height),gt.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),h.reset()}}}function Mw(n,t,e,i,s,r,o){const a=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,c=s.maxTextureSize,u=s.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function v(L,E){return x?new OffscreenCanvas(L,E):Bo("canvas")}function y(L,E,K,_t){let wt=1;if((L.width>_t||L.height>_t)&&(wt=_t/Math.max(L.width,L.height)),wt<1||!0===E){if(typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&L instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&L instanceof ImageBitmap){const Rt=E?Ga:Math.floor,ce=Rt(wt*L.width),B=Rt(wt*L.height);void 0===m&&(m=v(ce,B));const H=K?v(ce,B):m;return H.width=ce,H.height=B,H.getContext("2d").drawImage(L,0,0,ce,B),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+L.width+"x"+L.height+") to ("+ce+"x"+B+")."),H}return"data"in L&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+L.width+"x"+L.height+")."),L}return L}function b(L){return Qh(L.width)&&Qh(L.height)}function S(L,E){return L.generateMipmaps&&E&&L.minFilter!==xi&&L.minFilter!==vi}function A(L){n.generateMipmap(L)}function w(L,E,K,_t,wt=!1){if(!1===a)return E;if(null!==L){if(void 0!==n[L])return n[L];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+L+"'")}let Rt=E;return 6403===E&&(5126===K&&(Rt=33326),5131===K&&(Rt=33325),5121===K&&(Rt=33321)),33319===E&&(5126===K&&(Rt=33328),5131===K&&(Rt=33327),5121===K&&(Rt=33323)),6408===E&&(5126===K&&(Rt=34836),5131===K&&(Rt=34842),5121===K&&(Rt=_t===ii&&!1===wt?35907:32856),32819===K&&(Rt=32854),32820===K&&(Rt=32855)),(33325===Rt||33326===Rt||33327===Rt||33328===Rt||34842===Rt||34836===Rt)&&t.get("EXT_color_buffer_float"),Rt}function T(L,E,K){return!0===S(L,K)||L.isFramebufferTexture&&L.minFilter!==xi&&L.minFilter!==vi?Math.log2(Math.max(E.width,E.height))+1:void 0!==L.mipmaps&&L.mipmaps.length>0?L.mipmaps.length:L.isCompressedTexture&&Array.isArray(L.image)?E.mipmaps.length:1}function C(L){return L===xi||1004===L||1005===L?9728:9729}function F(L){const E=L.target;E.removeEventListener("dispose",F),function O(L){const E=i.get(L);if(void 0===E.__webglInit)return;const K=L.source,_t=g.get(K);if(_t){const wt=_t[E.__cacheKey];wt.usedTimes--,0===wt.usedTimes&&D(L),0===Object.keys(_t).length&&g.delete(K)}i.remove(L)}(E),E.isVideoTexture&&p.delete(E)}function Y(L){const E=L.target;E.removeEventListener("dispose",Y),function V(L){const E=L.texture,K=i.get(L),_t=i.get(E);if(void 0!==_t.__webglTexture&&(n.deleteTexture(_t.__webglTexture),o.memory.textures--),L.depthTexture&&L.depthTexture.dispose(),L.isWebGLCubeRenderTarget)for(let wt=0;wt<6;wt++)n.deleteFramebuffer(K.__webglFramebuffer[wt]),K.__webglDepthbuffer&&n.deleteRenderbuffer(K.__webglDepthbuffer[wt]);else{if(n.deleteFramebuffer(K.__webglFramebuffer),K.__webglDepthbuffer&&n.deleteRenderbuffer(K.__webglDepthbuffer),K.__webglMultisampledFramebuffer&&n.deleteFramebuffer(K.__webglMultisampledFramebuffer),K.__webglColorRenderbuffer)for(let wt=0;wt<K.__webglColorRenderbuffer.length;wt++)K.__webglColorRenderbuffer[wt]&&n.deleteRenderbuffer(K.__webglColorRenderbuffer[wt]);K.__webglDepthRenderbuffer&&n.deleteRenderbuffer(K.__webglDepthRenderbuffer)}if(L.isWebGLMultipleRenderTargets)for(let wt=0,Rt=E.length;wt<Rt;wt++){const ce=i.get(E[wt]);ce.__webglTexture&&(n.deleteTexture(ce.__webglTexture),o.memory.textures--),i.remove(E[wt])}i.remove(E),i.remove(L)}(E)}function D(L){const E=i.get(L);n.deleteTexture(E.__webglTexture),delete g.get(L.source)[E.__cacheKey],o.memory.textures--}let X=0;function pt(L,E){const K=i.get(L);if(L.isVideoTexture&&function je(L){const E=o.render.frame;p.get(L)!==E&&(p.set(L,E),L.update())}(L),!1===L.isRenderTargetTexture&&L.version>0&&K.__version!==L.version){const _t=L.image;if(null===_t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==_t.complete)return void Lt(K,L,E);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}e.bindTexture(3553,K.__webglTexture,33984+E)}const gt={1e3:10497,[Wi]:33071,1002:33648},At={[xi]:9728,1004:9984,1005:9986,[vi]:9729,1007:9985,[Gs]:9987};function nt(L,E,K){if(K?(n.texParameteri(L,10242,gt[E.wrapS]),n.texParameteri(L,10243,gt[E.wrapT]),(32879===L||35866===L)&&n.texParameteri(L,32882,gt[E.wrapR]),n.texParameteri(L,10240,At[E.magFilter]),n.texParameteri(L,10241,At[E.minFilter])):(n.texParameteri(L,10242,33071),n.texParameteri(L,10243,33071),(32879===L||35866===L)&&n.texParameteri(L,32882,33071),(E.wrapS!==Wi||E.wrapT!==Wi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(L,10240,C(E.magFilter)),n.texParameteri(L,10241,C(E.minFilter)),E.minFilter!==xi&&E.minFilter!==vi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const _t=t.get("EXT_texture_filter_anisotropic");if(E.magFilter===xi||1005!==E.minFilter&&E.minFilter!==Gs||E.type===xs&&!1===t.has("OES_texture_float_linear")||!1===a&&E.type===Po&&!1===t.has("OES_texture_half_float_linear"))return;(E.anisotropy>1||i.get(E).__currentAnisotropy)&&(n.texParameterf(L,_t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,s.getMaxAnisotropy())),i.get(E).__currentAnisotropy=E.anisotropy)}}function te(L,E){let K=!1;void 0===L.__webglInit&&(L.__webglInit=!0,E.addEventListener("dispose",F));const _t=E.source;let wt=g.get(_t);void 0===wt&&(wt={},g.set(_t,wt));const Rt=function et(L){const E=[];return E.push(L.wrapS),E.push(L.wrapT),E.push(L.wrapR||0),E.push(L.magFilter),E.push(L.minFilter),E.push(L.anisotropy),E.push(L.internalFormat),E.push(L.format),E.push(L.type),E.push(L.generateMipmaps),E.push(L.premultiplyAlpha),E.push(L.flipY),E.push(L.unpackAlignment),E.push(L.encoding),E.join()}(E);if(Rt!==L.__cacheKey){void 0===wt[Rt]&&(wt[Rt]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,K=!0),wt[Rt].usedTimes++;const ce=wt[L.__cacheKey];void 0!==ce&&(wt[L.__cacheKey].usedTimes--,0===ce.usedTimes&&D(E)),L.__cacheKey=Rt,L.__webglTexture=wt[Rt].texture}return K}function Lt(L,E,K){let _t=3553;(E.isDataArrayTexture||E.isCompressedArrayTexture)&&(_t=35866),E.isData3DTexture&&(_t=32879);const wt=te(L,E),Rt=E.source;e.bindTexture(_t,L.__webglTexture,33984+K);const ce=i.get(Rt);if(Rt.version!==ce.__version||!0===wt){e.activeTexture(33984+K),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const B=function M(L){return!a&&(L.wrapS!==Wi||L.wrapT!==Wi||L.minFilter!==xi&&L.minFilter!==vi)}(E)&&!1===b(E.image);let H=y(E.image,B,!1,c);H=ze(E,H);const Dt=b(H)||a,zt=r.convert(E.format,E.encoding);let Yt,Ot=r.convert(E.type),Zt=w(E.internalFormat,zt,Ot,E.encoding,E.isVideoTexture);nt(_t,E,Dt);const Oe=E.mipmaps,Fe=a&&!0!==E.isVideoTexture,Je=void 0===ce.__version||!0===wt,U=T(E,H,Dt);if(E.isDepthTexture)Zt=6402,a?Zt=E.type===xs?36012:E.type===Hs?33190:E.type===Cr?35056:33189:E.type===xs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),E.format===Ws&&6402===Zt&&1012!==E.type&&E.type!==Hs&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),E.type=Hs,Ot=r.convert(E.type)),E.format===Ir&&6402===Zt&&(Zt=34041,E.type!==Cr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),E.type=Cr,Ot=r.convert(E.type))),Je&&(Fe?e.texStorage2D(3553,1,Zt,H.width,H.height):e.texImage2D(3553,0,Zt,H.width,H.height,0,zt,Ot,null));else if(E.isDataTexture)if(Oe.length>0&&Dt){Fe&&Je&&e.texStorage2D(3553,U,Zt,Oe[0].width,Oe[0].height);for(let rt=0,yt=Oe.length;rt<yt;rt++)Yt=Oe[rt],Fe?e.texSubImage2D(3553,rt,0,0,Yt.width,Yt.height,zt,Ot,Yt.data):e.texImage2D(3553,rt,Zt,Yt.width,Yt.height,0,zt,Ot,Yt.data);E.generateMipmaps=!1}else Fe?(Je&&e.texStorage2D(3553,U,Zt,H.width,H.height),e.texSubImage2D(3553,0,0,0,H.width,H.height,zt,Ot,H.data)):e.texImage2D(3553,0,Zt,H.width,H.height,0,zt,Ot,H.data);else if(E.isCompressedTexture)if(E.isCompressedArrayTexture){Fe&&Je&&e.texStorage3D(35866,U,Zt,Oe[0].width,Oe[0].height,H.depth);for(let rt=0,yt=Oe.length;rt<yt;rt++)Yt=Oe[rt],E.format!==gn?null!==zt?Fe?e.compressedTexSubImage3D(35866,rt,0,0,0,Yt.width,Yt.height,H.depth,zt,Yt.data,0,0):e.compressedTexImage3D(35866,rt,Zt,Yt.width,Yt.height,H.depth,0,Yt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Fe?e.texSubImage3D(35866,rt,0,0,0,Yt.width,Yt.height,H.depth,zt,Ot,Yt.data):e.texImage3D(35866,rt,Zt,Yt.width,Yt.height,H.depth,0,zt,Ot,Yt.data)}else{Fe&&Je&&e.texStorage2D(3553,U,Zt,Oe[0].width,Oe[0].height);for(let rt=0,yt=Oe.length;rt<yt;rt++)Yt=Oe[rt],E.format!==gn?null!==zt?Fe?e.compressedTexSubImage2D(3553,rt,0,0,Yt.width,Yt.height,zt,Yt.data):e.compressedTexImage2D(3553,rt,Zt,Yt.width,Yt.height,0,Yt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Fe?e.texSubImage2D(3553,rt,0,0,Yt.width,Yt.height,zt,Ot,Yt.data):e.texImage2D(3553,rt,Zt,Yt.width,Yt.height,0,zt,Ot,Yt.data)}else if(E.isDataArrayTexture)Fe?(Je&&e.texStorage3D(35866,U,Zt,H.width,H.height,H.depth),e.texSubImage3D(35866,0,0,0,0,H.width,H.height,H.depth,zt,Ot,H.data)):e.texImage3D(35866,0,Zt,H.width,H.height,H.depth,0,zt,Ot,H.data);else if(E.isData3DTexture)Fe?(Je&&e.texStorage3D(32879,U,Zt,H.width,H.height,H.depth),e.texSubImage3D(32879,0,0,0,0,H.width,H.height,H.depth,zt,Ot,H.data)):e.texImage3D(32879,0,Zt,H.width,H.height,H.depth,0,zt,Ot,H.data);else if(E.isFramebufferTexture){if(Je)if(Fe)e.texStorage2D(3553,U,Zt,H.width,H.height);else{let rt=H.width,yt=H.height;for(let kt=0;kt<U;kt++)e.texImage2D(3553,kt,Zt,rt,yt,0,zt,Ot,null),rt>>=1,yt>>=1}}else if(Oe.length>0&&Dt){Fe&&Je&&e.texStorage2D(3553,U,Zt,Oe[0].width,Oe[0].height);for(let rt=0,yt=Oe.length;rt<yt;rt++)Yt=Oe[rt],Fe?e.texSubImage2D(3553,rt,0,0,zt,Ot,Yt):e.texImage2D(3553,rt,Zt,zt,Ot,Yt);E.generateMipmaps=!1}else Fe?(Je&&e.texStorage2D(3553,U,Zt,H.width,H.height),e.texSubImage2D(3553,0,0,0,zt,Ot,H)):e.texImage2D(3553,0,Zt,zt,Ot,H);S(E,Dt)&&A(_t),ce.__version=Rt.version,E.onUpdate&&E.onUpdate(E)}L.__version=E.version}function Tt(L,E,K,_t,wt){const Rt=r.convert(K.format,K.encoding),ce=r.convert(K.type),B=w(K.internalFormat,Rt,ce,K.encoding);i.get(E).__hasExternalTextures||(32879===wt||35866===wt?e.texImage3D(wt,0,B,E.width,E.height,E.depth,0,Rt,ce,null):e.texImage2D(wt,0,B,E.width,E.height,0,Rt,ce,null)),e.bindFramebuffer(36160,L),ee(E)?d.framebufferTexture2DMultisampleEXT(36160,_t,wt,i.get(K).__webglTexture,0,se(E)):(3553===wt||wt>=34069&&wt<=34074)&&n.framebufferTexture2D(36160,_t,wt,i.get(K).__webglTexture,0),e.bindFramebuffer(36160,null)}function he(L,E,K){if(n.bindRenderbuffer(36161,L),E.depthBuffer&&!E.stencilBuffer){let _t=33189;if(K||ee(E)){const wt=E.depthTexture;wt&&wt.isDepthTexture&&(wt.type===xs?_t=36012:wt.type===Hs&&(_t=33190));const Rt=se(E);ee(E)?d.renderbufferStorageMultisampleEXT(36161,Rt,_t,E.width,E.height):n.renderbufferStorageMultisample(36161,Rt,_t,E.width,E.height)}else n.renderbufferStorage(36161,_t,E.width,E.height);n.framebufferRenderbuffer(36160,36096,36161,L)}else if(E.depthBuffer&&E.stencilBuffer){const _t=se(E);K&&!1===ee(E)?n.renderbufferStorageMultisample(36161,_t,35056,E.width,E.height):ee(E)?d.renderbufferStorageMultisampleEXT(36161,_t,35056,E.width,E.height):n.renderbufferStorage(36161,34041,E.width,E.height),n.framebufferRenderbuffer(36160,33306,36161,L)}else{const _t=!0===E.isWebGLMultipleRenderTargets?E.texture:[E.texture];for(let wt=0;wt<_t.length;wt++){const Rt=_t[wt],ce=r.convert(Rt.format,Rt.encoding),B=r.convert(Rt.type),H=w(Rt.internalFormat,ce,B,Rt.encoding),Dt=se(E);K&&!1===ee(E)?n.renderbufferStorageMultisample(36161,Dt,H,E.width,E.height):ee(E)?d.renderbufferStorageMultisampleEXT(36161,Dt,H,E.width,E.height):n.renderbufferStorage(36161,H,E.width,E.height)}}n.bindRenderbuffer(36161,null)}function ot(L){const E=i.get(L),K=!0===L.isWebGLCubeRenderTarget;if(L.depthTexture&&!E.__autoAllocateDepthBuffer){if(K)throw new Error("target.depthTexture not supported in Cube render targets");!function ht(L,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,L),!E.depthTexture||!E.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),pt(E.depthTexture,0);const _t=i.get(E.depthTexture).__webglTexture,wt=se(E);if(E.depthTexture.format===Ws)ee(E)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,_t,0,wt):n.framebufferTexture2D(36160,36096,3553,_t,0);else{if(E.depthTexture.format!==Ir)throw new Error("Unknown depthTexture format");ee(E)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,_t,0,wt):n.framebufferTexture2D(36160,33306,3553,_t,0)}}(E.__webglFramebuffer,L)}else if(K){E.__webglDepthbuffer=[];for(let _t=0;_t<6;_t++)e.bindFramebuffer(36160,E.__webglFramebuffer[_t]),E.__webglDepthbuffer[_t]=n.createRenderbuffer(),he(E.__webglDepthbuffer[_t],L,!1)}else e.bindFramebuffer(36160,E.__webglFramebuffer),E.__webglDepthbuffer=n.createRenderbuffer(),he(E.__webglDepthbuffer,L,!1);e.bindFramebuffer(36160,null)}function se(L){return Math.min(u,L.samples)}function ee(L){const E=i.get(L);return a&&L.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==E.__useRenderToTexture}function ze(L,E){const K=L.encoding,_t=L.format,wt=L.type;return!0===L.isCompressedTexture||!0===L.isVideoTexture||1035===L.format||K!==Vs&&(K===ii?!1===a?!0===t.has("EXT_sRGB")&&_t===gn?(L.format=1035,L.minFilter=vi,L.generateMipmaps=!1):E=vf.sRGBToLinear(E):(_t!==gn||wt!==zs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",K)),E}this.allocateTextureUnit=function $(){const L=X;return L>=l&&console.warn("THREE.WebGLTextures: Trying to use "+L+" texture units while this GPU supports only "+l),X+=1,L},this.resetTextureUnits=function j(){X=0},this.setTexture2D=pt,this.setTexture2DArray=function J(L,E){const K=i.get(L);L.version>0&&K.__version!==L.version?Lt(K,L,E):e.bindTexture(35866,K.__webglTexture,33984+E)},this.setTexture3D=function Q(L,E){const K=i.get(L);L.version>0&&K.__version!==L.version?Lt(K,L,E):e.bindTexture(32879,K.__webglTexture,33984+E)},this.setTextureCube=function bt(L,E){const K=i.get(L);L.version>0&&K.__version!==L.version?function Kt(L,E,K){if(6!==E.image.length)return;const _t=te(L,E),wt=E.source;e.bindTexture(34067,L.__webglTexture,33984+K);const Rt=i.get(wt);if(wt.version!==Rt.__version||!0===_t){e.activeTexture(33984+K),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const ce=E.isCompressedTexture||E.image[0].isCompressedTexture,B=E.image[0]&&E.image[0].isDataTexture,H=[];for(let rt=0;rt<6;rt++)H[rt]=ce||B?B?E.image[rt].image:E.image[rt]:y(E.image[rt],!1,!0,h),H[rt]=ze(E,H[rt]);const Dt=H[0],zt=b(Dt)||a,Ot=r.convert(E.format,E.encoding),Zt=r.convert(E.type),Yt=w(E.internalFormat,Ot,Zt,E.encoding),Oe=a&&!0!==E.isVideoTexture,Fe=void 0===Rt.__version||!0===_t;let U,Je=T(E,Dt,zt);if(nt(34067,E,zt),ce){Oe&&Fe&&e.texStorage2D(34067,Je,Yt,Dt.width,Dt.height);for(let rt=0;rt<6;rt++){U=H[rt].mipmaps;for(let yt=0;yt<U.length;yt++){const kt=U[yt];E.format!==gn?null!==Ot?Oe?e.compressedTexSubImage2D(34069+rt,yt,0,0,kt.width,kt.height,Ot,kt.data):e.compressedTexImage2D(34069+rt,yt,Yt,kt.width,kt.height,0,kt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Oe?e.texSubImage2D(34069+rt,yt,0,0,kt.width,kt.height,Ot,Zt,kt.data):e.texImage2D(34069+rt,yt,Yt,kt.width,kt.height,0,Ot,Zt,kt.data)}}}else{U=E.mipmaps,Oe&&Fe&&(U.length>0&&Je++,e.texStorage2D(34067,Je,Yt,H[0].width,H[0].height));for(let rt=0;rt<6;rt++)if(B){Oe?e.texSubImage2D(34069+rt,0,0,0,H[rt].width,H[rt].height,Ot,Zt,H[rt].data):e.texImage2D(34069+rt,0,Yt,H[rt].width,H[rt].height,0,Ot,Zt,H[rt].data);for(let yt=0;yt<U.length;yt++){const qt=U[yt].image[rt].image;Oe?e.texSubImage2D(34069+rt,yt+1,0,0,qt.width,qt.height,Ot,Zt,qt.data):e.texImage2D(34069+rt,yt+1,Yt,qt.width,qt.height,0,Ot,Zt,qt.data)}}else{Oe?e.texSubImage2D(34069+rt,0,0,0,Ot,Zt,H[rt]):e.texImage2D(34069+rt,0,Yt,Ot,Zt,H[rt]);for(let yt=0;yt<U.length;yt++){const kt=U[yt];Oe?e.texSubImage2D(34069+rt,yt+1,0,0,Ot,Zt,kt.image[rt]):e.texImage2D(34069+rt,yt+1,Yt,Ot,Zt,kt.image[rt])}}}S(E,zt)&&A(34067),Rt.__version=wt.version,E.onUpdate&&E.onUpdate(E)}L.__version=E.version}(K,L,E):e.bindTexture(34067,K.__webglTexture,33984+E)},this.rebindTextures=function Mt(L,E,K){const _t=i.get(L);void 0!==E&&Tt(_t.__webglFramebuffer,L,L.texture,36064,3553),void 0!==K&&ot(L)},this.setupRenderTarget=function Ft(L){const E=L.texture,K=i.get(L),_t=i.get(E);L.addEventListener("dispose",Y),!0!==L.isWebGLMultipleRenderTargets&&(void 0===_t.__webglTexture&&(_t.__webglTexture=n.createTexture()),_t.__version=E.version,o.memory.textures++);const wt=!0===L.isWebGLCubeRenderTarget,Rt=!0===L.isWebGLMultipleRenderTargets,ce=b(L)||a;if(wt){K.__webglFramebuffer=[];for(let B=0;B<6;B++)K.__webglFramebuffer[B]=n.createFramebuffer()}else{if(K.__webglFramebuffer=n.createFramebuffer(),Rt)if(s.drawBuffers){const B=L.texture;for(let H=0,Dt=B.length;H<Dt;H++){const zt=i.get(B[H]);void 0===zt.__webglTexture&&(zt.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&L.samples>0&&!1===ee(L)){const B=Rt?E:[E];K.__webglMultisampledFramebuffer=n.createFramebuffer(),K.__webglColorRenderbuffer=[],e.bindFramebuffer(36160,K.__webglMultisampledFramebuffer);for(let H=0;H<B.length;H++){const Dt=B[H];K.__webglColorRenderbuffer[H]=n.createRenderbuffer(),n.bindRenderbuffer(36161,K.__webglColorRenderbuffer[H]);const zt=r.convert(Dt.format,Dt.encoding),Ot=r.convert(Dt.type),Zt=w(Dt.internalFormat,zt,Ot,Dt.encoding,!0===L.isXRRenderTarget),Yt=se(L);n.renderbufferStorageMultisample(36161,Yt,Zt,L.width,L.height),n.framebufferRenderbuffer(36160,36064+H,36161,K.__webglColorRenderbuffer[H])}n.bindRenderbuffer(36161,null),L.depthBuffer&&(K.__webglDepthRenderbuffer=n.createRenderbuffer(),he(K.__webglDepthRenderbuffer,L,!0)),e.bindFramebuffer(36160,null)}}if(wt){e.bindTexture(34067,_t.__webglTexture),nt(34067,E,ce);for(let B=0;B<6;B++)Tt(K.__webglFramebuffer[B],L,E,36064,34069+B);S(E,ce)&&A(34067),e.unbindTexture()}else if(Rt){const B=L.texture;for(let H=0,Dt=B.length;H<Dt;H++){const zt=B[H],Ot=i.get(zt);e.bindTexture(3553,Ot.__webglTexture),nt(3553,zt,ce),Tt(K.__webglFramebuffer,L,zt,36064+H,3553),S(zt,ce)&&A(3553)}e.unbindTexture()}else{let B=3553;(L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(a?B=L.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(B,_t.__webglTexture),nt(B,E,ce),Tt(K.__webglFramebuffer,L,E,36064,B),S(E,ce)&&A(B),e.unbindTexture()}L.depthBuffer&&ot(L)},this.updateRenderTargetMipmap=function Et(L){const E=b(L)||a,K=!0===L.isWebGLMultipleRenderTargets?L.texture:[L.texture];for(let _t=0,wt=K.length;_t<wt;_t++){const Rt=K[_t];if(S(Rt,E)){const ce=L.isWebGLCubeRenderTarget?34067:3553,B=i.get(Rt).__webglTexture;e.bindTexture(ce,B),A(ce),e.unbindTexture()}}},this.updateMultisampleRenderTarget=function pe(L){if(a&&L.samples>0&&!1===ee(L)){const E=L.isWebGLMultipleRenderTargets?L.texture:[L.texture],K=L.width,_t=L.height;let wt=16384;const Rt=[],ce=L.stencilBuffer?33306:36096,B=i.get(L),H=!0===L.isWebGLMultipleRenderTargets;if(H)for(let Dt=0;Dt<E.length;Dt++)e.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Dt,36161,null),e.bindFramebuffer(36160,B.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Dt,3553,null,0);e.bindFramebuffer(36008,B.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,B.__webglFramebuffer);for(let Dt=0;Dt<E.length;Dt++){Rt.push(36064+Dt),L.depthBuffer&&Rt.push(ce);const zt=void 0!==B.__ignoreDepthValues&&B.__ignoreDepthValues;if(!1===zt&&(L.depthBuffer&&(wt|=256),L.stencilBuffer&&(wt|=1024)),H&&n.framebufferRenderbuffer(36008,36064,36161,B.__webglColorRenderbuffer[Dt]),!0===zt&&(n.invalidateFramebuffer(36008,[ce]),n.invalidateFramebuffer(36009,[ce])),H){const Ot=i.get(E[Dt]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Ot,0)}n.blitFramebuffer(0,0,K,_t,0,0,K,_t,wt,9728),f&&n.invalidateFramebuffer(36008,Rt)}if(e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null),H)for(let Dt=0;Dt<E.length;Dt++){e.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Dt,36161,B.__webglColorRenderbuffer[Dt]);const zt=i.get(E[Dt]).__webglTexture;e.bindFramebuffer(36160,B.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Dt,3553,zt,0)}e.bindFramebuffer(36009,B.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ot,this.setupFrameBufferTexture=Tt,this.useMultisampledRTT=ee}function Sw(n,t,e){const i=e.isWebGL2;return{convert:function s(r,o=null){let a;if(r===zs)return 5121;if(1017===r)return 32819;if(1018===r)return 32820;if(1010===r)return 5120;if(1011===r)return 5122;if(1012===r)return 5123;if(1013===r)return 5124;if(r===Hs)return 5125;if(r===xs)return 5126;if(r===Po)return i?5131:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===r)return 6406;if(r===gn)return 6408;if(1024===r)return 6409;if(1025===r)return 6410;if(r===Ws)return 6402;if(r===Ir)return 34041;if(1022===r)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===r)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===r)return 6403;if(1029===r)return 36244;if(1030===r)return 33319;if(1031===r)return 33320;if(1033===r)return 36249;if(33776===r||33777===r||33778===r||33779===r)if(o===ii){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===r)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===r)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===r)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===r)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===r)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===r)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===r||37496===r){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===r)return o===ii?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===r)return o===ii?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===r){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===r)return o===ii?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}return r===Cr?i?34042:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[r]?n[r]:null}}}class Tw extends Bi{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Xo extends _n{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ew={type:"move"};class Rc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Xo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Xo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Xo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,h=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(h&&t.hand){o=!0;for(const m of t.hand.values()){const g=e.getJointPose(m,i),x=this._getHandJoint(h,m);null!==g&&(x.matrix.fromArray(g.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.jointRadius=g.radius),x.visible=null!==g}const d=h.joints["index-finger-tip"].position.distanceTo(h.joints["thumb-tip"].position),f=.02,p=.005;h.inputState.pinching&&d>f+p?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&d<=f-p&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==l&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));null!==a&&(s=e.getPose(t.targetRaySpace,i),null===s&&null!==r&&(s=r),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Ew)))}return null!==a&&(a.visible=null!==s),null!==l&&(l.visible=null!==r),null!==h&&(h.visible=null!==o),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new Xo;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class Aw extends Tn{constructor(t,e,i,s,r,o,a,l,h,c){if((c=void 0!==c?c:Ws)!==Ws&&c!==Ir)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ws&&(i=Hs),void 0===i&&c===Ir&&(i=Cr),super(null,s,r,o,a,l,c,i,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:xi,this.minFilter=void 0!==l?l:xi,this.flipY=!1,this.generateMipmaps=!1}}class Cw extends Ys{constructor(t,e){super();const i=this;let s=null,r=1,o=null,a="local-floor",l=null,h=null,c=null,u=null,d=null,f=null;const p=e.getContextAttributes();let m=null,g=null;const x=[],v=[],y=new Set,b=new Map,M=new Bi;M.layers.enable(1),M.viewport=new qe;const S=new Bi;S.layers.enable(2),S.viewport=new qe;const A=[M,S],w=new Tw;w.layers.enable(1),w.layers.enable(2);let T=null,C=null;function F(J){const Q=v.indexOf(J.inputSource);if(-1===Q)return;const bt=x[Q];void 0!==bt&&bt.dispatchEvent({type:J.type,data:J.inputSource})}function Y(){s.removeEventListener("select",F),s.removeEventListener("selectstart",F),s.removeEventListener("selectend",F),s.removeEventListener("squeeze",F),s.removeEventListener("squeezestart",F),s.removeEventListener("squeezeend",F),s.removeEventListener("end",Y),s.removeEventListener("inputsourceschange",O);for(let J=0;J<x.length;J++){const Q=v[J];null!==Q&&(v[J]=null,x[J].disconnect(Q))}T=null,C=null,t.setRenderTarget(m),d=null,u=null,c=null,s=null,g=null,pt.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function O(J){for(let Q=0;Q<J.removed.length;Q++){const bt=J.removed[Q],gt=v.indexOf(bt);gt>=0&&(v[gt]=null,x[gt].disconnect(bt))}for(let Q=0;Q<J.added.length;Q++){const bt=J.added[Q];let gt=v.indexOf(bt);if(-1===gt){for(let nt=0;nt<x.length;nt++){if(nt>=v.length){v.push(bt),gt=nt;break}if(null===v[nt]){v[nt]=bt,gt=nt;break}}if(-1===gt)break}const At=x[gt];At&&At.connect(bt)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let Q=x[J];return void 0===Q&&(Q=new Rc,x[J]=Q),Q.getTargetRaySpace()},this.getControllerGrip=function(J){let Q=x[J];return void 0===Q&&(Q=new Rc,x[J]=Q),Q.getGripSpace()},this.getHand=function(J){let Q=x[J];return void 0===Q&&(Q=new Rc,x[J]=Q),Q.getHandSpace()},this.setFramebufferScaleFactor=function(J){r=J,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(J){a=J,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(J){l=J},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=function(){var J=(0,Nt.Z)(function*(Q){if(s=Q,null!==s){if(m=t.getRenderTarget(),s.addEventListener("select",F),s.addEventListener("selectstart",F),s.addEventListener("selectend",F),s.addEventListener("squeeze",F),s.addEventListener("squeezestart",F),s.addEventListener("squeezeend",F),s.addEventListener("end",Y),s.addEventListener("inputsourceschange",O),!0!==p.xrCompatible&&(yield e.makeXRCompatible()),void 0===s.renderState.layers||!1===t.capabilities.isWebGL2)d=new XRWebGLLayer(s,e,{antialias:void 0!==s.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r}),s.updateRenderState({baseLayer:d}),g=new qs(d.framebufferWidth,d.framebufferHeight,{format:gn,type:zs,encoding:t.outputEncoding,stencilBuffer:p.stencil});else{let bt=null,gt=null,At=null;p.depth&&(At=p.stencil?35056:33190,bt=p.stencil?Ir:Ws,gt=p.stencil?Cr:Hs);const nt={colorFormat:32856,depthFormat:At,scaleFactor:r};c=new XRWebGLBinding(s,e),u=c.createProjectionLayer(nt),s.updateRenderState({layers:[u]}),g=new qs(u.textureWidth,u.textureHeight,{format:gn,type:zs,depthTexture:new Aw(u.textureWidth,u.textureHeight,gt,void 0,void 0,void 0,void 0,void 0,void 0,bt),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0}),t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=yield s.requestReferenceSpace(a),pt.setContext(s),pt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(Q){return J.apply(this,arguments)}}();const D=new P,V=new P;function j(J,Q){null===Q?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices(Q.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(null===s)return;w.near=S.near=M.near=J.near,w.far=S.far=M.far=J.far,(T!==w.near||C!==w.far)&&(s.updateRenderState({depthNear:w.near,depthFar:w.far}),T=w.near,C=w.far);const Q=J.parent,bt=w.cameras;j(w,Q);for(let At=0;At<bt.length;At++)j(bt[At],Q);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),J.matrix.copy(w.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale);const gt=J.children;for(let At=0,nt=gt.length;At<nt;At++)gt[At].updateMatrixWorld(!0);2===bt.length?function X(J,Q,bt){D.setFromMatrixPosition(Q.matrixWorld),V.setFromMatrixPosition(bt.matrixWorld);const gt=D.distanceTo(V),At=Q.projectionMatrix.elements,nt=bt.projectionMatrix.elements,te=At[14]/(At[10]-1),Lt=At[14]/(At[10]+1),Kt=(At[9]+1)/At[5],Tt=(At[9]-1)/At[5],he=(At[8]-1)/At[0],ht=(nt[8]+1)/nt[0],ot=te*he,Mt=te*ht,Ft=gt/(-he+ht),Et=Ft*-he;Q.matrixWorld.decompose(J.position,J.quaternion,J.scale),J.translateX(Et),J.translateZ(Ft),J.matrixWorld.compose(J.position,J.quaternion,J.scale),J.matrixWorldInverse.copy(J.matrixWorld).invert();const pe=te+Ft,se=Lt+Ft;J.projectionMatrix.makePerspective(ot-Et,Mt+(gt-Et),Kt*Lt/se*pe,Tt*Lt/se*pe,pe,se)}(w,M,S):w.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(J){null!==u&&(u.fixedFoveation=J),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=J)},this.getPlanes=function(){return y};let $=null;const pt=new Bf;pt.setAnimationLoop(function et(J,Q){if(h=Q.getViewerPose(l||o),f=Q,null!==h){const bt=h.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let gt=!1;bt.length!==w.cameras.length&&(w.cameras.length=0,gt=!0);for(let At=0;At<bt.length;At++){const nt=bt[At];let te=null;if(null!==d)te=d.getViewport(nt);else{const Kt=c.getViewSubImage(u,nt);te=Kt.viewport,0===At&&(t.setRenderTargetTextures(g,Kt.colorTexture,u.ignoreDepthValues?void 0:Kt.depthStencilTexture),t.setRenderTarget(g))}let Lt=A[At];void 0===Lt&&(Lt=new Bi,Lt.layers.enable(At),Lt.viewport=new qe,A[At]=Lt),Lt.matrix.fromArray(nt.transform.matrix),Lt.projectionMatrix.fromArray(nt.projectionMatrix),Lt.viewport.set(te.x,te.y,te.width,te.height),0===At&&w.matrix.copy(Lt.matrix),!0===gt&&w.cameras.push(Lt)}}for(let bt=0;bt<x.length;bt++){const gt=v[bt],At=x[bt];null!==gt&&void 0!==At&&At.update(gt,Q,l||o)}if($&&$(J,Q),Q.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Q.detectedPlanes});let bt=null;for(const gt of y)Q.detectedPlanes.has(gt)||(null===bt&&(bt=[]),bt.push(gt));if(null!==bt)for(const gt of bt)y.delete(gt),b.delete(gt),i.dispatchEvent({type:"planeremoved",data:gt});for(const gt of Q.detectedPlanes)if(y.has(gt)){const At=b.get(gt);gt.lastChangedTime>At&&(b.set(gt,gt.lastChangedTime),i.dispatchEvent({type:"planechanged",data:gt}))}else y.add(gt),b.set(gt,Q.lastChangedTime),i.dispatchEvent({type:"planeadded",data:gt})}f=null}),this.setAnimationLoop=function(J){$=J},this.dispose=function(){}}}function Iw(n,t){function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,1===g.side&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),1===g.side&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const x=t.get(g).envMap;if(x&&(m.envMap.value=x,m.flipEnvMap.value=x.isCubeTexture&&!1===x.isRenderTargetTexture?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;const b=!0!==n.physicallyCorrectLights?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*b}let v,y;g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity),g.map?v=g.map:g.specularMap?v=g.specularMap:g.displacementMap?v=g.displacementMap:g.normalMap?v=g.normalMap:g.bumpMap?v=g.bumpMap:g.roughnessMap?v=g.roughnessMap:g.metalnessMap?v=g.metalnessMap:g.alphaMap?v=g.alphaMap:g.emissiveMap?v=g.emissiveMap:g.clearcoatMap?v=g.clearcoatMap:g.clearcoatNormalMap?v=g.clearcoatNormalMap:g.clearcoatRoughnessMap?v=g.clearcoatRoughnessMap:g.iridescenceMap?v=g.iridescenceMap:g.iridescenceThicknessMap?v=g.iridescenceThicknessMap:g.specularIntensityMap?v=g.specularIntensityMap:g.specularColorMap?v=g.specularColorMap:g.transmissionMap?v=g.transmissionMap:g.thicknessMap?v=g.thicknessMap:g.sheenColorMap?v=g.sheenColorMap:g.sheenRoughnessMap&&(v=g.sheenRoughnessMap),void 0!==v&&(v.isWebGLRenderTarget&&(v=v.texture),!0===v.matrixAutoUpdate&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix)),g.aoMap?y=g.aoMap:g.lightMap&&(y=g.lightMap),void 0!==y&&(y.isWebGLRenderTarget&&(y=y.texture),!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uv2Transform.value.copy(y.matrix))}return{refreshFogUniforms:function e(m,g){g.color.getRGB(m.fogColor.value,Of(n)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)},refreshMaterialUniforms:function i(m,g,x,v,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),function c(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}(m,g)):g.isMeshPhongMaterial?(s(m,g),function h(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}(m,g)):g.isMeshStandardMaterial?(s(m,g),function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}(m,g),g.isMeshPhysicalMaterial&&function d(m,g,x){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,1===g.side&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=x.texture,m.transmissionSamplerSize.value.set(x.width,x.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}(m,g,y)):g.isMeshMatcapMaterial?(s(m,g),function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),function p(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(function r(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}(m,g),g.isLineDashedMaterial&&function o(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}(m,g)):g.isPointsMaterial?function a(m,g,x,v){let y;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*x,m.scale.value=.5*v,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?y=g.map:g.alphaMap&&(y=g.alphaMap),void 0!==y&&(!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}(m,g,x,v):g.isSpriteMaterial?function l(m,g){let x;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),void 0!==x&&(!0===x.matrixAutoUpdate&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function Rw(n,t,e,i){let s={},r={},o=[];const a=e.isWebGL2?n.getParameter(35375):0;function f(v,y,b){const M=v.value;if(void 0===b[y]){if("number"==typeof M)b[y]=M;else{const S=Array.isArray(M)?M:[M],A=[];for(let w=0;w<S.length;w++)A.push(S[w].clone());b[y]=A}return!0}if("number"==typeof M){if(b[y]!==M)return b[y]=M,!0}else{const S=Array.isArray(b[y])?b[y]:[b[y]],A=Array.isArray(M)?M:[M];for(let w=0;w<S.length;w++){const T=S[w];if(!1===T.equals(A[w]))return T.copy(A[w]),!0}}return!1}function m(v){const y={boundary:0,storage:0};return"number"==typeof v?(y.boundary=4,y.storage=4):v.isVector2?(y.boundary=8,y.storage=8):v.isVector3||v.isColor?(y.boundary=16,y.storage=12):v.isVector4?(y.boundary=16,y.storage=16):v.isMatrix3?(y.boundary=48,y.storage=48):v.isMatrix4?(y.boundary=64,y.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),y}function g(v){const y=v.target;y.removeEventListener("dispose",g);const b=o.indexOf(y.__bindingPointIndex);o.splice(b,1),n.deleteBuffer(s[y.id]),delete s[y.id],delete r[y.id]}return{bind:function l(v,y){i.uniformBlockBinding(v,y.program)},update:function h(v,y){let b=s[v.id];void 0===b&&(function p(v){const y=v.uniforms;let b=0;let S=0;for(let A=0,w=y.length;A<w;A++){const T=y[A],C={boundary:0,storage:0},F=Array.isArray(T.value)?T.value:[T.value];for(let Y=0,O=F.length;Y<O;Y++){const V=m(F[Y]);C.boundary+=V.boundary,C.storage+=V.storage}if(T.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=b,A>0){S=b%16;const Y=16-S;0!==S&&Y-C.boundary<0&&(b+=16-S,T.__offset=b)}b+=C.storage}S=b%16,S>0&&(b+=16-S),v.__size=b,v.__cache={}}(v),b=function c(v){const y=function u(){for(let v=0;v<a;v++)if(-1===o.indexOf(v))return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();v.__bindingPointIndex=y;const b=n.createBuffer(),M=v.__size,S=v.usage;return n.bindBuffer(35345,b),n.bufferData(35345,M,S),n.bindBuffer(35345,null),n.bindBufferBase(35345,y,b),b}(v),s[v.id]=b,v.addEventListener("dispose",g)),i.updateUBOMapping(v,y.program);const S=t.render.frame;r[v.id]!==S&&(function d(v){const b=v.uniforms,M=v.__cache;n.bindBuffer(35345,s[v.id]);for(let S=0,A=b.length;S<A;S++){const w=b[S];if(!0===f(w,S,M)){const T=w.__offset,C=Array.isArray(w.value)?w.value:[w.value];let F=0;for(let Y=0;Y<C.length;Y++){const O=C[Y],D=m(O);"number"==typeof O?(w.__data[0]=O,n.bufferSubData(35345,T+F,w.__data)):O.isMatrix3?(w.__data[0]=O.elements[0],w.__data[1]=O.elements[1],w.__data[2]=O.elements[2],w.__data[3]=O.elements[0],w.__data[4]=O.elements[3],w.__data[5]=O.elements[4],w.__data[6]=O.elements[5],w.__data[7]=O.elements[0],w.__data[8]=O.elements[6],w.__data[9]=O.elements[7],w.__data[10]=O.elements[8],w.__data[11]=O.elements[0]):(O.toArray(w.__data,F),F+=D.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,T,w.__data)}}n.bindBuffer(35345,null)}(v),r[v.id]=S)},dispose:function x(){for(const v in s)n.deleteBuffer(s[v]);o=[],s={},r={}}}}function cp(n={}){this.isWebGLRenderer=!0;const t=void 0!==n.canvas?n.canvas:function Pw(){const n=Bo("canvas");return n.style.display="block",n}(),e=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,s=void 0===n.stencil||n.stencil,r=void 0!==n.antialias&&n.antialias,o=void 0===n.premultipliedAlpha||n.premultipliedAlpha,a=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,l=void 0!==n.powerPreference?n.powerPreference:"default",h=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let c;c=null!==e?e.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let u=null,d=null;const f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Vs,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,x=0,v=0,y=null,b=-1,M=null;const S=new qe,A=new qe;let w=null,T=t.width,C=t.height,F=1,Y=null,O=null;const D=new qe(0,0,T,C),V=new qe(0,0,T,C);let X=!1;const j=new Mc;let $=!1,et=!1,pt=null;const J=new Me,Q=new ft,bt=new P,gt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function At(){return null===y?F:1}let Lt,Kt,Tt,he,ht,ot,Mt,Ft,Et,pe,se,ee,je,ze,L,E,K,_t,wt,Rt,ce,B,H,Dt,nt=e;function te(I,Z){for(let at=0;at<I.length;at++){const ut=t.getContext(I[at],Z);if(null!==ut)return ut}return null}try{const I={alpha:!0,depth:i,stencil:s,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r148"),t.addEventListener("webglcontextlost",Zt,!1),t.addEventListener("webglcontextrestored",Yt,!1),t.addEventListener("webglcontextcreationerror",Oe,!1),null===nt){const Z=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&Z.shift(),nt=te(Z,I),null===nt)throw te(Z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===nt.getShaderPrecisionFormat&&(nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(I){throw console.error("THREE.WebGLRenderer: "+I.message),I}function zt(){Lt=new Vv(nt),Kt=new Uv(nt,Lt,n),Lt.init(Kt),B=new Sw(nt,Lt,Kt),Tt=new ww(nt,Lt,Kt),he=new Zv,ht=new cw,ot=new Mw(nt,Lt,Tt,ht,Kt,B,he),Mt=new Gv(m),Ft=new Wv(m),Et=new Fy(nt,Kt),H=new Fv(nt,Lt,Et,Kt),pe=new Xv(nt,Et,he,H),se=new Jv(nt,pe,Et,he),wt=new jv(nt,Kt,ot),E=new kv(ht),ee=new hw(m,Mt,Ft,Lt,Kt,H,E),je=new Iw(m,ht),ze=new dw,L=new yw(Lt,Kt),_t=new Bv(m,Mt,Ft,Tt,se,c,o),K=new bw(m,se,Kt),Dt=new Rw(nt,he,Kt,Tt),Rt=new Nv(nt,Lt,he,Kt),ce=new Yv(nt,Lt,he,Kt),he.programs=ee.programs,m.capabilities=Kt,m.extensions=Lt,m.properties=ht,m.renderLists=ze,m.shadowMap=K,m.state=Tt,m.info=he}zt();const Ot=new Cw(m,nt);function Zt(I){I.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function Yt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const I=he.autoReset,Z=K.enabled,at=K.autoUpdate,W=K.needsUpdate,ut=K.type;zt(),he.autoReset=I,K.enabled=Z,K.autoUpdate=at,K.needsUpdate=W,K.type=ut}function Oe(I){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",I.statusMessage)}function Fe(I){const Z=I.target;Z.removeEventListener("dispose",Fe),function Je(I){(function U(I){const Z=ht.get(I).programs;void 0!==Z&&(Z.forEach(function(at){ee.releaseProgram(at)}),I.isShaderMaterial&&ee.releaseShaderCache(I))})(I),ht.remove(I)}(Z)}this.xr=Ot,this.getContext=function(){return nt},this.getContextAttributes=function(){return nt.getContextAttributes()},this.forceContextLoss=function(){const I=Lt.get("WEBGL_lose_context");I&&I.loseContext()},this.forceContextRestore=function(){const I=Lt.get("WEBGL_lose_context");I&&I.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(I){void 0!==I&&(F=I,this.setSize(T,C,!1))},this.getSize=function(I){return I.set(T,C)},this.setSize=function(I,Z,at){Ot.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=I,C=Z,t.width=Math.floor(I*F),t.height=Math.floor(Z*F),!1!==at&&(t.style.width=I+"px",t.style.height=Z+"px"),this.setViewport(0,0,I,Z))},this.getDrawingBufferSize=function(I){return I.set(T*F,C*F).floor()},this.setDrawingBufferSize=function(I,Z,at){T=I,C=Z,F=at,t.width=Math.floor(I*at),t.height=Math.floor(Z*at),this.setViewport(0,0,I,Z)},this.getCurrentViewport=function(I){return I.copy(S)},this.getViewport=function(I){return I.copy(D)},this.setViewport=function(I,Z,at,W){I.isVector4?D.set(I.x,I.y,I.z,I.w):D.set(I,Z,at,W),Tt.viewport(S.copy(D).multiplyScalar(F).floor())},this.getScissor=function(I){return I.copy(V)},this.setScissor=function(I,Z,at,W){I.isVector4?V.set(I.x,I.y,I.z,I.w):V.set(I,Z,at,W),Tt.scissor(A.copy(V).multiplyScalar(F).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(I){Tt.setScissorTest(X=I)},this.setOpaqueSort=function(I){Y=I},this.setTransparentSort=function(I){O=I},this.getClearColor=function(I){return I.copy(_t.getClearColor())},this.setClearColor=function(){_t.setClearColor.apply(_t,arguments)},this.getClearAlpha=function(){return _t.getClearAlpha()},this.setClearAlpha=function(){_t.setClearAlpha.apply(_t,arguments)},this.clear=function(I=!0,Z=!0,at=!0){let W=0;I&&(W|=16384),Z&&(W|=256),at&&(W|=1024),nt.clear(W)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Zt,!1),t.removeEventListener("webglcontextrestored",Yt,!1),t.removeEventListener("webglcontextcreationerror",Oe,!1),ze.dispose(),L.dispose(),ht.dispose(),Mt.dispose(),Ft.dispose(),se.dispose(),H.dispose(),Dt.dispose(),ee.dispose(),Ot.dispose(),Ot.removeEventListener("sessionstart",kt),Ot.removeEventListener("sessionend",qt),pt&&(pt.dispose(),pt=null),Ye.stop()},this.renderBufferDirect=function(I,Z,at,W,ut,re){null===Z&&(Z=gt);const xe=ut.isMesh&&ut.matrixWorld.determinant()<0,Ae=function O2(I,Z,at,W,ut){!0!==Z.isScene&&(Z=gt),ot.resetTextureUnits();const re=Z.fog,Ae=null===y?m.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:Vs,Re=(W.isMeshStandardMaterial?Ft:Mt).get(W.envMap||(W.isMeshStandardMaterial?Z.environment:null)),He=!0===W.vertexColors&&!!at.attributes.color&&4===at.attributes.color.itemSize,Ne=!!W.normalMap&&!!at.attributes.tangent,Ue=!!at.morphAttributes.position,Mi=!!at.morphAttributes.normal,pn=!!at.morphAttributes.color,_s=W.toneMapped?m.toneMapping:0,Tr=at.morphAttributes.position||at.morphAttributes.normal||at.morphAttributes.color,Si=void 0!==Tr?Tr.length:0,ke=ht.get(W),Gd=d.state.lights;!0!==$||!0!==et&&I===M||E.setState(W,I,I===M&&W.id===b);let Oi=!1;W.version===ke.__version?(ke.needsLights&&ke.lightsStateVersion!==Gd.state.version||ke.outputEncoding!==Ae||ut.isInstancedMesh&&!1===ke.instancing||!ut.isInstancedMesh&&!0===ke.instancing||ut.isSkinnedMesh&&!1===ke.skinning||!ut.isSkinnedMesh&&!0===ke.skinning||ke.envMap!==Re||!0===W.fog&&ke.fog!==re||void 0!==ke.numClippingPlanes&&(ke.numClippingPlanes!==E.numPlanes||ke.numIntersection!==E.numIntersection)||ke.vertexAlphas!==He||ke.vertexTangents!==Ne||ke.morphTargets!==Ue||ke.morphNormals!==Mi||ke.morphColors!==pn||ke.toneMapping!==_s||!0===Kt.isWebGL2&&ke.morphTargetsCount!==Si)&&(Oi=!0):(Oi=!0,ke.__version=W.version);let Er=ke.currentProgram;!0===Oi&&(Er=Mn(W,Z,ut));let w0=!1,Ia=!1,zd=!1;const ji=Er.getUniforms(),Ar=ke.uniforms;if(Tt.useProgram(Er.program)&&(w0=!0,Ia=!0,zd=!0),W.id!==b&&(b=W.id,Ia=!0),w0||M!==I){if(ji.setValue(nt,"projectionMatrix",I.projectionMatrix),Kt.logarithmicDepthBuffer&&ji.setValue(nt,"logDepthBufFC",2/(Math.log(I.far+1)/Math.LN2)),M!==I&&(M=I,Ia=!0,zd=!0),W.isShaderMaterial||W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshStandardMaterial||W.envMap){const mn=ji.map.cameraPosition;void 0!==mn&&mn.setValue(nt,bt.setFromMatrixPosition(I.matrixWorld))}(W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshLambertMaterial||W.isMeshBasicMaterial||W.isMeshStandardMaterial||W.isShaderMaterial)&&ji.setValue(nt,"isOrthographic",!0===I.isOrthographicCamera),(W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshLambertMaterial||W.isMeshBasicMaterial||W.isMeshStandardMaterial||W.isShaderMaterial||W.isShadowMaterial||ut.isSkinnedMesh)&&ji.setValue(nt,"viewMatrix",I.matrixWorldInverse)}if(ut.isSkinnedMesh){ji.setOptional(nt,ut,"bindMatrix"),ji.setOptional(nt,ut,"bindMatrixInverse");const mn=ut.skeleton;mn&&(Kt.floatVertexTextures?(null===mn.boneTexture&&mn.computeBoneTexture(),ji.setValue(nt,"boneTexture",mn.boneTexture,ot),ji.setValue(nt,"boneTextureSize",mn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Hd=at.morphAttributes;if((void 0!==Hd.position||void 0!==Hd.normal||void 0!==Hd.color&&!0===Kt.isWebGL2)&&wt.update(ut,at,W,Er),(Ia||ke.receiveShadow!==ut.receiveShadow)&&(ke.receiveShadow=ut.receiveShadow,ji.setValue(nt,"receiveShadow",ut.receiveShadow)),W.isMeshGouraudMaterial&&null!==W.envMap&&(Ar.envMap.value=Re,Ar.flipEnvMap.value=Re.isCubeTexture&&!1===Re.isRenderTargetTexture?-1:1),Ia&&(ji.setValue(nt,"toneMappingExposure",m.toneMappingExposure),ke.needsLights&&function B2(I,Z){I.ambientLightColor.needsUpdate=Z,I.lightProbe.needsUpdate=Z,I.directionalLights.needsUpdate=Z,I.directionalLightShadows.needsUpdate=Z,I.pointLights.needsUpdate=Z,I.pointLightShadows.needsUpdate=Z,I.spotLights.needsUpdate=Z,I.spotLightShadows.needsUpdate=Z,I.rectAreaLights.needsUpdate=Z,I.hemisphereLights.needsUpdate=Z}(Ar,zd),re&&!0===W.fog&&je.refreshFogUniforms(Ar,re),je.refreshMaterialUniforms(Ar,W,F,C,pt),cl.upload(nt,ke.uniformsList,Ar,ot)),W.isShaderMaterial&&!0===W.uniformsNeedUpdate&&(cl.upload(nt,ke.uniformsList,Ar,ot),W.uniformsNeedUpdate=!1),W.isSpriteMaterial&&ji.setValue(nt,"center",ut.center),ji.setValue(nt,"modelViewMatrix",ut.modelViewMatrix),ji.setValue(nt,"normalMatrix",ut.normalMatrix),ji.setValue(nt,"modelMatrix",ut.matrixWorld),W.isShaderMaterial||W.isRawShaderMaterial){const mn=W.uniformsGroups;for(let Wd=0,N2=mn.length;Wd<N2;Wd++)if(Kt.isWebGL2){const M0=mn[Wd];Dt.update(M0,Er),Dt.bind(M0,Er)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Er}(I,Z,at,W,ut);Tt.setMaterial(W,xe);let Re=at.index,He=1;!0===W.wireframe&&(Re=pe.getWireframeAttribute(at),He=2);const Ne=at.drawRange,Ue=at.attributes.position;let Mi=Ne.start*He,pn=(Ne.start+Ne.count)*He;null!==re&&(Mi=Math.max(Mi,re.start*He),pn=Math.min(pn,(re.start+re.count)*He)),null!==Re?(Mi=Math.max(Mi,0),pn=Math.min(pn,Re.count)):null!=Ue&&(Mi=Math.max(Mi,0),pn=Math.min(pn,Ue.count));const _s=pn-Mi;if(_s<0||_s===1/0)return;H.setup(ut,W,Ae,at,Re);let Tr,Si=Rt;if(null!==Re&&(Tr=Et.get(Re),Si=ce,Si.setIndex(Tr)),ut.isMesh)!0===W.wireframe?(Tt.setLineWidth(W.wireframeLinewidth*At()),Si.setMode(1)):Si.setMode(4);else if(ut.isLine){let ke=W.linewidth;void 0===ke&&(ke=1),Tt.setLineWidth(ke*At()),Si.setMode(ut.isLineSegments?1:ut.isLineLoop?2:3)}else ut.isPoints?Si.setMode(0):ut.isSprite&&Si.setMode(4);if(ut.isInstancedMesh)Si.renderInstances(Mi,_s,ut.count);else if(at.isInstancedBufferGeometry){const Gd=Math.min(at.instanceCount,void 0!==at._maxInstanceCount?at._maxInstanceCount:1/0);Si.renderInstances(Mi,_s,Gd)}else Si.render(Mi,_s)},this.compile=function(I,Z){function at(W,ut,re){!0===W.transparent&&3===W.side?(W.side=1,W.needsUpdate=!0,Mn(W,ut,re),W.side=0,W.needsUpdate=!0,Mn(W,ut,re),W.side=3):Mn(W,ut,re)}d=L.get(I),d.init(),p.push(d),I.traverseVisible(function(W){W.isLight&&W.layers.test(Z.layers)&&(d.pushLight(W),W.castShadow&&d.pushShadow(W))}),d.setupLights(m.physicallyCorrectLights),I.traverse(function(W){const ut=W.material;if(ut)if(Array.isArray(ut))for(let re=0;re<ut.length;re++)at(ut[re],I,W);else at(ut,I,W)}),p.pop(),d=null};let rt=null;function kt(){Ye.stop()}function qt(){Ye.start()}const Ye=new Bf;function Li(I,Z,at,W){if(!1===I.visible)return;if(I.layers.test(Z.layers))if(I.isGroup)at=I.renderOrder;else if(I.isLOD)!0===I.autoUpdate&&I.update(Z);else if(I.isLight)d.pushLight(I),I.castShadow&&d.pushShadow(I);else if(I.isSprite){if(!I.frustumCulled||j.intersectsSprite(I)){W&&bt.setFromMatrixPosition(I.matrixWorld).applyMatrix4(J);const xe=se.update(I),Ae=I.material;Ae.visible&&u.push(I,xe,Ae,at,bt.z,null)}}else if((I.isMesh||I.isLine||I.isPoints)&&(I.isSkinnedMesh&&I.skeleton.frame!==he.render.frame&&(I.skeleton.update(),I.skeleton.frame=he.render.frame),!I.frustumCulled||j.intersectsObject(I))){W&&bt.setFromMatrixPosition(I.matrixWorld).applyMatrix4(J);const xe=se.update(I),Ae=I.material;if(Array.isArray(Ae)){const Re=xe.groups;for(let He=0,Ne=Re.length;He<Ne;He++){const Ue=Re[He],Mi=Ae[Ue.materialIndex];Mi&&Mi.visible&&u.push(I,xe,Mi,at,bt.z,Ue)}}else Ae.visible&&u.push(I,xe,Ae,at,bt.z,null)}const re=I.children;for(let xe=0,Ae=re.length;xe<Ae;xe++)Li(re[xe],Z,at,W)}function zi(I,Z,at,W){const ut=I.opaque,re=I.transmissive,xe=I.transparent;d.setupLightsView(at),re.length>0&&function Sr(I,Z,at){const W=Kt.isWebGL2;null===pt&&(pt=new qs(1,1,{generateMipmaps:!0,type:Lt.has("EXT_color_buffer_half_float")?Po:zs,minFilter:Gs,samples:W&&!0===r?4:0})),m.getDrawingBufferSize(Q),W?pt.setSize(Q.x,Q.y):pt.setSize(Ga(Q.x),Ga(Q.y));const ut=m.getRenderTarget();m.setRenderTarget(pt),m.clear();const re=m.toneMapping;m.toneMapping=0,oi(I,Z,at),m.toneMapping=re,ot.updateMultisampleRenderTarget(pt),ot.updateRenderTargetMipmap(pt),m.setRenderTarget(ut)}(ut,Z,at),W&&Tt.viewport(S.copy(W)),ut.length>0&&oi(ut,Z,at),re.length>0&&oi(re,Z,at),xe.length>0&&oi(xe,Z,at),Tt.buffers.depth.setTest(!0),Tt.buffers.depth.setMask(!0),Tt.buffers.color.setMask(!0),Tt.setPolygonOffset(!1)}function oi(I,Z,at){const W=!0===Z.isScene?Z.overrideMaterial:null;for(let ut=0,re=I.length;ut<re;ut++){const xe=I[ut],Ae=xe.object,Re=xe.geometry,He=null===W?xe.material:W,Ne=xe.group;Ae.layers.test(at.layers)&&gs(Ae,Z,at,Re,He,Ne)}}function gs(I,Z,at,W,ut,re){I.onBeforeRender(m,Z,at,W,ut,re),I.modelViewMatrix.multiplyMatrices(at.matrixWorldInverse,I.matrixWorld),I.normalMatrix.getNormalMatrix(I.modelViewMatrix),ut.onBeforeRender(m,Z,at,W,I,re),!0===ut.transparent&&3===ut.side?(ut.side=1,ut.needsUpdate=!0,m.renderBufferDirect(at,Z,W,ut,I,re),ut.side=0,ut.needsUpdate=!0,m.renderBufferDirect(at,Z,W,ut,I,re),ut.side=3):m.renderBufferDirect(at,Z,W,ut,I,re),I.onAfterRender(m,Z,at,W,ut,re)}function Mn(I,Z,at){!0!==Z.isScene&&(Z=gt);const W=ht.get(I),ut=d.state.lights,xe=ut.state.version,Ae=ee.getParameters(I,ut.state,d.state.shadowsArray,Z,at),Re=ee.getProgramCacheKey(Ae);let He=W.programs;W.environment=I.isMeshStandardMaterial?Z.environment:null,W.fog=Z.fog,W.envMap=(I.isMeshStandardMaterial?Ft:Mt).get(I.envMap||W.environment),void 0===He&&(I.addEventListener("dispose",Fe),He=new Map,W.programs=He);let Ne=He.get(Re);if(void 0!==Ne){if(W.currentProgram===Ne&&W.lightsStateVersion===xe)return b0(I,Ae),Ne}else Ae.uniforms=ee.getUniforms(I),I.onBuild(at,Ae,m),I.onBeforeCompile(Ae,m),Ne=ee.acquireProgram(Ae,Re),He.set(Re,Ne),W.uniforms=Ae.uniforms;const Ue=W.uniforms;(!I.isShaderMaterial&&!I.isRawShaderMaterial||!0===I.clipping)&&(Ue.clippingPlanes=E.uniform),b0(I,Ae),W.needsLights=function F2(I){return I.isMeshLambertMaterial||I.isMeshToonMaterial||I.isMeshPhongMaterial||I.isMeshStandardMaterial||I.isShadowMaterial||I.isShaderMaterial&&!0===I.lights}(I),W.lightsStateVersion=xe,W.needsLights&&(Ue.ambientLightColor.value=ut.state.ambient,Ue.lightProbe.value=ut.state.probe,Ue.directionalLights.value=ut.state.directional,Ue.directionalLightShadows.value=ut.state.directionalShadow,Ue.spotLights.value=ut.state.spot,Ue.spotLightShadows.value=ut.state.spotShadow,Ue.rectAreaLights.value=ut.state.rectArea,Ue.ltc_1.value=ut.state.rectAreaLTC1,Ue.ltc_2.value=ut.state.rectAreaLTC2,Ue.pointLights.value=ut.state.point,Ue.pointLightShadows.value=ut.state.pointShadow,Ue.hemisphereLights.value=ut.state.hemi,Ue.directionalShadowMap.value=ut.state.directionalShadowMap,Ue.directionalShadowMatrix.value=ut.state.directionalShadowMatrix,Ue.spotShadowMap.value=ut.state.spotShadowMap,Ue.spotLightMatrix.value=ut.state.spotLightMatrix,Ue.spotLightMap.value=ut.state.spotLightMap,Ue.pointShadowMap.value=ut.state.pointShadowMap,Ue.pointShadowMatrix.value=ut.state.pointShadowMatrix);const Mi=Ne.getUniforms(),pn=cl.seqWithValue(Mi.seq,Ue);return W.currentProgram=Ne,W.uniformsList=pn,Ne}function b0(I,Z){const at=ht.get(I);at.outputEncoding=Z.outputEncoding,at.instancing=Z.instancing,at.skinning=Z.skinning,at.morphTargets=Z.morphTargets,at.morphNormals=Z.morphNormals,at.morphColors=Z.morphColors,at.morphTargetsCount=Z.morphTargetsCount,at.numClippingPlanes=Z.numClippingPlanes,at.numIntersection=Z.numClipIntersection,at.vertexAlphas=Z.vertexAlphas,at.vertexTangents=Z.vertexTangents,at.toneMapping=Z.toneMapping}Ye.setAnimationLoop(function yt(I){rt&&rt(I)}),typeof self<"u"&&Ye.setContext(self),this.setAnimationLoop=function(I){rt=I,Ot.setAnimationLoop(I),null===I?Ye.stop():Ye.start()},Ot.addEventListener("sessionstart",kt),Ot.addEventListener("sessionend",qt),this.render=function(I,Z){if(void 0===Z||!0===Z.isCamera){if(!0!==g){if(!0===I.matrixWorldAutoUpdate&&I.updateMatrixWorld(),null===Z.parent&&!0===Z.matrixWorldAutoUpdate&&Z.updateMatrixWorld(),!0===Ot.enabled&&!0===Ot.isPresenting&&(!0===Ot.cameraAutoUpdate&&Ot.updateCamera(Z),Z=Ot.getCamera()),!0===I.isScene&&I.onBeforeRender(m,I,Z,y),d=L.get(I,p.length),d.init(),p.push(d),J.multiplyMatrices(Z.projectionMatrix,Z.matrixWorldInverse),j.setFromProjectionMatrix(J),et=this.localClippingEnabled,$=E.init(this.clippingPlanes,et,Z),u=ze.get(I,f.length),u.init(),f.push(u),Li(I,Z,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(Y,O),!0===$&&E.beginShadows(),K.render(d.state.shadowsArray,I,Z),!0===$&&E.endShadows(),!0===this.info.autoReset&&this.info.reset(),_t.render(u,I),d.setupLights(m.physicallyCorrectLights),Z.isArrayCamera){const W=Z.cameras;for(let ut=0,re=W.length;ut<re;ut++){const xe=W[ut];zi(u,I,xe,xe.viewport)}}else zi(u,I,Z);null!==y&&(ot.updateMultisampleRenderTarget(y),ot.updateRenderTargetMipmap(y)),!0===I.isScene&&I.onAfterRender(m,I,Z),H.resetDefaultState(),b=-1,M=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),u=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(I,Z,at){ht.get(I.texture).__webglTexture=Z,ht.get(I.depthTexture).__webglTexture=at;const W=ht.get(I);W.__hasExternalTextures=!0,W.__hasExternalTextures&&(W.__autoAllocateDepthBuffer=void 0===at,W.__autoAllocateDepthBuffer||!0===Lt.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),W.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(I,Z){const at=ht.get(I);at.__webglFramebuffer=Z,at.__useDefaultFramebuffer=void 0===Z},this.setRenderTarget=function(I,Z=0,at=0){y=I,x=Z,v=at;let W=!0,ut=null,re=!1,xe=!1;if(I){const Re=ht.get(I);void 0!==Re.__useDefaultFramebuffer?(Tt.bindFramebuffer(36160,null),W=!1):void 0===Re.__webglFramebuffer?ot.setupRenderTarget(I):Re.__hasExternalTextures&&ot.rebindTextures(I,ht.get(I.texture).__webglTexture,ht.get(I.depthTexture).__webglTexture);const He=I.texture;(He.isData3DTexture||He.isDataArrayTexture||He.isCompressedArrayTexture)&&(xe=!0);const Ne=ht.get(I).__webglFramebuffer;I.isWebGLCubeRenderTarget?(ut=Ne[Z],re=!0):ut=Kt.isWebGL2&&I.samples>0&&!1===ot.useMultisampledRTT(I)?ht.get(I).__webglMultisampledFramebuffer:Ne,S.copy(I.viewport),A.copy(I.scissor),w=I.scissorTest}else S.copy(D).multiplyScalar(F).floor(),A.copy(V).multiplyScalar(F).floor(),w=X;if(Tt.bindFramebuffer(36160,ut)&&Kt.drawBuffers&&W&&Tt.drawBuffers(I,ut),Tt.viewport(S),Tt.scissor(A),Tt.setScissorTest(w),re){const Re=ht.get(I.texture);nt.framebufferTexture2D(36160,36064,34069+Z,Re.__webglTexture,at)}else if(xe){const Re=ht.get(I.texture);nt.framebufferTextureLayer(36160,36064,Re.__webglTexture,at||0,Z||0)}b=-1},this.readRenderTargetPixels=function(I,Z,at,W,ut,re,xe){if(!I||!I.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ae=ht.get(I).__webglFramebuffer;if(I.isWebGLCubeRenderTarget&&void 0!==xe&&(Ae=Ae[xe]),Ae){Tt.bindFramebuffer(36160,Ae);try{const Re=I.texture,He=Re.format,Ne=Re.type;if(He!==gn&&B.convert(He)!==nt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Ue=Ne===Po&&(Lt.has("EXT_color_buffer_half_float")||Kt.isWebGL2&&Lt.has("EXT_color_buffer_float"));if(!(Ne===zs||B.convert(Ne)===nt.getParameter(35738)||Ne===xs&&(Kt.isWebGL2||Lt.has("OES_texture_float")||Lt.has("WEBGL_color_buffer_float"))||Ue))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Z>=0&&Z<=I.width-W&&at>=0&&at<=I.height-ut&&nt.readPixels(Z,at,W,ut,B.convert(He),B.convert(Ne),re)}finally{const Re=null!==y?ht.get(y).__webglFramebuffer:null;Tt.bindFramebuffer(36160,Re)}}},this.copyFramebufferToTexture=function(I,Z,at=0){const W=Math.pow(2,-at),ut=Math.floor(Z.image.width*W),re=Math.floor(Z.image.height*W);ot.setTexture2D(Z,0),nt.copyTexSubImage2D(3553,at,0,0,I.x,I.y,ut,re),Tt.unbindTexture()},this.copyTextureToTexture=function(I,Z,at,W=0){const ut=Z.image.width,re=Z.image.height,xe=B.convert(at.format),Ae=B.convert(at.type);ot.setTexture2D(at,0),nt.pixelStorei(37440,at.flipY),nt.pixelStorei(37441,at.premultiplyAlpha),nt.pixelStorei(3317,at.unpackAlignment),Z.isDataTexture?nt.texSubImage2D(3553,W,I.x,I.y,ut,re,xe,Ae,Z.image.data):Z.isCompressedTexture?nt.compressedTexSubImage2D(3553,W,I.x,I.y,Z.mipmaps[0].width,Z.mipmaps[0].height,xe,Z.mipmaps[0].data):nt.texSubImage2D(3553,W,I.x,I.y,xe,Ae,Z.image),0===W&&at.generateMipmaps&&nt.generateMipmap(3553),Tt.unbindTexture()},this.copyTextureToTexture3D=function(I,Z,at,W,ut=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const re=I.max.x-I.min.x+1,xe=I.max.y-I.min.y+1,Ae=I.max.z-I.min.z+1,Re=B.convert(W.format),He=B.convert(W.type);let Ne;if(W.isData3DTexture)ot.setTexture3D(W,0),Ne=32879;else{if(!W.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ot.setTexture2DArray(W,0),Ne=35866}nt.pixelStorei(37440,W.flipY),nt.pixelStorei(37441,W.premultiplyAlpha),nt.pixelStorei(3317,W.unpackAlignment);const Ue=nt.getParameter(3314),Mi=nt.getParameter(32878),pn=nt.getParameter(3316),_s=nt.getParameter(3315),Tr=nt.getParameter(32877),Si=at.isCompressedTexture?at.mipmaps[0]:at.image;nt.pixelStorei(3314,Si.width),nt.pixelStorei(32878,Si.height),nt.pixelStorei(3316,I.min.x),nt.pixelStorei(3315,I.min.y),nt.pixelStorei(32877,I.min.z),at.isDataTexture||at.isData3DTexture?nt.texSubImage3D(Ne,ut,Z.x,Z.y,Z.z,re,xe,Ae,Re,He,Si.data):at.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),nt.compressedTexSubImage3D(Ne,ut,Z.x,Z.y,Z.z,re,xe,Ae,Re,Si.data)):nt.texSubImage3D(Ne,ut,Z.x,Z.y,Z.z,re,xe,Ae,Re,He,Si),nt.pixelStorei(3314,Ue),nt.pixelStorei(32878,Mi),nt.pixelStorei(3316,pn),nt.pixelStorei(3315,_s),nt.pixelStorei(32877,Tr),0===ut&&W.generateMipmaps&&nt.generateMipmap(Ne),Tt.unbindTexture()},this.initTexture=function(I){I.isCubeTexture?ot.setTextureCube(I,0):I.isData3DTexture?ot.setTexture3D(I,0):I.isDataArrayTexture||I.isCompressedArrayTexture?ot.setTexture2DArray(I,0):ot.setTexture2D(I,0),Tt.unbindTexture()},this.resetState=function(){x=0,v=0,y=null,Tt.reset(),H.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class Dw extends cp{}).prototype.isWebGL1Renderer=!0;class up extends _n{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}function xn(n,t,e){return ru(n)?new n.constructor(n.subarray(t,void 0!==e?e:n.length)):n.slice(t,e)}function sr(n,t,e){return!n||!e&&n.constructor===t?n:"number"==typeof t.BYTES_PER_ELEMENT?new t(n):Array.prototype.slice.call(n)}function ru(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}class Pl{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];t:{e:{let o;i:{n:if(!(t<s)){for(let a=i+2;;){if(void 0===s){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=e[++i],t<s)break e}o=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let l=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=e[--i-1],t>=r)break e}o=i,i=0}}for(;i<o;){const a=i+o>>>1;t<e[a]?o=a:i=a+1}if(s=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===s)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s;for(let o=0;o!==s;++o)e[o]=i[r+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class B1 extends Pl{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,i){const s=this.parameterPositions;let r=t-2,o=t+1,a=s[r],l=s[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=t,a=2*e-i;break;case 2402:r=s.length-2,a=e+s[r]-s[r+1];break;default:r=t,a=i}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:o=t,l=2*i-e;break;case 2402:o=1,l=i+s[1]-s[0];break;default:o=t-1,l=e}const h=.5*(i-e),c=this.valueSize;this._weightPrev=h/(e-a),this._weightNext=h/(l-i),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=t*a,h=l-a,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(i-e)/(s-e),m=p*p,g=m*p,x=-d*g+2*d*m-d*p,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,y=(-1-f)*g+(1.5+f)*m+.5*p,b=f*g-f*m;for(let M=0;M!==a;++M)r[M]=x*o[c+M]+v*o[h+M]+y*o[l+M]+b*o[u+M];return r}}class qp extends Pl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=t*a,h=l-a,c=(i-e)/(s-e),u=1-c;for(let d=0;d!==a;++d)r[d]=o[h+d]*u+o[l+d]*c;return r}}class F1 extends Pl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class Xn{constructor(t,e,i,s){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=sr(e,this.TimeBufferType),this.values=sr(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:sr(t.times,Array),values:sr(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new F1(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new qp(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new B1(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<t;)++r;for(;-1!==o&&i[o]>e;)--o;if(++o,0!==r||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=xn(i,r,o),this.values=xn(this.values,r*a,o*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),t=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),t=!1;break}o=l}if(void 0!==s&&ru(s))for(let a=0,l=s.length;a!==l;++a){const h=s[a];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,h),t=!1;break}}return t}optimize(){const t=xn(this.times),e=xn(this.values),i=this.getValueSize(),s=2302===this.getInterpolation(),r=t.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const h=t[a];if(h!==t[a+1]&&(1!==a||h!==t[0]))if(s)l=!0;else{const u=a*i,d=u-i,f=u+i;for(let p=0;p!==i;++p){const m=e[u+p];if(m!==e[d+p]||m!==e[f+p]){l=!0;break}}}if(l){if(a!==o){t[o]=t[a];const u=a*i,d=o*i;for(let f=0;f!==i;++f)e[d+f]=e[u+f]}++o}}if(r>0){t[o]=t[r];for(let a=r*i,l=o*i,h=0;h!==i;++h)e[l+h]=e[a+h];++o}return o!==t.length?(this.times=xn(t,0,o),this.values=xn(e,0,o*i)):(this.times=t,this.values=e),this}clone(){const t=xn(this.times,0),e=xn(this.values,0),s=new(0,this.constructor)(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}Xn.prototype.TimeBufferType=Float32Array,Xn.prototype.ValueBufferType=Float32Array,Xn.prototype.DefaultInterpolation=2301;class oo extends Xn{}oo.prototype.ValueTypeName="bool",oo.prototype.ValueBufferType=Array,oo.prototype.DefaultInterpolation=2300,oo.prototype.InterpolantFactoryMethodLinear=void 0,oo.prototype.InterpolantFactoryMethodSmooth=void 0;(class jp extends Xn{}).prototype.ValueTypeName="color";(class Dl extends Xn{}).prototype.ValueTypeName="number";class N1 extends Pl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-e)/(s-e);let h=t*a;for(let c=h+a;h!==c;h+=4)Xi.slerpFlat(r,0,o,h-a,o,h,l);return r}}class sa extends Xn{InterpolantFactoryMethodLinear(t){return new N1(this.times,this.values,this.getValueSize(),t)}}sa.prototype.ValueTypeName="quaternion",sa.prototype.DefaultInterpolation=2301,sa.prototype.InterpolantFactoryMethodSmooth=void 0;class ao extends Xn{}ao.prototype.ValueTypeName="string",ao.prototype.ValueBufferType=Array,ao.prototype.DefaultInterpolation=2300,ao.prototype.InterpolantFactoryMethodLinear=void 0,ao.prototype.InterpolantFactoryMethodSmooth=void 0;(class Ll extends Xn{}).prototype.ValueTypeName="vector";const lo={enabled:!1,files:{},add:function(n,t){!1!==this.enabled&&(this.files[n]=t)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Jp{constructor(t,e,i){const s=this;let l,r=!1,o=0,a=0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(c){a++,!1===r&&void 0!==s.onStart&&s.onStart(c,o,a),r=!0},this.itemEnd=function(c){o++,void 0!==s.onProgress&&s.onProgress(c,o,a),o===a&&(r=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(c){void 0!==s.onError&&s.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,u){return h.push(c,u),this},this.removeHandler=function(c){const u=h.indexOf(c);return-1!==u&&h.splice(u,2),this},this.getHandler=function(c){for(let u=0,d=h.length;u<d;u+=2){const f=h[u],p=h[u+1];if(f.global&&(f.lastIndex=0),f.test(c))return p}return null}}}const G1=new Jp;class Kp{constructor(t){this.manager=void 0!==t?t:G1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,r){i.load(t,s,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Error;class Bl extends Kp{constructor(t){super(t)}load(t,e,i,s){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=lo.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const a=Bo("img");function l(){c(),lo.add(t,this),e&&e(this),r.manager.itemEnd(t)}function h(u){c(),s&&s(u),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){a.removeEventListener("load",l,!1),a.removeEventListener("error",h,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",h,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class H1 extends Kp{constructor(t){super(t)}load(t,e,i,s){const r=new Tn,o=new Bl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){r.image=a,r.needsUpdate=!0,void 0!==e&&e(r)},i,s),r}}const uu="\\[\\]\\.:\\/",aM=new RegExp("["+uu+"]","g"),du="[^"+uu+"]",lM="[^"+uu.replace("\\.","")+"]",fM=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",du)+/(WCOD+)?/.source.replace("WCOD",lM)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",du)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",du)+"$"),pM=["material","materials","bones","map"];class mM{constructor(t,e,i){const s=i||ni.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}getValue(t,e){this.bind();const s=this._bindings[this._targetGroup.nCachedObjects_];void 0!==s&&s.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}let ni=(()=>{class n{constructor(e,i,s){this.path=i,this.parsedPath=s||n.parseTrackName(i),this.node=n.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,s){return e&&e.isAnimationObjectGroup?new n.Composite(e,i,s):new n(e,i,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(aM,"")}static parseTrackName(e){const i=fM.exec(e);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=s.nodeName&&s.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const o=s.nodeName.substring(r+1);-1!==pM.indexOf(o)&&(s.nodeName=s.nodeName.substring(0,r),s.objectName=o)}if(null===s.propertyName||0===s.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,i){if(void 0===i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(i);if(void 0!==s)return s}if(e.children){const s=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const h=s(l.children);if(h)return h}return null},r=s(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)e[i++]=s[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,s=i.objectName,r=i.propertyName;let o=i.propertyIndex;if(e||(e=n.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(s){let c=i.objectIndex;switch(s){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[s])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[s]}if(void 0!==c){if(void 0===e[c])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[c]}}const a=e[r];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+r+" but it wasn't found.",e);let l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[o]&&(o=e.morphTargetDictionary[o])}h=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(h=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=mM,n})();ni.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ni.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ni.prototype.GetterByBindingType=[ni.prototype._getValue_direct,ni.prototype._getValue_array,ni.prototype._getValue_arrayElement,ni.prototype._getValue_toArray],ni.prototype.SetterByBindingTypeAndVersioning=[[ni.prototype._setValue_direct,ni.prototype._setValue_direct_setNeedsUpdate,ni.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ni.prototype._setValue_array,ni.prototype._setValue_array_setNeedsUpdate,ni.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ni.prototype._setValue_arrayElement,ni.prototype._setValue_arrayElement_setNeedsUpdate,ni.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ni.prototype._setValue_fromArray,ni.prototype._setValue_fromArray_setNeedsUpdate,ni.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class fm{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(mi(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"148"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="148");const gu=n=>new Jt.y(t=>{(new H1).loadAsync(n).then(i=>{t.next(i),t.complete()}).catch(i=>{t.error(i)})});var MM=st(4350),Wl=st(4766);const Mm={type:"change"},_u={type:"start"},Sm={type:"end"};class SM extends Ys{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(B){B.addEventListener("keydown",ze),this._domElementKeyEvents=B},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Mm),i.update(),r=s.NONE},this.update=function(){const B=new P,H=(new Xi).setFromUnitVectors(t.up,new P(0,1,0)),Dt=H.clone().invert(),zt=new P,Ot=new Xi,Zt=2*Math.PI;return function(){const Oe=i.object.position;B.copy(Oe).sub(i.target),B.applyQuaternion(H),a.setFromVector3(B),i.autoRotate&&r===s.NONE&&T(function A(){return 2*Math.PI/60/60*i.autoRotateSpeed}()),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let Fe=i.minAzimuthAngle,Je=i.maxAzimuthAngle;return isFinite(Fe)&&isFinite(Je)&&(Fe<-Math.PI?Fe+=Zt:Fe>Math.PI&&(Fe-=Zt),Je<-Math.PI?Je+=Zt:Je>Math.PI&&(Je-=Zt),a.theta=Fe<=Je?Math.max(Fe,Math.min(Je,a.theta)):a.theta>(Fe+Je)/2?Math.max(Fe,a.theta):Math.min(Je,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=h,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(c,i.dampingFactor):i.target.add(c),B.setFromSpherical(a),B.applyQuaternion(Dt),Oe.copy(i.target).add(B),i.object.lookAt(i.target),!0===i.enableDamping?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,c.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),c.set(0,0,0)),h=1,!!(u||zt.distanceToSquared(i.object.position)>o||8*(1-Ot.dot(i.object.quaternion))>o)&&(i.dispatchEvent(Mm),zt.copy(i.object.position),Ot.copy(i.object.quaternion),u=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",K),i.domElement.removeEventListener("pointerdown",Mt),i.domElement.removeEventListener("pointercancel",pe),i.domElement.removeEventListener("wheel",je),i.domElement.removeEventListener("pointermove",Ft),i.domElement.removeEventListener("pointerup",Et),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",ze)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new fm,l=new fm;let h=1;const c=new P;let u=!1;const d=new ft,f=new ft,p=new ft,m=new ft,g=new ft,x=new ft,v=new ft,y=new ft,b=new ft,M=[],S={};function w(){return Math.pow(.95,i.zoomSpeed)}function T(B){l.theta-=B}function C(B){l.phi-=B}const F=function(){const B=new P;return function(Dt,zt){B.setFromMatrixColumn(zt,0),B.multiplyScalar(-Dt),c.add(B)}}(),Y=function(){const B=new P;return function(Dt,zt){!0===i.screenSpacePanning?B.setFromMatrixColumn(zt,1):(B.setFromMatrixColumn(zt,0),B.crossVectors(i.object.up,B)),B.multiplyScalar(Dt),c.add(B)}}(),O=function(){const B=new P;return function(Dt,zt){const Ot=i.domElement;if(i.object.isPerspectiveCamera){B.copy(i.object.position).sub(i.target);let Yt=B.length();Yt*=Math.tan(i.object.fov/2*Math.PI/180),F(2*Dt*Yt/Ot.clientHeight,i.object.matrix),Y(2*zt*Yt/Ot.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(F(Dt*(i.object.right-i.object.left)/i.object.zoom/Ot.clientWidth,i.object.matrix),Y(zt*(i.object.top-i.object.bottom)/i.object.zoom/Ot.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function D(B){i.object.isPerspectiveCamera?h/=B:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*B)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function V(B){i.object.isPerspectiveCamera?h*=B:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/B)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function X(B){d.set(B.clientX,B.clientY)}function $(B){m.set(B.clientX,B.clientY)}function gt(){1===M.length?d.set(M[0].pageX,M[0].pageY):d.set(.5*(M[0].pageX+M[1].pageX),.5*(M[0].pageY+M[1].pageY))}function At(){1===M.length?m.set(M[0].pageX,M[0].pageY):m.set(.5*(M[0].pageX+M[1].pageX),.5*(M[0].pageY+M[1].pageY))}function nt(){const B=M[0].pageX-M[1].pageX,H=M[0].pageY-M[1].pageY,Dt=Math.sqrt(B*B+H*H);v.set(0,Dt)}function Kt(B){if(1==M.length)f.set(B.pageX,B.pageY);else{const Dt=ce(B);f.set(.5*(B.pageX+Dt.x),.5*(B.pageY+Dt.y))}p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const H=i.domElement;T(2*Math.PI*p.x/H.clientHeight),C(2*Math.PI*p.y/H.clientHeight),d.copy(f)}function Tt(B){if(1===M.length)g.set(B.pageX,B.pageY);else{const H=ce(B);g.set(.5*(B.pageX+H.x),.5*(B.pageY+H.y))}x.subVectors(g,m).multiplyScalar(i.panSpeed),O(x.x,x.y),m.copy(g)}function he(B){const H=ce(B),Dt=B.pageX-H.x,zt=B.pageY-H.y,Ot=Math.sqrt(Dt*Dt+zt*zt);y.set(0,Ot),b.set(0,Math.pow(y.y/v.y,i.zoomSpeed)),D(b.y),v.copy(y)}function Mt(B){!1!==i.enabled&&(0===M.length&&(i.domElement.setPointerCapture(B.pointerId),i.domElement.addEventListener("pointermove",Ft),i.domElement.addEventListener("pointerup",Et)),function _t(B){M.push(B)}(B),"touch"===B.pointerType?function L(B){switch(Rt(B),M.length){case 1:switch(i.touches.ONE){case 0:if(!1===i.enableRotate)return;gt(),r=s.TOUCH_ROTATE;break;case 1:if(!1===i.enablePan)return;At(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case 2:if(!1===i.enableZoom&&!1===i.enablePan)return;(function te(){i.enableZoom&&nt(),i.enablePan&&At()})(),r=s.TOUCH_DOLLY_PAN;break;case 3:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function Lt(){i.enableZoom&&nt(),i.enableRotate&&gt()})(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(_u)}(B):function se(B){let H;switch(B.button){case 0:H=i.mouseButtons.LEFT;break;case 1:H=i.mouseButtons.MIDDLE;break;case 2:H=i.mouseButtons.RIGHT;break;default:H=-1}switch(H){case 1:if(!1===i.enableZoom)return;(function j(B){v.set(B.clientX,B.clientY)})(B),r=s.DOLLY;break;case 0:if(B.ctrlKey||B.metaKey||B.shiftKey){if(!1===i.enablePan)return;$(B),r=s.PAN}else{if(!1===i.enableRotate)return;X(B),r=s.ROTATE}break;case 2:if(B.ctrlKey||B.metaKey||B.shiftKey){if(!1===i.enableRotate)return;X(B),r=s.ROTATE}else{if(!1===i.enablePan)return;$(B),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(_u)}(B))}function Ft(B){!1!==i.enabled&&("touch"===B.pointerType?function E(B){switch(Rt(B),r){case s.TOUCH_ROTATE:if(!1===i.enableRotate)return;Kt(B),i.update();break;case s.TOUCH_PAN:if(!1===i.enablePan)return;Tt(B),i.update();break;case s.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;(function ht(B){i.enableZoom&&he(B),i.enablePan&&Tt(B)})(B),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function ot(B){i.enableZoom&&he(B),i.enableRotate&&Kt(B)})(B),i.update();break;default:r=s.NONE}}(B):function ee(B){switch(r){case s.ROTATE:if(!1===i.enableRotate)return;!function et(B){f.set(B.clientX,B.clientY),p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const H=i.domElement;T(2*Math.PI*p.x/H.clientHeight),C(2*Math.PI*p.y/H.clientHeight),d.copy(f),i.update()}(B);break;case s.DOLLY:if(!1===i.enableZoom)return;!function pt(B){y.set(B.clientX,B.clientY),b.subVectors(y,v),b.y>0?D(w()):b.y<0&&V(w()),v.copy(y),i.update()}(B);break;case s.PAN:if(!1===i.enablePan)return;!function J(B){g.set(B.clientX,B.clientY),x.subVectors(g,m).multiplyScalar(i.panSpeed),O(x.x,x.y),m.copy(g),i.update()}(B)}}(B))}function Et(B){wt(B),0===M.length&&(i.domElement.releasePointerCapture(B.pointerId),i.domElement.removeEventListener("pointermove",Ft),i.domElement.removeEventListener("pointerup",Et)),i.dispatchEvent(Sm),r=s.NONE}function pe(B){wt(B)}function je(B){!1===i.enabled||!1===i.enableZoom||r!==s.NONE||(B.preventDefault(),i.dispatchEvent(_u),function Q(B){B.deltaY<0?V(w()):B.deltaY>0&&D(w()),i.update()}(B),i.dispatchEvent(Sm))}function ze(B){!1===i.enabled||!1===i.enablePan||function bt(B){let H=!1;switch(B.code){case i.keys.UP:B.ctrlKey||B.metaKey||B.shiftKey?C(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,i.keyPanSpeed),H=!0;break;case i.keys.BOTTOM:B.ctrlKey||B.metaKey||B.shiftKey?C(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,-i.keyPanSpeed),H=!0;break;case i.keys.LEFT:B.ctrlKey||B.metaKey||B.shiftKey?T(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(i.keyPanSpeed,0),H=!0;break;case i.keys.RIGHT:B.ctrlKey||B.metaKey||B.shiftKey?T(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(-i.keyPanSpeed,0),H=!0}H&&(B.preventDefault(),i.update())}(B)}function K(B){!1!==i.enabled&&B.preventDefault()}function wt(B){delete S[B.pointerId];for(let H=0;H<M.length;H++)if(M[H].pointerId==B.pointerId)return void M.splice(H,1)}function Rt(B){let H=S[B.pointerId];void 0===H&&(H=new ft,S[B.pointerId]=H),H.set(B.pageX,B.pageY)}function ce(B){return S[(B.pointerId===M[0].pointerId?M[1]:M[0]).pointerId]}i.domElement.addEventListener("contextmenu",K),i.domElement.addEventListener("pointerdown",Mt),i.domElement.addEventListener("pointercancel",pe),i.domElement.addEventListener("wheel",je,{passive:!1}),this.update()}}var cr=st(388),ho=st(529),TM=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,EM=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,AM=/[^-+\dA-Z]/g;function Tm(n,t,e,i){if(1===arguments.length&&"string"==typeof n&&!/\d/.test(n)&&(t=n,n=void 0),(n=n||0===n?n:new Date)instanceof Date||(n=new Date(n)),isNaN(n))throw TypeError("Invalid date");var s=(t=String(Em[t]||t||Em.default)).slice(0,4);("UTC:"===s||"GMT:"===s)&&(t=t.slice(4),e=!0,"GMT:"===s&&(i=!0));var r=function(){return e?"getUTC":"get"},o=function(){return n[r()+"Date"]()},a=function(){return n[r()+"Day"]()},l=function(){return n[r()+"Month"]()},h=function(){return n[r()+"FullYear"]()},c=function(){return n[r()+"Hours"]()},u=function(){return n[r()+"Minutes"]()},d=function(){return n[r()+"Seconds"]()},f=function(){return n[r()+"Milliseconds"]()},p=function(){return e?0:n.getTimezoneOffset()},m=function(){return CM(n)},g=function(){return IM(n)},x={d:function(){return o()},dd:function(){return ln(o())},ddd:function(){return Qi.dayNames[a()]},DDD:function(){return Am({y:h(),m:l(),d:o(),_:r(),dayName:Qi.dayNames[a()],short:!0})},dddd:function(){return Qi.dayNames[a()+7]},DDDD:function(){return Am({y:h(),m:l(),d:o(),_:r(),dayName:Qi.dayNames[a()+7]})},m:function(){return l()+1},mm:function(){return ln(l()+1)},mmm:function(){return Qi.monthNames[l()]},mmmm:function(){return Qi.monthNames[l()+12]},yy:function(){return String(h()).slice(2)},yyyy:function(){return ln(h(),4)},h:function(){return c()%12||12},hh:function(){return ln(c()%12||12)},H:function(){return c()},HH:function(){return ln(c())},M:function(){return u()},MM:function(){return ln(u())},s:function(){return d()},ss:function(){return ln(d())},l:function(){return ln(f(),3)},L:function(){return ln(Math.floor(f()/10))},t:function(){return c()<12?Qi.timeNames[0]:Qi.timeNames[1]},tt:function(){return c()<12?Qi.timeNames[2]:Qi.timeNames[3]},T:function(){return c()<12?Qi.timeNames[4]:Qi.timeNames[5]},TT:function(){return c()<12?Qi.timeNames[6]:Qi.timeNames[7]},Z:function(){return i?"GMT":e?"UTC":RM(n)},o:function(){return(p()>0?"-":"+")+ln(100*Math.floor(Math.abs(p())/60)+Math.abs(p())%60,4)},p:function(){return(p()>0?"-":"+")+ln(Math.floor(Math.abs(p())/60),2)+":"+ln(Math.floor(Math.abs(p())%60),2)},S:function(){return["th","st","nd","rd"][o()%10>3?0:(o()%100-o()%10!=10)*o()%10]},W:function(){return m()},WW:function(){return ln(m())},N:function(){return g()}};return t.replace(TM,function(v){return v in x?x[v]():v.slice(1,v.length-1)})}var Em={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Qi={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},ln=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},Am=function(t){var e=t.y,i=t.m,s=t.d,r=t._,o=t.dayName,a=t.short,l=void 0!==a&&a,h=new Date,c=new Date;c.setDate(c[r+"Date"]()-1);var u=new Date;return u.setDate(u[r+"Date"]()+1),h[r+"FullYear"]()===e&&h[r+"Month"]()===i&&h[r+"Date"]()===s?l?"Tdy":"Today":c[r+"FullYear"]()===e&&c[r+"Month"]()===i&&c[r+"Date"]()===s?l?"Ysd":"Yesterday":u[r+"FullYear"]()===e&&u[r+"Month"]()===i&&u[r+"Date"]()===s?l?"Tmw":"Tomorrow":o},CM=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var i=new Date(e.getFullYear(),0,4);i.setDate(i.getDate()-(i.getDay()+6)%7+3);var s=e.getTimezoneOffset()-i.getTimezoneOffset();return e.setHours(e.getHours()-s),1+Math.floor((e-i)/6048e5)},IM=function(t){var e=t.getDay();return 0===e&&(e=7),e},RM=function(t){return(String(t).match(EM)||[""]).pop().replace(AM,"").replace(/GMT\+0000/g,"UTC")},Cm=st(8060),Vl=st(1831);let ur=(()=>{class n{constructor(e,i){this.http=e,this.store=i,this.baseUrl=Wl.N.rpwebAPI}loadPositionTypeBins(){return this.http.get(`${this.baseUrl}/PositionTypeMaster`)}loadMiscellaneousType(){return this.http.get(`${this.baseUrl}/miscellaneous`)}loadAddresses(e){this.http.get(`${this.baseUrl}/address`,{params:(new ho.LE).append("scenarioName",e)}).subscribe(i=>{this.store.dispatch((n=>({type:Cm.n.SetAddresses,payload:{addresses:n}}))(i))})}load3dAddresses(){return this.http.get(`${this.baseUrl}/address/address3d`)}loadHeatMapFlow2D(e,i){const s=(new ho.LE).set("start",Tm(e,"yyyy-mm-dd")).set("end",Tm(i,"yyyy-mm-dd"));return this.http.get(`${this.baseUrl}/point`,{params:s})}loadAddressDetail(e){return this.http.get(`${this.baseUrl}/address/addressdetail/${e}`)}loadProducts(){return this.http.get(`${this.baseUrl}/product`)}loadScenariosChanges(e){return this.http.get(`${this.baseUrl}/scenario/scenarioname`,{params:(new ho.LE).append("scenarioName",e)})}saveAddresess(e){return this.http.post(`${this.baseUrl}/address`,e)}saveAddressDetail(e,i){return this.http.post(`${this.baseUrl}/address/addressDetail/${e}`,i)}loadStaticMiscellaneousType(){return this.http.get("/assets/miscellaneousLayout.json")}loadStatic2dAddresses(){return this.http.get("/assets/addressLayout.json")}loadStaticIndicators(){return this.http.get("/assets/indicatorData.json")}loadStaicHeatmapFlowActual(){return this.http.get("/assets/points.json")}loadStaicHeatmapFlowScenario(){return this.http.get("/assets/newPoints.json")}}return n.\u0275fac=function(e){return new(e||n)(_.LFG(ho.eN),_.LFG(Vl.yh))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var LM=st(7185),Im=st(6064);const OM=["input"];function BM(n,t){if(1&n&&(_.TgZ(0,"div",5)(1,"div",6),_._uU(2,"*Required"),_.qZA(),_.TgZ(3,"p"),_._uU(4),_.qZA()()),2&n){const e=_.oxw();_.xp6(4),_.hij("",e.label," is missing!")}}let yu=(()=>{class n{constructor(e){this.controlDir=e,this.type="",this.label="",this.controlDir.valueAccessor=this}ngOnInit(){const e=this.controlDir.control;e.setValidators(e.validator?[e.validator]:[]),e.updateValueAndValidity()}onChange(e){}onTouched(){}writeValue(e){this.input.nativeElement.value=e||""}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}getValue(e){return e.target.value}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(mt.a5,2))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-text-input"]],viewQuery:function(e,i){if(1&e&&_.Gf(OM,7),2&e){let s;_.iGM(s=_.CRH())&&(i.input=s.first)}},inputs:{type:"type",label:"label"},features:[_._Bn([],[{provide:mt.gN,useExisting:mt.sg}])],decls:7,vars:6,consts:[[1,"space-between"],[3,"ngClass"],[3,"type","placeholder","id","input","blur"],["input",""],["class","ui error message",4,"ngIf"],[1,"ui","error","message"],[1,"header"]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"label"),_._uU(3),_.qZA(),_.TgZ(4,"input",2,3),_.NdJ("input",function(r){return i.onChange(i.getValue(r))})("blur",function(){return i.onTouched()}),_.qZA()(),_.YNc(6,BM,5,1,"div",4),_.qZA()),2&e&&(_.xp6(1),_.Q6J("ngClass",i.controlDir&&i.controlDir.control&&i.controlDir.control.touched?i.controlDir.control.valid?"field":"field error":null),_.xp6(2),_.Oqu(i.label),_.xp6(1),_.s9C("type",i.type),_.s9C("placeholder",i.label),_.s9C("id",i.label),_.xp6(2),_.Q6J("ngIf",i.controlDir&&i.controlDir.control&&!i.controlDir.control.valid&&i.controlDir.control.touched))},dependencies:[le.mk,le.O5],styles:[".space-between[_ngcontent-%COMP%]{margin:2.5%}"]}),n})();var xu=st(1607),Rm=st(5987),FM=st(727),vu=st(5191),Pm=st(515),NM=st(457),Xe=st(7340),Dm=st(2381),Lm=st(8372),UM=st(8505),kM=st(3900),GM=st(5577),oa=st(9300),zM=st(7359),Om=st(4482);const WM=(n,t)=>(n.push(t),n);const XM=["ulElement"],YM=["liElements"];function ZM(n,t){}function $M(n,t){if(1&n&&_._UZ(0,"span",4),2&n){const e=t.match,i=t.query,s=_.oxw();_.Q6J("innerHtml",s.highlight(e,i),_.oJD)}}function qM(n,t){if(1&n&&(_.TgZ(0,"li",10,11),_._uU(2),_.qZA()),2&n){const e=_.oxw().$implicit;_.xp6(2),_.Oqu(e)}}function jM(n,t){}const Bm=function(n,t,e,i){return{item:n,index:t,match:e,query:i}};function JM(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"li",12,11),_.NdJ("mouseenter",function(){_.CHM(e);const s=_.oxw().$implicit,r=_.oxw(2);return _.KtG(r.selectActive(s))}),_.TgZ(2,"a",13),_.NdJ("click",function(s){_.CHM(e);const r=_.oxw().$implicit,o=_.oxw(2);return _.KtG(o.selectMatch(r,s))}),_.YNc(3,jM,0,0,"ng-template",0),_.qZA()()}if(2&n){const e=_.oxw(),i=e.$implicit,s=e.index,r=_.oxw(2),o=_.MAs(2);_.ekj("active",r.isActive(i)),_.Q6J("id",r.popupId+"-"+s)("@typeaheadAnimation",r.animationState),_.xp6(3),_.Q6J("ngTemplateOutlet",r.itemTemplate||o)("ngTemplateOutletContext",_.l5B(6,Bm,i.item,s,i,r.query))}}function KM(n,t){if(1&n&&(_.YNc(0,qM,3,1,"li",8),_.YNc(1,JM,4,11,"li",9)),2&n){const e=t.$implicit;_.Q6J("ngIf",e.isHeader()),_.xp6(1),_.Q6J("ngIf",!e.isHeader())}}function QM(n,t){if(1&n&&(_.TgZ(0,"ul",5,6),_.YNc(2,KM,2,2,"ng-template",7),_.qZA()),2&n){const e=_.oxw();_.Udp("overflow-y",e.needScrollbar?"scroll":"auto")("height",e.needScrollbar?e.guiHeight:"auto"),_.xp6(2),_.Q6J("ngForOf",e.matches)}}function tS(n,t){if(1&n&&(_.TgZ(0,"h6",10),_._uU(1),_.qZA()),2&n){const e=_.oxw().$implicit;_.xp6(1),_.Oqu(e)}}function eS(n,t){}function iS(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"button",15,11),_.NdJ("click",function(s){_.CHM(e);const r=_.oxw().$implicit,o=_.oxw(2);return _.KtG(o.selectMatch(r,s))})("mouseenter",function(){_.CHM(e);const s=_.oxw().$implicit,r=_.oxw(2);return _.KtG(r.selectActive(s))}),_.YNc(2,eS,0,0,"ng-template",0),_.qZA()}if(2&n){const e=_.oxw(),i=e.$implicit,s=e.index,r=_.oxw(2),o=_.MAs(2);_.ekj("active",r.isActive(i)),_.Q6J("id",r.popupId+"-"+s)("@typeaheadAnimation",r.animationState),_.xp6(2),_.Q6J("ngTemplateOutlet",r.itemTemplate||o)("ngTemplateOutletContext",_.l5B(6,Bm,i.item,s,i,r.query))}}function nS(n,t){if(1&n&&(_.YNc(0,tS,2,1,"h6",8),_.YNc(1,iS,3,11,"ng-template",14)),2&n){const e=t.$implicit;_.Q6J("ngIf",e.isHeader()),_.xp6(1),_.Q6J("ngIf",!e.isHeader())}}function sS(n,t){if(1&n&&_.YNc(0,nS,2,2,"ng-template",7),2&n){const e=_.oxw();_.Q6J("ngForOf",e.matches)}}const rS=function(n,t,e,i){return{matches:n,itemTemplate:t,query:e,$implicit:i}},oS={\u00c1:"A",\u0102:"A",\u1eae:"A",\u1eb6:"A",\u1eb0:"A",\u1eb2:"A",\u1eb4:"A",\u01cd:"A",\u00c2:"A",\u1ea4:"A",\u1eac:"A",\u1ea6:"A",\u1ea8:"A",\u1eaa:"A",\u00c4:"A",\u01de:"A",\u0226:"A",\u01e0:"A",\u1ea0:"A",\u0200:"A",\u00c0:"A",\u1ea2:"A",\u0202:"A",\u0100:"A",\u0104:"A",\u00c5:"A",\u01fa:"A",\u1e00:"A",\u023a:"A",\u00c3:"A",\ua732:"AA",\u00c6:"AE",\u01fc:"AE",\u01e2:"AE",\ua734:"AO",\ua736:"AU",\ua738:"AV",\ua73a:"AV",\ua73c:"AY",\u1e02:"B",\u1e04:"B",\u0181:"B",\u1e06:"B",\u0243:"B",\u0182:"B",\u0106:"C",\u010c:"C",\u00c7:"C",\u1e08:"C",\u0108:"C",\u010a:"C",\u0187:"C",\u023b:"C",\u010e:"D",\u1e10:"D",\u1e12:"D",\u1e0a:"D",\u1e0c:"D",\u018a:"D",\u1e0e:"D",\u01f2:"D",\u01c5:"D",\u0110:"D",\u018b:"D",\u01f1:"DZ",\u01c4:"DZ",\u00c9:"E",\u0114:"E",\u011a:"E",\u0228:"E",\u1e1c:"E",\u00ca:"E",\u1ebe:"E",\u1ec6:"E",\u1ec0:"E",\u1ec2:"E",\u1ec4:"E",\u1e18:"E",\u00cb:"E",\u0116:"E",\u1eb8:"E",\u0204:"E",\u00c8:"E",\u1eba:"E",\u0206:"E",\u0112:"E",\u1e16:"E",\u1e14:"E",\u0118:"E",\u0246:"E",\u1ebc:"E",\u1e1a:"E",\ua76a:"ET",\u1e1e:"F",\u0191:"F",\u01f4:"G",\u011e:"G",\u01e6:"G",\u0122:"G",\u011c:"G",\u0120:"G",\u0193:"G",\u1e20:"G",\u01e4:"G",\u1e2a:"H",\u021e:"H",\u1e28:"H",\u0124:"H",\u2c67:"H",\u1e26:"H",\u1e22:"H",\u1e24:"H",\u0126:"H",\u00cd:"I",\u012c:"I",\u01cf:"I",\u00ce:"I",\u00cf:"I",\u1e2e:"I",\u0130:"I",\u1eca:"I",\u0208:"I",\u00cc:"I",\u1ec8:"I",\u020a:"I",\u012a:"I",\u012e:"I",\u0197:"I",\u0128:"I",\u1e2c:"I",\ua779:"D",\ua77b:"F",\ua77d:"G",\ua782:"R",\ua784:"S",\ua786:"T",\ua76c:"IS",\u0134:"J",\u0248:"J",\u1e30:"K",\u01e8:"K",\u0136:"K",\u2c69:"K",\ua742:"K",\u1e32:"K",\u0198:"K",\u1e34:"K",\ua740:"K",\ua744:"K",\u0139:"L",\u023d:"L",\u013d:"L",\u013b:"L",\u1e3c:"L",\u1e36:"L",\u1e38:"L",\u2c60:"L",\ua748:"L",\u1e3a:"L",\u013f:"L",\u2c62:"L",\u01c8:"L",\u0141:"L",\u01c7:"LJ",\u1e3e:"M",\u1e40:"M",\u1e42:"M",\u2c6e:"M",\u0143:"N",\u0147:"N",\u0145:"N",\u1e4a:"N",\u1e44:"N",\u1e46:"N",\u01f8:"N",\u019d:"N",\u1e48:"N",\u0220:"N",\u01cb:"N",\u00d1:"N",\u01ca:"NJ",\u00d3:"O",\u014e:"O",\u01d1:"O",\u00d4:"O",\u1ed0:"O",\u1ed8:"O",\u1ed2:"O",\u1ed4:"O",\u1ed6:"O",\u00d6:"O",\u022a:"O",\u022e:"O",\u0230:"O",\u1ecc:"O",\u0150:"O",\u020c:"O",\u00d2:"O",\u1ece:"O",\u01a0:"O",\u1eda:"O",\u1ee2:"O",\u1edc:"O",\u1ede:"O",\u1ee0:"O",\u020e:"O",\ua74a:"O",\ua74c:"O",\u014c:"O",\u1e52:"O",\u1e50:"O",\u019f:"O",\u01ea:"O",\u01ec:"O",\u00d8:"O",\u01fe:"O",\u00d5:"O",\u1e4c:"O",\u1e4e:"O",\u022c:"O",\u01a2:"OI",\ua74e:"OO",\u0190:"E",\u0186:"O",\u0222:"OU",\u1e54:"P",\u1e56:"P",\ua752:"P",\u01a4:"P",\ua754:"P",\u2c63:"P",\ua750:"P",\ua758:"Q",\ua756:"Q",\u0154:"R",\u0158:"R",\u0156:"R",\u1e58:"R",\u1e5a:"R",\u1e5c:"R",\u0210:"R",\u0212:"R",\u1e5e:"R",\u024c:"R",\u2c64:"R",\ua73e:"C",\u018e:"E",\u015a:"S",\u1e64:"S",\u0160:"S",\u1e66:"S",\u015e:"S",\u015c:"S",\u0218:"S",\u1e60:"S",\u1e62:"S",\u1e68:"S",\u0164:"T",\u0162:"T",\u1e70:"T",\u021a:"T",\u023e:"T",\u1e6a:"T",\u1e6c:"T",\u01ac:"T",\u1e6e:"T",\u01ae:"T",\u0166:"T",\u2c6f:"A",\ua780:"L",\u019c:"M",\u0245:"V",\ua728:"TZ",\u00da:"U",\u016c:"U",\u01d3:"U",\u00db:"U",\u1e76:"U",\u00dc:"U",\u01d7:"U",\u01d9:"U",\u01db:"U",\u01d5:"U",\u1e72:"U",\u1ee4:"U",\u0170:"U",\u0214:"U",\u00d9:"U",\u1ee6:"U",\u01af:"U",\u1ee8:"U",\u1ef0:"U",\u1eea:"U",\u1eec:"U",\u1eee:"U",\u0216:"U",\u016a:"U",\u1e7a:"U",\u0172:"U",\u016e:"U",\u0168:"U",\u1e78:"U",\u1e74:"U",\ua75e:"V",\u1e7e:"V",\u01b2:"V",\u1e7c:"V",\ua760:"VY",\u1e82:"W",\u0174:"W",\u1e84:"W",\u1e86:"W",\u1e88:"W",\u1e80:"W",\u2c72:"W",\u1e8c:"X",\u1e8a:"X",\u00dd:"Y",\u0176:"Y",\u0178:"Y",\u1e8e:"Y",\u1ef4:"Y",\u1ef2:"Y",\u01b3:"Y",\u1ef6:"Y",\u1efe:"Y",\u0232:"Y",\u024e:"Y",\u1ef8:"Y",\u0179:"Z",\u017d:"Z",\u1e90:"Z",\u2c6b:"Z",\u017b:"Z",\u1e92:"Z",\u0224:"Z",\u1e94:"Z",\u01b5:"Z",\u0132:"IJ",\u0152:"OE",\u1d00:"A",\u1d01:"AE",\u0299:"B",\u1d03:"B",\u1d04:"C",\u1d05:"D",\u1d07:"E",\ua730:"F",\u0262:"G",\u029b:"G",\u029c:"H",\u026a:"I",\u0281:"R",\u1d0a:"J",\u1d0b:"K",\u029f:"L",\u1d0c:"L",\u1d0d:"M",\u0274:"N",\u1d0f:"O",\u0276:"OE",\u1d10:"O",\u1d15:"OU",\u1d18:"P",\u0280:"R",\u1d0e:"N",\u1d19:"R",\ua731:"S",\u1d1b:"T",\u2c7b:"E",\u1d1a:"R",\u1d1c:"U",\u1d20:"V",\u1d21:"W",\u028f:"Y",\u1d22:"Z",\u00e1:"a",\u0103:"a",\u1eaf:"a",\u1eb7:"a",\u1eb1:"a",\u1eb3:"a",\u1eb5:"a",\u01ce:"a",\u00e2:"a",\u1ea5:"a",\u1ead:"a",\u1ea7:"a",\u1ea9:"a",\u1eab:"a",\u00e4:"a",\u01df:"a",\u0227:"a",\u01e1:"a",\u1ea1:"a",\u0201:"a",\u00e0:"a",\u1ea3:"a",\u0203:"a",\u0101:"a",\u0105:"a",\u1d8f:"a",\u1e9a:"a",\u00e5:"a",\u01fb:"a",\u1e01:"a",\u2c65:"a",\u00e3:"a",\ua733:"aa",\u00e6:"ae",\u01fd:"ae",\u01e3:"ae",\ua735:"ao",\ua737:"au",\ua739:"av",\ua73b:"av",\ua73d:"ay",\u1e03:"b",\u1e05:"b",\u0253:"b",\u1e07:"b",\u1d6c:"b",\u1d80:"b",\u0180:"b",\u0183:"b",\u0275:"o",\u0107:"c",\u010d:"c",\u00e7:"c",\u1e09:"c",\u0109:"c",\u0255:"c",\u010b:"c",\u0188:"c",\u023c:"c",\u010f:"d",\u1e11:"d",\u1e13:"d",\u0221:"d",\u1e0b:"d",\u1e0d:"d",\u0257:"d",\u1d91:"d",\u1e0f:"d",\u1d6d:"d",\u1d81:"d",\u0111:"d",\u0256:"d",\u018c:"d",\u0131:"i",\u0237:"j",\u025f:"j",\u0284:"j",\u01f3:"dz",\u01c6:"dz",\u00e9:"e",\u0115:"e",\u011b:"e",\u0229:"e",\u1e1d:"e",\u00ea:"e",\u1ebf:"e",\u1ec7:"e",\u1ec1:"e",\u1ec3:"e",\u1ec5:"e",\u1e19:"e",\u00eb:"e",\u0117:"e",\u1eb9:"e",\u0205:"e",\u00e8:"e",\u1ebb:"e",\u0207:"e",\u0113:"e",\u1e17:"e",\u1e15:"e",\u2c78:"e",\u0119:"e",\u1d92:"e",\u0247:"e",\u1ebd:"e",\u1e1b:"e",\ua76b:"et",\u1e1f:"f",\u0192:"f",\u1d6e:"f",\u1d82:"f",\u01f5:"g",\u011f:"g",\u01e7:"g",\u0123:"g",\u011d:"g",\u0121:"g",\u0260:"g",\u1e21:"g",\u1d83:"g",\u01e5:"g",\u1e2b:"h",\u021f:"h",\u1e29:"h",\u0125:"h",\u2c68:"h",\u1e27:"h",\u1e23:"h",\u1e25:"h",\u0266:"h",\u1e96:"h",\u0127:"h",\u0195:"hv",\u00ed:"i",\u012d:"i",\u01d0:"i",\u00ee:"i",\u00ef:"i",\u1e2f:"i",\u1ecb:"i",\u0209:"i",\u00ec:"i",\u1ec9:"i",\u020b:"i",\u012b:"i",\u012f:"i",\u1d96:"i",\u0268:"i",\u0129:"i",\u1e2d:"i",\ua77a:"d",\ua77c:"f",\u1d79:"g",\ua783:"r",\ua785:"s",\ua787:"t",\ua76d:"is",\u01f0:"j",\u0135:"j",\u029d:"j",\u0249:"j",\u1e31:"k",\u01e9:"k",\u0137:"k",\u2c6a:"k",\ua743:"k",\u1e33:"k",\u0199:"k",\u1e35:"k",\u1d84:"k",\ua741:"k",\ua745:"k",\u013a:"l",\u019a:"l",\u026c:"l",\u013e:"l",\u013c:"l",\u1e3d:"l",\u0234:"l",\u1e37:"l",\u1e39:"l",\u2c61:"l",\ua749:"l",\u1e3b:"l",\u0140:"l",\u026b:"l",\u1d85:"l",\u026d:"l",\u0142:"l",\u01c9:"lj",\u017f:"s",\u1e9c:"s",\u1e9b:"s",\u1e9d:"s",\u1e3f:"m",\u1e41:"m",\u1e43:"m",\u0271:"m",\u1d6f:"m",\u1d86:"m",\u0144:"n",\u0148:"n",\u0146:"n",\u1e4b:"n",\u0235:"n",\u1e45:"n",\u1e47:"n",\u01f9:"n",\u0272:"n",\u1e49:"n",\u019e:"n",\u1d70:"n",\u1d87:"n",\u0273:"n",\u00f1:"n",\u01cc:"nj",\u00f3:"o",\u014f:"o",\u01d2:"o",\u00f4:"o",\u1ed1:"o",\u1ed9:"o",\u1ed3:"o",\u1ed5:"o",\u1ed7:"o",\u00f6:"o",\u022b:"o",\u022f:"o",\u0231:"o",\u1ecd:"o",\u0151:"o",\u020d:"o",\u00f2:"o",\u1ecf:"o",\u01a1:"o",\u1edb:"o",\u1ee3:"o",\u1edd:"o",\u1edf:"o",\u1ee1:"o",\u020f:"o",\ua74b:"o",\ua74d:"o",\u2c7a:"o",\u014d:"o",\u1e53:"o",\u1e51:"o",\u01eb:"o",\u01ed:"o",\u00f8:"o",\u01ff:"o",\u00f5:"o",\u1e4d:"o",\u1e4f:"o",\u022d:"o",\u01a3:"oi",\ua74f:"oo",\u025b:"e",\u1d93:"e",\u0254:"o",\u1d97:"o",\u0223:"ou",\u1e55:"p",\u1e57:"p",\ua753:"p",\u01a5:"p",\u1d71:"p",\u1d88:"p",\ua755:"p",\u1d7d:"p",\ua751:"p",\ua759:"q",\u02a0:"q",\u024b:"q",\ua757:"q",\u0155:"r",\u0159:"r",\u0157:"r",\u1e59:"r",\u1e5b:"r",\u1e5d:"r",\u0211:"r",\u027e:"r",\u1d73:"r",\u0213:"r",\u1e5f:"r",\u027c:"r",\u1d72:"r",\u1d89:"r",\u024d:"r",\u027d:"r",\u2184:"c",\ua73f:"c",\u0258:"e",\u027f:"r",\u015b:"s",\u1e65:"s",\u0161:"s",\u1e67:"s",\u015f:"s",\u015d:"s",\u0219:"s",\u1e61:"s",\u1e63:"s",\u1e69:"s",\u0282:"s",\u1d74:"s",\u1d8a:"s",\u023f:"s",\u0261:"g",\u1d11:"o",\u1d13:"o",\u1d1d:"u",\u0165:"t",\u0163:"t",\u1e71:"t",\u021b:"t",\u0236:"t",\u1e97:"t",\u2c66:"t",\u1e6b:"t",\u1e6d:"t",\u01ad:"t",\u1e6f:"t",\u1d75:"t",\u01ab:"t",\u0288:"t",\u0167:"t",\u1d7a:"th",\u0250:"a",\u1d02:"ae",\u01dd:"e",\u1d77:"g",\u0265:"h",\u02ae:"h",\u02af:"h",\u1d09:"i",\u029e:"k",\ua781:"l",\u026f:"m",\u0270:"m",\u1d14:"oe",\u0279:"r",\u027b:"r",\u027a:"r",\u2c79:"r",\u0287:"t",\u028c:"v",\u028d:"w",\u028e:"y",\ua729:"tz",\u00fa:"u",\u016d:"u",\u01d4:"u",\u00fb:"u",\u1e77:"u",\u00fc:"u",\u01d8:"u",\u01da:"u",\u01dc:"u",\u01d6:"u",\u1e73:"u",\u1ee5:"u",\u0171:"u",\u0215:"u",\u00f9:"u",\u1ee7:"u",\u01b0:"u",\u1ee9:"u",\u1ef1:"u",\u1eeb:"u",\u1eed:"u",\u1eef:"u",\u0217:"u",\u016b:"u",\u1e7b:"u",\u0173:"u",\u1d99:"u",\u016f:"u",\u0169:"u",\u1e79:"u",\u1e75:"u",\u1d6b:"ue",\ua778:"um",\u2c74:"v",\ua75f:"v",\u1e7f:"v",\u028b:"v",\u1d8c:"v",\u2c71:"v",\u1e7d:"v",\ua761:"vy",\u1e83:"w",\u0175:"w",\u1e85:"w",\u1e87:"w",\u1e89:"w",\u1e81:"w",\u2c73:"w",\u1e98:"w",\u1e8d:"x",\u1e8b:"x",\u1d8d:"x",\u00fd:"y",\u0177:"y",\u00ff:"y",\u1e8f:"y",\u1ef5:"y",\u1ef3:"y",\u01b4:"y",\u1ef7:"y",\u1eff:"y",\u0233:"y",\u1e99:"y",\u024f:"y",\u1ef9:"y",\u017a:"z",\u017e:"z",\u1e91:"z",\u0291:"z",\u2c6c:"z",\u017c:"z",\u1e93:"z",\u0225:"z",\u1e95:"z",\u1d76:"z",\u1d8e:"z",\u0290:"z",\u01b6:"z",\u0240:"z",\ufb00:"ff",\ufb03:"ffi",\ufb04:"ffl",\ufb01:"fi",\ufb02:"fl",\u0133:"ij",\u0153:"oe",\ufb06:"st",\u2090:"a",\u2091:"e",\u1d62:"i",\u2c7c:"j",\u2092:"o",\u1d63:"r",\u1d64:"u",\u1d65:"v",\u2093:"x"};class Xl{constructor(t,e=t,i=!1){this.item=t,this.value=e,this.header=i}isHeader(){return this.header}toString(){return this.value}}function aa(n){return n?n.replace(/[^A-Za-z0-9[\] ]/g,function(t){return oS[t]||t}):""}function bu(n,t=" ",e="",i){let s=[];if(i){const o=n.split(new RegExp(`([${i}]+)`,"g")),a=o[o.length-1];a>""&&(t&&e?s=Fm(a,t,e):s.push(a))}else s=Fm(n,t,e);return s}function Fm(n,t,e){const i=[],r=n.split(new RegExp(`(?:[${e}])([^${e}]+)(?:[${e}])|([^${t}]+)`,"g")),o=r.length;let a;const l=new RegExp(`[${e}]+`,"g");for(let h=0;h<o;h+=1)a=r[h],a&&a.length&&a!==t&&i.push(a.replace(l,""));return i}function dr(n,t){if(!t||"object"!=typeof n)return n.toString();if(t.endsWith("()"))return n[t.slice(0,t.length-2)]().toString();const i=t.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split(".");for(const s of i)s in n&&(n=n[s]);return n?n.toString():""}const Nm="220ms cubic-bezier(0, 0, 0.2, 1)",aS=(0,Xe.X$)("typeaheadAnimation",[(0,Xe.SB)("animated-down",(0,Xe.oB)({height:"*",overflow:"hidden"})),(0,Xe.eR)("* => animated-down",[(0,Xe.oB)({height:0,overflow:"hidden"}),(0,Xe.jt)(Nm)]),(0,Xe.SB)("animated-up",(0,Xe.oB)({height:"*",overflow:"hidden"})),(0,Xe.eR)("* => animated-up",[(0,Xe.oB)({height:"*",overflow:"hidden"}),(0,Xe.jt)(Nm)]),(0,Xe.eR)("* => unanimated",(0,Xe.jt)("0s"))]);let lS=0,hS=(()=>{class n{constructor(e,i,s,r){this.positionService=e,this.renderer=i,this.element=s,this.changeDetectorRef=r,this.activeChangeEvent=new _.vpe,this.isFocused=!1,this.positionServiceSubscription=new FM.w0,this.height=0,this.popupId="ngb-typeahead-"+lS++,this._matches=[],this.renderer.setAttribute(this.element.nativeElement,"id",this.popupId),this.positionServiceSubscription.add(this.positionService.event$?.subscribe(()=>{if(this.isAnimated)return this.animationState=this.isTopPosition?"animated-up":"animated-down",void this.changeDetectorRef.detectChanges();this.animationState="unanimated",this.changeDetectorRef.detectChanges()}))}get isBs4(){return!(0,xu.XA)()}get typeaheadTemplateMethods(){return{selectMatch:this.selectMatch.bind(this),selectActive:this.selectActive.bind(this),isActive:this.isActive.bind(this)}}get active(){return this._active}set active(e){this._active=e,this.activeChanged()}get matches(){return this._matches}set matches(e){if(this.positionService.setOptions({modifiers:{flip:{enabled:this.adaptivePosition}},allowedPositions:["top","bottom"]}),this._matches=e,this.needScrollbar=this.typeaheadScrollable&&this.typeaheadOptionsInScrollableView<this.matches.length,this.typeaheadScrollable&&setTimeout(()=>{this.setScrollableMode()}),this.typeaheadIsFirstItemActive&&this._matches.length>0&&(this.setActive(this._matches[0]),this._active?.isHeader()&&this.nextActiveMatch()),this._active&&!this.typeaheadIsFirstItemActive){const i=this._matches.find(s=>s.value===this._active?.value);if(i)return void this.selectActive(i);this.active=void 0}}get isTopPosition(){return this.element.nativeElement.classList.contains("top")}get optionsListTemplate(){return this.parent?this.parent.optionsListTemplate:void 0}get isAnimated(){return!!this.parent&&this.parent.isAnimated}get adaptivePosition(){return!!this.parent&&this.parent.adaptivePosition}get typeaheadScrollable(){return!!this.parent&&this.parent.typeaheadScrollable}get typeaheadOptionsInScrollableView(){return this.parent?this.parent.typeaheadOptionsInScrollableView:5}get typeaheadIsFirstItemActive(){return!this.parent||this.parent.typeaheadIsFirstItemActive}get itemTemplate(){return this.parent?this.parent.typeaheadItemTemplate:void 0}get canSelectItemsOnBlur(){return!!this.parent?.selectItemOnBlur}selectActiveMatch(e){this._active&&this.parent?.typeaheadSelectFirstItem&&this.selectMatch(this._active),!this.parent?.typeaheadSelectFirstItem&&e&&this.selectMatch(this._active)}activeChanged(){if(!this._active)return;const e=this.matches.indexOf(this._active);this.activeChangeEvent.emit(`${this.popupId}-${e}`)}prevActiveMatch(){if(!this._active)return;const e=this.matches.indexOf(this._active);this.setActive(this.matches[e-1<0?this.matches.length-1:e-1]),this._active.isHeader()&&this.prevActiveMatch(),this.typeaheadScrollable&&this.scrollPrevious(e)}nextActiveMatch(){const e=this._active?this.matches.indexOf(this._active):-1;this.setActive(this.matches[e+1>this.matches.length-1?0:e+1]),this._active?.isHeader()&&this.nextActiveMatch(),this.typeaheadScrollable&&this.scrollNext(e)}selectActive(e){this.isFocused=!0,this.setActive(e)}highlight(e,i){let o,a,s=e.value,r=(this.parent&&this.parent.typeaheadLatinize?aa(s):s).toLowerCase();if("object"==typeof i){const l=i.length;for(let h=0;h<l;h+=1)o=r.indexOf(i[h]),a=i[h].length,o>=0&&a>0&&(s=`${s.substring(0,o)}<strong>${s.substring(o,o+a)}</strong>${s.substring(o+a)}`,r=`${r.substring(0,o)}        ${" ".repeat(a)}         ${r.substring(o+a)}`)}else i&&(o=r.indexOf(i),a=i.length,o>=0&&a>0&&(s=`${s.substring(0,o)}<strong>${s.substring(o,o+a)}</strong>${s.substring(o+a)}`));return s}focusLost(){this.isFocused=!1,this.canSelectItemsOnBlur||this.setActive(void 0)}isActive(e){return this.active===e}selectMatch(e,i){return i&&(i.stopPropagation(),i.preventDefault()),this.parent?.changeModel(e),setTimeout(()=>this.parent?.typeaheadOnSelect.emit(e),0),!1}setScrollableMode(){if(this.ulElement||(this.ulElement=this.element),this.liElements?.first){const e=xu.cQ.getStyles(this.ulElement.nativeElement),i=xu.cQ.getStyles(this.liElements.first.nativeElement),s=parseFloat((e["padding-bottom"]?e["padding-bottom"]:"").replace("px","")),r=parseFloat((e["padding-top"]?e["padding-top"]:"0").replace("px","")),o=parseFloat((i.height?i.height:"0").replace("px",""));this.guiHeight=`${this.typeaheadOptionsInScrollableView*o+r+s}px`}this.renderer.setStyle(this.element.nativeElement,"visibility","visible")}scrollPrevious(e){if(0!==e){if(this.liElements&&this.ulElement){const i=this.liElements.toArray()[e-1];i&&!this.isScrolledIntoView(i.nativeElement)&&(this.ulElement.nativeElement.scrollTop=i.nativeElement.offsetTop)}}else this.scrollToBottom()}scrollNext(e){if(e+1>this.matches.length-1)this.scrollToTop();else if(this.liElements&&this.ulElement){const i=this.liElements.toArray()[e+1];i&&!this.isScrolledIntoView(i.nativeElement)&&(this.ulElement.nativeElement.scrollTop=i.nativeElement.offsetTop-Number(this.ulElement.nativeElement.offsetHeight)+Number(i.nativeElement.offsetHeight))}}ngOnDestroy(){this.positionServiceSubscription.unsubscribe()}setActive(e){let i;this._active=e,null==this._active||this._active.isHeader()||(i=e),this.parent?.typeaheadOnPreview.emit(i)}isScrolledIntoView(e){if(!this.ulElement)return!1;const i=this.ulElement.nativeElement.scrollTop,s=i+Number(this.ulElement.nativeElement.offsetHeight),r=e.offsetTop;return r+e.offsetHeight<=s&&r>=i}scrollToBottom(){!this.ulElement?.nativeElement||(this.ulElement.nativeElement.scrollTop=this.ulElement.nativeElement.scrollHeight)}scrollToTop(){!this.ulElement?.nativeElement||(this.ulElement.nativeElement.scrollTop=0)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(Rm.sA),_.Y36(_.Qsj),_.Y36(_.SBq),_.Y36(_.sBO))},n.\u0275cmp=_.Xpm({type:n,selectors:[["typeahead-container"]],viewQuery:function(e,i){if(1&e&&(_.Gf(XM,5),_.Gf(YM,5)),2&e){let s;_.iGM(s=_.CRH())&&(i.ulElement=s.first),_.iGM(s=_.CRH())&&(i.liElements=s)}},hostAttrs:[1,"dropdown","open","bottom",2,"position","absolute","display","block"],hostVars:9,hostBindings:function(e,i){1&e&&_.NdJ("mouseleave",function(){return i.focusLost()})("blur",function(){return i.focusLost()}),2&e&&(_.uIk("role",i.isBs4?"listbox":null),_.Udp("height",i.isBs4&&i.needScrollbar?i.guiHeight:"auto")("visibility","inherit"),_.ekj("dropdown-menu",i.isBs4)("dropup",i.dropup))},outputs:{activeChangeEvent:"activeChange"},decls:7,vars:7,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext"],["bsItemTemplate",""],["bs3Template",""],["bs4Template",""],[3,"innerHtml"],["role","listbox",1,"dropdown-menu"],["ulElement",""],["ngFor","",3,"ngForOf"],["class","dropdown-header",4,"ngIf"],["role","option",3,"id","active","mouseenter",4,"ngIf"],[1,"dropdown-header"],["liElements",""],["role","option",3,"id","mouseenter"],["href","#","tabindex","-1",3,"click"],[3,"ngIf"],["role","option",1,"dropdown-item",3,"id","click","mouseenter"]],template:function(e,i){if(1&e&&(_.YNc(0,ZM,0,0,"ng-template",0),_.YNc(1,$M,1,1,"ng-template",null,1,_.W1O),_.YNc(3,QM,3,5,"ng-template",null,2,_.W1O),_.YNc(5,sS,1,1,"ng-template",null,3,_.W1O)),2&e){const s=_.MAs(2),r=_.MAs(4),o=_.MAs(6);_.Q6J("ngTemplateOutlet",i.optionsListTemplate||(i.isBs4?o:r))("ngTemplateOutletContext",_.l5B(2,rS,i.matches,i.itemTemplate||s,i.query,i.typeaheadTemplateMethods))}},dependencies:[le.sg,le.O5,le.tP],styles:[".dropdown[_nghost-%COMP%]{z-index:1000}.dropdown-menu[_nghost-%COMP%], .dropdown-menu[_ngcontent-%COMP%]{overflow-y:auto;height:100px}"],data:{animation:[aS]}}),n})(),Um=(()=>{class n{constructor(){this.adaptivePosition=!1,this.isAnimated=!1,this.hideResultsOnBlur=!0,this.cancelRequestOnFocusLost=!1,this.selectFirstItem=!0,this.isFirstItemActive=!0,this.minLength=1,this.selectItemOnBlur=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),cS=(()=>{class n{constructor(e,i,s,r,o,a,l){this.changeDetection=s,this.element=r,this.ngControl=o,this.renderer=a,this.typeaheadMinLength=1,this.adaptivePosition=!1,this.isAnimated=!1,this.typeaheadWaitMs=0,this.typeaheadLatinize=!0,this.typeaheadSingleWords=!0,this.typeaheadWordDelimiters=" ",this.typeaheadMultipleSearchDelimiters=",",this.typeaheadPhraseDelimiters="'\"",this.typeaheadScrollable=!1,this.typeaheadOptionsInScrollableView=5,this.typeaheadSelectFirstItem=!0,this.typeaheadIsFirstItemActive=!0,this.typeaheadLoading=new _.vpe,this.typeaheadNoResults=new _.vpe,this.typeaheadOnSelect=new _.vpe,this.typeaheadOnPreview=new _.vpe,this.typeaheadOnBlur=new _.vpe,this.dropup=!1,this.isOpen=!1,this.list="list",this.isActiveItemChanged=!1,this.isFocused=!1,this.cancelRequestOnFocusLost=!1,this.selectItemOnBlur=!1,this.keyUpEventEmitter=new _.vpe,this.placement="bottom left",this._matches=[],this._subscriptions=[],this._outsideClickListener=()=>{},this._typeahead=e.createLoader(r,l,a).provide({provide:Um,useValue:i}),Object.assign(this,{typeaheadHideResultsOnBlur:i.hideResultsOnBlur,cancelRequestOnFocusLost:i.cancelRequestOnFocusLost,typeaheadSelectFirstItem:i.selectFirstItem,typeaheadIsFirstItemActive:i.isFirstItemActive,typeaheadMinLength:i.minLength,adaptivePosition:i.adaptivePosition,isAnimated:i.isAnimated,selectItemOnBlur:i.selectItemOnBlur})}get matches(){return this._matches}ngOnInit(){this.typeaheadOptionsLimit=this.typeaheadOptionsLimit||20,this.typeaheadMinLength=void 0===this.typeaheadMinLength?1:this.typeaheadMinLength,void 0===this.typeaheadAsync&&!(0,vu.b)(this.typeahead)&&(this.typeaheadAsync=!1),(0,vu.b)(this.typeahead)&&(this.typeaheadAsync=!0),this.typeaheadAsync?this.asyncActions():this.syncActions(),this.checkDelimitersConflict()}onInput(e){const i=void 0!==e.target.value?e.target.value:void 0!==e.target.textContent?e.target.textContent:e.target.innerText;null!=i&&i.trim().length>=this.typeaheadMinLength?(this.typeaheadLoading.emit(!0),this.keyUpEventEmitter.emit(e.target.value)):(this.typeaheadLoading.emit(!1),this.typeaheadNoResults.emit(!1),this.hide())}onChange(e){if(this._container){if(27===e.keyCode||"Escape"===e.key)return void this.hide();if(38===e.keyCode||"ArrowUp"===e.key)return this.isActiveItemChanged=!0,void this._container.prevActiveMatch();if(40===e.keyCode||"ArrowDown"===e.key)return this.isActiveItemChanged=!0,void this._container.nextActiveMatch();if(13===e.keyCode||"Enter"===e.key)return void this._container.selectActiveMatch()}}onFocus(){this.isFocused=!0,setTimeout(()=>{0===this.typeaheadMinLength&&(this.typeaheadLoading.emit(!0),this.keyUpEventEmitter.emit(this.element.nativeElement.value||""))},0)}onBlur(){this.isFocused=!1,this._container&&!this._container.isFocused&&this.typeaheadOnBlur.emit(this._container.active),!this.container&&0===this._matches?.length&&this.typeaheadOnBlur.emit(new Xl(this.element.nativeElement.value,this.element.nativeElement.value,!1))}onKeydown(e){if(this._container&&((9===e.keyCode||"Tab"===e.key)&&this.onBlur(),9===e.keyCode||"Tab"===e.key||13===e.keyCode||"Enter"===e.key)){if(e.preventDefault(),this.typeaheadSelectFirstItem)return void this._container.selectActiveMatch();this.typeaheadSelectFirstItem||(this._container.selectActiveMatch(this.isActiveItemChanged),this.isActiveItemChanged=!1,this.hide())}}changeModel(e){if(!e)return;let i;if(this.typeaheadMultipleSearch&&this._allEnteredValue){const s=this._allEnteredValue.split(new RegExp(`([${this.typeaheadMultipleSearchDelimiters}]+)`));this._allEnteredValue=s.slice(0,s.length-1).concat(e.value).join(""),i=this._allEnteredValue}else i=e.value;this.ngControl.viewToModelUpdate(i),this.ngControl.control?.setValue(i),this.changeDetection.markForCheck(),this.hide()}show(){if(this._typeahead.attach(hS).to(this.container).position({attachment:(this.dropup?"top":"bottom")+" left"}).show({typeaheadRef:this,placement:this.placement,animation:!1,dropup:this.dropup}),this._outsideClickListener=this.renderer.listen("document","click",i=>{0===this.typeaheadMinLength&&this.element.nativeElement.contains(i.target)||!this.typeaheadHideResultsOnBlur||this.element.nativeElement.contains(i.target)||this.onOutsideClick()}),!this._typeahead.instance||!this.ngControl.control)return;this._container=this._typeahead.instance,this._container.parent=this;const e=(this.typeaheadLatinize?aa(this.ngControl.control.value):this.ngControl.control.value).toString().toLowerCase();this._container.query=this.tokenizeQuery(e),this._container.matches=this._matches,this.element.nativeElement.focus(),this._container.activeChangeEvent.subscribe(i=>{this.activeDescendant=i,this.changeDetection.markForCheck()}),this.isOpen=!0}hide(){this._typeahead.isShown&&(this._typeahead.hide(),this._outsideClickListener(),this._container=void 0,this.isOpen=!1,this.changeDetection.markForCheck()),this.typeaheadOnPreview.emit()}onOutsideClick(){this._container&&!this._container.isFocused&&this.hide()}ngOnDestroy(){for(const e of this._subscriptions)e.unsubscribe();this._typeahead.dispose()}asyncActions(){this._subscriptions.push(this.keyUpEventEmitter.pipe((0,Lm.b)(this.typeaheadWaitMs),(0,UM.b)(e=>this._allEnteredValue=e),(0,kM.w)(()=>this.typeahead?this.typeahead:Pm.E)).subscribe(e=>{this.finalizeAsyncCall(e)}))}syncActions(){this._subscriptions.push(this.keyUpEventEmitter.pipe((0,Lm.b)(this.typeaheadWaitMs),(0,GM.z)(e=>{this._allEnteredValue=e;const i=this.normalizeQuery(e);return this.typeahead?((0,vu.b)(this.typeahead)?this.typeahead:(0,NM.D)(this.typeahead)).pipe((0,oa.h)(r=>!!r&&this.testMatch(this.normalizeOption(r),i)),function VM(){return(0,Om.e)((n,t)=>{(function HM(n,t){return(0,Om.e)((0,zM.U)(n,t,arguments.length>=2,!1,!0))})(WM,[])(n).subscribe(t)})}()):Pm.E})).subscribe(e=>{this.finalizeAsyncCall(e)}))}normalizeOption(e){const i=dr(e,this.typeaheadOptionField);return(this.typeaheadLatinize?aa(i):i).toLowerCase()}tokenizeQuery(e){let i=e;return this.typeaheadMultipleSearch&&this.typeaheadSingleWords?this.haveCommonCharacters(`${this.typeaheadPhraseDelimiters}${this.typeaheadWordDelimiters}`,this.typeaheadMultipleSearchDelimiters)||(i=bu(i,this.typeaheadWordDelimiters,this.typeaheadPhraseDelimiters,this.typeaheadMultipleSearchDelimiters)):i=this.typeaheadSingleWords?bu(i,this.typeaheadWordDelimiters,this.typeaheadPhraseDelimiters):bu(i,void 0,void 0,this.typeaheadMultipleSearchDelimiters),i}normalizeQuery(e){let i=(this.typeaheadLatinize?aa(e):e).toString().toLowerCase();return i=this.tokenizeQuery(i),i}testMatch(e,i){let s;if("object"==typeof i){s=i.length;for(let r=0;r<s;r+=1)if(i[r].length>0&&e.indexOf(i[r])<0)return!1;return!0}return e.indexOf(i)>=0}finalizeAsyncCall(e){if(this.prepareMatches(e||[]),this.typeaheadLoading.emit(!1),this.typeaheadNoResults.emit(!this.hasMatches()),this.hasMatches()){if(this.isFocused||!this.cancelRequestOnFocusLost)if(this._container&&this.ngControl.control){const s=((this.typeaheadLatinize?aa(this.ngControl.control.value):this.ngControl.control.value)||"").toString().toLowerCase();this._container.query=this.tokenizeQuery(s),this._container.matches=this._matches}else this.show()}else this.hide()}prepareMatches(e){const i=e.slice(0,this.typeaheadOptionsLimit),s=this.typeaheadOrderBy?this.orderMatches(i):i;if(this.typeaheadGroupField){let r=[];s.map(a=>dr(a,this.typeaheadGroupField)).filter((a,l,h)=>h.indexOf(a)===l).forEach(a=>{r.push(new Xl(a,a,!0)),r=r.concat(s.filter(l=>dr(l,this.typeaheadGroupField)===a).map(l=>new Xl(l,dr(l,this.typeaheadOptionField))))}),this._matches=r}else this._matches=s.map(r=>new Xl(r,dr(r,this.typeaheadOptionField)))}orderMatches(e){if(!e.length)return e;if(null!=this.typeaheadOrderBy&&"object"==typeof this.typeaheadOrderBy&&0===Object.keys(this.typeaheadOrderBy).length)return console.error("Field and direction properties for typeaheadOrderBy have to be set according to documentation!"),e;const{field:i,direction:s}=this.typeaheadOrderBy||{};return!s||"asc"!==s&&"desc"!==s?(console.error('typeaheadOrderBy direction has to equal "asc" or "desc". Please follow the documentation.'),e):"string"==typeof e[0]?"asc"===s?e.sort():e.sort().reverse():i&&"string"==typeof i?e.sort((r,o)=>{const a=dr(r,i),l=dr(o,i);return a<l?"asc"===s?-1:1:a>l?"asc"===s?1:-1:0}):(console.error("typeaheadOrderBy field has to set according to the documentation."),e)}hasMatches(){return this._matches.length>0}checkDelimitersConflict(){if(this.typeaheadMultipleSearch&&this.typeaheadSingleWords&&this.haveCommonCharacters(`${this.typeaheadPhraseDelimiters}${this.typeaheadWordDelimiters}`,this.typeaheadMultipleSearchDelimiters))throw new Error(`Delimiters used in typeaheadMultipleSearchDelimiters must be different\n          from delimiters used in typeaheadWordDelimiters (current value: ${this.typeaheadWordDelimiters}) and\n          typeaheadPhraseDelimiters (current value: ${this.typeaheadPhraseDelimiters}).\n          Please refer to the documentation`)}haveCommonCharacters(e,i){for(let s=0;s<e.length;s++)if(e.charAt(s).indexOf(i)>-1)return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(Dm.oj),_.Y36(Um),_.Y36(_.sBO),_.Y36(_.SBq),_.Y36(mt.a5),_.Y36(_.Qsj),_.Y36(_.s_b))},n.\u0275dir=_.lG2({type:n,selectors:[["","typeahead",""]],hostVars:4,hostBindings:function(e,i){1&e&&_.NdJ("input",function(r){return i.onInput(r)})("keyup",function(r){return i.onChange(r)})("click",function(){return i.onFocus()})("focus",function(){return i.onFocus()})("blur",function(){return i.onBlur()})("keydown",function(r){return i.onKeydown(r)}),2&e&&_.uIk("aria-activedescendant",i.activeDescendant)("aria-owns",i.isOpen?i._container.popupId:null)("aria-expanded",i.isOpen)("aria-autocomplete",i.list)},inputs:{typeahead:"typeahead",typeaheadMinLength:"typeaheadMinLength",adaptivePosition:"adaptivePosition",isAnimated:"isAnimated",typeaheadWaitMs:"typeaheadWaitMs",typeaheadOptionsLimit:"typeaheadOptionsLimit",typeaheadOptionField:"typeaheadOptionField",typeaheadGroupField:"typeaheadGroupField",typeaheadOrderBy:"typeaheadOrderBy",typeaheadAsync:"typeaheadAsync",typeaheadLatinize:"typeaheadLatinize",typeaheadSingleWords:"typeaheadSingleWords",typeaheadWordDelimiters:"typeaheadWordDelimiters",typeaheadMultipleSearch:"typeaheadMultipleSearch",typeaheadMultipleSearchDelimiters:"typeaheadMultipleSearchDelimiters",typeaheadPhraseDelimiters:"typeaheadPhraseDelimiters",typeaheadItemTemplate:"typeaheadItemTemplate",optionsListTemplate:"optionsListTemplate",typeaheadScrollable:"typeaheadScrollable",typeaheadOptionsInScrollableView:"typeaheadOptionsInScrollableView",typeaheadHideResultsOnBlur:"typeaheadHideResultsOnBlur",typeaheadSelectFirstItem:"typeaheadSelectFirstItem",typeaheadIsFirstItemActive:"typeaheadIsFirstItemActive",container:"container",dropup:"dropup"},outputs:{typeaheadLoading:"typeaheadLoading",typeaheadNoResults:"typeaheadNoResults",typeaheadOnSelect:"typeaheadOnSelect",typeaheadOnPreview:"typeaheadOnPreview",typeaheadOnBlur:"typeaheadOnBlur"},exportAs:["bs-typeahead"]}),n})(),uS=(()=>{class n{static forRoot(){return{ngModule:n,providers:[Dm.oj,Rm.sA]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[le.ez]}),n})();const dS=["canvas"];function fS(n,t){if(1&n&&(_.TgZ(0,"div",7)(1,"label",8),_._uU(2),_.qZA()()),2&n){const e=_.oxw();_.xp6(2),_.AsE("Total Height (",e.unitSystem,"): ",e.address?e.convertUnits(e.address.totalHeight):"0.0","")}}function pS(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"div",28),_.NdJ("dblclick",function(){const r=_.CHM(e).$implicit,o=_.oxw();return _.KtG(o.openModal2(r.id))}),_.TgZ(1,"p",29),_._uU(2),_.qZA()()}if(2&n){const e=t.$implicit;_.xp6(2),_.hij(" ",e.binDescription," ")}}const km=function(n){return{display:n}},mS=function(n,t){return{"grid-template-columns":n,"grid-template-row":t}};let Gm=(()=>{class n{constructor(e,i,s,r,o){this.bsModalRef=e,this.fb=i,this.warehouseService=s,this.toastr=r,this.unitService=o,this.title="",this.id=0,this.divCountColumn="2",this.divGridSizeColumn="50%",this.divCountRow="1",this.divGridSizeRow="100%",this.bins=[],this.products=[],this.productsStrs=[],this.scale=1e3,this.isModalOpen=!1,this.unitSystem="m",this.animaitonId=-1}onRightClick(e){e.preventDefault()}ngOnDestroy(){this.unitSystemSubscription?.unsubscribe()}ngOnInit(){this.form=this.fb.group({addressId:["",mt.kI.nullValidator]}),this.unitService.unit$.subscribe(e=>{this.unitSystem=e?"in":"m"}),this.animation=this.animation.bind(this),this.warehouseService.loadAddressDetail(this.id).pipe((0,ye.U)(e=>{this.address=e,this.form.get("addressId")?.setValue(this.address.addressId);const i=this.address.layers.length,s=this.address.layers[0].bins.length,o=100/i;this.divGridSizeColumn=`${(100/s).toFixed(2)}%`,this.divGridSizeRow=`${o.toFixed(2)}%`,this.divCountRow=i.toString(),this.divCountColumn=s.toString();const a=[];return this.address.layers.forEach(l=>{l.bins.forEach(h=>{h.binDescription=`${l.layerDescription}${h.binDescription}`}),a.push(...l.bins)}),a}),function Ge(n,t,e){let i,s=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:t=1/0,refCount:s=!1,scheduler:e}=n):i=n??1/0,(0,fe.B)({connector:()=>new jt(i,t,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}()).subscribe({next:e=>this.bins=e,error:console.error}),this.warehouseService.loadProducts().pipe((0,ye.U)(e=>(this.productsStrs=e.map(i=>`${i.productId}-${i.productDescription}`),e))).subscribe({next:e=>this.products=e,error:console.error})}closeModal(){this.bsModalRef.hide()}closeModal2(){this.isModalOpen=!1,cancelAnimationFrame(this.animaitonId)}openModal2(e){this.init3d(),this.animation(),this.binSelected=this.bins.find(i=>i.id===e),this.binSelected?(this.binSelected.products[0]?(this.selected=this.binSelected.products[0].productId+"-"+this.binSelected.products[0].productDescription,this.product=this.binSelected.products[0],this.product3d(this.product)):this.selected="",this.isModalOpen=!0):this.toastr.warning("Not Founded!")}productSelected(e){const i=e.value.split("-")[0],s=this.products.find(r=>r.productId===i);s?(s.images="bin"===this.address?.type?s.images.slice(0,6):s.images.slice(6,13),this.product=s,this.product3d(s)):this.toastr.warning("Product not founeded!")}get canvas(){return this.canvasRef?.nativeElement}init3d(){this.renderer=new cp({antialias:!0,canvas:this.canvas}),this.renderer.setSize(this.canvas.width,this.canvas.height),this.camera=new Bi(70,this.canvas.width/this.canvas.height,1,1e3),this.controls=new SM(this.camera,this.renderer.domElement),this.camera.position.z=10,this.controls.update(),this.scene=new up;const e=new Ss(.1,.1,.1),i=new Ki({color:267386880});this.mesh=new Yi(e,i),this.scene.add(this.mesh),this.scene.background=new Gt(13882323)}animation(){this.animaitonId=requestAnimationFrame(this.animation),this.mesh.rotation.y+=.005,this.controls?.update(),this.renderer?.render(this.scene,this.camera)}product3d(e){this.scene?.clear();let i={front:e.totalFront,depth:e.totalHeight,height:e.totalDepth};"bin"!==this.address?.type&&(i={front:e.palletFront,depth:e.palletHeight,height:e.palletDepth});const s=new Ss(i.front,i.height,i.depth),o="bin"!==this.address?.type?`COMBINED/PL/${e.productId}`:`${e.productId}T`,a="bin"!==this.address?.type?`COMBINED/PT/${e.productId}`:`${e.productId}S`,l=gu(`${Wl.N.images}/MyImages/${"bin"!==this.address?.type?`COMBINED/PF/${e.productId}`:`${e.productId}F`}.jpg`).pipe((0,We.K)(u=>(console.error(u),(0,Ce.of)(new Tn)))),h=gu(`${Wl.N.images}/MyImages/${o}.jpg`).pipe((0,We.K)(u=>(console.error(u),(0,Ce.of)(new Tn)))),c=gu(`${Wl.N.images}/MyImages/${a}.jpg`).pipe((0,We.K)(u=>(console.error(u),(0,Ce.of)(new Tn))));(0,Ke.D)([l,h,c]).pipe((0,ye.U)(u=>[new Ki({map:u[2],color:16777215}),new Ki({map:u[2],color:16777215}),new Ki({map:u[1],color:16777215}),new Ki({map:u[1],color:16777215}),new Ki({map:u[0],color:16777215}),new Ki({map:u[0],color:16777215})])).subscribe({next:u=>{this.mesh=new Yi(s,u),this.scene?.add(this.mesh),this.mesh.rotation.x-=9},error:console.error})}save(){const e=this.form.get("addressId")?.value;this.address&&e&&(this.address.addressId=e,this.warehouseService.saveAddressDetail(this.address?.id,this.address).subscribe(()=>{this.closeModal()}))}saveProduct(){this.product?this.binSelected.products=[this.product]:this.toastr.error("Unable to set product to this position!!"),this.closeModal2()}convertUnits(e){let i=e;return"in"===this.unitSystem&&(i=(0,MM.c)(i)),i.toFixed(2)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(cr.UZ),_.Y36(mt.qu),_.Y36(ur),_.Y36(LM._W),_.Y36(Im._))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-modal-address-detail"]],viewQuery:function(e,i){if(1&e&&_.Gf(dS,5),2&e){let s;_.iGM(s=_.CRH())&&(i.canvasRef=s.first)}},hostBindings:function(e,i){1&e&&_.NdJ("contextmenu",function(r){return i.onRightClick(r)})},inputs:{title:"title",id:"id"},decls:50,vars:21,consts:[["tabindex","-1",1,"modal-lg",3,"ngStyle"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[2,"margin-top","10px","margin-left","2%"],[1,"ui","label","big"],["style","margin-top: 10px; margin-left: 2%",4,"ngIf"],[1,"ui","form",3,"formGroup"],["type","text","label","Address Id","formControlName","addressId"],[1,"grid-layout-address-spot",3,"ngStyle"],["class","div-address-spot",3,"dblclick",4,"ngFor","ngForOf"],[2,"margin-top","8px"],[1,"ui","button","primary",3,"click"],[1,"ui","button","red",3,"click"],[1,"modal-lg",3,"ngStyle"],["tabindex","1",1,"modal-header"],[1,"modal-title","pull-left"],[2,"height","600px"],[2,"margin-bottom","0.25%"],[1,"form-control",3,"ngModel","typeahead","ngModelChange","typeaheadOnSelect"],[2,"height","90%","margin-top","1%"],["width","770","height","530",2,"border-radius","5%"],["canvas",""],["type","button",1,"ui","button","primary",3,"click"],["type","button",1,"ui","button","red",3,"click"],[1,"div-address-spot",3,"dblclick"],[2,"text-align","center","font-weight","600","font-size","18px"]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),_._uU(4),_.qZA(),_.TgZ(5,"button",4),_.NdJ("click",function(){return i.closeModal()}),_.TgZ(6,"span",5),_._uU(7,"\xd7"),_.qZA()()(),_.TgZ(8,"div",6)(9,"div")(10,"div",7)(11,"label",8),_._uU(12),_.qZA()(),_.TgZ(13,"div",7)(14,"label",8),_._uU(15),_.qZA()(),_.TgZ(16,"div",7)(17,"label",8),_._uU(18),_.qZA()(),_.YNc(19,fS,3,2,"div",9),_.TgZ(20,"form",10),_._UZ(21,"app-text-input",11),_.qZA(),_.TgZ(22,"div"),_._uU(23,"Address Infos"),_.qZA(),_.TgZ(24,"div",12),_.YNc(25,pS,3,1,"div",13),_.qZA(),_.TgZ(26,"div",14)(27,"button",15),_.NdJ("click",function(){return i.save()}),_._uU(28,"Save"),_.qZA(),_.TgZ(29,"button",16),_.NdJ("click",function(){return i.closeModal()}),_._uU(30,"Close"),_.qZA()()()()()(),_.TgZ(31,"div",17)(32,"div",18)(33,"h4",19),_._uU(34,"Product"),_.qZA(),_.TgZ(35,"button",4),_.NdJ("click",function(){return i.closeModal2()}),_.TgZ(36,"span",5),_._uU(37,"\xd7"),_.qZA()()(),_.TgZ(38,"div",6)(39,"div",20)(40,"label",21),_._uU(41,"Product"),_.qZA(),_.TgZ(42,"input",22),_.NdJ("ngModelChange",function(r){return i.selected=r})("typeaheadOnSelect",function(r){return i.productSelected(r)}),_.qZA(),_.TgZ(43,"div",23),_._UZ(44,"canvas",24,25),_.qZA()(),_.TgZ(46,"button",26),_.NdJ("click",function(){return i.saveProduct()}),_._uU(47," Save "),_.qZA(),_.TgZ(48,"button",27),_.NdJ("click",function(){return i.closeModal2()}),_._uU(49," Close "),_.qZA()()()),2&e&&(_.Q6J("ngStyle",_.VKq(14,km,i.isModalOpen?"none":"block")),_.xp6(4),_.hij(" ",i.title," "),_.xp6(8),_.hij("Type: ",i.address?i.address.type.charAt(0).toUpperCase()+i.address.type.substr(1):"Undefined",""),_.xp6(3),_.AsE("Total Front (",i.unitSystem,"): ",i.address?i.convertUnits(i.address.totalFront):"0.0",""),_.xp6(3),_.AsE("Total Depth (",i.unitSystem,"): ",i.address?i.convertUnits(i.address.totalDepth):"0.0",""),_.xp6(1),_.Q6J("ngIf","floor"!==(null==i.address?null:i.address.type)),_.xp6(1),_.Q6J("formGroup",i.form),_.xp6(4),_.Q6J("ngStyle",_.WLB(16,mS,"repeat("+i.divCountColumn+","+i.divGridSizeColumn+")","repeat("+i.divCountRow+","+i.divGridSizeRow+")")),_.xp6(1),_.Q6J("ngForOf",i.bins),_.xp6(6),_.Q6J("ngStyle",_.VKq(19,km,i.isModalOpen?"block":"none")),_.xp6(11),_.Q6J("ngModel",i.selected)("typeahead",i.productsStrs))},dependencies:[le.sg,le.O5,le.PC,mt._Y,mt.Fj,mt.JJ,mt.JL,mt.sg,mt.u,mt.On,yu,cS],styles:[".grid-layout-address-spot[_ngcontent-%COMP%]{display:grid;height:400px;width:100%;border:1px solid lightgrey;padding:.5%}.div-address-spot[_ngcontent-%COMP%]{background-color:green;border:1px solid black;align-items:center}"]}),n})();var fr=(n=>(n[n.WEBGL_LEGACY=0]="WEBGL_LEGACY",n[n.WEBGL=1]="WEBGL",n[n.WEBGL2=2]="WEBGL2",n))(fr||{}),wu=(n=>(n[n.COLOR=16384]="COLOR",n[n.DEPTH=256]="DEPTH",n[n.STENCIL=1024]="STENCIL",n))(wu||{}),ae=(n=>(n[n.NORMAL=0]="NORMAL",n[n.ADD=1]="ADD",n[n.MULTIPLY=2]="MULTIPLY",n[n.SCREEN=3]="SCREEN",n[n.OVERLAY=4]="OVERLAY",n[n.DARKEN=5]="DARKEN",n[n.LIGHTEN=6]="LIGHTEN",n[n.COLOR_DODGE=7]="COLOR_DODGE",n[n.COLOR_BURN=8]="COLOR_BURN",n[n.HARD_LIGHT=9]="HARD_LIGHT",n[n.SOFT_LIGHT=10]="SOFT_LIGHT",n[n.DIFFERENCE=11]="DIFFERENCE",n[n.EXCLUSION=12]="EXCLUSION",n[n.HUE=13]="HUE",n[n.SATURATION=14]="SATURATION",n[n.COLOR=15]="COLOR",n[n.LUMINOSITY=16]="LUMINOSITY",n[n.NORMAL_NPM=17]="NORMAL_NPM",n[n.ADD_NPM=18]="ADD_NPM",n[n.SCREEN_NPM=19]="SCREEN_NPM",n[n.NONE=20]="NONE",n[n.SRC_OVER=0]="SRC_OVER",n[n.SRC_IN=21]="SRC_IN",n[n.SRC_OUT=22]="SRC_OUT",n[n.SRC_ATOP=23]="SRC_ATOP",n[n.DST_OVER=24]="DST_OVER",n[n.DST_IN=25]="DST_IN",n[n.DST_OUT=26]="DST_OUT",n[n.DST_ATOP=27]="DST_ATOP",n[n.ERASE=26]="ERASE",n[n.SUBTRACT=28]="SUBTRACT",n[n.XOR=29]="XOR",n))(ae||{}),Yn=(n=>(n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n))(Yn||{}),St=(n=>(n[n.RGBA=6408]="RGBA",n[n.RGB=6407]="RGB",n[n.RG=33319]="RG",n[n.RED=6403]="RED",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.ALPHA=6406]="ALPHA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n))(St||{}),co=(n=>(n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n))(co||{}),Qt=(n=>(n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.BYTE=5120]="BYTE",n[n.SHORT=5122]="SHORT",n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.HALF_FLOAT=36193]="HALF_FLOAT",n))(Qt||{}),Mu=(n=>(n[n.FLOAT=0]="FLOAT",n[n.INT=1]="INT",n[n.UINT=2]="UINT",n))(Mu||{}),hs=(n=>(n[n.NEAREST=0]="NEAREST",n[n.LINEAR=1]="LINEAR",n))(hs||{}),Cs=(n=>(n[n.CLAMP=33071]="CLAMP",n[n.REPEAT=10497]="REPEAT",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n))(Cs||{}),Zn=(n=>(n[n.OFF=0]="OFF",n[n.POW2=1]="POW2",n[n.ON=2]="ON",n[n.ON_MANUAL=3]="ON_MANUAL",n))(Zn||{}),In=(n=>(n[n.NPM=0]="NPM",n[n.UNPACK=1]="UNPACK",n[n.PMA=2]="PMA",n[n.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",n[n.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",n[n.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",n))(In||{}),$n=(n=>(n[n.NO=0]="NO",n[n.YES=1]="YES",n[n.AUTO=2]="AUTO",n[n.BLEND=0]="BLEND",n[n.CLEAR=1]="CLEAR",n[n.BLIT=2]="BLIT",n))($n||{}),Su=(n=>(n[n.AUTO=0]="AUTO",n[n.MANUAL=1]="MANUAL",n))(Su||{}),vn=(n=>(n.LOW="lowp",n.MEDIUM="mediump",n.HIGH="highp",n))(vn||{}),Ii=(n=>(n[n.NONE=0]="NONE",n[n.SCISSOR=1]="SCISSOR",n[n.STENCIL=2]="STENCIL",n[n.SPRITE=3]="SPRITE",n[n.COLOR=4]="COLOR",n))(Ii||{}),wi=(n=>(n[n.NONE=0]="NONE",n[n.LOW=2]="LOW",n[n.MEDIUM=4]="MEDIUM",n[n.HIGH=8]="HIGH",n))(wi||{}),qn=(n=>(n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n))(qn||{});const Bt={ADAPTER:{createCanvas:(n,t)=>{const e=document.createElement("canvas");return e.width=n,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(n,t)=>fetch(n,t),parseXML:n=>(new DOMParser).parseFromString(n,"text/xml")},RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Tu=/iPhone/i,zm=/iPod/i,Hm=/iPad/i,Wm=/\biOS-universal(?:.+)Mac\b/i,Eu=/\bAndroid(?:.+)Mobile\b/i,Vm=/Android/i,uo=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Yl=/Silk/i,cs=/Windows Phone/i,Xm=/\bWindows(?:.+)ARM\b/i,Ym=/BlackBerry/i,Zm=/BB10/i,$m=/Opera Mini/i,qm=/\b(CriOS|Chrome)(?:.+)Mobile/i,jm=/Mobile(?:.+)Firefox\b/i,Jm=function(n){return typeof n<"u"&&"MacIntel"===n.platform&&"number"==typeof n.maxTouchPoints&&n.maxTouchPoints>1&&typeof MSStream>"u"};const us=function xS(n){var t={userAgent:"",platform:"",maxTouchPoints:0};!n&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:"string"==typeof n?t.userAgent=n:n&&n.userAgent&&(t={userAgent:n.userAgent,platform:n.platform,maxTouchPoints:n.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),typeof(i=e.split("Twitter"))[1]<"u"&&(e=i[0]);var s=function yS(n){return function(t){return t.test(n)}}(e),r={apple:{phone:s(Tu)&&!s(cs),ipod:s(zm),tablet:!s(Tu)&&(s(Hm)||Jm(t))&&!s(cs),universal:s(Wm),device:(s(Tu)||s(zm)||s(Hm)||s(Wm)||Jm(t))&&!s(cs)},amazon:{phone:s(uo),tablet:!s(uo)&&s(Yl),device:s(uo)||s(Yl)},android:{phone:!s(cs)&&s(uo)||!s(cs)&&s(Eu),tablet:!s(cs)&&!s(uo)&&!s(Eu)&&(s(Yl)||s(Vm)),device:!s(cs)&&(s(uo)||s(Yl)||s(Eu)||s(Vm))||s(/\bokhttp\b/i)},windows:{phone:s(cs),tablet:s(Xm),device:s(cs)||s(Xm)},other:{blackberry:s(Ym),blackberry10:s(Zm),opera:s($m),firefox:s(jm),chrome:s(qm),device:s(Ym)||s(Zm)||s($m)||s(jm)||s(qm)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}(globalThis.navigator);Bt.RETINA_PREFIX=/@([0-9\.]+)x/,Bt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var la=st(2005),vS=st(5469),Au=st(8762);const bS={parse:Au.Qc,format:Au.WU,resolve:Au.DB};function Rn(n){if("string"!=typeof n)throw new TypeError(`Path must be a string. Received ${JSON.stringify(n)}`)}function ha(n){return n.split("?")[0].split("#")[0]}const Fi={toPosix:n=>function MS(n,t,e){return n.replace(new RegExp(function wS(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t),"g"),e)}(n,"\\","/"),isUrl(n){return/^https?:/.test(this.toPosix(n))},isDataUrl:n=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(n),hasProtocol(n){return/^[^/:]+:\//.test(this.toPosix(n))},getProtocol(n){Rn(n),n=this.toPosix(n);let t="";const e=/^file:\/\/\//.exec(n),i=/^[^/:]+:\/\//.exec(n),s=/^[^/:]+:\//.exec(n);if(e||i||s){const r=e?.[0]||i?.[0]||s?.[0];t=r,n=n.slice(r.length)}return t},toAbsolute(n,t,e){if(this.isDataUrl(n))return n;const i=ha(this.toPosix(t??Bt.ADAPTER.getBaseUrl())),s=ha(this.toPosix(e??this.rootname(i)));return Rn(n),(n=this.toPosix(n)).startsWith("/")?Fi.join(s,n.slice(1)):this.isAbsolute(n)?n:this.join(i,n)},normalize(n){if(Rn(n=this.toPosix(n)),0===n.length)return".";let t="";const e=n.startsWith("/");this.hasProtocol(n)&&(t=this.rootname(n),n=n.slice(t.length));const i=n.endsWith("/");return n=function SS(n,t){let e="",i=0,s=-1,r=0,o=-1;for(let a=0;a<=n.length;++a){if(a<n.length)o=n.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(s!==a-1&&1!==r)if(s!==a-1&&2===r){if(e.length<2||2!==i||46!==e.charCodeAt(e.length-1)||46!==e.charCodeAt(e.length-2))if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){-1===l?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),s=a,r=0;continue}}else if(2===e.length||1===e.length){e="",i=0,s=a,r=0;continue}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${n.slice(s+1,a)}`:e=n.slice(s+1,a),i=a-s-1;s=a,r=0}else 46===o&&-1!==r?++r:r=-1}return e}(n,!1),n.length>0&&i&&(n+="/"),e?`/${n}`:t+n},isAbsolute(n){return Rn(n),n=this.toPosix(n),!!this.hasProtocol(n)||n.startsWith("/")},join(...n){if(0===n.length)return".";let t;for(let e=0;e<n.length;++e){const i=n[e];Rn(i),i.length>0&&(void 0===t?t=i:this.extname(n[e-1]??"")?t+=`/../${i}`:t+=`/${i}`)}return void 0===t?".":this.normalize(t)},dirname(n){if(Rn(n),0===n.length)return".";let t=(n=this.toPosix(n)).charCodeAt(0);const e=47===t;let i=-1,s=!0;const r=this.getProtocol(n),o=n;for(let a=(n=n.slice(r.length)).length-1;a>=1;--a)if(t=n.charCodeAt(a),47===t){if(!s){i=a;break}}else s=!1;return-1===i?e?"/":this.isUrl(o)?r+n:r:e&&1===i?"//":r+n.slice(0,i)},rootname(n){Rn(n);let t="";if(t=(n=this.toPosix(n)).startsWith("/")?"/":this.getProtocol(n),this.isUrl(n)){const e=n.indexOf("/",t.length);t=-1!==e?n.slice(0,e):n,t.endsWith("/")||(t+="/")}return t},basename(n,t){Rn(n),t&&Rn(t),n=ha(this.toPosix(n));let r,e=0,i=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=n.length){if(t.length===n.length&&t===n)return"";let o=t.length-1,a=-1;for(r=n.length-1;r>=0;--r){const l=n.charCodeAt(r);if(47===l){if(!s){e=r+1;break}}else-1===a&&(s=!1,a=r+1),o>=0&&(l===t.charCodeAt(o)?-1==--o&&(i=r):(o=-1,i=a))}return e===i?i=a:-1===i&&(i=n.length),n.slice(e,i)}for(r=n.length-1;r>=0;--r)if(47===n.charCodeAt(r)){if(!s){e=r+1;break}}else-1===i&&(s=!1,i=r+1);return-1===i?"":n.slice(e,i)},extname(n){Rn(n);let t=-1,e=0,i=-1,s=!0,r=0;for(let o=(n=ha(this.toPosix(n))).length-1;o>=0;--o){const a=n.charCodeAt(o);if(47!==a)-1===i&&(s=!1,i=o+1),46===a?-1===t?t=o:1!==r&&(r=1):-1!==t&&(r=-1);else if(!s){e=o+1;break}}return-1===t||-1===i||0===r||1===r&&t===i-1&&t===e+1?"":n.slice(t,i)},parse(n){Rn(n);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===n.length)return t;let e=(n=ha(this.toPosix(n))).charCodeAt(0);const i=this.isAbsolute(n);let s;t.root=this.rootname(n),s=i||this.hasProtocol(n)?1:0;let o=-1,a=0,l=-1,h=!0,c=n.length-1,u=0;for(;c>=s;--c)if(e=n.charCodeAt(c),47!==e)-1===l&&(h=!1,l=c+1),46===e?-1===o?o=c:1!==u&&(u=1):-1!==o&&(u=-1);else if(!h){a=c+1;break}return-1===o||-1===l||0===u||1===u&&o===l-1&&o===a+1?-1!==l&&(t.base=t.name=n.slice(0===a&&i?1:a,l)):(0===a&&i?(t.name=n.slice(1,o),t.base=n.slice(1,l)):(t.name=n.slice(a,o),t.base=n.slice(a,l)),t.ext=n.slice(o,l)),t.dir=this.dirname(n),t},sep:"/",delimiter:":"},Km={};function Be(n,t,e=3){if(Km[t])return;let i=(new Error).stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${n}`):(i=i.split("\n").splice(e).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${n}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${n}`),console.warn(i))),Km[t]=!0}let Cu;var dA={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ca(n,t=[]){return t[0]=(n>>16&255)/255,t[1]=(n>>8&255)/255,t[2]=(255&n)/255,t}function Qm(n){let t=n.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function Iu(n){if("string"==typeof n&&("#"===(n=dA[n.toLowerCase()]||n)[0]&&(n=n.slice(1)),3===n.length)){const[t,e,i]=n;n=t+t+e+e+i+i}return parseInt(n,16)}const tg=function fA(){const n=[],t=[];for(let i=0;i<32;i++)n[i]=i,t[i]=i;n[ae.NORMAL_NPM]=ae.NORMAL,n[ae.ADD_NPM]=ae.ADD,n[ae.SCREEN_NPM]=ae.SCREEN,t[ae.NORMAL]=ae.NORMAL_NPM,t[ae.ADD]=ae.ADD_NPM,t[ae.SCREEN]=ae.SCREEN_NPM;const e=[];return e.push(t),e.push(n),e}();function eg(n,t){return tg[t?1:0][n]}function Ru(n,t){if(1===t)return(255*t<<24)+n;if(0===t)return 0;let e=n>>16&255,i=n>>8&255,s=255&n;return e=e*t+.5|0,i=i*t+.5|0,s=s*t+.5|0,(255*t<<24)+(e<<16)+(i<<8)+s}function ig(n,t,e,i){return(e=e||new Float32Array(4))[0]=(n>>16&255)/255,e[1]=(n>>8&255)/255,e[2]=(255&n)/255,(i||void 0===i)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function Pu(n){if(4===n.BYTES_PER_ELEMENT)return n instanceof Float32Array?"Float32Array":n instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===n.BYTES_PER_ELEMENT){if(n instanceof Uint16Array)return"Uint16Array"}else if(1===n.BYTES_PER_ELEMENT&&n instanceof Uint8Array)return"Uint8Array";return null}function Zl(n){return n+=0===n?1:0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,1+(n|=n>>>16)}function ng(n){return!(n&n-1||!n)}function sg(n){let t=(n>65535?1:0)<<4,e=((n>>>=t)>255?1:0)<<3;return t|=e,e=((n>>>=e)>15?1:0)<<2,t|=e,e=((n>>>=e)>3?1:0)<<1,t|=e,t|(n>>>=e)>>1}function fo(n,t,e){const i=n.length;let s;if(t>=i||0===e)return;const r=i-(e=t+e>i?i-t:e);for(s=t;s<r;++s)n[s]=n[s+e];n.length=r}function po(n){return 0===n?0:n<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let yA=0;function pr(){return++yA}const rg=class{constructor(n,t,e,i){this.left=n,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Du=rg;Du.EMPTY=new rg(0,0,0,0);const og={},tn=Object.create(null),bn=Object.create(null);class ag{constructor(t,e,i){this._canvas=Bt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||Bt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function lg(n,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(0!==n[s+3])return!1;return!0}function hg(n,t,e,i,s){const r=4*t;for(let o=i,a=i*r+4*e;o<=s;++o,a+=r)if(0!==n[a+3])return!1;return!0}let $l;function Is(n,t=1){const e=Bt.RETINA_PREFIX?.exec(n);return e?parseFloat(e[1]):t}var Pt=(n=>(n.Renderer="renderer",n.Application="application",n.RendererSystem="renderer-webgl-system",n.RendererPlugin="renderer-webgl-plugin",n.CanvasRendererSystem="renderer-canvas-system",n.CanvasRendererPlugin="renderer-canvas-plugin",n.Asset="asset",n.LoadParser="load-parser",n.ResolveParser="resolve-parser",n.CacheParser="cache-parser",n.DetectionParser="detection-parser",n))(Pt||{});const Lu=n=>{if("function"==typeof n||"object"==typeof n&&n.extension){if(!n.extension)throw new Error("Extension class must have an extension object");n={..."object"!=typeof n.extension?{type:n.extension}:n.extension,ref:n}}if("object"!=typeof n)throw new Error("Invalid extension type");return"string"==typeof(n={...n}).type&&(n.type=[n.type]),n},cg=(n,t)=>Lu(n).priority??t,Xt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...n){return n.map(Lu).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...n){return n.map(Lu).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(n,t,e){const i=this._addHandlers,s=this._removeHandlers;if(i[n]||s[n])throw new Error(`Extension type ${n} already has a handler`);i[n]=t,s[n]=e;const r=this._queue;return r[n]&&(r[n].forEach(o=>t(o)),delete r[n]),this},handleByMap(n,t){return this.handle(n,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(n,t,e=-1){return this.handle(n,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,r)=>cg(r,e)-cg(s,e)))},i=>{const s=t.indexOf(i.ref);-1!==s&&t.splice(s,1)})}};class Ou{constructor(t){this.rawBinaryData="number"==typeof t?new ArrayBuffer(t):t instanceof Uint8Array?t.buffer:t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const wA=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function MA(n){let t="";for(let e=0;e<n;++e)e>0&&(t+="\nelse "),e<n-1&&(t+=`if(test == ${e}.0){}`);return t}class ds{constructor(){this.data=0,this.blendMode=ae.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ae.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ds;return t.depthTest=!1,t.blend=!0,t}}const zu=[];function ug(n,t){if(!n)return null;let e="";if("string"==typeof n){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(n);i&&(e=i[1].toLowerCase())}for(let i=zu.length-1;i>=0;--i){const s=zu[i];if(s.test&&s.test(n,e))return new s(n,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Pn{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,r,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](t,e,i,s,r,o,a,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(Pn.prototype,{dispatch:{value:Pn.prototype.emit},run:{value:Pn.prototype.emit}});class ua{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Pn("setRealSize"),this.onUpdate=new Pn("update"),this.onError=new Pn("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class da extends ua{constructor(t,e){const{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t}upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===In.UNPACK);const r=e.realWidth,o=e.realHeight;return i.width===r&&i.height===o?s.texSubImage2D(e.target,0,0,0,r,o,e.format,i.type,this.data):(i.width=r,i.height=o,s.texImage2D(e.target,0,i.internalFormat,r,o,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const TA={scaleMode:hs.NEAREST,format:St.RGBA,alphaMode:In.NPM},mo=class extends la{constructor(n=null,t=null){super(),t=Object.assign({},mo.defaultOptions,t);const{alphaMode:e,mipmap:i,anisotropicLevel:s,scaleMode:r,width:o,height:a,wrapMode:l,format:h,type:c,target:u,resolution:d,resourceOptions:f}=t;n&&!(n instanceof ua)&&((n=ug(n,f)).internal=!0),this.resolution=d||Bt.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=r,this.format=h,this.type=c,this.target=u,this.alphaMode=e,this.uid=pr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(n)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(n){this._mipmap!==n&&(this._mipmap=n,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(n){this._scaleMode!==n&&(this._scaleMode=n,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(n){this._wrapMode!==n&&(this._wrapMode=n,this.dirtyStyleId++)}setStyle(n,t){let e;return void 0!==n&&n!==this.scaleMode&&(this.scaleMode=n,e=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(n,t,e){return this.setRealSize(n*(e=e||this.resolution),t*e,e)}setRealSize(n,t,e){return this.resolution=e||this.resolution,this.width=Math.round(n)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ng(this.realWidth)&&ng(this.realHeight)}setResolution(n){const t=this.resolution;return t===n||(this.resolution=n,this.valid&&(this.width=Math.round(this.width*t)/n,this.height=Math.round(this.height*t)/n,this.emit("update",this)),this._refreshPOT()),this}setResource(n){if(this.resource===n)return this;if(this.resource)throw new Error("Resource can be set only once");return n.bind(this),this.resource=n,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(n){this.emit("error",this,n)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete bn[this.cacheId],delete tn[this.cacheId],this.cacheId=null),this.dispose(),mo.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(n,t,e=Bt.STRICT_TEXTURE_CACHE){const i="string"==typeof n;let s=null;i?s=n:(n._pixiId||(n._pixiId=`${t?.pixiIdPrefix||"pixiid"}_${pr()}`),s=n._pixiId);let r=bn[s];if(i&&e&&!r)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return r||(r=new mo(n,t),r.cacheId=s,mo.addToCache(r,s)),r}static fromBuffer(n,t,e,i){n=n||new Float32Array(t*e*4);const s=new da(n,{width:t,height:e}),r=n instanceof Float32Array?Qt.FLOAT:Qt.UNSIGNED_BYTE;return new mo(s,Object.assign({},TA,i||{width:t,height:e,type:r}))}static addToCache(n,t){t&&(n.textureCacheIds.includes(t)||n.textureCacheIds.push(t),bn[t]&&bn[t]!==n&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),bn[t]=n)}static removeFromCache(n){if("string"==typeof n){const t=bn[n];if(t){const e=t.textureCacheIds.indexOf(n);return e>-1&&t.textureCacheIds.splice(e,1),delete bn[n],t}}else if(n?.textureCacheIds){for(let t=0;t<n.textureCacheIds.length;++t)delete bn[n.textureCacheIds[t]];return n.textureCacheIds.length=0,n}return null}};let _e=mo;_e.defaultOptions={mipmap:Zn.POW2,anisotropicLevel:0,scaleMode:hs.LINEAR,wrapMode:Cs.CLAMP,alphaMode:In.UNPACK,target:co.TEXTURE_2D,format:St.RGBA,type:Qt.UNSIGNED_BYTE},_e._globalBatch=0;class Hu{constructor(){this.texArray=null,this.blend=0,this.type=Yn.TRIANGLES,this.start=0,this.size=0,this.data=null}}let EA=0;class _i{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=EA++,this.disposeRunner=new Pn("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?qn.ELEMENT_ARRAY_BUFFER:qn.ARRAY_BUFFER}get index(){return this.type===qn.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new _i(t)}}class ql{constructor(t,e=0,i=!1,s=Qt.FLOAT,r,o,a,l=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=r,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(t,e,i,s,r){return new ql(t,e,i,s,r)}}const AA={Float32Array,Uint32Array,Int32Array,Uint8Array},dg={5126:4,5123:2,5121:1};let IA=0;const RA={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Rs{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=IA++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Pn("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,r,o,a,l=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof _i||(e instanceof Array&&(e=new Float32Array(e)),e=new _i(e));const h=t.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],e,i,s,r);return this}let c=this.buffers.indexOf(e);return-1===c&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new ql(c,i,s,r,o,a,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof _i||(t instanceof Array&&(t=new Uint16Array(t)),t=new _i(t)),t.type=qn.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new _i;let s;for(s in this.attributes){const r=this.attributes[s];t.push(this.buffers[r.buffer].data),e.push(r.size*dg[r.type]/4),r.buffer=0}for(i.data=function CA(n,t){let e=0,i=0;const s={};for(let l=0;l<n.length;l++)i+=t[l],e+=n[l].length;const r=new ArrayBuffer(4*e);let o=null,a=0;for(let l=0;l<n.length;l++){const h=t[l],c=n[l],u=Pu(c);s[u]||(s[u]=new AA[u](r)),o=s[u];for(let d=0;d<c.length;d++)o[(d/h|0)*i+a+d%h]=c[d];a+=h}return new Float32Array(r)}(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Rs;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new _i(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new ql(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=qn.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Rs,i=[],s=[],r=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,r[l]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new(RA[Pu(o.buffers[a].data)])(s[a]),e.buffers[a]=new _i(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)i[l].set(o.buffers[l].data,r[l]),r[l]+=o.buffers[l].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=qn.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(0|d.buffer)===c&&(l+=d.size*dg[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+h]+=a;a+=t[u].buffers[c].data.length/l,h+=d.length}}return e}}class fg extends Rs{constructor(t=!1){super(),this._buffer=new _i(null,t,!1),this._indexBuffer=new _i(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Qt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Qt.FLOAT).addAttribute("aColor",this._buffer,4,!0,Qt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Qt.FLOAT).addIndex(this._indexBuffer)}}const jl=2*Math.PI,PA=180/Math.PI,DA=Math.PI/180;var Ni=(n=>(n[n.POLY=0]="POLY",n[n.RECT=1]="RECT",n[n.CIRC=2]="CIRC",n[n.ELIP=3]="ELIP",n[n.RREC=4]="RREC",n))(Ni||{});class ne{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ne(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Jl=[new ne,new ne,new ne,new ne];class Se{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=Ni.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Se(0,0,0,0)}clone(){return new Se(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e)return!((this.right>t.right?t.right:this.right)<=(this.x<t.x?t.x:this.x))&&(this.bottom>t.bottom?t.bottom:this.bottom)>(this.y<t.y?t.y:this.y);const i=this.left,s=this.right,r=this.top,o=this.bottom;if(s<=i||o<=r)return!1;const a=Jl[0].set(t.left,t.top),l=Jl[1].set(t.left,t.bottom),h=Jl[2].set(t.right,t.top),c=Jl[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u||(e.apply(a,a),e.apply(l,l),e.apply(h,h),e.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=i||Math.min(a.x,l.x,h.x,c.x)>=s||Math.max(a.y,l.y,h.y,c.y)<=r||Math.min(a.y,l.y,h.y,c.y)>=o))return!1;const d=u*(l.y-a.y),f=u*(a.x-l.x),p=d*i+f*r,m=d*s+f*r,g=d*i+f*o,x=d*s+f*o;if(Math.max(p,m,g,x)<=d*a.x+f*a.y||Math.min(p,m,g,x)>=d*c.x+f*c.y)return!1;const v=u*(a.y-h.y),y=u*(h.x-a.x),b=v*i+y*r,M=v*s+y*r,S=v*i+y*o,A=v*s+y*o;return!(Math.max(b,M,S,A)<=v*a.x+y*a.y||Math.min(b,M,S,A)>=v*c.x+y*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(r-s,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=r-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Wu{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Ni.CIRC}clone(){return new Wu(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let s=this.x-t,r=this.y-e;return s*=s,r*=r,s+r<=this.radius*this.radius}getBounds(){return new Se(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Vu{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=Ni.ELIP}clone(){return new Vu(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Se(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class go{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const i=[];for(let s=0,r=e.length;s<r;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=Ni.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new go(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const s=this.points.length/2;for(let r=0,o=s-1;r<s;o=r++){const a=this.points[2*r],l=this.points[2*r+1],h=this.points[2*o],c=this.points[2*o+1];l>e!=c>e&&t<(e-l)/(c-l)*(h-a)+a&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}}class Xu{constructor(t=0,e=0,i=0,s=0,r=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=r,this.type=Ni.RREC}clone(){return new Xu(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),r=e-(this.y+i);const o=i*i;if(s*s+r*r<=o||(s=t-(this.x+this.width-i),s*s+r*r<=o)||(r=e-(this.y+this.height-i),s*s+r*r<=o)||(s=t-(this.x+i),s*s+r*r<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class ri{constructor(t=1,e=0,i=0,s=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,r,o){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new ne;const i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new ne;const i=1/(this.a*this.d+this.c*-this.b),s=t.x,r=t.y;return e.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.c,o=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,s=this.c,r=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}setTransform(t,e,i,s,r,o,a,l,h){return this.a=Math.cos(a+h)*r,this.b=Math.sin(a+h)*r,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,s=this.c,r=this.d,o=t.pivot,a=-Math.atan2(-s,r),l=Math.atan2(i,e),h=Math.abs(a+l);return h<1e-5||Math.abs(jl-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+r*r),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*i+o.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,o=t*s-e*i;return this.a=s/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-s*r)/o,this.ty=-(t*this.ty-e*r)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new ri;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new ri}static get TEMP_MATRIX(){return new ri}}const mr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],gr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],_r=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],yr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Yu=[],pg=[],Kl=Math.sign;!function LA(){for(let n=0;n<16;n++){const t=[];Yu.push(t);for(let e=0;e<16;e++){const i=Kl(mr[n]*mr[e]+_r[n]*gr[e]),s=Kl(gr[n]*mr[e]+yr[n]*gr[e]),r=Kl(mr[n]*_r[e]+_r[n]*yr[e]),o=Kl(gr[n]*_r[e]+yr[n]*yr[e]);for(let a=0;a<16;a++)if(mr[a]===i&&gr[a]===s&&_r[a]===r&&yr[a]===o){t.push(a);break}}}for(let n=0;n<16;n++){const t=new ri;t.set(mr[n],gr[n],_r[n],yr[n],0,0),pg.push(t)}}();const hi={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:n=>mr[n],uY:n=>gr[n],vX:n=>_r[n],vY:n=>yr[n],inv:n=>8&n?15&n:7&-n,add:(n,t)=>Yu[n][t],sub:(n,t)=>Yu[n][hi.inv(t)],rotate180:n=>4^n,isVertical:n=>2==(3&n),byDirection:(n,t)=>2*Math.abs(n)<=Math.abs(t)?t>=0?hi.S:hi.N:2*Math.abs(t)<=Math.abs(n)?n>0?hi.E:hi.W:t>0?n>0?hi.SE:hi.SW:n>0?hi.NE:hi.NW,matrixAppendRotationInv:(n,t,e=0,i=0)=>{const s=pg[hi.inv(t)];s.tx=e,s.ty=i,n.append(s)}};class Ps{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ps(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const mg=class{constructor(){this.worldTransform=new ri,this.localTransform=new ri,this.position=new Ps(this.onChange,this,0,0),this.scale=new Ps(this.onChange,this,1,1),this.pivot=new Ps(this.onChange,this,0,0),this.skew=new Ps(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const n=this.localTransform;this._localID!==this._currentLocalID&&(n.a=this._cx*this.scale.x,n.b=this._sx*this.scale.x,n.c=this._cy*this.scale.y,n.d=this._sy*this.scale.y,n.tx=this.position.x-(this.pivot.x*n.a+this.pivot.y*n.c),n.ty=this.position.y-(this.pivot.x*n.b+this.pivot.y*n.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(n){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==n._worldID){const e=n.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=n._worldID,this._worldID++}}setFromMatrix(n){n.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(n){this._rotation!==n&&(this._rotation=n,this.updateSkew())}};let Zu=mg;Zu.IDENTITY=new mg;const _o=[{test:n=>"float"===n.type&&1===n.size&&!n.isArray,code:n=>`\n            if(uv["${n}"] !== ud["${n}"].value)\n            {\n                ud["${n}"].value = uv["${n}"]\n                gl.uniform1f(ud["${n}"].location, uv["${n}"])\n            }\n            `},{test:(n,t)=>!("sampler2D"!==n.type&&"samplerCube"!==n.type&&"sampler2DArray"!==n.type||1!==n.size||n.isArray||null!=t&&void 0===t.castToBaseTexture),code:n=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${n}"], t);\n\n            if(ud["${n}"].value !== t)\n            {\n                ud["${n}"].value = t;\n                gl.uniform1i(ud["${n}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(n,t)=>"mat3"===n.type&&1===n.size&&!n.isArray&&void 0!==t.a,code:n=>`\n            gl.uniformMatrix3fv(ud["${n}"].location, false, uv["${n}"].toArray(true));\n            `,codeUbo:n=>`\n                var ${n}_matrix = uv.${n}.toArray(true);\n\n                data[offset] = ${n}_matrix[0];\n                data[offset+1] = ${n}_matrix[1];\n                data[offset+2] = ${n}_matrix[2];\n        \n                data[offset + 4] = ${n}_matrix[3];\n                data[offset + 5] = ${n}_matrix[4];\n                data[offset + 6] = ${n}_matrix[5];\n        \n                data[offset + 8] = ${n}_matrix[6];\n                data[offset + 9] = ${n}_matrix[7];\n                data[offset + 10] = ${n}_matrix[8];\n            `},{test:(n,t)=>"vec2"===n.type&&1===n.size&&!n.isArray&&void 0!==t.x,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${n}"].location, v.x, v.y);\n                }`,codeUbo:n=>`\n                v = uv.${n};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:n=>"vec2"===n.type&&1===n.size&&!n.isArray,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${n}"].location, v[0], v[1]);\n                }\n            `},{test:(n,t)=>"vec4"===n.type&&1===n.size&&!n.isArray&&void 0!==t.width,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${n}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:n=>`\n                    v = uv.${n};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:n=>"vec4"===n.type&&1===n.size&&!n.isArray,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${n}"].location, v[0], v[1], v[2], v[3])\n                }`}],FA={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},NA={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},gg={};let th,Ql=gg;const zA={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function _g(n){return zA[n]}let eh=null;const yg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function xg(n,t){if(!eh){const e=Object.keys(yg);eh={};for(let i=0;i<e.length;++i){const s=e[i];eh[n[s]]=yg[s]}}return eh[t]}function vg(n,t,e){if("precision"!==n.substring(0,9)){let i=t;return t===vn.HIGH&&e!==vn.HIGH&&(i=vn.MEDIUM),`precision ${i} float;\n${n}`}return e!==vn.HIGH&&"precision highp"===n.substring(0,15)?n.replace("precision highp","precision mediump"):n}let HA=0;const ih={},yo=class{constructor(n,t,e="pixi-shader",i={}){this.extra={},this.id=HA++,this.vertexSrc=n||yo.defaultVertexSrc,this.fragmentSrc=t||yo.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,"#version"!==this.vertexSrc.substring(0,8)&&(e=e.replace(/\s+/g,"-"),ih[e]?(ih[e]++,e+=`-${ih[e]}`):ih[e]=1,this.vertexSrc=`#define SHADER_NAME ${e}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${e}\n${this.fragmentSrc}`,this.vertexSrc=vg(this.vertexSrc,yo.defaultVertexPrecision,vn.HIGH),this.fragmentSrc=vg(this.fragmentSrc,yo.defaultFragmentPrecision,function GA(){if(!th){th=vn.MEDIUM;const n=function kA(){if(Ql===gg||Ql?.isContextLost()){const n=Bt.ADAPTER.createCanvas();let t;Bt.PREFER_ENV>=fr.WEBGL2&&(t=n.getContext("webgl2",{})),t||(t=n.getContext("webgl",{})||n.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ql=t}return Ql}();n&&n.getShaderPrecisionFormat&&(th=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision?vn.HIGH:vn.MEDIUM)}return th}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(n,t,e){const i=n+t;let s=og[i];return s||(og[i]=s=new yo(n,t,e)),s}};let Dn=yo;Dn.defaultVertexPrecision=vn.HIGH,Dn.defaultFragmentPrecision=us.apple.device?vn.HIGH:vn.MEDIUM;let WA=0;class Ln{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=WA++,this.static=!!e,this.ubo=!!i,t instanceof _i?(this.buffer=t,this.buffer.type=qn.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new _i(new Float32Array(1)),this.buffer.type=qn.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new Ln(e,i)}static from(t,e,i){return new Ln(t,e,i)}static uboFrom(t,e){return new Ln(t,e??!0,!0)}}class jn{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof Ln?e:new Ln(e):new Ln({}),this.disposeRunner=new Pn("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const s=e.uniforms[i];if(s.group&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const s=Dn.from(t,e);return new jn(s,i)}}class VA{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let r=0;r<t;r++)i[r]=r;this.defaultGroupCache[t]=Ln.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Dn(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ri,default:this.defaultGroupCache[t]};return new jn(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class $u{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class nh{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const On=class extends nh{constructor(n){super(n),this.setShaderGenerator(),this.geometryClass=fg,this.vertexSize=6,this.state=ds.for2d(),this.size=4*On.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),n.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function YA(n){let t=!0;const e=Bt.ADAPTER.getNavigator();if(us.tablet||us.phone){if(us.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(us.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?n:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(n){this._defaultMaxTextures=n}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??function XA(){return!us.apple.device}(),this._canUploadSameBuffer}static set canUploadSameBuffer(n){this._canUploadSameBuffer=n}get MAX_TEXTURES(){return Be("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:n=On.defaultVertexSrc,fragment:t=On.defaultFragmentTemplate}={}){this.shaderGenerator=new VA(n,t)}contextChange(){const n=this.renderer.gl;Bt.PREFER_ENV===fr.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),On.defaultMaxTextures),this.maxTextures=function SA(n,t){if(0===n)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=wA.replace(/%forloop%/gi,MA(n));if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))break;n=n/2|0}return n}(this.maxTextures,n)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:n,_textureArrayPool:t}=On,e=this.size/4,i=Math.floor(e/this.maxTextures)+1;for(;n.length<e;)n.push(new Hu);for(;t.length<i;)t.push(new $u);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(n){!n._texture.valid||(this._vertexCount+n.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=n.vertexData.length/2,this._indexCount+=n.indices.length,this._bufferedTextures[this._bufferSize]=n._texture.baseTexture,this._bufferedElements[this._bufferSize++]=n)}buildTexturesAndDrawCalls(){const{_bufferedTextures:n,maxTextures:t}=this,e=On._textureArrayPool,i=this.renderer.batch,s=this._tempBoundTextures,r=this.renderer.textureGC.count;let o=++_e._globalBatch,a=0,l=e[0],h=0;i.copyBoundTextures(s,t);for(let c=0;c<this._bufferSize;++c){const u=n[c];n[c]=null,u._batchEnabled!==o&&(l.count>=t&&(i.boundArray(l,s,o,t),this.buildDrawCalls(l,h,c),h=c,l=e[++a],++o),u._batchEnabled=o,u.touched=r,l.elements[l.count++]=u)}l.count>0&&(i.boundArray(l,s,o,t),this.buildDrawCalls(l,h,this._bufferSize),++a,++o);for(let c=0;c<s.length;c++)s[c]=null;_e._globalBatch=o}buildDrawCalls(n,t,e){const{_bufferedElements:i,_attributeBuffer:s,_indexBuffer:r,vertexSize:o}=this,a=On._drawCallPool;let l=this._dcIndex,h=this._aIndex,c=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=n;for(let d=t;d<e;++d){const f=i[d],m=tg[f._texture.baseTexture.alphaMode?1:0][f.blendMode];i[d]=null,t<d&&u.blend!==m&&(u.size=c-u.start,t=d,u=a[++l],u.texArray=n,u.start=c),this.packInterleavedGeometry(f,s,r,h,c),h+=f.vertexData.length/2*o,c+=f.indices.length,u.blend=m}t<e&&(u.size=c-u.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=c}bindAndClearTexArray(n){const t=this.renderer.texture;for(let e=0;e<n.count;e++)t.bind(n.elements[e],n.ids[e]),n.elements[e]=null;n.count=0}updateGeometry(){const{_packedGeometries:n,_attributeBuffer:t,_indexBuffer:e}=this;On.canUploadSameBuffer?(n[this._flushId]._buffer.update(t.rawBinaryData),n[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,n[this._flushId]=new this.geometryClass),n[this._flushId]._buffer.update(t.rawBinaryData),n[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(n[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const n=this._dcIndex,{gl:t,state:e}=this.renderer,i=On._drawCallPool;let s=null;for(let r=0;r<n;r++){const{texArray:o,type:a,size:l,start:h,blend:c}=i[r];s!==o&&(s=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,e.set(this.state),t.drawElements(a,l,t.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),On.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let n=0;n<this._packedGeometryPoolSize;n++)this._packedGeometries[n]&&this._packedGeometries[n].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(n){const t=Zl(Math.ceil(n/8)),e=sg(t),i=8*t;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let s=this._aBuffers[i];return s||(this._aBuffers[i]=s=new Ou(i*this.vertexSize*4)),s}getIndexBuffer(n){const t=Zl(Math.ceil(n/12)),e=sg(t),i=12*t;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let s=this._iBuffers[e];return s||(this._iBuffers[e]=s=new Uint16Array(i)),s}packInterleavedGeometry(n,t,e,i,s){const{uint32View:r,float32View:o}=t,a=i/this.vertexSize,l=n.uvs,h=n.indices,c=n.vertexData,u=n._texture.baseTexture._batchLocation,d=Math.min(n.worldAlpha,1),f=d<1&&n._texture.baseTexture.alphaMode?Ru(n._tintRGB,d):n._tintRGB+(255*d<<24);for(let p=0;p<c.length;p+=2)o[i++]=c[p],o[i++]=c[p+1],o[i++]=l[p],o[i++]=l[p+1],r[i++]=f,o[i++]=u;for(let p=0;p<h.length;p++)e[s++]=a+h[p]}};let Bn=On;Bn.defaultBatchSize=4096,Bn.extension={name:"batch",type:Pt.RendererPlugin},Bn._drawCallPool=[],Bn._textureArrayPool=[],Xt.add(Bn);const fa=class extends jn{constructor(n,t,e){super(Dn.from(n||fa.defaultVertexSrc,t||fa.defaultFragmentSrc),e),this.padding=0,this.resolution=fa.defaultResolution,this.multisample=fa.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ds}apply(n,t,e,i,s){n.applyFilter(this,t,e,i)}get blendMode(){return this.state.blendMode}set blendMode(n){this.state.blendMode=n}get resolution(){return this._resolution}set resolution(n){this._resolution=n}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let Ui=fa;Ui.defaultResolution=1,Ui.defaultMultisample=wi.NONE;class bg{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color="string"==typeof t.color?Iu(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=Qm(t),ca(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}bg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"background"},Xt.add(bg);class wg{constructor(t){this.renderer=t,this.emptyRenderer=new nh(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){const{elements:r,ids:o,count:a}=t;let l=0;for(let h=0;h<a;h++){const c=r[h],u=c._batchLocation;if(u>=0&&u<s&&e[u]===c)o[h]=u;else for(;l<s;){const d=e[l];if(!d||d._batchEnabled!==i||d._batchLocation!==l){o[h]=l,c._batchLocation=l,e[l]=c;break}l++}}}destroy(){this.renderer=null}}wg.extension={type:Pt.RendererSystem,name:"batch"},Xt.add(wg);let Mg=0;class Sg{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Mg++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Mg++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(Bt.PREFER_ENV>=fr.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Sg.extension={type:Pt.RendererSystem,name:"context"},Xt.add(Sg);class JA extends da{upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===In.UNPACK);const r=e.realWidth,o=e.realHeight;return i.width===r&&i.height===o?s.texSubImage2D(e.target,0,0,0,r,o,e.format,i.type,this.data):(i.width=r,i.height=o,s.texImage2D(e.target,0,i.internalFormat,r,o,0,e.format,i.type,this.data)),!0}}class qu{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Pn("disposeFramebuffer"),this.multisample=wi.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new _e(null,{scaleMode:hs.NEAREST,resolution:1,mipmap:Zn.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new _e(new JA(null,{width:this.width,height:this.height}),{scaleMode:hs.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Zn.OFF,format:St.DEPTH_COMPONENT,type:Qt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],r=s.resolution;s.setSize(t/r,e/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Tg extends _e{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=wi.NONE),super(null,t),this.mipmap=Zn.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new qu(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ds extends ua{constructor(t){super(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=function bA(n,t=globalThis.location){if(n.startsWith("data:"))return"";t=t||globalThis.location,$l||($l=document.createElement("a")),$l.href=n;const e=bS.parse($l.href);return e.hostname!==t.hostname||(e.port||""!==t.port)&&e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}(e)}upload(t,e,i,s){const r=t.gl,o=e.realWidth,a=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||0===s.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&0===s.buffered.length)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===In.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==o||i.height!==a?(i.width=o,i.height=a,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,s),!0}update(){if(this.destroyed)return;const t=this.source;this.resize(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),super.update()}dispose(){this.source=null}}class Eg extends Ds{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;Ds.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Bt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const s=this.source;this.url=s.src;const r=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,e(this.createBitmap?this.process():this))};s.complete&&s.src?r():(s.onload=r,s.onerror=o=>{i(o),this.onError.emit(o)})})),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap;return this._process=fetch(t.src,{mode:t.crossOrigin&&"anonymous"!==t.crossOrigin?"no-cors":"cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===In.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0;const r=e._glTextures;for(const o in r){const a=r[o];if(a!==i&&a.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}class Ag{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const s=e.width,r=e.height;if(i){const o=t.width/2/s,a=t.height/2/r,l=t.x/s+o,h=t.y/r+a;i=hi.add(i,hi.NW),this.x0=l+o*hi.uX(i),this.y0=h+a*hi.uY(i),i=hi.add(i,2),this.x1=l+o*hi.uX(i),this.y1=h+a*hi.uY(i),i=hi.add(i,2),this.x2=l+o*hi.uX(i),this.y2=h+a*hi.uY(i),i=hi.add(i,2),this.x3=l+o*hi.uX(i),this.y3=h+a*hi.uY(i)}else this.x0=t.x/s,this.y0=t.y/r,this.x1=(t.x+t.width)/s,this.y1=t.y/r,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/r,this.x3=t.x/s,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Cg=new Ag;function sh(n){n.destroy=function(){},n.on=function(){},n.once=function(){},n.emit=function(){}}class Vt extends la{constructor(t,e,i,s,r,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Se(0,0,1,1)),t instanceof Vt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this._uvs=Cg,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new ne(o.x,o.y):new ne(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&tn[e.url]&&Vt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Vt.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Vt(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Cg&&(this._uvs=new Ag),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=Bt.STRICT_TEXTURE_CACHE){const s="string"==typeof t;let r=null;s?r=t:t instanceof _e?(t.cacheId||(t.cacheId=`${e?.pixiIdPrefix||"pixiid"}-${pr()}`,_e.addToCache(t,t.cacheId)),r=t.cacheId):(t._pixiId||(t._pixiId=`${e?.pixiIdPrefix||"pixiid"}_${pr()}`),r=t._pixiId);let o=tn[r];if(s&&i&&!o)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return o||t instanceof _e?!o&&t instanceof _e&&(o=new Vt(t),Vt.addToCache(o,r)):(e.resolution||(e.resolution=Is(t)),o=new Vt(new _e(t,e)),o.baseTexture.cacheId=r,_e.addToCache(o.baseTexture,r),Vt.addToCache(o,r)),o}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),s=Vt.from(t,Object.assign({resourceOptions:i},e),!1),r=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):r.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new Vt(_e.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){const r=new _e(t,Object.assign({scaleMode:_e.defaultOptions.scaleMode,resolution:Is(e)},s)),{resource:o}=r;o instanceof Eg&&(o.url=e);const a=new Vt(r);return i||(i=e),_e.addToCache(a.baseTexture,i),Vt.addToCache(a,i),i!==e&&(_e.addToCache(a.baseTexture,e),Vt.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),tn[e]&&tn[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),tn[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=tn[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete tn[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)tn[t.textureCacheIds[e]]===t&&delete tn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:s,height:r}=t,o=e+s>this.baseTexture.width,a=i+r>this.baseTexture.height;if(o||a)throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width} ${o&&a?"and":"or"} Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`);this.valid=s&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Vt._EMPTY||(Vt._EMPTY=new Vt(new _e),sh(Vt._EMPTY),sh(Vt._EMPTY.baseTexture)),Vt._EMPTY}static get WHITE(){if(!Vt._WHITE){const t=Bt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Vt._WHITE=new Vt(_e.from(t)),sh(Vt._WHITE),sh(Vt._WHITE.baseTexture)}return Vt._WHITE}}class Ls extends Vt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const s=this.baseTexture.resolution,r=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=r>0&&o>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(r,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ls(new Tg(t))}}let KA=(()=>{class n{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,s=wi.NONE){const r=new Tg(Object.assign({width:e,height:i,resolution:1,multisample:s},this.textureOptions));return new Ls(r)}getOptimalTexture(e,i,s=1,r=wi.NONE){let o;e=Math.ceil(e*s-1e-6),i=Math.ceil(i*s-1e-6),this.enableFullScreen&&e===this._pixelsWidth&&i===this._pixelsHeight?o=r>1?-r:-1:(o=((65535&(e=Zl(e)))<<16|65535&(i=Zl(i)))>>>0,r>1&&(o+=4294967296*r)),this.texturePool[o]||(this.texturePool[o]=[]);let a=this.texturePool[o].pop();return a||(a=this.createTexture(e,i,r)),a.filterPoolKey=o,a.setResolution(s),a}getFilterTexture(e,i,s){const r=this.getOptimalTexture(e.width,e.height,i||e.resolution,s||wi.NONE);return r.filterFrame=e.filterFrame,r}returnTexture(e){const i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const i in this.texturePool){const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const i in this.texturePool){if(!(Number(i)<0))continue;const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}return n.SCREEN_KEY=-1,n})();class QA extends Rs{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ig extends Rs{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new _i(this.vertices),this.uvBuffer=new _i(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class tC{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=wi.NONE,this.sourceFrame=new Se,this.destinationFrame=new Se,this.bindingSourceFrame=new Se,this.bindingDestinationFrame=new Se,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const rh=[new ne,new ne,new ne,new ne],ju=new ri;class Rg{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new KA,this.statePool=[],this.quad=new QA,this.quadUv=new Ig,this.tempRect=new Se,this.activeState={},this.globalUniforms=new Ln({outputFrame:new Se,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,s=this.defaultFilterStack,r=this.statePool.pop()||new tC,o=this.renderer.renderTexture;let a=e[0].resolution,l=e[0].multisample,h=e[0].padding,c=e[0].autoFit,u=e[0].legacy??!0;for(let p=1;p<e.length;p++){const m=e[p];a=Math.min(a,m.resolution),l=Math.min(l,m.multisample),h=this.useMaxPadding?Math.max(h,m.padding):h+m.padding,c=c&&m.autoFit,u=u||(m.legacy??!0)}1===s.length&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(r),r.resolution=a,r.multisample=l,r.legacy=u,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(h);const d=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(ju.copyFrom(i.projection.transform).invert(),d),c?(r.sourceFrame.fit(d),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(d)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,a,l),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=r.sourceFrame.width,f.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(o.sourceFrame),r.bindingDestinationFrame.copyFrom(o.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,o.bind(r.renderTexture,r.sourceFrame,f),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const r=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],o[0]=Math.round(r[0]*e.resolution),o[1]=Math.round(r[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*r[2]-.5*o[2],a[3]=e.sourceFrame.height*r[3]-.5*o[3],e.legacy){const h=s.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,l.renderTexture,$n.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let h=e.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,e.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<i.length-1;++u){1===u&&e.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,e.resolution),c.filterFrame=h.filterFrame),i[u].apply(this,h,c,$n.CLEAR,e);const d=h;h=c,c=d}i[u].apply(this,h,l.renderTexture,$n.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=$n.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(this.renderer.projection.transform=t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.activeState.transform:null,t?.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);(e===$n.CLEAR||e===$n.BLIT&&(1&s.stateId||this.forceClear))&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){const r=this.renderer;r.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(Yn.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(Yn.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:r}=e._texture,o=t.set(s.width,0,0,s.height,i.x,i.y),a=e.worldTransform.copyTo(ri.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/r.width,1/r.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=wi.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if("number"==typeof t){const r=t;t=e,e=r}const s=this.texturePool.getOptimalTexture((t=t||this.activeState.renderTexture).width,t.height,e||t.resolution,i||wi.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=rh[0],s=rh[1],r=rh[2],o=rh[3];i.set(e.left,e.top),s.set(e.left,e.bottom),r.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(r,r),t.apply(o,o);const a=Math.min(i.x,s.x,r.x,o.x),l=Math.min(i.y,s.y,r.y,o.y),h=Math.max(i.x,s.x,r.x,o.x),c=Math.max(i.y,s.y,r.y,o.y);e.x=a,e.y=l,e.width=h-a,e.height=c-l}roundFrame(t,e,i,s,r){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(r){const{a:o,b:a,c:l,d:h}=r;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}(r=r?ju.copyFrom(r):ju.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}Rg.extension={type:Pt.RendererSystem,name:"filter"},Xt.add(Rg);class eC{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=wi.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const iC=new Se;class Pg{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new qu(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Se,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Bt.PREFER_ENV===fr.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:s}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>i,l=o/e.width;this.setViewport(e.x*l,e.y*l,o,e.height>>i)}else this.setViewport(0,0,t.width>>i,t.height>>i)}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){const r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(r.width!==i||r.height!==s||r.x!==t||r.y!==e)&&(r.x=t,r.y=e,r.width=i,r.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,r=wu.COLOR|wu.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,s),o.clear(r)}initFramebuffer(t){const{gl:e}=this,i=new eC(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const s=t.colorTextures;let r=s.length;e.drawBuffers||(r=Math.min(r,1));for(let o=0;o<r;o++){const a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),0===o&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let o=r.length;i.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const h=r[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),0===l&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+l))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null):(s.stencil=s.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=wi.NONE;if(t<=1||null===e)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return 1===i&&(i=wi.NONE),i}blit(t,e,i){const{current:s,renderer:r,gl:o,CONTEXT_UID:a}=this;if(2!==r.context.webGLVersion||!s)return;const l=s.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;const c=s.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new qu(s.width,s.height),l.blitFramebuffer.addColorTexture(0,c)),(t=l.blitFramebuffer).colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||((e=iC).width=s.width,e.height=s.height),i||(i=e);const h=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,s=t.height,r=this.gl,o=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,o),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,s):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,s),e.stencil=o,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Se}destroy(){this.renderer=null}}Pg.extension={type:Pt.RendererSystem,name:"framebuffer"},Xt.add(Pg);const Ju={5126:4,5123:2,5121:1};class Dg{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let i=this.renderer.context.extensions.vertexArrayObject;Bt.PREFER_ENV===fr.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(s,r)=>i.vertexAttribDivisorANGLE(s,r),t.drawElementsInstanced=(s,r,o,a,l)=>i.drawElementsInstancedANGLE(s,r,o,a,l),t.drawArraysInstanced=(s,r,o,a)=>i.drawArraysInstancedANGLE(s,r,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},r=!0);const o=s[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++)e.update(t.buffers[i])}checkCompatibility(t,e){const i=t.attributes,s=e.attributeData;for(const r in s)if(!i[r])throw new Error(`shader and geometry incompatible, geometry missing the "${r}" attribute`)}getSignature(t,e){const i=t.attributes,s=e.attributeData,r=["g",t.id];for(const o in i)s[o]&&r.push(o,s[o].location);return r.join("-")}initGeometryVao(t,e,i=!0){const s=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let c=h[l];if(c)return h[a.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*Ju[d[m].type];for(const m in d){const g=d[m],x=g.size;void 0===g.stride&&(g.stride=f[g.buffer]===x*Ju[g.type]?0:f[g.buffer]),void 0===g.start&&(g.start=p[g.buffer],p[g.buffer]+=x*Ju[g.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let m=0;m<u.length;m++){const g=u[m];o.bind(g),i&&g._glBuffers[r].refCount++}return this.activateVao(t,a),h[a.id]=c,h[l]=c,s.bindVertexArray(null),o.unbind(qn.ARRAY_BUFFER),c}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,r=t.buffers,o=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(o)for(let a=0;a<r.length;a++){const l=r[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!e&&o.dispose(r[a],e))}if(!e)for(const a in i)if("g"===a[0]){const l=i[a];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let l=null;for(const h in a){const c=a[h],u=o[c.buffer],d=u._glBuffers[s];if(e.attributeData[h]){l!==d&&(r.bind(u),l=d);const f=e.attributeData[h].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(f,c.divisor)}}}}draw(t,e,i,s){const{gl:r}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=2===a?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?o.instanced?r.drawElementsInstanced(t,e||o.indexBuffer.data.length,l,(i||0)*a,s||1):r.drawElements(t,e||o.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?r.drawArraysInstanced(t,i,e||o.getSize(),s||1):r.drawArrays(t,i,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Dg.extension={type:Pt.RendererSystem,name:"geometry"},Xt.add(Dg);const Lg=new ri;class Og{constructor(t,e){this._texture=t,this.mapCoord=new ri,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let s=0;s<t.length;s+=2){const r=t[s],o=t[s+1];e[s]=r*i.a+o*i.c+i.tx,e[s+1]=r*i.b+o*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=e.orig,r=e.trim;r&&(Lg.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Lg));const o=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(e._frame.x+l+h)/o.width,a[1]=(e._frame.y+l+h)/o.height,a[2]=(e._frame.x+e._frame.width-l+h)/o.width,a[3]=(e._frame.y+e._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0}}class rC extends Ui{constructor(t,e,i){let s=null;"string"!=typeof t&&void 0===e&&void 0===i&&(s=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=s,this.maskMatrix=new ri}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){const r=this._maskSprite,o=r._texture;!o.valid||(o.uvMatrix||(o.uvMatrix=new Og(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}}class oC{constructor(t=null){this.type=Ii.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ui.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ii.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Bg{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const r=this.maskDataPool.pop()||new oC;r.pooled=!0,r.maskObject=e,i=r}const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Ii.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Ii.SCISSOR:this.renderer.scissor.push(i);break;case Ii.STENCIL:this.renderer.stencil.push(i);break;case Ii.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Ii.COLOR:this.pushColorMask(i)}i.type===Ii.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case Ii.SCISSOR:this.renderer.scissor.pop(e);break;case Ii.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Ii.SPRITE:this.popSpriteMask(e);break;case Ii.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const i=this.maskStack[this.maskStack.length-1];i.type===Ii.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;t.type=e?e.isSprite?Ii.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?Ii.SCISSOR:Ii.STENCIL:Ii.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new rC]));const r=this.renderer,o=r.renderTexture;let a,l;if(o.current){const c=o.current;a=t.resolution||c.resolution,l=t.multisample??c.multisample}else a=t.resolution||r.resolution,l=t.multisample??r.multisample;s[0].resolution=a,s[0].multisample=l,s[0].maskSprite=e;const h=i.filterArea;i.filterArea=e.getBounds(!0),r.filter.push(i,s),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t._colorMask&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}Bg.extension={type:Pt.RendererSystem,name:"mask"},Xt.add(Bg);class Fg{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==i&&(0===s?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Ng=new ri,Ug=[],oh=class extends Fg{constructor(n){super(n),this.glConst=Bt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const n=this.maskStack[this.maskStack.length-1];return n?n._scissorCounter:0}calcScissorRect(n){if(n._scissorRectLocal)return;const t=n._scissorRect,{maskObject:e}=n,{renderer:i}=this,s=i.renderTexture,r=e.getBounds(!0,Ug.pop()??new Se);this.roundFrameToPixels(r,s.current?s.current.resolution:i.resolution,s.sourceFrame,s.destinationFrame,i.projection.transform),t&&r.fit(t),n._scissorRectLocal=r}static isMatrixRotated(n){if(!n)return!1;const{a:t,b:e,c:i,d:s}=n;return(Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4)}testScissor(n){const{maskObject:t}=n;if(!t.isFastRect||!t.isFastRect()||oh.isMatrixRotated(t.worldTransform)||oh.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(n);const e=n._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(n,t,e,i,s){oh.isMatrixRotated(s)||((s=s?Ng.copyFrom(s):Ng.identity()).translate(-e.x,-e.y).scale(i.width/e.width,i.height/e.height).translate(i.x,i.y),this.renderer.filter.transformAABB(s,n),n.fit(i),n.x=Math.round(n.x*t),n.y=Math.round(n.y*t),n.width=Math.round(n.width*t),n.height=Math.round(n.height*t))}push(n){n._scissorRectLocal||this.calcScissorRect(n);const{gl:t}=this.renderer;n._scissorRect||t.enable(t.SCISSOR_TEST),n._scissorCounter++,n._scissorRect=n._scissorRectLocal,this._useCurrent()}pop(n){const{gl:t}=this.renderer;n&&Ug.push(n._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const n=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?n.y:this.renderer.height-n.height-n.y,this.renderer.gl.scissor(n.x,t,n.width,n.height)}};let kg=oh;kg.extension={type:Pt.RendererSystem,name:"scissor"},Xt.add(kg);class Gg extends Fg{constructor(t){super(t),this.glConst=Bt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;0===s&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;0!==r&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(t._colorMask=r,i.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;0!==s&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==s&&(i._colorMask=s,e.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Gg.extension={type:Pt.RendererSystem,name:"stencil"},Xt.add(Gg);class zg{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Be("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(Be("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(Be("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}zg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"_plugin"},Xt.add(zg);class Hg{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ri,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){const r=this.projectionMatrix,o=s?-1:1;r.identity(),r.a=1/e.width*2,r.d=o*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-o-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}Hg.extension={type:Pt.RendererSystem,name:"projection"},Xt.add(Hg);const aC=new Zu;class Wg{constructor(t){this.renderer=t,this._tempMatrix=new ri}generateTexture(t,e){const{region:i,...s}=e||{},r=i||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const o=Ls.create({width:r.width,height:r.height,...s});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const a=t.transform;return t.transform=aC,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}Wg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"textureGenerator"},Xt.add(Wg);const xr=new Se,pa=new Se;class Vg{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Se,this.destinationFrame=new Se,this.viewportFrame=new Se}bind(t=null,e,i){const s=this.renderer;let r,o,a;this.current=t,t?(r=t.baseTexture,a=r.resolution,e||(xr.width=t.frame.width,xr.height=t.frame.height,e=xr),i||(pa.x=t.frame.x,pa.y=t.frame.y,pa.width=e.width,pa.height=e.height,i=pa),o=r.framebuffer):(a=s.resolution,e||(xr.width=s._view.screen.width,xr.height=s._view.screen.height,e=xr),i||((i=xr).width=e.width,i.height=e.height));const l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,t||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(i,e,a,!o),this.renderer.mask.setMaskStack(t?r.maskStack:this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.renderer.background.colorRgba;const i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,r=i.width!==s.width||i.height!==s.height;if(r){let{x:o,y:a,width:l,height:h}=this.viewportFrame;o=Math.round(o),a=Math.round(a),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,a,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Vg.extension={type:Pt.RendererSystem,name:"renderTexture"},Xt.add(Vg);class lC{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Xg(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}function Ku(n){const t=new Array(n);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Yg(n,t){switch(n){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Ku(2*t);case"bvec3":return Ku(3*t);case"bvec4":return Ku(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Zg(n,t){const e=n.getShaderSource(t).split("\n").map((h,c)=>`${c}: ${h}`),i=n.getShaderInfoLog(t),s=i.split("\n"),r={},o=s.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>!(!h||r[h]||(r[h]=!0,0))),a=[""];o.forEach(h=>{e[h-1]=`%c${e[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=e.join("\n");a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function fC(n,t,e,i,s){e.buffer.update(s)}const pC={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},$g={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let ma,xC=0;const ah={textureCount:0,uboCount:0};class qg{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=xC++}systemCheck(){if(!function yC(){if("boolean"==typeof ma)return ma;try{ma=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{ma=!1}return ma}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(ah.textureCount=0,ah.uboCount=0,this.syncUniformGroup(t.uniformGroup,ah)),s}setUniforms(t){const e=this.shader.program;e.syncUniforms(e.glPrograms[this.renderer.CONTEXT_UID].uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function UA(n,t){const e=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const i in n.uniforms){const s=t[i];if(!s){n.uniforms[i]?.group&&e.push(n.uniforms[i].ubo?`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `:`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `);continue}const r=n.uniforms[i];let o=!1;for(let a=0;a<_o.length;a++)if(_o[a].test(s,r)){e.push(_o[a].code(i,r)),o=!0;break}if(!o){const l=(1!==s.size||s.isArray?NA:FA)[s.type].replace("location",`ud["${i}"].location`);e.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${l};`)}}return new Function("ud","uv","renderer","syncData",e.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,ah,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=function _C(n,t){if(!n.autoManage)return{size:0,syncFunc:fC};const e=function gC(n,t){const e=[];for(const i in n)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}(n.uniforms,t),{uboElements:i,size:s}=function mC(n){const t=n.map(r=>({data:r,offset:0,dataLen:0,dirty:0}));let e=0,i=0,s=0;for(let r=0;r<t.length;r++){const o=t[r];if(e=$g[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!=0&&i<16){const a=i%e%16;i+=a,s+=a}i+e>16?(s=16*Math.ceil(s/16),o.offset=s,s+=e,i=e):(o.offset=s,i+=e,s+=e)}return s=16*Math.ceil(s/16),{uboElements:t,size:s}}(e),r=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let o=0;o<i.length;o++){const a=i[o],l=n.uniforms[a.data.name],h=a.data.name;let c=!1;for(let u=0;u<_o.length;u++){const d=_o[u];if(d.codeUbo&&d.test(a.data,l)){r.push(`offset = ${a.offset/4};`,_o[u].codeUbo(a.data.name,l)),c=!0;break}}if(!c)if(a.data.size>1){const u=_g(a.data.type),d=Math.max($g[a.data.type]/16,1),f=u/d;r.push(`\n                cv = ud.${h}.value;\n                v = uv.${h};\n                offset = ${a.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${a.data.size*d}; i++)\n                {\n                    for(var j = 0; j < ${f}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${(4-f%4)%4};\n                }\n\n                `)}else r.push(`\n                cv = ud.${h}.value;\n                v = uv.${h};\n                offset = ${a.offset/4};\n                ${pC[a.data.type]};\n                `)}return r.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(a.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const s=t.uniforms,r=[`${i}-`];for(const o in s)r.push(o),e[o]&&r.push(e[o].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const i=t.program,s=function dC(n,t){const e=Xg(n,n.VERTEX_SHADER,t.vertexSrc),i=Xg(n,n.FRAGMENT_SHADER,t.fragmentSrc),s=n.createProgram();n.attachShader(s,e),n.attachShader(s,i);const r=t.extra?.transformFeedbackVaryings;if(r&&("function"!=typeof n.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):n.transformFeedbackVaryings(s,r.names,"separate"===r.bufferMode?n.SEPARATE_ATTRIBS:n.INTERLEAVED_ATTRIBS)),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS)||function uC(n,t,e,i){n.getProgramParameter(t,n.LINK_STATUS)||(n.getShaderParameter(e,n.COMPILE_STATUS)||Zg(n,e),n.getShaderParameter(i,n.COMPILE_STATUS)||Zg(n,i),console.error("PixiJS Error: Could not initialize shader."),""!==n.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",n.getProgramInfoLog(t)))}(n,s,e,i),t.attributeData=function hC(n,t){const e={},i=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=t.getActiveAttrib(n,s);if(r.name.startsWith("gl_"))continue;const o=xg(t,r.type),a={type:o,name:r.name,size:_g(o),location:t.getAttribLocation(n,r.name)};e[r.name]=a}return e}(s,n),t.uniformData=function cC(n,t){const e={},i=t.getProgramParameter(n,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const r=t.getActiveUniform(n,s),o=r.name.replace(/\[.*?\]$/,""),a=!!r.name.match(/\[.*?\]$/),l=xg(t,r.type);e[o]={name:o,index:s,type:l,size:r.size,isArray:a,value:Yg(l,r.size)}}return e}(s,n),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((h,c)=>h>c?1:-1);for(let h=0;h<l.length;h++)t.attributeData[l[h]].location=h,n.bindAttribLocation(s,h,l[h]);n.linkProgram(s)}n.deleteShader(e),n.deleteShader(i);const o={};for(const l in t.uniformData){const h=t.uniformData[l];o[l]={location:n.getUniformLocation(s,l),value:Yg(h.type,h.size)}}return new lC(s,o)}(this.gl,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}qg.extension={type:Pt.RendererSystem,name:"shader"},Xt.add(qg);class jg{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.1.1 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}jg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"startup"},Xt.add(jg);const Qu=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ae.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ds,this.defaultState.blend=!0}contextChange(n){this.gl=n,this.blendModes=function vC(n,t=[]){return t[ae.NORMAL]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.ADD]=[n.ONE,n.ONE],t[ae.MULTIPLY]=[n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.SCREEN]=[n.ONE,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.OVERLAY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.DARKEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.LIGHTEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.COLOR_DODGE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.COLOR_BURN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.HARD_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.SOFT_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.DIFFERENCE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.EXCLUSION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.HUE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.SATURATION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.COLOR]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.LUMINOSITY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.NONE]=[0,0],t[ae.NORMAL_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.ADD_NPM]=[n.SRC_ALPHA,n.ONE,n.ONE,n.ONE],t[ae.SCREEN_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[ae.SRC_IN]=[n.DST_ALPHA,n.ZERO],t[ae.SRC_OUT]=[n.ONE_MINUS_DST_ALPHA,n.ZERO],t[ae.SRC_ATOP]=[n.DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],t[ae.DST_OVER]=[n.ONE_MINUS_DST_ALPHA,n.ONE],t[ae.DST_IN]=[n.ZERO,n.SRC_ALPHA],t[ae.DST_OUT]=[n.ZERO,n.ONE_MINUS_SRC_ALPHA],t[ae.DST_ATOP]=[n.ONE_MINUS_DST_ALPHA,n.SRC_ALPHA],t[ae.XOR]=[n.ONE_MINUS_DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],t[ae.SUBTRACT]=[n.ONE,n.ONE,n.ONE,n.ONE,n.FUNC_REVERSE_SUBTRACT,n.FUNC_ADD],t}(n),this.set(this.defaultState),this.reset()}set(n){if(this.stateId!==(n=n||this.defaultState).data){let t=this.stateId^n.data,e=0;for(;t;)1&t&&this.map[e].call(this,!!(n.data&1<<e)),t>>=1,e++;this.stateId=n.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,n)}forceState(n){n=n||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(n.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,n);this.stateId=n.data}setBlend(n){this.updateCheck(Qu.checkBlendMode,n),this.gl[n?"enable":"disable"](this.gl.BLEND)}setOffset(n){this.updateCheck(Qu.checkPolygonOffset,n),this.gl[n?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(n){this.gl[n?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(n){this.gl.depthMask(n)}setCullFace(n){this.gl[n?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(n){this.gl.frontFace(this.gl[n?"CW":"CCW"])}setBlendMode(n){if(n===this.blendMode)return;this.blendMode=n;const t=this.blendModes[n],e=this.gl;2===t.length?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(n,t){this.gl.polygonOffset(n,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(n,t){const e=this.checks.indexOf(n);t&&-1===e?this.checks.push(n):!t&&-1!==e&&this.checks.splice(e,1)}static checkBlendMode(n,t){n.setBlendMode(t.blendMode)}static checkPolygonOffset(n,t){n.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let Jg=Qu;Jg.extension={type:Pt.RendererSystem,name:"state"},Xt.add(Jg);class AC extends la{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Pn(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(s=>{const r=i.find(o=>this._systemsHash[o]===s);s[t.name](e[r])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const lh=class{constructor(n){this.renderer=n,this.count=0,this.checkCount=0,this.maxIdle=lh.defaultMaxIdle,this.checkCountMax=lh.defaultCheckCountMax,this.mode=lh.defaultMode}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==Su.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const n=this.renderer.texture,t=n.managedTextures;let e=!1;for(let i=0;i<t.length;i++){const s=t[i];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(n.destroyTexture(s,!0),t[i]=null,e=!0)}if(e){let i=0;for(let s=0;s<t.length;s++)null!==t[s]&&(t[i++]=t[s]);t.length=i}}unload(n){const e=n._texture;e&&!e.framebuffer&&this.renderer.texture.destroyTexture(e);for(let i=n.children.length-1;i>=0;i--)this.unload(n.children[i])}destroy(){this.renderer=null}};let Fn=lh;Fn.defaultMode=Su.AUTO,Fn.defaultMaxIdle=3600,Fn.defaultCheckCountMax=600,Fn.extension={type:Pt.RendererSystem,name:"textureGC"},Xt.add(Fn);class td{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Qt.UNSIGNED_BYTE,this.internalFormat=St.RGBA,this.samplerType=0}}class Kg{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new _e,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function CC(n){let t;return t="WebGL2RenderingContext"in globalThis&&n instanceof globalThis.WebGL2RenderingContext?{[Qt.UNSIGNED_BYTE]:{[St.RGBA]:n.RGBA8,[St.RGB]:n.RGB8,[St.RG]:n.RG8,[St.RED]:n.R8,[St.RGBA_INTEGER]:n.RGBA8UI,[St.RGB_INTEGER]:n.RGB8UI,[St.RG_INTEGER]:n.RG8UI,[St.RED_INTEGER]:n.R8UI,[St.ALPHA]:n.ALPHA,[St.LUMINANCE]:n.LUMINANCE,[St.LUMINANCE_ALPHA]:n.LUMINANCE_ALPHA},[Qt.BYTE]:{[St.RGBA]:n.RGBA8_SNORM,[St.RGB]:n.RGB8_SNORM,[St.RG]:n.RG8_SNORM,[St.RED]:n.R8_SNORM,[St.RGBA_INTEGER]:n.RGBA8I,[St.RGB_INTEGER]:n.RGB8I,[St.RG_INTEGER]:n.RG8I,[St.RED_INTEGER]:n.R8I},[Qt.UNSIGNED_SHORT]:{[St.RGBA_INTEGER]:n.RGBA16UI,[St.RGB_INTEGER]:n.RGB16UI,[St.RG_INTEGER]:n.RG16UI,[St.RED_INTEGER]:n.R16UI,[St.DEPTH_COMPONENT]:n.DEPTH_COMPONENT16},[Qt.SHORT]:{[St.RGBA_INTEGER]:n.RGBA16I,[St.RGB_INTEGER]:n.RGB16I,[St.RG_INTEGER]:n.RG16I,[St.RED_INTEGER]:n.R16I},[Qt.UNSIGNED_INT]:{[St.RGBA_INTEGER]:n.RGBA32UI,[St.RGB_INTEGER]:n.RGB32UI,[St.RG_INTEGER]:n.RG32UI,[St.RED_INTEGER]:n.R32UI,[St.DEPTH_COMPONENT]:n.DEPTH_COMPONENT24},[Qt.INT]:{[St.RGBA_INTEGER]:n.RGBA32I,[St.RGB_INTEGER]:n.RGB32I,[St.RG_INTEGER]:n.RG32I,[St.RED_INTEGER]:n.R32I},[Qt.FLOAT]:{[St.RGBA]:n.RGBA32F,[St.RGB]:n.RGB32F,[St.RG]:n.RG32F,[St.RED]:n.R32F,[St.DEPTH_COMPONENT]:n.DEPTH_COMPONENT32F},[Qt.HALF_FLOAT]:{[St.RGBA]:n.RGBA16F,[St.RGB]:n.RGB16F,[St.RG]:n.RG16F,[St.RED]:n.R16F},[Qt.UNSIGNED_SHORT_5_6_5]:{[St.RGB]:n.RGB565},[Qt.UNSIGNED_SHORT_4_4_4_4]:{[St.RGBA]:n.RGBA4},[Qt.UNSIGNED_SHORT_5_5_5_1]:{[St.RGBA]:n.RGB5_A1},[Qt.UNSIGNED_INT_2_10_10_10_REV]:{[St.RGBA]:n.RGB10_A2,[St.RGBA_INTEGER]:n.RGB10_A2UI},[Qt.UNSIGNED_INT_10F_11F_11F_REV]:{[St.RGB]:n.R11F_G11F_B10F},[Qt.UNSIGNED_INT_5_9_9_9_REV]:{[St.RGB]:n.RGB9_E5},[Qt.UNSIGNED_INT_24_8]:{[St.DEPTH_STENCIL]:n.DEPTH24_STENCIL8},[Qt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[St.DEPTH_STENCIL]:n.DEPTH32F_STENCIL8}}:{[Qt.UNSIGNED_BYTE]:{[St.RGBA]:n.RGBA,[St.RGB]:n.RGB,[St.ALPHA]:n.ALPHA,[St.LUMINANCE]:n.LUMINANCE,[St.LUMINANCE_ALPHA]:n.LUMINANCE_ALPHA},[Qt.UNSIGNED_SHORT_5_6_5]:{[St.RGB]:n.RGB},[Qt.UNSIGNED_SHORT_4_4_4_4]:{[St.RGBA]:n.RGBA},[Qt.UNSIGNED_SHORT_5_5_5_1]:{[St.RGBA]:n.RGBA}},t}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const i=new td(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new td(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let r=t-1;r>=0;--r){const o=e[r];o&&o._glTextures[s].samplerType!==Mu.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new td(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.type=2===this.webGLVersion&&t.type===Qt.HALF_FLOAT?this.gl.HALF_FLOAT:t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==Mu.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,r=t.realHeight,o=i.gl;(e.width!==s||e.height!==r||e.dirtyId<0)&&(e.width=s,e.height=r,o.texImage2D(t.target,0,e.internalFormat,s,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);-1!==s&&fo(this.managedTextures,s,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];!e||(e.mipmap=!!(t.mipmap!==Zn.POW2&&2===this.webGLVersion||t.isPowerOfTwo)&&t.mipmap>=1,e.wrapMode=2===this.webGLVersion||t.isPowerOfTwo?t.wrapMode:Cs.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==Zn.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===hs.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===hs.LINEAR){const r=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===hs.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===hs.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Kg.extension={type:Pt.RendererSystem,name:"texture"},Xt.add(Kg);class Qg{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:s}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[s]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];!a||(i.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!e&&r.dispose(a,e))}!i||(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Qg.extension={type:Pt.RendererSystem,name:"transformFeedback"},Xt.add(Qg);class t_{constructor(t){this.renderer=t}init(t){this.screen=new Se(0,0,t.width,t.height),this.element=t.view||Bt.ADAPTER.createCanvas(),this.resolution=t.resolution||Bt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}t_.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"_view"},Xt.add(t_),Bt.PREFER_ENV=fr.WEBGL2,Bt.STRICT_TEXTURE_CACHE=!1,Object.defineProperties(Bt,{WRAP_MODE:{get:()=>_e.defaultOptions.wrapMode,set(n){Be("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),_e.defaultOptions.wrapMode=n}},SCALE_MODE:{get:()=>_e.defaultOptions.scaleMode,set(n){Be("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),_e.defaultOptions.scaleMode=n}},MIPMAP_TEXTURES:{get:()=>_e.defaultOptions.mipmap,set(n){Be("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),_e.defaultOptions.mipmap=n}},ANISOTROPIC_LEVEL:{get:()=>_e.defaultOptions.anisotropicLevel,set(n){Be("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),_e.defaultOptions.anisotropicLevel=n}},FILTER_RESOLUTION:{get:()=>(Be("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ui.defaultResolution),set(n){Ui.defaultResolution=n}},FILTER_MULTISAMPLE:{get:()=>(Be("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ui.defaultMultisample),set(n){Ui.defaultMultisample=n}},SPRITE_MAX_TEXTURES:{get:()=>Bn.defaultMaxTextures,set(n){Be("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Bn.defaultMaxTextures=n}},SPRITE_BATCH_SIZE:{get:()=>Bn.defaultBatchSize,set(n){Be("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Bn.defaultBatchSize=n}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Bn.canUploadSameBuffer,set(n){Be("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Bn.canUploadSameBuffer=n}},GC_MODE:{get:()=>Fn.defaultMode,set(n){Be("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Fn.defaultMode=n}},GC_MAX_IDLE:{get:()=>Fn.defaultMaxIdle,set(n){Be("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Fn.defaultMaxIdle=n}},GC_MAX_CHECK_COUNT:{get:()=>Fn.defaultCheckCountMax,set(n){Be("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Fn.defaultCheckCountMax=n}},PRECISION_VERTEX:{get:()=>Dn.defaultVertexPrecision,set(n){Be("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Dn.defaultVertexPrecision=n}},PRECISION_FRAGMENT:{get:()=>Dn.defaultFragmentPrecision,set(n){Be("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Dn.defaultFragmentPrecision=n}}});var xo=(n=>(n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY",n))(xo||{});class ed{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const hn=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ed(null,null,1/0),this.deltaMS=1/hn.targetFPMS,this.elapsedMS=1/hn.targetFPMS,this._tick=n=>{this._requestId=null,this.started&&(this.update(n),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(n,t,e=xo.NORMAL){return this._addListener(new ed(n,t,e))}addOnce(n,t,e=xo.NORMAL){return this._addListener(new ed(n,t,e,!0))}_addListener(n){let t=this._head.next,e=this._head;if(t){for(;t;){if(n.priority>t.priority){n.connect(e);break}e=t,t=t.next}n.previous||n.connect(e)}else n.connect(e);return this._startIfPossible(),this}remove(n,t){let e=this._head.next;for(;e;)e=e.match(n,t)?e.destroy():e.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let n=0,t=this._head;for(;t=t.next;)n++;return n}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let n=this._head.next;for(;n;)n=n.destroy(!0);this._head.destroy(),this._head=null}}update(n=performance.now()){let t;if(n>this.lastTime){if(t=this.elapsedMS=n-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const s=n-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=n-s%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*hn.targetFPMS;const e=this._head;let i=e.next;for(;i;)i=i.emit(this.deltaTime);e.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=n}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(n){const t=Math.min(this.maxFPS,n),e=Math.min(Math.max(0,t)/1e3,hn.targetFPMS);this._maxElapsedMS=1/e}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(n){if(0===n)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,n);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!hn._shared){const n=hn._shared=new hn;n.autoStart=!0,n._protected=!0}return hn._shared}static get system(){if(!hn._system){const n=hn._system=new hn;n.autoStart=!0,n._protected=!0}return hn._system}};let qi=hn;qi.targetFPMS=.06,Object.defineProperties(Bt,{TARGET_FPMS:{get:()=>qi.targetFPMS,set(n){Be("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),qi.targetFPMS=n}}});class e_{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,xo.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?qi.shared:new qi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}e_.extension=Pt.Application,Xt.add(e_);const i_=[];Xt.handleByList(Pt.Renderer,i_);const n_="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class s_{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}this.multisample=e>=wi.HIGH?wi.HIGH:e>=wi.MEDIUM?wi.MEDIUM:e>=wi.LOW?wi.LOW:wi.NONE}destroy(){}}s_.extension={type:Pt.RendererSystem,name:"_multisample"},Xt.add(s_);class LC{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class r_{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,i){const{gl:s,CONTEXT_UID:r}=this;i=i||0;const o=t._glBuffers[r]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new LC(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}r_.extension={type:Pt.RendererSystem,name:"buffer"},Xt.add(r_);class o_{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let s,r,o,a;if(e&&(s=e.renderTexture,r=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(s||(this.lastObjectRendered=t),!a){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}o_.extension={type:Pt.RendererSystem,name:"objectRenderer"},Xt.add(o_);const id=class extends AC{constructor(n){super(),n=Object.assign({},Bt.RENDER_OPTIONS,n),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ln({projectionMatrix:new ri},!0),this.setup({runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:id.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]}),"useContextAlpha"in n&&(Be("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),n.premultipliedAlpha=n.useContextAlpha&&"notMultiplied"!==n.useContextAlpha,n.backgroundAlpha=!1===n.useContextAlpha?1:n.backgroundAlpha),this.startup.run({hello:n.hello,_plugin:id.__plugins,background:{alpha:n.backgroundAlpha,color:n.background??n.backgroundColor,clearBeforeRender:n.clearBeforeRender},_view:{height:n.height,width:n.width,autoDensity:n.autoDensity,resolution:n.resolution,view:n.view},context:{antialias:n.antialias,context:n.context,powerPreference:n.powerPreference,premultipliedAlpha:n.premultipliedAlpha,preserveDrawingBuffer:n.preserveDrawingBuffer}}),this.options=n}static test(n){return!n?.forceCanvas&&function TS(){return typeof Cu>"u"&&(Cu=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:Bt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Bt.ADAPTER.getWebGLRenderingContext())return!1;const e=Bt.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const s=!!i?.getContextAttributes()?.stencil;if(i){const r=i.getExtension("WEBGL_lose_context");r&&r.loseContext()}return i=null,s}catch{return!1}}()),Cu}()}render(n,t){this.objectRenderer.render(n,t)}resize(n,t){this._view.resizeView(n,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(n=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:n}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(n){this._view.resolution=n,this.runners.resolutionChange.emit(n)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Be("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Be("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Be("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Be("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(n){Be("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=n}get backgroundAlpha(){return Be("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(n){Be("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=n}get powerPreference(){return Be("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(n,t){return this.textureGenerator.generateTexture(n,t)}};let vo=id;vo.extension={type:Pt.Renderer,priority:1},vo.__plugins={},vo.__systems={},Xt.handleByMap(Pt.RendererPlugin,vo.__plugins),Xt.handleByMap(Pt.RendererSystem,vo.__systems),Xt.add(vo);class a_ extends ua{constructor(t,e){const{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let r=0;r<t;r++){const o=new _e;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)!t[i]||(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):this.addResourceAt(t[i]instanceof ua?t[i]:ug(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(e).then(()=>{const{realWidth:i,realHeight:s}=this.items[0];return this.resize(i,s),Promise.resolve(this)}),this._load}}const ga=class extends a_{constructor(n,t){const{width:e,height:i,autoLoad:s,linkBaseTexture:r}=t||{};if(n&&n.length!==ga.SIDES)throw new Error(`Invalid length. Got ${n.length}, expected 6`);super(6,{width:e,height:i});for(let o=0;o<ga.SIDES;o++)this.items[o].target=co.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==r,n&&this.initFromArray(n,t),!1!==s&&this.load()}bind(n){super.bind(n),n.target=co.TEXTURE_CUBE_MAP}addBaseTextureAt(n,t,e){if(void 0===e&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||n.parentTextureArray||Object.keys(n._glTextures).length>0){if(!n.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(n.resource,t)}else n.target=co.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.parentTextureArray=this.baseTexture,this.items[t]=n;return n.valid&&!this.valid&&this.resize(n.realWidth,n.realHeight),this.items[t]=n,this}upload(n,t,e){const i=this.itemDirtyIds;for(let s=0;s<ga.SIDES;s++){const r=this.items[s];(i[s]<r.dirtyId||e.dirtyId<t.dirtyId)&&(r.valid&&r.resource?(r.resource.upload(n,r,e),i[s]=r.dirtyId):i[s]<-1&&(n.gl.texImage2D(r.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),i[s]=-1))}return!0}static test(n){return Array.isArray(n)&&n.length===ga.SIDES}};let l_=ga;l_.SIDES=6;class bo extends Ds{constructor(t,e){let i,s;e=e||{},"string"==typeof t?(i=bo.EMPTY,s=t):(i=t,s=null),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){var t=this;return this._load||(this._load=new Promise(function(){var e=(0,Nt.Z)(function*(i,s){if(null!==t.url)try{const r=yield Bt.ADAPTER.fetch(t.url,{mode:t.crossOrigin?"cors":"no-cors"});if(t.destroyed)return;const o=yield r.blob();if(t.destroyed)return;const a=yield createImageBitmap(o,{premultiplyAlpha:null===t.alphaMode||t.alphaMode===In.UNPACK?"premultiply":"none"});if(t.destroyed)return;t.source=a,t.update(),i(t)}catch(r){if(t.destroyed)return;s(r),t.onError.emit(r)}else i(t)});return function(i,s){return e.apply(this,arguments)}}())),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return bo._EMPTY=bo._EMPTY??Bt.ADAPTER.createCanvas(0,0),bo._EMPTY}}const hh=class extends Ds{constructor(n,t){t=t||{},super(Bt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=n,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(n=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),n(this)},hh.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const n=new Image;Ds.crossOrigin(n,this.svg,this._crossorigin),n.src=this.svg,n.onerror=t=>{!this._resolve||(n.onerror=null,this.onError.emit(t))},n.onload=()=>{if(!this._resolve)return;const t=n.width,e=n.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,s=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/e*t,s=this._overrideHeight||this._overrideWidth/t*e),i=Math.round(i),s=Math.round(s);const r=this.source;r.width=i,r.height=s,r._pixiId=`canvas_${pr()}`,r.getContext("2d").drawImage(n,0,0,t,e,0,0,i,s),this._resolve(),this._resolve=null}}static getSize(n){const t=hh.SVG_SIZE.exec(n),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(n,t){return"svg"===t||"string"==typeof n&&n.startsWith("data:image/svg+xml")||"string"==typeof n&&hh.SVG_XML.test(n)}};let _a=hh;_a.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,_a.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const nd=class extends Ds{constructor(n,t){if(t=t||{},!(n instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),"string"==typeof n&&(n=[n]),Ds.crossOrigin(e,n[0].src||n[0],t.crossorigin);for(let s=0;s<n.length;++s){const r=document.createElement("source");let{src:o,mime:a}=n[s];o=o||n[s];const l=o.split("?").shift().toLowerCase(),h=l.slice(l.lastIndexOf(".")+1);a=a||nd.MIME_TYPES[h]||`video/${h}`,r.src=o,r.type=a,e.appendChild(r)}n=e}super(n),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==t.autoLoad&&this.load()}update(n=0){this.destroyed||(this._msToNextUpdate=Math.floor(this._msToNextUpdate-qi.shared.elapsedMS*this.source.playbackRate),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))}load(){if(this._load)return this._load;const n=this.source;return(n.readyState===n.HAVE_ENOUGH_DATA||n.readyState===n.HAVE_FUTURE_DATA)&&n.width&&n.height&&(n.complete=!0),n.addEventListener("play",this._onPlayStart.bind(this)),n.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(n.addEventListener("canplay",this._onCanPlay),n.addEventListener("canplaythrough",this._onCanPlay),n.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,n.load())}),this._load}_onError(n){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(n)}_isSourcePlaying(){const n=this.source;return!n.paused&&!n.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(qi.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(qi.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const n=this.source;n.removeEventListener("canplay",this._onCanPlay),n.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(n.videoWidth,n.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&n.play()}dispose(){this._isConnectedToTicker&&(qi.shared.remove(this.update,this),this._isConnectedToTicker=!1);const n=this.source;n&&(n.removeEventListener("error",this._onError,!0),n.pause(),n.src="",n.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(n){n!==this._autoUpdate&&(this._autoUpdate=n,!this._autoUpdate&&this._isConnectedToTicker?(qi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(qi.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(n){n!==this._updateFPS&&(this._updateFPS=n)}static test(n,t){return globalThis.HTMLVideoElement&&n instanceof HTMLVideoElement||nd.TYPES.includes(t)}};let sd=nd;sd.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],sd.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},zu.push(bo,Eg,class BC extends Ds{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},sd,_a,da,l_,class OC extends a_{constructor(t,e){const{width:i,height:s}=e||{};let r,o;Array.isArray(t)?(r=t,o=t.length):o=t,super(o,{width:i,height:s}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=co.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:s,itemDirtyIds:r,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let l=0;l<s;l++){const h=o[l];r[l]<h.dirtyId&&(r[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,i.type,h.resource.source))}return!0}});class ch{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Se.EMPTY:((t=t||new Se(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:s,c:r,d:o,tx:a,ty:l}=t,h=i*e.x+r*e.y+a,c=s*e.x+o*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,r=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,r=a>r?a:r,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,r=a>r?a:r,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,r=a>r?a:r,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,r=a>r?a:r,this.minX=e,this.minY=i,this.maxX=s,this.maxY=r}addFrame(t,e,i,s,r){this.addFrameMatrix(t.worldTransform,e,i,s,r)}addFrameMatrix(t,e,i,s,r){const o=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*e+l*i+c,x=a*e+h*i+u;d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=o*s+l*i+c,x=a*s+h*i+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=o*e+l*r+c,x=a*e+h*r+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=o*s+l*r+c,x=a*s+h*r+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,i){let s=this.minX,r=this.minY,o=this.maxX,a=this.maxY;for(let l=e;l<i;l+=2){const h=t[l],c=t[l+1];s=h<s?h:s,r=c<r?c:r,o=h>o?h:o,a=c>a?c:a}this.minX=s,this.minY=r,this.maxX=o,this.maxY=a}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,r=0,o=r){const a=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let x=i;x<s;x+=2){const v=e[x],y=e[x+1],b=a*v+h*y+u,M=c*y+l*v+d;f=Math.min(f,b-r),m=Math.max(m,b+r),p=Math.min(p,M-o),g=Math.max(g,M+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,s=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=r&&s<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=s<l?s:l,this.maxX=r>h?r:h,this.maxY=o>c?o:c}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=r&&s<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=s<l?s:l,this.maxX=r>h?r:h,this.maxY=o>c?o:c}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,r,o){e-=o,i+=r,s+=o,this.minX=this.minX<(t-=r)?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class ci extends la{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Zu,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ch,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const s=e[i];Object.defineProperty(ci.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Se),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Se),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ch);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-r,o}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,r=0,o=0,a=0,l=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=r,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new FC),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*PA}set angle(t){this.transform.rotation=t*DA}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class FC extends ci{constructor(){super(...arguments),this.sortDirty=null}}ci.prototype.displayObjectUpdateTransform=ci.prototype.updateTransform;const NC=new ri;function UC(n,t){return n.zIndex===t.zIndex?n._lastSortedIndex-t._lastSortedIndex:n.zIndex-t.zIndex}const rd=class extends ci{constructor(){super(),this.children=[],this.sortableChildren=rd.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(n){}addChild(...n){if(n.length>1)for(let t=0;t<n.length;t++)this.addChild(n[t]);else{const t=n[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return n[0]}addChildAt(n,t){if(t<0||t>this.children.length)throw new Error(`${n}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.splice(t,0,n),this._boundsID++,this.onChildrenChange(t),n.emit("added",this),this.emit("childAdded",n,this,t),n}swapChildren(n,t){if(n===t)return;const e=this.getChildIndex(n),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=n,this.onChildrenChange(e<i?e:i)}getChildIndex(n){const t=this.children.indexOf(n);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(n,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const e=this.getChildIndex(n);fo(this.children,e,1),this.children.splice(t,0,n),this.onChildrenChange(t)}getChildAt(n){if(n<0||n>=this.children.length)throw new Error(`getChildAt: Index (${n}) does not exist.`);return this.children[n]}removeChild(...n){if(n.length>1)for(let t=0;t<n.length;t++)this.removeChild(n[t]);else{const t=n[0],e=this.children.indexOf(t);if(-1===e)return null;t.parent=null,t.transform._parentID=-1,fo(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e)}return n[0]}removeChildAt(n){const t=this.getChildAt(n);return t.parent=null,t.transform._parentID=-1,fo(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this),this.emit("childRemoved",t,this,n),t}removeChildren(n=0,t=this.children.length){const s=t-n;let r;if(s>0&&s<=t){r=this.children.splice(n,s);for(let o=0;o<r.length;++o)r[o].parent=null,r[o].transform&&(r[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(n);for(let o=0;o<r.length;++o)r[o].emit("removed",this),this.emit("childRemoved",r[o],this,o);return r}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let n=!1;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i._lastSortedIndex=t,!n&&0!==i.zIndex&&(n=!0)}n&&this.children.length>1&&this.children.sort(UC),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let n=0,t=this.children.length;n<t;++n){const e=this.children[n];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let n=0;n<this.children.length;n++){const t=this.children[n];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(n,t=!1){const e=super.getLocalBounds(n);if(!t)for(let i=0,s=this.children.length;i<s;++i){const r=this.children[i];r.visible&&r.updateTransform()}return e}_calculateBounds(){}_renderWithCulling(n){const t=n.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let e,i;this.cullArea?(e=this.cullArea,i=this.worldTransform):this._render!==rd.prototype._render&&(e=this.getBounds(!0));const s=n.projection.transform;if(s&&(i?(i=NC.copyFrom(i),i.prepend(s)):i=s),e&&t.intersects(e,i))this._render(n);else if(this.cullArea)return;for(let r=0,o=this.children.length;r<o;++r){const a=this.children[r],l=a.cullable;a.cullable=l||!this.cullArea,a.render(n),a.cullable=l}}render(n){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(n);else if(this.cullable)this._renderWithCulling(n);else{this._render(n);for(let t=0,e=this.children.length;t<e;++t)this.children[t].render(n)}}renderAdvanced(n){const t=this.filters,e=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let s=0;s<t.length;s++)t[s].enabled&&this._enabledFilters.push(t[s])}const i=t&&this._enabledFilters?.length||e&&(!e.isMaskData||e.enabled&&(e.autoDetect||e.type!==Ii.NONE));if(i&&n.batch.flush(),t&&this._enabledFilters?.length&&n.filter.push(this,this._enabledFilters),e&&n.mask.push(this,this._mask),this.cullable)this._renderWithCulling(n);else{this._render(n);for(let s=0,r=this.children.length;s<r;++s)this.children[s].render(n)}i&&n.batch.flush(),e&&n.mask.pop(this),t&&this._enabledFilters?.length&&n.filter.pop()}_render(n){}destroy(n){super.destroy(),this.sortDirty=!1;const t="boolean"==typeof n?n:n?.children,e=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<e.length;++i)e[i].destroy(n)}get width(){return this.scale.x*this.getLocalBounds().width}set width(n){const t=this.getLocalBounds().width;this.scale.x=0!==t?n/t:1,this._width=n}get height(){return this.scale.y*this.getLocalBounds().height}set height(n){const t=this.getLocalBounds().height;this.scale.y=0!==t?n/t:1,this._height=n}};let cn=rd;cn.defaultSortableChildren=!1,cn.prototype.containerUpdateTransform=cn.prototype.updateTransform,Object.defineProperties(Bt,{SORTABLE_CHILDREN:{get:()=>cn.defaultSortableChildren,set(n){Be("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),cn.defaultSortableChildren=n}}});var kC=Object.defineProperty,ct=(n,t,e)=>(((n,t,e)=>{t in n?kC(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e})(n,"symbol"!=typeof t?t+"":t,e),e);class wn{constructor(t){ct(this,"parent"),ct(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var n,zC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h_={exports:{}};n=h_,function(){var e,s;s=e={linear:function(s,r,o,a){return o*s/a+r},easeInQuad:function(s,r,o,a){return o*(s/=a)*s+r},easeOutQuad:function(s,r,o,a){return-o*(s/=a)*(s-2)+r},easeInOutQuad:function(s,r,o,a){return(s/=a/2)<1?o/2*s*s+r:-o/2*(--s*(s-2)-1)+r},easeInCubic:function(s,r,o,a){return o*(s/=a)*s*s+r},easeOutCubic:function(s,r,o,a){return o*((s=s/a-1)*s*s+1)+r},easeInOutCubic:function(s,r,o,a){return(s/=a/2)<1?o/2*s*s*s+r:o/2*((s-=2)*s*s+2)+r},easeInQuart:function(s,r,o,a){return o*(s/=a)*s*s*s+r},easeOutQuart:function(s,r,o,a){return-o*((s=s/a-1)*s*s*s-1)+r},easeInOutQuart:function(s,r,o,a){return(s/=a/2)<1?o/2*s*s*s*s+r:-o/2*((s-=2)*s*s*s-2)+r},easeInQuint:function(s,r,o,a){return o*(s/=a)*s*s*s*s+r},easeOutQuint:function(s,r,o,a){return o*((s=s/a-1)*s*s*s*s+1)+r},easeInOutQuint:function(s,r,o,a){return(s/=a/2)<1?o/2*s*s*s*s*s+r:o/2*((s-=2)*s*s*s*s+2)+r},easeInSine:function(s,r,o,a){return-o*Math.cos(s/a*(Math.PI/2))+o+r},easeOutSine:function(s,r,o,a){return o*Math.sin(s/a*(Math.PI/2))+r},easeInOutSine:function(s,r,o,a){return-o/2*(Math.cos(Math.PI*s/a)-1)+r},easeInExpo:function(s,r,o,a){return 0===s?r:o*Math.pow(2,10*(s/a-1))+r},easeOutExpo:function(s,r,o,a){return s===a?r+o:o*(1-Math.pow(2,-10*s/a))+r},easeInOutExpo:function(s,r,o,a){return(s/=a/2)<1?o/2*Math.pow(2,10*(s-1))+r:o/2*(2-Math.pow(2,-10*--s))+r},easeInCirc:function(s,r,o,a){return-o*(Math.sqrt(1-(s/=a)*s)-1)+r},easeOutCirc:function(s,r,o,a){return o*Math.sqrt(1-(s=s/a-1)*s)+r},easeInOutCirc:function(s,r,o,a){return(s/=a/2)<1?-o/2*(Math.sqrt(1-s*s)-1)+r:o/2*(Math.sqrt(1-(s-=2)*s)+1)+r},easeInElastic:function(s,r,o,a){var l,h,c;return c=1.70158,0===s||(s/=a),(h=0)||(h=.3*a),(l=o)<Math.abs(o)?(l=o,c=h/4):c=h/(2*Math.PI)*Math.asin(o/l),-l*Math.pow(2,10*(s-=1))*Math.sin((s*a-c)*(2*Math.PI)/h)+r},easeOutElastic:function(s,r,o,a){var l,h,c;return c=1.70158,0===s||(s/=a),(h=0)||(h=.3*a),(l=o)<Math.abs(o)?(l=o,c=h/4):c=h/(2*Math.PI)*Math.asin(o/l),l*Math.pow(2,-10*s)*Math.sin((s*a-c)*(2*Math.PI)/h)+o+r},easeInOutElastic:function(s,r,o,a){var l,h,c;return c=1.70158,0===s||(s/=a/2),(h=0)||(h=a*(.3*1.5)),(l=o)<Math.abs(o)?(l=o,c=h/4):c=h/(2*Math.PI)*Math.asin(o/l),s<1?l*Math.pow(2,10*(s-=1))*Math.sin((s*a-c)*(2*Math.PI)/h)*-.5+r:l*Math.pow(2,-10*(s-=1))*Math.sin((s*a-c)*(2*Math.PI)/h)*.5+o+r},easeInBack:function(s,r,o,a,l){return void 0===l&&(l=1.70158),o*(s/=a)*s*((l+1)*s-l)+r},easeOutBack:function(s,r,o,a,l){return void 0===l&&(l=1.70158),o*((s=s/a-1)*s*((l+1)*s+l)+1)+r},easeInOutBack:function(s,r,o,a,l){return void 0===l&&(l=1.70158),(s/=a/2)<1?o/2*(s*s*((1+(l*=1.525))*s-l))+r:o/2*((s-=2)*s*((1+(l*=1.525))*s+l)+2)+r},easeInBounce:function(s,r,o,a){return o-e.easeOutBounce(a-s,0,o,a)+r},easeOutBounce:function(s,r,o,a){return(s/=a)<1/2.75?o*(7.5625*s*s)+r:s<2/2.75?o*(7.5625*(s-=1.5/2.75)*s+.75)+r:s<2.5/2.75?o*(7.5625*(s-=2.25/2.75)*s+.9375)+r:o*(7.5625*(s-=2.625/2.75)*s+.984375)+r},easeInOutBounce:function(s,r,o,a){return s<a/2?.5*e.easeInBounce(2*s,0,o,a)+r:.5*e.easeOutBounce(2*s-a,0,o,a)+.5*o+r}},n.exports=s}.call(zC);const c_=h_.exports;function uh(n,t){return n?"function"==typeof n?n:"string"==typeof n?c_[n]:void 0:c_[t]}const HC={removeOnInterrupt:!1,ease:"linear",time:1e3};class WC extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"startX"),ct(this,"startY"),ct(this,"deltaX"),ct(this,"deltaY"),ct(this,"keepCenter"),ct(this,"startWidth",null),ct(this,"startHeight",null),ct(this,"deltaWidth",null),ct(this,"deltaHeight",null),ct(this,"width",null),ct(this,"height",null),ct(this,"time",0),this.options=Object.assign({},HC,e),this.options.ease=uh(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),null!==this.width&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),null!==this.height&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),null!==this.width&&this.parent.fitWidth(this.width,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.height,this.keepCenter,null===this.width),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new ne(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const i=this.parent.width,s=this.parent.height;this.complete(),(i!==this.parent.width||s!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const i=this.options.ease(this.time,0,1,this.options.time);if(null!==this.width&&this.parent.fitWidth(this.startWidth+this.deltaWidth*i,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.startHeight+this.deltaHeight*i,this.keepCenter,null===this.width),null===this.width?this.parent.scale.x=this.parent.scale.y:null===this.height&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const s=this.startX,r=this.startY,o=this.deltaX,a=this.deltaY,l=new ne(this.parent.x,this.parent.y);this.parent.moveCenter(s+o*i,r+a*i),this.parent.emit("moved",{viewport:this.parent,original:l,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const VC={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class XC extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"left"),ct(this,"top"),ct(this,"right"),ct(this,"bottom"),ct(this,"underflowX"),ct(this,"underflowY"),ct(this,"ease"),ct(this,"toX"),ct(this,"toY"),this.options=Object.assign({},VC,e),this.ease=uh(this.options.ease,"easeInOutSine"),this.options.sides?"all"===this.options.sides?this.top=this.bottom=this.left=this.right=!0:"horizontal"===this.options.sides?(this.right=this.left=!0,this.top=this.bottom=!1):"vertical"===this.options.sides?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=-1!==this.options.sides.indexOf("top"),this.bottom=-1!==this.options.sides.indexOf("bottom"),this.left=-1!==this.options.sides.indexOf("left"),this.right=-1!==this.options.sides.indexOf("right")):this.left=this.top=this.right=this.bottom=!1;const i=this.options.underflow.toLowerCase();"center"===i?(this.underflowX=0,this.underflowY=0):(this.underflowX=-1!==i.indexOf("left")?-1:-1!==i.indexOf("right")?1:0,this.underflowY=-1!==i.indexOf("top")?-1:-1!==i.indexOf("bottom")?1:0),this.reset()}isActive(){return null!==this.toX||null!==this.toY}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,i=typeof t.y>"u"?0:t.y,s=typeof t.width>"u"?this.parent.worldWidth:t.width,r=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>s,top:this.parent.top<i,bottom:this.parent.bottom>r,topLeft:new ne(e*this.parent.scale.x,i*this.parent.scale.y),bottomRight:new ne(s*this.parent.scale.x-this.parent.screenWidth,r*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new ne(0,0),bottomRight:new ne(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let i,s=this.parent.plugins.get("decelerate",!0);s&&(s.x||s.y)&&(s.x&&s.percentChangeX===(null==(t=s.options)?void 0:t.friction)||s.y&&s.percentChangeY===(null==(e=s.options)?void 0:e.friction))&&(i=this.oob(),(i.left&&this.left||i.right&&this.right)&&(s.percentChangeX=this.options.friction),(i.top&&this.top||i.bottom&&this.bottom)&&(s.percentChangeY=this.options.friction));const r=this.parent.plugins.get("drag",!0)||{},o=this.parent.plugins.get("pinch",!0)||{};if(s=s||{},!(null!=r&&r.active||null!=o&&o.active||this.toX&&this.toY||s.x&&s.y)){i=i||this.oob();const a=i.topLeft,l=i.bottomRight;if(!this.toX&&!s.x){let h=null;i.left&&this.left?h=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-a.x:i.right&&this.right&&(h=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-l.x),null!==h&&this.parent.x!==h&&(this.toX={time:0,start:this.parent.x,delta:h-this.parent.x,end:h},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!s.y){let h=null;i.top&&this.top?h=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-a.y:i.bottom&&this.bottom&&(h=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-l.y),null!==h&&this.parent.y!==h&&(this.toY={time:0,start:this.parent.y,delta:h-this.parent.y,end:h},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const YC={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class ZC extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"last"),ct(this,"noUnderflow"),ct(this,"underflowX"),ct(this,"underflowY"),this.options=Object.assign({},YC,e),this.options.direction&&(this.options.left="x"===this.options.direction||"all"===this.options.direction||null,this.options.right="x"===this.options.direction||"all"===this.options.direction||null,this.options.top="y"===this.options.direction||"all"===this.options.direction||null,this.options.bottom="y"===this.options.direction||"all"===this.options.direction||null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();"none"===t?this.noUnderflow=!0:"center"===t?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=-1!==t.indexOf("left")?-1:-1!==t.indexOf("right")?1:0,this.underflowY=-1!==t.indexOf("top")?-1:-1!==t.indexOf("bottom")?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new ne(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(null!==this.options.left||null!==this.options.right){let i=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:0!==this.parent.x&&(this.parent.x=0,i=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,i=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,i=!0)}else null!==this.options.left&&this.parent.left<(!0===this.options.left?0:this.options.left)&&(this.parent.x=-(!0===this.options.left?0:this.options.left)*this.parent.scale.x,e.x=0,i=!0),null!==this.options.right&&this.parent.right>(!0===this.options.right?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(!0===this.options.right?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,i=!0);i&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(null!==this.options.top||null!==this.options.bottom){let i=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:0!==this.parent.y&&(this.parent.y=0,i=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,i=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,i=!0)}else null!==this.options.top&&this.parent.top<(!0===this.options.top?0:this.options.top)&&(this.parent.y=-(!0===this.options.top?0:this.options.top)*this.parent.scale.y,e.y=0,i=!0),null!==this.options.bottom&&this.parent.bottom>(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,i=!0);i&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const $C={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class qC extends wn{constructor(t,e={}){super(t),ct(this,"options"),this.options=Object.assign({},$C,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused)if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(null!==this.options.minWidth&&t<this.options.minWidth){const i=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/i,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxWidth&&t>this.options.maxWidth){const i=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/i,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.minHeight&&e<this.options.minHeight){const i=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/i,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxHeight&&e>this.options.maxHeight){const i=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/i,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if("number"==typeof this.options.minScale)t.x=this.options.minScale,t.y=this.options.minScale;else if(null!==this.options.minScale){const r=this.options.minScale;t.x=typeof r.x>"u"?null:r.x,t.y=typeof r.y>"u"?null:r.y}if("number"==typeof this.options.maxScale)e.x=this.options.maxScale,e.y=this.options.maxScale;else if(null!==this.options.maxScale){const r=this.options.maxScale;e.x=typeof r.x>"u"?null:r.x,e.y=typeof r.y>"u"?null:r.y}let i=this.parent.scale.x,s=this.parent.scale.y;null!==t.x&&i<t.x&&(i=t.x),null!==e.x&&i>e.x&&(i=e.x),null!==t.y&&s<t.y&&(s=t.y),null!==e.y&&s>e.y&&(s=e.y),(i!==this.parent.scale.x||s!==this.parent.scale.y)&&(this.parent.scale.set(i,s),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}reset(){this.clamp()}}const jC={friction:.98,bounce:.8,minSpeed:.01};class JC extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"x"),ct(this,"y"),ct(this,"percentChangeX"),ct(this,"percentChangeY"),ct(this,"saved"),ct(this,"timeSinceRelease"),this.options=Object.assign({},jC,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",i=>this.handleMoved(i))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!(!this.x&&!this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(1===t||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];"clamp-x"===t.type&&t.original?e.x===t.original.x&&(e.x=this.parent.x):"clamp-y"===t.type&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(0===this.parent.input.count()&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const i=t-e.time;this.x=(this.parent.x-e.x)/i,this.y=(this.parent.y-e.y)/i,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){typeof(t=t||{}).x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,i=this.timeSinceRelease,s=this.timeSinceRelease+t;if(this.x){const r=this.percentChangeX,o=Math.log(r);this.parent.x+=16*this.x/o*(Math.pow(r,s/16)-Math.pow(r,i/16)),this.x*=Math.pow(this.percentChangeX,t/16)}if(this.y){const r=this.percentChangeY,o=Math.log(r);this.parent.y+=16*this.y/o*(Math.pow(r,s/16)-Math.pow(r,i/16)),this.y*=Math.pow(this.percentChangeY,t/16)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const KC={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class QC extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"moved"),ct(this,"reverse"),ct(this,"xDirection"),ct(this,"yDirection"),ct(this,"keyIsPressed"),ct(this,"mouse"),ct(this,"underflowX"),ct(this,"underflowY"),ct(this,"last"),ct(this,"current"),ct(this,"windowEventHandlers",[]),this.options=Object.assign({},KC,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||"all"===this.options.direction||"x"===this.options.direction,this.yDirection=!this.options.direction||"all"===this.options.direction||"y"===this.options.direction,this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){this.addWindowEventHandler("keyup",s=>{t.includes(s.code)&&(this.keyIsPressed=!1)}),this.addWindowEventHandler("keydown",s=>{t.includes(s.code)&&(this.keyIsPressed=!0)})}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){this.mouse=t&&"all"!==t?[-1!==t.indexOf("left"),-1!==t.indexOf("middle"),-1!==t.indexOf("right")]:[!0,!0,!0]}parseUnderflow(){const t=this.options.underflow.toLowerCase();"center"===t?(this.underflowX=0,this.underflowY=0):(this.underflowX=t.includes("left")?-1:t.includes("right")?1:0,this.underflowY=t.includes("top")?-1:t.includes("bottom")?1:0)}checkButtons(t){const e="mouse"===t.pointerType,i=this.parent.input.count();return!(!(1===i||i>1&&!this.parent.plugins.get("pinch",!0))||e&&!this.mouse[t.button])}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&"touch"===t.data.pointerType}down(t){return!(this.paused||!this.options.pressDrag||(this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,0):(this.last=null,1)))}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,i=t.global.y,s=this.parent.input.count();if(1===s||s>1&&!this.parent.plugins.get("pinch",!0)){const r=e-this.last.x,o=i-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(r)||this.yDirection&&this.parent.input.checkThreshold(o)){const a={x:e,y:i};return this.xDirection&&(this.parent.x+=(a.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(a.y-this.last.y)*this.options.factor),this.last=a,this.moved||this.parent.emit("drag-start",{event:t,screen:new ne(this.last.x,this.last.y),world:this.parent.toWorld(new ne(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(1===e.length){const i=e[0];return i.last&&(this.last={x:i.last.x,y:i.last.y},this.current=i.id),this.moved=!1,!0}if(this.last&&this.moved){const i=new ne(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:i,world:this.parent.toWorld(i),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const i=t.deltaMode?this.options.lineHeight:1,s=[t.deltaX,t.deltaY],[r,o]=this.options.wheelSwapAxes?s.reverse():s;return this.xDirection&&(this.parent.x+=r*i*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=o*i*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if("y"!==this.options.clampWheel)if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if("x"!==this.options.clampWheel)if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const tI={speed:0,acceleration:null,radius:null};class eI extends wn{constructor(t,e,i={}){super(t),ct(this,"options"),ct(this,"target"),ct(this,"velocity"),this.target=e,this.options=Object.assign({},tI,i),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let i=this.target.x,s=this.target.y;if(this.options.radius){if(!(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius))return;{const a=Math.atan2(this.target.y-e.y,this.target.x-e.x);i=this.target.x-Math.cos(a)*this.options.radius,s=this.target.y-Math.sin(a)*this.options.radius}}const r=i-e.x,o=s-e.y;if(r||o)if(this.options.speed)if(this.options.acceleration){const a=Math.atan2(s-e.y,i-e.x),l=Math.sqrt(Math.pow(r,2)+Math.pow(o,2));if(l){const h=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);this.velocity=l>h?{x:Math.min(this.velocity.x+this.options.speed),y:Math.min(this.velocity.y+this.options.speed)}:{x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const c=Math.cos(a)*this.velocity.x,u=Math.sin(a)*this.velocity.y,d=Math.abs(c)>Math.abs(r)?i:e.x+c,f=Math.abs(u)>Math.abs(o)?s:e.y+u;this.parent.moveCenter(d,f),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const a=Math.atan2(s-e.y,i-e.x),l=Math.cos(a)*this.options.speed,h=Math.sin(a)*this.options.speed,c=Math.abs(l)>Math.abs(r)?i:e.x+l,u=Math.abs(h)>Math.abs(o)?s:e.y+h;this.parent.moveCenter(c,u),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(i,s),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const iI={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class nI extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"reverse"),ct(this,"radiusSquared"),ct(this,"left"),ct(this,"top"),ct(this,"right"),ct(this,"bottom"),ct(this,"horizontal"),ct(this,"vertical"),this.options=Object.assign({},iI,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared="number"==typeof this.options.radius?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;null!==t?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=null===this.options.right?null:this.parent.screenWidth-this.options.right,this.bottom=null===this.options.bottom?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||"mouse"!==t.pointerType&&1!==t.pointerId||!this.options.allowButtons&&0!==t.buttons)return!1;const e=t.global.x,i=t.global.y;if(this.radiusSquared){const s=this.parent.toScreen(this.parent.center);if(Math.pow(s.x-e,2)+Math.pow(s.y-i,2)>=this.radiusSquared){const r=Math.atan2(s.y-i,s.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(r))*this.options.speed*this.reverse*.06,this.vertical=Math.round(Math.sin(r))*this.options.speed*this.reverse*.06):(this.horizontal=Math.cos(r)*this.options.speed*this.reverse*.06,this.vertical=Math.sin(r)*this.options.speed*this.reverse*.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else null!==this.left&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*.06:null!==this.right&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*.06:(this.decelerateHorizontal(),this.horizontal=0),null!==this.top&&i<this.top?this.vertical=Number(this.reverse)*this.options.speed*.06:null!==this.bottom&&i>this.bottom?this.vertical=-1*this.reverse*this.options.speed*.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const sI={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class rI extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"active",!1),ct(this,"pinching",!1),ct(this,"moved",!1),ct(this,"lastCenter"),this.options=Object.assign({},sI,e)}down(){return this.parent.input.count()>=2&&(this.active=!0,!0)}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,i=t.global.y,s=this.parent.input.touches;if(s.length>=2){const r=s[0],o=s[1],a=r.last&&o.last?Math.sqrt(Math.pow(o.last.x-r.last.x,2)+Math.pow(o.last.y-r.last.y,2)):null;if(r.id===t.pointerId?r.last={x:e,y:i,data:t}:o.id===t.pointerId&&(o.last={x:e,y:i,data:t}),a){let l;const h=new ne(r.last.x+(o.last.x-r.last.x)/2,r.last.y+(o.last.y-r.last.y)/2);this.options.center||(l=this.parent.toLocal(h));let c=Math.sqrt(Math.pow(o.last.x-r.last.x,2)+Math.pow(o.last.y-r.last.y,2));c=0===c?c=1e-10:c;const u=(1-a/c)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=u),this.isAxisY()&&(this.parent.scale.y+=u),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:h});const d=this.parent.plugins.get("clamp-zoom",!0);if(d&&d.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const f=this.parent.toGlobal(l);this.parent.x+=(h.x-f.x)*this.options.factor,this.parent.y+=(h.y-f.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(h.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(h.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=h,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return!!(this.pinching&&this.parent.input.touches.length<=1)&&(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0)}}const oI={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class aI extends wn{constructor(t,e,i,s={}){super(t),ct(this,"options"),ct(this,"ease"),ct(this,"x"),ct(this,"y"),ct(this,"percent"),ct(this,"snapping"),ct(this,"deltaX"),ct(this,"deltaY"),ct(this,"startX"),ct(this,"startY"),this.options=Object.assign({},oI,s),this.ease=uh(s.ease,"easeInOutSine"),this.x=e,this.y=i,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(0===this.parent.input.count()){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!(this.paused||this.options.interrupt&&0!==this.parent.input.count()))if(this.snapping){const e=this.snapping;let i,s,r;e.time+=t;const o=this.startX,a=this.startY,l=this.deltaX,h=this.deltaY;if(e.time>this.options.time)i=!0,s=o+l,r=a+h;else{const c=this.ease(e.time,0,1,this.options.time);s=o+l*c,r=a+h*c}this.options.topLeft?this.parent.moveCorner(s,r):this.parent.moveCenter(s,r),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),i&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const e=this.options.topLeft?this.parent.corner:this.parent.center;(e.x!==this.x||e.y!==this.y)&&this.snapStart()}}}const lI={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class hI extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"ease"),ct(this,"xScale"),ct(this,"yScale"),ct(this,"xIndependent"),ct(this,"yIndependent"),ct(this,"snapping"),this.options=Object.assign({},lI,e),this.ease=uh(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,0===this.options.time?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;this.snapping={time:0,startX:t,startY:e,deltaX:this.parent.screenWidth/this.xScale-t,deltaY:this.parent.screenHeight/this.yScale-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&0!==this.parent.input.count())return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),this.snapping){if(this.snapping){const i=this.snapping;if(i.time+=t,i.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const r=this.snapping,o=this.ease(r.time,r.startX,r.deltaX,this.options.time),a=this.ease(r.time,r.startY,r.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/o,this.parent.scale.y=this.parent.screenHeight/a}const s=this.parent.plugins.get("clamp-zoom",!0);s&&s.clamp(),this.options.noMove||this.parent.moveCenter(this.options.center?this.options.center:e)}}else(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping()}resume(){this.snapping=null,super.resume()}}const cI={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class uI extends wn{constructor(t,e={}){super(t),ct(this,"options"),ct(this,"smoothing"),ct(this,"smoothingCenter"),ct(this,"smoothingCount"),ct(this,"keyIsPressed"),this.options=Object.assign({},cI,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let i;this.options.center||(i=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const r=this.parent.toGlobal(i);this.parent.x+=t.x-r.x,this.parent.y+=t.y-r.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),s=Math.pow(2,(1+this.options.percent)*(-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200));let r;this.options.center||(r=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=s),this.isAxisY()&&(this.parent.scale.y*=s),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(r);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),s=Math.pow(2,(1+this.options.percent)*((this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500));if(this.options.smooth){const r={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+r.x)*s-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+r.y)*s-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let r;this.options.center||(r=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=s),this.isAxisY()&&(this.parent.scale.y*=s),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(r);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class dI{constructor(t){ct(this,"viewport"),ct(this,"clickedAvailable"),ct(this,"isMouseDown"),ct(this,"last"),ct(this,"wheelFunction"),ct(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new Se(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.on("pointerout",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!this.viewport.pause&&this.viewport.worldVisible){if("mouse"===t.pointerType?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),1===this.count()){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),i=this.viewport.plugins.get("bounce",!0);this.clickedAvailable=!(e&&e.isActive()||i&&i.isActive())}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const s=t.global.y-this.last.y;(this.checkThreshold(t.global.x-this.last.x)||this.checkThreshold(s))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;"mouse"===t.pointerType&&(this.isMouseDown=!1),"mouse"!==t.pointerType&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&0===this.count()&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new ne;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t)return void this.touches.splice(e,1)}count(){return(this.isMouseDown?1:0)+this.touches.length}}const ya=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class fI{constructor(t){ct(this,"plugins"),ct(this,"list"),ct(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,i=ya.length){const s=this.plugins[t];s&&s.destroy(),this.plugins[t]=e;const r=ya.indexOf(t);-1!==r&&ya.splice(r,1),ya.splice(i,0,t),this.sort()}get(t,e){var i;return e&&null!=(i=this.plugins[t])&&i.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&(null==(e=this.plugins[t])||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;null==(e=this.plugins[t])||e.pause()}resume(t){var e;null==(e=this.plugins[t])||e.resume()}sort(){this.list=[];for(const t of ya)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const i of this.list)i.down(t)&&(e=!0);return e}move(t){let e=!1;for(const i of this.viewport.plugins.list)i.move(t)&&(e=!0);return e}up(t){let e=!1;for(const i of this.list)i.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const i of this.list)i.wheel(t)&&(e=!0);return e}}const pI={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:qi.shared};class mI extends cn{constructor(t){super(),ct(this,"moving"),ct(this,"screenWidth"),ct(this,"screenHeight"),ct(this,"threshold"),ct(this,"input"),ct(this,"plugins"),ct(this,"zooming"),ct(this,"lastViewport"),ct(this,"options"),ct(this,"_dirty"),ct(this,"_forceHitArea"),ct(this,"_hitAreaDefault"),ct(this,"_pause"),ct(this,"tickerFunction"),ct(this,"_worldWidth"),ct(this,"_worldHeight"),ct(this,"_disableOnContextMenu",e=>e.preventDefault()),this.options={...pI,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new dI(this),this.plugins=new fI(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new Se(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,i,s){this.screenWidth=t,this.screenHeight=e,typeof i<"u"&&(this._worldWidth=i),typeof s<"u"&&(this._worldHeight=s),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new Se(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return this.toLocal(2===arguments.length?new ne(t,e):t)}toScreen(t,e){return this.toGlobal(2===arguments.length?new ne(t,e):t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new ne(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,i;"number"==typeof t[0]?(e=t[0],i=t[1]):(e=t[0].x,i=t[0].y);const s=(this.worldScreenWidth/2-e)*this.scale.x,r=(this.worldScreenHeight/2-i)*this.scale.y;return(this.x!==s||this.y!==r)&&(this.position.set(s,r),this.plugins.reset(),this.dirty=!0),this}get corner(){return new ne(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,i;return 1===t.length?(e=-t[0].x*this.scale.x,i=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,i=-t[1]*this.scale.y),(e!==this.x||i!==this.y)&&(this.position.set(e,i),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){return Math.min(this.screenWidth/t,this.screenHeight/e)}findCover(t,e){return Math.max(this.screenWidth/t,this.screenHeight/e)}fitWidth(t=this.worldWidth,e,i=!0,s){let r;e&&(r=this.center),this.scale.x=this.screenWidth/t,i&&(this.scale.y=this.scale.x);const o=this.plugins.get("clamp-zoom",!0);return!s&&o&&o.clamp(),e&&r&&this.moveCenter(r),this}fitHeight(t=this.worldHeight,e,i=!0,s){let r;e&&(r=this.center),this.scale.y=this.screenHeight/t,i&&(this.scale.x=this.scale.y);const o=this.plugins.get("clamp-zoom",!0);return!s&&o&&o.clamp(),e&&r&&this.moveCenter(r),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,i=this.worldHeight){let s;t&&(s=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/i,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&s&&this.moveCenter(s),this}setZoom(t,e){let i;e&&(i=this.center),this.scale.set(t);const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),e&&i&&this.moveCenter(i),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new hI(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new ne(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new Se(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new QC(this,t)),this}clamp(t){return this.plugins.add("clamp",new ZC(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new JC(this,t)),this}bounce(t){return this.plugins.add("bounce",new XC(this,t)),this}pinch(t){return this.plugins.add("pinch",new rI(this,t)),this}snap(t,e,i){return this.plugins.add("snap",new aI(this,t,e,i)),this}follow(t,e){return this.plugins.add("follow",new eI(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new uI(this,t)),this}animate(t){return this.plugins.add("animate",new WC(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new qC(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new nI(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,i,s,r){r&&(i>this.worldScreenWidth||s>this.worldScreenHeight)&&(this.fit(!0,i,s),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let o=!1;t<this.left?(this.left=t,o=!0):t+i>this.right&&(this.right=t+i,o=!0),e<this.top?(this.top=e,o=!0):e+s>this.bottom&&(this.bottom=e+s,o=!0),o&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}const xa=new ne,gI=new Uint16Array([0,1,2,0,2,3]);class va extends cn{constructor(t){super(),this._anchor=new Ps(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ae.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Vt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=gI,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Bt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=po(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=po(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,s=e.b,r=e.c,o=e.d,a=e.tx,l=e.ty,h=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,g=c.y-d._y*u.height,m=g+c.height):(p=-d._x*u.width,f=p+u.width,g=-d._y*u.height,m=g+u.height),h[0]=i*p+r*g+a,h[1]=o*g+s*p+l,h[2]=i*f+r*g+a,h[3]=o*g+s*f+l,h[4]=i*f+r*m+a,h[5]=o*m+s*f+l,h[6]=i*p+r*m+a,h[7]=o*m+s*p+l,this._roundPixels){const x=Bt.RESOLUTION;for(let v=0;v<h.length;++v)h[v]=Math.round(h[v]*x)/x}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this.vertexTrimmedData,i=this._texture.orig,s=this._anchor,r=this.transform.worldTransform,o=r.a,a=r.b,l=r.c,h=r.d,c=r.tx,u=r.ty,d=-s._x*i.width,f=d+i.width,p=-s._y*i.height,m=p+i.height;e[0]=o*d+l*p+c,e[1]=h*p+a*d+u,e[2]=o*f+l*p+c,e[3]=h*p+a*f+u,e[4]=o*f+l*m+c,e[5]=h*m+a*f+u,e[6]=o*d+l*m+c,e[7]=h*m+a*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new ch),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Se),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,xa);const e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;let r=0;return xa.x>=s&&xa.x<s+e&&(r=-i*this.anchor.y,xa.y>=r&&xa.y<r+i)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof t?t:t?.texture)&&this._texture.destroy(!!("boolean"==typeof t?t:t?.baseTexture)),this._texture=null}static from(t,e){const i=t instanceof Vt?t:Vt.from(t,e);return new va(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=po(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=po(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Vt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const u_=new ri;ci.prototype._cacheAsBitmap=!1,ci.prototype._cacheData=null,ci.prototype._cacheAsBitmapResolution=null,ci.prototype._cacheAsBitmapMultisample=null;class _I{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ci.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(n){n!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(n){n!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(n){if(this._cacheAsBitmap===n)return;let t;this._cacheAsBitmap=n,n?(this._cacheData||(this._cacheData=new _I),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),ci.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ci.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();this.filters?.length&&i.pad(this.filters[0].padding),i.ceil(Bt.RESOLUTION);const s=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,l=Ls.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${pr()}`;this._cacheData.textureCacheId=h,_e.addToCache(l.baseTexture,h),Vt.addToCache(l,h);const c=this.transform.localTransform.copyTo(u_).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(s,r,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new va(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-i.x/i.width,u.anchor.y=-i.y/i.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},ci.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ci.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const s=t.canvasContext.activeContext,r=t._projTransform;e.ceil(Bt.RESOLUTION);const o=Ls.create({width:e.width,height:e.height}),a=`cacheAsBitmap_${pr()}`;this._cacheData.textureCacheId=a,_e.addToCache(o.baseTexture,a),Vt.addToCache(o,a);const l=u_;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=s,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new va(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},ci.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ci.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ci.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,_e.removeFromCache(this._cacheData.textureCacheId),Vt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ci.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ci.prototype.name=null,cn.prototype.getChildByName=function(t,e){for(let i=0,s=this.children.length;i<s;i++)if(this.children[i].name===t)return this.children[i];if(e)for(let i=0,s=this.children.length;i<s;i++){const r=this.children[i];if(!r.getChildByName)continue;const o=r.getChildByName(t,!0);if(o)return o}return null},ci.prototype.getGlobalPosition=function(t=new ne,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const vI={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},bI=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class od extends Ui{constructor(t,e=8,i=4,s=Ui.defaultResolution,r=5){const o=function SI(n,t){const e=Math.ceil(n/2);let r,i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";r=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<n;o++){let a=r.replace("%index%",o.toString());a=a.replace("%sampleIndex%",o-(e-1)+".0"),s+=a,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",n.toString()),i}(r,t),a=function wI(n){const t=vI[n],e=t.length;let o,i=bI,s="";for(let a=0;a<n;a++){let l="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());o=a,a>=e&&(o=n-a-1),l=l.replace("%value%",t[o].toString()),s+=l,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",n.toString()),i}(r);super(o,a),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(this.uniforms.strength=i?this.horizontal?1/i.width*(i.width/e.width):1/i.height*(i.height/e.height):this.horizontal?1/t.renderer.width*(t.renderer.width/e.width):1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,s);else{const r=t.getFilterTexture(),o=t.renderer;let a=e,l=r;this.state.blend=!1,t.applyFilter(this,a,l,$n.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(a,$n.BLIT),this.uniforms.uSampler=l;const c=l;l=a,a=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,i,s),t.returnFilterTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class ad extends Ui{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(n_,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)}tint(t,e){this._loadMatrix([(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0],e)}greyscale(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),s=Math.sin(t),o=1/3,a=(0,Math.sqrt)(o);this._loadMatrix([i+(1-i)*o,o*(1-i)-a*s,o*(1-i)+a*s,0,0,o*(1-i)+a*s,i+o*(1-i),o*(1-i)-a*s,0,0,o*(1-i)-a*s,o*(1-i)+a*s,i+o*(1-i),0,0,0,0,0,1,0],e)}contrast(t,e){const i=(t||0)+1,s=-.5*(i-1);this._loadMatrix([i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0],e)}saturate(t=0,e){const i=2*t/3+1,s=-.5*(i-1);this._loadMatrix([i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0],e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,s,r){const o=((i=i||16770432)>>16&255)/255,a=(i>>8&255)/255,l=(255&i)/255,h=((s=s||3375104)>>16&255)/255,c=(s>>8&255)/255,u=(255&s)/255;this._loadMatrix([.3,.59,.11,0,0,o,a,l,t=t||.2,0,h,c,u,e=e||.15,0,o-h,a-c,l-u,0,0],r)}night(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)}predator(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}ad.prototype.grayscale=ad.prototype.greyscale;const d_={AlphaFilter:class xI extends Ui{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class TI extends Ui{constructor(t=8,e=4,i=Ui.defaultResolution,s=5){super(),this.blurXFilter=new od(!0,t,e,i,s),this.blurYFilter=new od(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){const r=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(r&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,$n.CLEAR),this.blurYFilter.apply(t,a,i,s),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this.padding=this._repeatEdgePixels?0:2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:od,ColorMatrixFilter:ad,DisplacementFilter:class II extends Ui{constructor(t,e){const i=new ri;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,null==e&&(e=20),this.scale=new ne(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,o=Math.sqrt(r.a*r.a+r.b*r.b),a=Math.sqrt(r.c*r.c+r.d*r.d);0!==o&&0!==a&&(this.uniforms.rotation[0]=r.a/o,this.uniforms.rotation[1]=r.b/o,this.uniforms.rotation[2]=r.c/a,this.uniforms.rotation[3]=r.d/a),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class DI extends Ui{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class OI extends Ui{constructor(t=.5,e=Math.random()){super(n_,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(d_).forEach(([n,t])=>{Object.defineProperty(d_,n,{get:()=>(Be("7.1.0",`filters.${n} has moved to ${n}`),t)})});class ba{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ba.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ne,this.page=new ne,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class dh extends ba{constructor(){super(...arguments),this.client=new ne,this.movement=new ne,this.offset=new ne,this.global=new ne,this.screen=new ne}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,r,o,a,l,h,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class Nn extends dh{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ld extends dh{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const FI=new ne,hd=new ne;class NI{constructor(t){this.dispatch=new la,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,FI.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,r=i.length-1;s<r;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const s=i.children;if(s)for(let r=0;r<s.length;r++)this.all(t,e,s[r]);t.currentTarget=i,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,i,s,r){if(!t||!t.visible||r(t,i))return null;if(t.interactiveChildren&&t.children){const o=t.children;for(let a=o.length-1;a>=0;a--){const l=o[a],h=this.hitTestRecursive(l,e||l.interactive,i,s,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;return(h.length>0||t.interactive)&&h.push(t),h}}}return e&&s(t,i)?t.interactive?[t]:[]:null}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,hd),!t.hitArea.contains(hd.x,hd.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!!t.containsPoint&&t.containsPoint(e)}notifyTarget(t,e){t.currentTarget[`on${e=e??t.type}`]?.(t),this.notifyListeners(t,t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Nn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType?this.dispatchEvent(e,"touchstart"):"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.dispatchEvent(e,2===e.button?"rightdown":"mousedown"),this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Nn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t),i="mouse"===e.pointerType||"pen"===e.pointerType,s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&r!==e.target){const l=this.createPointerEvent(t,"mousemove"===t.type?"mouseout":"pointerout",r);if(this.dispatchEvent(l,"pointerout"),i&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(r)){const h=this.createPointerEvent(t,"pointerleave",r);for(h.eventPhase=h.AT_TARGET;h.target&&!e.composedPath().includes(h.target);)h.currentTarget=h.target,this.notifyTarget(h),i&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;this.freeEvent(h)}this.freeEvent(l)}if(r!==e.target){const l=this.clonePointerEvent(e,"mousemove"===t.type?"mouseover":"pointerover");this.dispatchEvent(l,"pointerover"),i&&this.dispatchEvent(l,"mouseover");let h=r?.parent;for(;h&&h!==this.rootTarget.parent&&h!==e.target;)h=h.parent;if(!h||h===this.rootTarget.parent){const u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==r&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}const o=this.moveOnAll?"all":"dispatchEvent";this[o](e,"pointermove"),this.all(e,"globalpointermove"),"touch"===e.pointerType&&(this[o](e,"touchmove"),this.all(e,"globaltouchmove")),i&&(this[o](e,"mousemove"),this.all(e,"globalmousemove"),this.cursor=e.target?.cursor),s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Nn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof Nn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,s=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const o=this.createPointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Nn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType?this.dispatchEvent(i,"touchend"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.dispatchEvent(i,2===i.button?"rightup":"mouseup");const s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[t.button]);let o=r;if(r&&!i.composedPath().includes(r)){let a=r;for(;a&&!i.composedPath().includes(a);)i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),a=a.parent;delete s.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const l=s.clicksByButton[t.button];l.target===a.target&&e-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=e,a.detail=l.clickCount,"mouse"===a.pointerType?this.dispatchEvent(a,"click"):"touch"===a.pointerType&&this.dispatchEvent(a,"tap"),this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Nn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let r=i;for(;r;)s.currentTarget=r,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?this.notifyTarget(s,"touchendoutside"):("mouse"===s.pointerType||"pen"===s.pointerType)&&this.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof ld))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const s=this.allocateEvent(Nn);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y),"string"==typeof e&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(ld);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Nn);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Nn&&e instanceof Nn&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof dh&&e instanceof dh&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.fn.call(i.context,t);else for(let s=0,r=i.length;s<r&&!t.propagationImmediatelyStopped;s++)i[s].fn.call(i[s].context,t)}}const kI={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class f_{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new NI(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Nn(null),this.rootWheelEvent=new ld(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){const o=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let r=0,o=s.length;r<o;r++){const a=this.bootstrapEvent(this.rootPointerEvent,s[r]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s;s=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=this.domElement.width/s.width*(e-s.left)*r,t.y=this.domElement.height/s.height*(i-s.top)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){const r=t.changedTouches[i];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=1),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=kI[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}f_.extension={name:"events",type:[Pt.RendererSystem,Pt.CanvasRendererSystem]},Xt.add(f_);const GI={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(n,t,e){const s="function"==typeof t?void 0:t;this.on(n="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${n}capture`:n,t="function"==typeof t?t:t.handleEvent,s)},removeEventListener(n,t,e){const s="function"==typeof t?void 0:t;this.off(n="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${n}capture`:n,t="function"==typeof t?t:t.handleEvent,s)},dispatchEvent(n){if(!(n instanceof ba))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=null,n.target=this,n.manager.dispatchEvent(n),!n.defaultPrevented}};ci.mixin(GI),ci.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class g_{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(us.tablet||us.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(us.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:s,height:r}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=s/o*l,c=r/a*l;let u=this.div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,fo(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(u.style.left=(m.tx+p.x*m.a)*h+"px",u.style.top=(m.ty+p.y*m.d)*c+"px",u.style.width=p.width*m.a*h+"px",u.style.height=p.height*m.d*c+"px"):(p=f.getBounds(),this.capHitArea(p),u.style.left=p.x*h+"px",u.style.top=p.y*c+"px",u.style.width=p.width*h+"px",u.style.height=p.height*c+"px",u.title!==f.accessibleTitle&&null!==f.accessibleTitle&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&null!==f.accessibleHint&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,r=Object.assign(new ba(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>s.dispatchEvent(r,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}g_.extension={name:"accessibility",type:[Pt.RendererPlugin,Pt.CanvasRendererPlugin]},Xt.add(g_);const cd=class{constructor(n){this.stage=new cn,n=Object.assign({forceCanvas:!1},n),this.renderer=function IC(n){for(const t of i_)if(t.test(n))return new t(n);throw new Error("Unable to auto-detect a suitable renderer.")}(n),cd._plugins.forEach(t=>{t.init.call(this,n)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(n,t){const e=cd._plugins.slice(0);e.reverse(),e.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(n),this.renderer=null}};let ph=cd;ph._plugins=[],Xt.handleByList(Pt.Application,ph._plugins);class __{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,i;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:r}=this._resizeTo;e=s,i=r}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}__.extension=Pt.Application,Xt.add(__);const y_={loader:Pt.LoadParser,resolver:Pt.ResolveParser,cache:Pt.CacheParser,detection:Pt.DetectionParser};Xt.handle(Pt.Asset,n=>{const t=n.ref;Object.entries(y_).filter(([e])=>!!t[e]).forEach(([e,i])=>Xt.add(Object.assign(t[e],{extension:t[e].extension??i})))},n=>{const t=n.ref;Object.keys(y_).filter(e=>!!t[e]).forEach(e=>Xt.remove(t[e]))});class $I{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){var t=this;return(0,Nt.Z)(function*(){if(t._assetList.length&&t._isActive){t._isLoading=!0;const e=[],i=Math.min(t._assetList.length,t._maxConcurrent);for(let s=0;s<i;s++)e.push(t._assetList.pop());yield t._loader.load(e),t._isLoading=!1,t._next()}})()}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function mh(n,t){const e=n.split("?")[0],i=Fi.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const fs=(n,t)=>(Array.isArray(n)||(n=[n]),t?n.map(e=>"string"==typeof e?t(e):e):n),wa=new class qI{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=fs(t);let s;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(e)){s=l.getCacheableAssets(i,e);break}}s||(s={},i.forEach(a=>{s[a]=e}));const r=Object.keys(s),o={cacheKeys:r,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),r.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),e instanceof Vt){const a=e;i.forEach(l=>{a.baseTexture!==Vt.EMPTY.baseTexture&&_e.addToCache(a.baseTexture,l),Vt.addToCache(a,l)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach(s=>{this._cache.delete(s)}),e.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}},gh=n=>!Array.isArray(n);class jI{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){var i=this;const s={promise:null,parser:null};return s.promise=(0,Nt.Z)(function*(){let r=null;for(let o=0;o<i.parsers.length;o++){const a=i.parsers[o];if(a.load&&a.test?.(t,e,i)){r=yield a.load(t,e,i),s.parser=a;break}}if(!s.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let o=0;o<i.parsers.length;o++){const a=i.parsers[o];a.parse&&a.parse&&(yield a.testParse?.(r,e,i))&&(r=(yield a.parse(r,e,i))||r,s.parser=a)}return r})(),s}load(t,e){var i=this;return(0,Nt.Z)(function*(){let s=0;const r={},o=gh(t),a=fs(t,c=>({src:c})),l=a.length,h=a.map(function(){var c=(0,Nt.Z)(function*(u){const d=Fi.toAbsolute(u.src);if(!r[u.src])try{i.promiseCache[d]||(i.promiseCache[d]=i._getLoadPromiseAndParser(d,u)),r[u.src]=yield i.promiseCache[d].promise,e&&e(++s/l)}catch(f){throw delete i.promiseCache[d],delete r[u.src],new Error(`[Loader.load] Failed to load ${d}.\n${f}`)}});return function(u){return c.apply(this,arguments)}}());return yield Promise.all(h),o?r[a[0].src]:r})()}unload(t){var e=this;return(0,Nt.Z)(function*(){const s=fs(t,r=>({src:r})).map(function(){var r=(0,Nt.Z)(function*(o){const a=Fi.toAbsolute(o.src),l=e.promiseCache[a];if(l){const h=yield l.promise;l.parser?.unload?.(h,o,e),delete e.promiseCache[a]}});return function(o){return r.apply(this,arguments)}}());yield Promise.all(s)})()}get parsers(){return this._parsers}}var Jn=(n=>(n[n.Low=0]="Low",n[n.Normal=1]="Normal",n[n.High=2]="High",n))(Jn||{});const JI={extension:{type:Pt.LoadParser,priority:Jn.Low},test:n=>".json"===Fi.extname(n).toLowerCase(),load:n=>(0,Nt.Z)(function*(){return yield(yield Bt.ADAPTER.fetch(n)).json()})()};Xt.add(JI);const KI={extension:{type:Pt.LoadParser,priority:Jn.Low},test:n=>".txt"===Fi.extname(n).toLowerCase(),load:n=>(0,Nt.Z)(function*(){return yield(yield Bt.ADAPTER.fetch(n)).text()})()};function x_(n,t){if(Array.isArray(t)){for(const e of t)if(n.startsWith(`data:${e}`))return!0;return!1}return n.startsWith(`data:${t}`)}Xt.add(KI);const QI=["normal","bold","100","200","300","400","500","600","700","800","900"],tR=[".ttf",".otf",".woff",".woff2"],eR=["font/ttf","font/otf","font/woff","font/woff2"],nR={extension:{type:Pt.LoadParser,priority:Jn.Low},test:n=>x_(n,eR)||mh(n,tR),load:(n,t)=>(0,Nt.Z)(function*(){if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=Bt.ADAPTER.getFontFaceSet();if(e){const i=[],s=t.data?.family??function iR(n){const t=Fi.extname(n);return Fi.basename(n,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}(n),r=t.data?.weights?.filter(a=>QI.includes(a))??["normal"],o=t.data??{};for(let a=0;a<r.length;a++){const l=r[a],h=new FontFace(s,`url(${encodeURI(n)})`,{...o,weight:l});yield h.load(),e.add(h),i.push(h)}return 1===i.length?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})(),unload(n){(Array.isArray(n)?n:[n]).forEach(t=>Bt.ADAPTER.getFontFaceSet().delete(t))}};Xt.add(nR);let ud,v_=0;const sR_code="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",rR_code="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let dd;const b_=new class oR{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([sR_code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)})})),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}_initWorkers(){var t=this;return(0,Nt.Z)(function*(){t._initialized||(t._initialized=!0)})()}getWorker(){void 0===ud&&(ud=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<ud&&(dd||(dd=URL.createObjectURL(new Blob([rR_code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(dd),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}_run(t,e){var i=this;return(0,Nt.Z)(function*(){yield i._initWorkers();const s=new Promise((r,o)=>{i.queue.push({id:t,arguments:e,resolve:r,reject:o})});return i.next(),s})()}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[v_]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:v_++,id:i})}};function _h(n,t,e){const i=new Vt(n);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),i}const aR=[".jpeg",".jpg",".png",".webp",".avif"],lR=["image/jpeg","image/png","image/webp","image/avif"];function fd(){return fd=(0,Nt.Z)(function*(n){const t=yield Bt.ADAPTER.fetch(n);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${n}: ${t.status} ${t.statusText}`);const e=yield t.blob();return yield createImageBitmap(e)}),fd.apply(this,arguments)}const Ma={extension:{type:Pt.LoadParser,priority:Jn.High},config:{preferWorkers:!0},test:n=>x_(n,lR)||mh(n,aR),load(n,t,e){var i=this;return(0,Nt.Z)(function*(){let s=null;s=globalThis.createImageBitmap?i.config.preferWorkers&&(yield b_.isImageBitmapSupported())?yield b_.loadImageBitmap(n):yield function hR(n){return fd.apply(this,arguments)}(n):yield new Promise(o=>{s=new Image,s.crossOrigin="anonymous",s.src=n,s.complete?o(s):s.onload=()=>{o(s)}});const r=new _e(s,{resolution:Is(n),...t.data});return r.resource.src=n,_h(r,e,n)})()},unload(n){n.destroy(!0)}};Xt.add(Ma);const cR={extension:{type:Pt.LoadParser,priority:Jn.High},test:n=>".svg"===Fi.extname(n).toLowerCase(),testParse:n=>(0,Nt.Z)(function*(){return _a.test(n)})(),parse:(n,t,e)=>(0,Nt.Z)(function*(){const i=new _a(n,t?.data?.resourceOptions),s=new _e(i,{resolution:Is(n),...t?.data});s.resource.src=n;const r=_h(s,e,n);return t?.data?.resourceOptions?.autoLoad||(yield i.load()),r})(),load:(n,t)=>(0,Nt.Z)(function*(){return(yield Bt.ADAPTER.fetch(n)).text()})(),unload:Ma.unload};function w_(n,t,e,i,s){const r=t[e];for(let o=0;o<r.length;o++){const a=r[o];e<t.length-1?w_(n.replace(i[e],a),t,e+1,i,s):s.push(n.replace(i[e],a))}}function uR(n){const e=n.match(/\{(.*?)\}/g),i=[];if(e){const s=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");s.push(o)}),w_(n,s,0,e,i)}else i.push(n);return i}Xt.add(cR);class dR{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,e)=>`${t}${this._bundleIdConnector}${e}`,this._extractAssetIdFromBundle=(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(s=>{if("string"==typeof s.name){const r=this._createBundleAssetId(t,s.name);i.push(r),this.add([s.name,r],s.srcs,s.data)}else{const r=s.name.map(o=>this._createBundleAssetId(t,o));r.forEach(o=>{i.push(o)}),this.add([...s.name,...r],s.srcs)}}):Object.keys(e).forEach(s=>{i.push(this._createBundleAssetId(t,s)),this.add([s,this._createBundleAssetId(t,s)],e[s])}),this._bundles[t]=i}add(t,e,i){const s=fs(t);s.forEach(o=>{this._assetMap[o]&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(e)||(e="string"==typeof e?uR(e):[e]);const r=e.map(o=>{let a=o;if("string"==typeof o){let l=!1;for(let h=0;h<this._parsers.length;h++){const c=this._parsers[h];if(c.test(o)){a=c.parse(o),l=!0;break}}l||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=s),(this._basePath||this._rootPath)&&(a.src=Fi.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??i,a});s.forEach(o=>{this._assetMap[o]=r})}resolveBundle(t){const e=gh(t);t=fs(t);const i={};return t.forEach(s=>{const r=this._bundles[s];if(r){const o=this.resolve(r),a={};for(const l in o){const h=o[l];a[this._extractAssetIdFromBundle(s,l)]=h}i[s]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const i={};for(const s in e)i[s]=e[s].src;return i}return e.src}resolve(t){const e=gh(t);t=fs(t);const i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let r=this._assetMap[s];const o=this._getPreferredOrder(r),a=r[0];o?.priority.forEach(l=>{o.params[l].forEach(h=>{const c=r.filter(u=>!!u[l]&&u[l]===h);c.length&&(r=c)})}),this._resolverHash[s]=r[0]??a}else{let r=s;(this._basePath||this._rootPath)&&(r=Fi.toAbsolute(r,this._basePath,this._rootPath)),r=this._appendDefaultSearchParams(r),this._resolverHash[s]={src:r}}i[s]=this._resolverHash[s]}),e?i[t[0]]:i}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],s=this._preferredOrder.find(r=>r.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){return this._defaultSearchParams?`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`:t}}const yh=new class fR{constructor(){this._detections=[],this._initialized=!1,this.resolver=new dR,this.loader=new jI,this.cache=wa,this._backgroundLoader=new $I(this.loader),this._backgroundLoader.active=!0,this.reset()}init(t={}){var e=this;return(0,Nt.Z)(function*(){if(e._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(e._initialized=!0,t.defaultSearchParams&&e.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(e.resolver.basePath=t.basePath),t.bundleIdentifier&&e.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;"string"==typeof o&&(o=yield e.load(o)),e.resolver.addManifest(o)}const i=t.texturePreference?.resolution??1,s="number"==typeof i?[i]:i;let r=[];if(t.texturePreference?.format){const o=t.texturePreference?.format;r="string"==typeof o?[o]:o;for(const a of e._detections)(yield a.test())||(r=yield a.remove(r))}else for(const o of e._detections)(yield o.test())&&(r=yield o.add(r));e.resolver.prefer({params:{format:r,resolution:s}})})()}add(t,e,i){this.resolver.add(t,e,i)}load(t,e){var i=this;return(0,Nt.Z)(function*(){i._initialized||(yield i.init());const s=gh(t),r=fs(t).map(l=>"string"!=typeof l?(i.resolver.add(l.src,l),l.src):l),o=i.resolver.resolve(r),a=yield i._mapLoadToResolve(o,e);return s?a[r[0]]:a})()}addBundle(t,e){this.resolver.addBundle(t,e)}loadBundle(t,e){var i=this;return(0,Nt.Z)(function*(){i._initialized||(yield i.init());let s=!1;"string"==typeof t&&(s=!0,t=[t]);const r=i.resolver.resolveBundle(t),o={},a=Object.keys(r);let l=0,h=0;const c=()=>{e?.(++l/h)},u=a.map(d=>{const f=r[d];return h+=Object.keys(f).length,i._mapLoadToResolve(f,c).then(p=>{o[d]=p})});return yield Promise.all(u),s?o[t[0]]:o})()}backgroundLoad(t){var e=this;return(0,Nt.Z)(function*(){e._initialized||(yield e.init()),"string"==typeof t&&(t=[t]);const i=e.resolver.resolve(t);e._backgroundLoader.add(Object.values(i))})()}backgroundLoadBundle(t){var e=this;return(0,Nt.Z)(function*(){e._initialized||(yield e.init()),"string"==typeof t&&(t=[t]);const i=e.resolver.resolveBundle(t);Object.values(i).forEach(s=>{e._backgroundLoader.add(Object.values(s))})})()}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return wa.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=wa.get(t[i]);return e}_mapLoadToResolve(t,e){var i=this;return(0,Nt.Z)(function*(){const s=Object.values(t),r=Object.keys(t);i._backgroundLoader.active=!1;const o=yield i.loader.load(s,e);i._backgroundLoader.active=!0;const a={};return s.forEach((l,h)=>{const c=o[l.src],u=[l.src];l.alias&&u.push(...l.alias),a[r[h]]=c,wa.set(u,c)}),a})()}unload(t){var e=this;return(0,Nt.Z)(function*(){e._initialized||(yield e.init());const i=fs(t).map(r=>"string"!=typeof r?r.src:r),s=e.resolver.resolve(i);yield e._unloadFromResolved(s)})()}unloadBundle(t){var e=this;return(0,Nt.Z)(function*(){e._initialized||(yield e.init()),t=fs(t);const i=e.resolver.resolveBundle(t),s=Object.keys(i).map(r=>e._unloadFromResolved(i[r]));yield Promise.all(s)})()}_unloadFromResolved(t){var e=this;return(0,Nt.Z)(function*(){const i=Object.values(t);i.forEach(s=>{wa.remove(s.src)}),yield e.loader.unload(i)})()}get detections(){return this._detections}get preferWorkers(){return Ma.config.preferWorkers}set preferWorkers(t){Ma.config.preferWorkers=t}};Xt.handleByList(Pt.LoadParser,yh.loader.parsers).handleByList(Pt.ResolveParser,yh.resolver.parsers).handleByList(Pt.CacheParser,yh.cache.parsers).handleByList(Pt.DetectionParser,yh.detections);const pR={extension:Pt.CacheParser,test:n=>Array.isArray(n)&&n.every(t=>t instanceof Vt),getCacheableAssets:(n,t)=>{const e={};return n.forEach(i=>{t.forEach((s,r)=>{e[i+(0===r?"":r+1)]=s})}),e}};Xt.add(pR);const mR={extension:{type:Pt.DetectionParser,priority:1},test:function(){var n=(0,Nt.Z)(function*(){if(!globalThis.createImageBitmap)return!1;const e=yield Bt.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)});return function(){return n.apply(this,arguments)}}(),add:function(){var n=(0,Nt.Z)(function*(t){return[...t,"avif"]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Nt.Z)(function*(t){return t.filter(e=>"avif"!==e)});return function(e){return n.apply(this,arguments)}}()};Xt.add(mR);const gR={extension:{type:Pt.DetectionParser,priority:0},test:function(){var n=(0,Nt.Z)(function*(){if(!globalThis.createImageBitmap)return!1;const e=yield Bt.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)});return function(){return n.apply(this,arguments)}}(),add:function(){var n=(0,Nt.Z)(function*(t){return[...t,"webp"]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Nt.Z)(function*(t){return t.filter(e=>"webp"!==e)});return function(e){return n.apply(this,arguments)}}()};Xt.add(gR);const M_=["png","jpg","jpeg"],_R={extension:{type:Pt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:function(){var n=(0,Nt.Z)(function*(t){return[...t,...M_]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Nt.Z)(function*(t){return t.filter(e=>!M_.includes(e))});return function(e){return n.apply(this,arguments)}}()};Xt.add(_R);const yR={extension:Pt.ResolveParser,test:Ma.test,parse:n=>({resolution:parseFloat(Bt.RETINA_PREFIX.exec(n)?.[1]??"1"),format:n.split(".").pop(),src:n})};Xt.add(yR);const pd=(n,t)=>{const e=t.split("?")[1];return e&&(n+=`?${e}`),n};var un=(n=>(n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n))(un||{});const xh={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let ps,wo;function S_(){wo={s3tc:ps.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ps.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:ps.getExtension("WEBGL_compressed_texture_etc"),etc1:ps.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:ps.getExtension("WEBGL_compressed_texture_pvrtc")||ps.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:ps.getExtension("WEBGL_compressed_texture_atc"),astc:ps.getExtension("WEBGL_compressed_texture_astc")}}const xR={extension:{type:Pt.DetectionParser,priority:2},test:function(){var n=(0,Nt.Z)(function*(){const e=Bt.ADAPTER.createCanvas().getContext("webgl");return e?(ps=e,!0):(console.warn("WebGL not available for compressed textures."),!1)});return function(){return n.apply(this,arguments)}}(),add:function(){var n=(0,Nt.Z)(function*(t){wo||S_();const e=[];for(const i in wo)!wo[i]||e.push(i);return[...e,...t]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Nt.Z)(function*(t){return wo||S_(),t.filter(e=>!(e in wo))});return function(e){return n.apply(this,arguments)}}()};Xt.add(xR);class vR extends da{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;"string"==typeof t?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new Ou(s):null,this.origin&&!1!==e.autoLoad&&this.load(),s?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){var t=this;return(0,Nt.Z)(function*(){const s=yield(yield(yield fetch(t.origin)).blob()).arrayBuffer();return t.data=new Uint32Array(s),t.buffer=new Ou(s),t.loaded=!0,t.onBlobLoaded(s),t.update(),t})()}}class vr extends vR{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=vr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||vr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:l,levelWidth:h,levelHeight:c,levelBuffer:u}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,l,this.format,h,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=vr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,s,r,o,a){const l=new Array(i);let h=t.byteOffset,c=o,u=a,d=c+s-1&~(s-1),f=u+r-1&~(r-1),p=d*f*xh[e];for(let m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?c:d,levelHeight:i>1?u:f,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),f=u+r-1&~(r-1),p=d*f*xh[e];return l}}const NR={827611204:un.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:un.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:un.COMPRESSED_RGBA_S3TC_DXT5_EXT},UR={70:un.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:un.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:un.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:un.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:un.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:un.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:un.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:un.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:un.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},E_=[171,75,84,88,32,49,49,187,13,10,26,10],A_={[Qt.UNSIGNED_BYTE]:1,[Qt.UNSIGNED_SHORT]:2,[Qt.INT]:4,[Qt.UNSIGNED_INT]:4,[Qt.FLOAT]:4,[Qt.HALF_FLOAT]:8},zR={[St.RGBA]:4,[St.RGB]:3,[St.RG]:2,[St.RED]:1,[St.LUMINANCE]:1,[St.LUMINANCE_ALPHA]:2,[St.ALPHA]:1},HR={[Qt.UNSIGNED_SHORT_4_4_4_4]:2,[Qt.UNSIGNED_SHORT_5_5_5_1]:2,[Qt.UNSIGNED_SHORT_5_6_5]:2};function XR(n){switch(n){case St.RGBA:return St.RGBA_INTEGER;case St.RGB:return St.RGB_INTEGER;case St.RG:return St.RG_INTEGER;case St.RED:return St.RED_INTEGER;default:return n}}const ZR={extension:{type:Pt.LoadParser,priority:Jn.High},test:n=>mh(n,".dds"),load:(n,t,e)=>(0,Nt.Z)(function*(){const o=function kR(n){const t=new Uint32Array(n);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(n,0,124/Uint32Array.BYTES_PER_ELEMENT),s=i[3],r=i[4],o=i[7],a=new Uint32Array(n,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),l=a[1];if(4&l){const h=a[2];if(808540228!==h){const y=NR[h],M=new Uint8Array(n,128);return[new vr(M,{format:y,width:r,height:s,levels:o})]}const u=new Uint32Array(t.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=u[0],f=u[1],p=u[2],m=u[3],g=UR[d];if(void 0===g)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(4===p)throw new Error("DDSParser does not support cubemap textures");if(6===f)throw new Error("DDSParser does not supported 3D texture data");const x=new Array,v=148;if(1===m)x.push(new Uint8Array(n,v));else{const y=xh[g];let b=0,M=r,S=s;for(let w=0;w<o;w++)b+=Math.max(1,M+3&-4)*Math.max(1,S+3&-4)*y,M>>>=1,S>>>=1;let A=v;for(let w=0;w<m;w++)x.push(new Uint8Array(n,A,b)),A+=b}return x.map(y=>new vr(y,{format:g,width:r,height:s,levels:o}))}throw 64&l?new Error("DDSParser does not support uncompressed texture data."):512&l?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&l?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&l?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(yield(yield Bt.ADAPTER.fetch(n)).arrayBuffer()).map(a=>_h(new _e(a,{mipmap:Zn.OFF,alphaMode:In.NO_PREMULTIPLIED_ALPHA,resolution:Is(n),...t.data}),e,n));return 1===o.length?o[0]:o})(),unload(n){Array.isArray(n)?n.forEach(t=>t.destroy(!0)):n.destroy(!0)}};Xt.add(ZR);const $R={extension:{type:Pt.LoadParser,priority:Jn.High},test:n=>mh(n,".ktx"),load:(n,t,e)=>(0,Nt.Z)(function*(){const s=yield(yield Bt.ADAPTER.fetch(n)).arrayBuffer(),{compressed:r,uncompressed:o,kvData:a}=function WR(n,t,e=!1){const i=new DataView(t);if(!function VR(n,t){for(let e=0;e<E_.length;e++)if(t.getUint8(e)!==E_[e])return console.error(`${n} is not a valid *.ktx file!`),!1;return!0}(n,i))return null;const s=67305985===i.getUint32(12,!0),r=i.getUint32(16,s),o=i.getUint32(24,s),a=i.getUint32(28,s),l=i.getUint32(36,s),h=i.getUint32(40,s)||1,c=i.getUint32(44,s)||1,u=i.getUint32(48,s)||1,d=i.getUint32(52,s),f=i.getUint32(56,s),p=i.getUint32(60,s);if(0===h||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const x=l+3&-4,v=h+3&-4,y=new Array(u);let M,b=l*h;if(0===r&&(b=x*v),M=0!==r?A_[r]?A_[r]*zR[o]:HR[r]:xh[a],void 0===M)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const S=e?function YR(n,t,e){const i=new Map;let s=0;for(;s<t;){const r=n.getUint32(64+s,e),o=64+s+4,a=3-(r+3)%4;if(0===r||r>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<r&&0!==n.getUint8(o+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=(new TextDecoder).decode(new Uint8Array(n.buffer,o,l)),c=new DataView(n.buffer,o+l+1,r-l-1);i.set(h,c),s+=4+r+a}return i}(i,p,s):null;let w=b*M,T=l,C=h,F=x,Y=v,O=64+p;for(let D=0;D<f;D++){const V=i.getUint32(O,s);let X=O+4;for(let j=0;j<u;j++){let $=y[j];$||($=y[j]=new Array(f)),$[D]={levelID:D,levelWidth:f>1||0!==r?T:F,levelHeight:f>1||0!==r?C:Y,levelBuffer:new Uint8Array(t,X,w)},X+=w}O+=V+4,O=O%4!=0?O+4-O%4:O,T=T>>1||1,C=C>>1||1,F=T+4-1&-4,Y=C+4-1&-4,w=F*Y*M}return 0!==r?{uncompressed:y.map(D=>{let V=D[0].levelBuffer,X=!1;return r===Qt.FLOAT?V=new Float32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4):r===Qt.UNSIGNED_INT?(X=!0,V=new Uint32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4)):r===Qt.INT&&(X=!0,V=new Int32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4)),{resource:new da(V,{width:D[0].levelWidth,height:D[0].levelHeight}),type:r,format:X?XR(o):o}}),kvData:S}:{compressed:y.map(D=>new vr(null,{format:a,width:l,height:h,levels:f,levelBuffers:D})),kvData:S}}(n,s),l=r??o,h={mipmap:Zn.OFF,alphaMode:In.NO_PREMULTIPLIED_ALPHA,resolution:Is(n),...t.data},c=l.map(u=>{l===o&&Object.assign(h,{type:u.type,format:u.format});const d=new _e(u,h);return d.ktxKeyValueData=a,_h(d,e,n)});return 1===c.length?c[0]:c})(),unload(n){Array.isArray(n)?n.forEach(t=>t.destroy(!0)):n.destroy(!0)}};Xt.add($R);const qR={extension:Pt.ResolveParser,test:n=>{const e=n.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:n=>{if("ktx"===n.split("?")[0].split(".").pop()){const i=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(i.some(s=>n.endsWith(s)))return{resolution:parseFloat(Bt.RETINA_PREFIX.exec(n)?.[1]??"1"),format:i.find(s=>n.endsWith(s)),src:n}}return{resolution:parseFloat(Bt.RETINA_PREFIX.exec(n)?.[1]??"1"),format:n.split(".").pop(),src:n}}};Xt.add(qR);const C_=new Se,_d=class{constructor(n){this.renderer=n}image(n,t,e){var i=this;return(0,Nt.Z)(function*(){const s=new Image;return s.src=yield i.base64(n,t,e),s})()}base64(n,t,e){var i=this;return(0,Nt.Z)(function*(){const s=i.canvas(n);if(void 0!==s.toDataURL)return s.toDataURL(t,e);if(void 0!==s.convertToBlob){const r=yield s.convertToBlob({type:t,quality:e});return yield new Promise(o=>{const a=new FileReader;a.onload=()=>o(a.result),a.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")})()}canvas(n,t){const e=this.renderer;let i,r,s=!1,o=!1;n&&(n instanceof Ls?r=n:(r=this.renderer.generateTexture(n),o=!0)),r?(i=r.baseTexture.resolution,t=t??r.frame,s=!1,e.renderTexture.bind(r)):(i=e.resolution,t||((t=C_).width=e.width,t.height=e.height),s=!0,e.renderTexture.bind(null));const a=Math.round(t.width*i),l=Math.round(t.height*i);let h=new ag(a,l,1);const c=new Uint8Array(4*a*l),u=e.gl;u.readPixels(Math.round(t.x*i),Math.round(t.y*i),a,l,u.RGBA,u.UNSIGNED_BYTE,c);const d=h.context.getImageData(0,0,a,l);if(_d.arrayPostDivide(c,d.data),h.context.putImageData(d,0,0),s){const f=new ag(h.width,h.height,1);f.context.scale(1,-1),f.context.drawImage(h.canvas,0,-l),h.destroy(),h=f}return o&&r.destroy(!0),h.canvas}pixels(n,t){const e=this.renderer;let i,s,r=!1;n&&(n instanceof Ls?s=n:(s=this.renderer.generateTexture(n),r=!0)),s?(i=s.baseTexture.resolution,t=t??s.frame,e.renderTexture.bind(s)):(i=e.resolution,t||((t=C_).width=e.width,t.height=e.height),e.renderTexture.bind(null));const o=Math.round(t.width*i),a=Math.round(t.height*i),l=new Uint8Array(4*o*a),h=e.gl;return h.readPixels(Math.round(t.x*i),Math.round(t.y*i),o,a,h.RGBA,h.UNSIGNED_BYTE,l),r&&s.destroy(!0),_d.arrayPostDivide(l,l),l}destroy(){this.renderer=null}static arrayPostDivide(n,t){for(let e=0;e<n.length;e+=4){const i=t[e+3]=n[e+3];0!==i?(t[e]=Math.round(Math.min(255*n[e]/i,255)),t[e+1]=Math.round(Math.min(255*n[e+1]/i,255)),t[e+2]=Math.round(Math.min(255*n[e+2]/i,255))):(t[e]=n[e],t[e+1]=n[e+1],t[e+2]=n[e+2])}}};let R_=_d;R_.extension={name:"extract",type:Pt.RendererSystem},Xt.add(R_);const Sa={build(n){const t=n.points;let e,i,s,r,o,a;if(n.type===Ni.CIRC){const p=n.shape;e=p.x,i=p.y,o=a=p.radius,s=r=0}else if(n.type===Ni.ELIP){const p=n.shape;e=p.x,i=p.y,o=p.width,a=p.height,s=r=0}else{const p=n.shape,m=p.width/2,g=p.height/2;e=p.x+m,i=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-o,r=g-a}if(!(o>=0&&a>=0&&s>=0&&r>=0))return void(t.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),h=8*l+(s?4:0)+(r?4:0);if(t.length=h,0===h)return;if(0===l)return t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+r,t[2]=t[4]=e-s,void(t[5]=t[7]=i-r);let c=0,u=4*l+(s?2:0)+2,d=u,f=h;{const p=s+o,m=r,g=e+p,x=e-p,v=i+m;if(t[c++]=g,t[c++]=v,t[--u]=v,t[--u]=x,r){const y=i-m;t[d++]=x,t[d++]=y,t[--f]=y,t[--f]=g}}for(let p=1;p<l;p++){const m=Math.PI/2*(p/l),g=s+Math.cos(m)*o,x=r+Math.sin(m)*a,v=e+g,y=e-g,b=i+x,M=i-x;t[c++]=v,t[c++]=b,t[--u]=b,t[--u]=y,t[d++]=y,t[d++]=M,t[--f]=M,t[--f]=v}{const m=r+a,g=e+s,x=e-s,v=i+m,y=i-m;t[c++]=g,t[c++]=v,t[--f]=y,t[--f]=g,s&&(t[c++]=x,t[c++]=v,t[--f]=y,t[--f]=x)}},triangulate(n,t){const e=n.points,i=t.points,s=t.indices;if(0===e.length)return;let r=i.length/2;const o=r;let a,l;if(n.type!==Ni.RREC){const c=n.shape;a=c.x,l=c.y}else{const c=n.shape;a=c.x+c.width/2,l=c.y+c.height/2}const h=n.matrix;i.push(n.matrix?h.a*a+h.c*l+h.tx:a,n.matrix?h.b*a+h.d*l+h.ty:l),r++,i.push(e[0],e[1]);for(let c=2;c<e.length;c+=2)i.push(e[c],e[c+1]),s.push(r++,o,r);s.push(o+1,o,r)}};function P_(n,t=!1){const e=n.length;if(e<6)return;let i=0;for(let s=0,r=n[e-2],o=n[e-1];s<e;s+=2){const a=n[s],l=n[s+1];i+=(a-r)*(l+o),r=a,o=l}if(!t&&i>0||t&&i<=0){const s=e/2;for(let r=s+s%2;r<e;r+=2){const o=e-r-2,a=e-r-1,l=r,h=r+1;[n[o],n[l]]=[n[l],n[o]],[n[a],n[h]]=[n[h],n[a]]}}}const yd={build(n){n.points=n.shape.points.slice()},triangulate(n,t){let e=n.points;const i=n.holes,s=t.points,r=t.indices;if(e.length>=6){P_(e,!1);const o=[];for(let h=0;h<i.length;h++){const c=i[h];P_(c.points,!0),o.push(e.length/2),e=e.concat(c.points)}const a=vS(e,o,2);if(!a)return;const l=s.length/2;for(let h=0;h<a.length;h+=3)r.push(a[h]+l),r.push(a[h+1]+l),r.push(a[h+2]+l);for(let h=0;h<e.length;h++)s.push(e[h])}}},D_={build(n){const t=n.shape,e=t.x,i=t.y,s=t.width,r=t.height,o=n.points;o.length=0,s>=0&&r>=0&&o.push(e,i,e+s,i,e+s,i+r,e,i+r)},triangulate(n,t){const e=n.points,i=t.points;if(0===e.length)return;const s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},L_={build(n){Sa.build(n)},triangulate(n,t){Sa.triangulate(n,t)}};var Bs=(n=>(n.MITER="miter",n.BEVEL="bevel",n.ROUND="round",n))(Bs||{}),br=(n=>(n.BUTT="butt",n.ROUND="round",n.SQUARE="square",n))(br||{});const Mo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(n,t=20){if(!this.adaptive||!n||isNaN(n))return t;let e=Math.ceil(n/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class xd{static curveTo(t,e,i,s,r,o){const h=o[o.length-1]-e,c=o[o.length-2]-t,u=s-e,d=i-t,f=Math.abs(h*d-c*u);if(f<1e-8||0===r)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const p=h*h+c*c,m=u*u+d*d,g=h*u+c*d,x=r*Math.sqrt(p)/f,v=r*Math.sqrt(m)/f,y=x*g/p,b=v*g/m,M=x*d+v*c,S=x*u+v*h,T=d*(x+b),C=u*(x+b);return{cx:M+t,cy:S+e,radius:r,startAngle:Math.atan2(h*(v+y)-S,c*(v+y)-M),endAngle:Math.atan2(C-S,T-M),anticlockwise:c*u>d*h}}static arc(t,e,i,s,r,o,a,l,h){const c=a-o,u=Mo._segmentsCount(Math.abs(c)*r,40*Math.ceil(Math.abs(c)/jl)),d=c/(2*u),f=2*d,p=Math.cos(d),m=Math.sin(d),g=u-1,x=g%1/g;for(let v=0;v<=g;++v){const b=d+o+f*(v+x*v),M=Math.cos(b),S=-Math.sin(b);h.push((p*M+m*S)*r+i,(p*-S+m*M)*r+s)}}}class Mh{static curveLength(t,e,i,s,r,o,a,l){let c=0,u=0,d=0,f=0,p=0,m=0,g=0,x=0,v=0,y=0,b=0,M=t,S=e;for(let A=1;A<=10;++A)u=A/10,d=u*u,f=d*u,p=1-u,m=p*p,g=m*p,x=g*t+3*m*u*i+3*p*d*r+f*a,v=g*e+3*m*u*s+3*p*d*o+f*l,y=M-x,b=S-v,M=x,S=v,c+=Math.sqrt(y*y+b*b);return c}static curveTo(t,e,i,s,r,o,a){const l=a[a.length-2],h=a[a.length-1];a.length-=2;const c=Mo._segmentsCount(Mh.curveLength(l,h,t,e,i,s,r,o));let u=0,d=0,f=0,p=0,m=0;a.push(l,h);for(let g=1,x=0;g<=c;++g)x=g/c,u=1-x,d=u*u,f=d*u,p=x*x,m=p*x,a.push(f*l+3*d*x*t+3*u*p*i+m*r,f*h+3*d*x*e+3*u*p*s+m*o)}}function O_(n,t,e,i,s,r,o,a){let d,f;o?(d=i,f=-e):(d=-i,f=e);const g=n+e*r+d,x=t+i*r+f;return a.push(n-e*s+d,t-i*s+f),a.push(g,x),2}function wr(n,t,e,i,s,r,o,a){const l=e-n,h=i-t;let c=Math.atan2(l,h),u=Math.atan2(s-n,r-t);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(l*l+h*h),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),x=f/g;if(d+=x,a){o.push(n,t),o.push(e,i);for(let v=1,y=d;v<g;v++,y+=x)o.push(n,t),o.push(n+Math.sin(y)*m,t+Math.cos(y)*m);o.push(n,t),o.push(s,r)}else{o.push(e,i),o.push(n,t);for(let v=1,y=d;v<g;v++,y+=x)o.push(n+Math.sin(y)*m,t+Math.cos(y)*m),o.push(n,t);o.push(s,r),o.push(n,t)}return 2*g}function vd(n,t){n.lineStyle.native?function JR(n,t){let e=0;const i=n.shape,s=n.points||i.points,r=i.type!==Ni.POLY||i.closeStroke;if(0===s.length)return;const o=t.points,a=t.indices,l=s.length/2,h=o.length/2;let c=h;for(o.push(s[0],s[1]),e=1;e<l;e++)o.push(s[2*e],s[2*e+1]),a.push(c,c+1),c++;r&&a.push(c,h)}(n,t):function jR(n,t){const e=n.shape;let i=n.points||e.points.slice();const s=t.closePointEps;if(0===i.length)return;const r=n.lineStyle,o=new ne(i[0],i[1]),a=new ne(i[i.length-2],i[i.length-1]),l=e.type!==Ni.POLY||e.closeStroke,h=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){i=i.slice(),h&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const j=.5*(o.x+a.x),$=.5*(a.y+o.y);i.unshift(j,$),i.push(j,$)}const c=t.points,u=i.length/2;let d=i.length;const f=c.length/2,p=r.width/2,m=p*p,g=r.miterLimit*r.miterLimit;let x=i[0],v=i[1],y=i[2],b=i[3],M=0,S=0,A=-(v-b),w=x-y,T=0,C=0,F=Math.sqrt(A*A+w*w);A/=F,w/=F,A*=p,w*=p;const Y=r.alignment,O=2*(1-Y),D=2*Y;l||(r.cap===br.ROUND?d+=wr(x-A*(O-D)*.5,v-w*(O-D)*.5,x-A*O,v-w*O,x+A*D,v+w*D,c,!0)+2:r.cap===br.SQUARE&&(d+=O_(x,v,A,w,O,D,!0,c))),c.push(x-A*O,v-w*O),c.push(x+A*D,v+w*D);for(let j=1;j<u-1;++j){x=i[2*(j-1)],v=i[2*(j-1)+1],y=i[2*j],b=i[2*j+1],M=i[2*(j+1)],S=i[2*(j+1)+1],A=-(v-b),w=x-y,F=Math.sqrt(A*A+w*w),A/=F,w/=F,A*=p,w*=p,T=-(b-S),C=y-M,F=Math.sqrt(T*T+C*C),T/=F,C/=F,T*=p,C*=p;const $=y-x,et=v-b,pt=y-M,J=S-b,Q=$*pt+et*J,bt=et*pt-J*$,gt=bt<0;if(Math.abs(bt)<.001*Math.abs(Q)){c.push(y-A*O,b-w*O),c.push(y+A*D,b+w*D),Q>=0&&(d+=r.join===Bs.ROUND?wr(y,b,y-A*O,b-w*O,y-T*O,b-C*O,c,!1)+4:2,c.push(y-T*D,b-C*D),c.push(y+T*O,b+C*O));continue}const At=(-A+x)*(-w+b)-(-A+y)*(-w+v),nt=(-T+M)*(-C+b)-(-T+y)*(-C+S),te=($*nt-pt*At)/bt,Lt=(J*At-et*nt)/bt,Kt=(te-y)*(te-y)+(Lt-b)*(Lt-b),Tt=y+(te-y)*O,he=b+(Lt-b)*O,ht=y-(te-y)*D,ot=b-(Lt-b)*D,Ft=gt?O:D;Kt<=Math.min($*$+et*et,pt*pt+J*J)+Ft*Ft*m?r.join===Bs.BEVEL||Kt/m>g?(gt?(c.push(Tt,he),c.push(y+A*D,b+w*D),c.push(Tt,he),c.push(y+T*D,b+C*D)):(c.push(y-A*O,b-w*O),c.push(ht,ot),c.push(y-T*O,b-C*O),c.push(ht,ot)),d+=2):r.join===Bs.ROUND?gt?(c.push(Tt,he),c.push(y+A*D,b+w*D),d+=wr(y,b,y+A*D,b+w*D,y+T*D,b+C*D,c,!0)+4,c.push(Tt,he),c.push(y+T*D,b+C*D)):(c.push(y-A*O,b-w*O),c.push(ht,ot),d+=wr(y,b,y-A*O,b-w*O,y-T*O,b-C*O,c,!1)+4,c.push(y-T*O,b-C*O),c.push(ht,ot)):(c.push(Tt,he),c.push(ht,ot)):(c.push(y-A*O,b-w*O),c.push(y+A*D,b+w*D),r.join===Bs.ROUND?d+=gt?wr(y,b,y+A*D,b+w*D,y+T*D,b+C*D,c,!0)+2:wr(y,b,y-A*O,b-w*O,y-T*O,b-C*O,c,!1)+2:r.join===Bs.MITER&&Kt/m<=g&&(gt?(c.push(ht,ot),c.push(ht,ot)):(c.push(Tt,he),c.push(Tt,he)),d+=2),c.push(y-T*O,b-C*O),c.push(y+T*D,b+C*D),d+=2)}x=i[2*(u-2)],v=i[2*(u-2)+1],y=i[2*(u-1)],b=i[2*(u-1)+1],A=-(v-b),w=x-y,F=Math.sqrt(A*A+w*w),A/=F,w/=F,A*=p,w*=p,c.push(y-A*O,b-w*O),c.push(y+A*D,b+w*D),l||(r.cap===br.ROUND?d+=wr(y-A*(O-D)*.5,b-w*(O-D)*.5,y-A*O,b-w*O,y+A*D,b+w*D,c,!1)+2:r.cap===br.SQUARE&&(d+=O_(y,b,A,w,O,D,!1,c)));const V=t.indices,X=Mo.epsilon*Mo.epsilon;for(let j=f;j<d+f-2;++j)x=c[2*j],v=c[2*j+1],y=c[2*(j+1)],b=c[2*(j+1)+1],M=c[2*(j+2)],S=c[2*(j+2)+1],!(Math.abs(x*(b-S)+y*(S-v)+M*(v-b))<X)&&V.push(j,j+1,j+2)}(n,t)}class Sh{static curveLength(t,e,i,s,r,o){const a=t-2*i+r,l=e-2*s+o,h=2*i-2*t,c=2*s-2*e,u=4*(a*a+l*l),d=4*(a*h+l*c),f=h*h+c*c,p=2*Math.sqrt(u+d+f),m=Math.sqrt(u),g=2*u*m,x=2*Math.sqrt(f),v=d/m;return(g*p+m*d*(p-x)+(4*f*u-d*d)*Math.log((2*m+v+p)/(v+x)))/(4*g)}static curveTo(t,e,i,s,r){const o=r[r.length-2],a=r[r.length-1],l=Mo._segmentsCount(Sh.curveLength(o,a,t,e,i,s));let h=0,c=0;for(let u=1;u<=l;++u){const d=u/l;h=o+(t-o)*d,c=a+(e-a)*d,r.push(h+(t+(i-t)*d-h)*d,c+(e+(s-e)*d-c)*d)}}}const Th={[Ni.POLY]:yd,[Ni.CIRC]:Sa,[Ni.ELIP]:Sa,[Ni.RECT]:D_,[Ni.RREC]:L_},bd=[],Ta=[];class Eh{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new Eh(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class B_{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const So=new ne,F_=class extends fg{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ch,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let n=0;n<this.drawCalls.length;n++)this.drawCalls[n].texArray.clear(),Ta.push(this.drawCalls[n]);this.drawCalls.length=0;for(let n=0;n<this.batches.length;n++){const t=this.batches[n];t.reset(),bd.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(n,t=null,e=null,i=null){const s=new Eh(n,t,e,i);return this.graphicsData.push(s),this.dirty++,this}drawHole(n,t=null){if(!this.graphicsData.length)return null;const e=new Eh(n,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=i.lineStyle,i.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let n=0;n<this.graphicsData.length;++n)this.graphicsData[n].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(n){const t=this.graphicsData;for(let e=0;e<t.length;++e){const i=t[e];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(n,So):So.copyFrom(n),i.shape.contains(So.x,So.y))){let s=!1;if(i.holes)for(let r=0;r<i.holes.length;r++)if(i.holes[r].shape.contains(So.x,So.y)){s=!0;break}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const n=this.uvs,t=this.graphicsData;let e=null,i=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],i=e.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const l=t[a],h=l.fillStyle,c=l.lineStyle;Th[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=0===d?h:c;if(!f.visible)continue;const m=this.indices.length,g=this.points.length/2;f.texture.baseTexture.wrapMode=Cs.REPEAT,0===d?this.processFill(l):this.processLine(l);const x=this.points.length/2-g;0!==x&&(e&&!this._compareStyles(i,f)&&(e.end(m,g),e=null),e||(e=bd.pop()||new B_,e.begin(f,m,g),this.batches.push(e),i=f),this.addUvs(this.points,n,f.texture,g,x,f.matrix))}}const r=this.points.length/2;if(e&&e.end(this.indices.length,r),0===this.batches.length)return void(this.batchable=!0);const o=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(n,t){return!(!n||!t||n.texture.baseTexture!==t.texture.baseTexture||n.color+n.alpha!==t.color+t.alpha||!!n.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let n=0,t=this.graphicsData.length;n<t;n++){const e=this.graphicsData[n],i=e.fillStyle,s=e.lineStyle;if(i&&!i.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const n=this.batches;for(let t=0,e=n.length;t<e;t++){const i=n[t];for(let s=0;s<i.size;s++){const r=i.start+s;this.indicesUint16[r]=this.indicesUint16[r]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const n=this.batches;for(let t=0;t<n.length;t++)if(n[t].style.native)return!1;return this.points.length<2*F_.BATCHABLE_SIZE}buildDrawCalls(){let n=++_e._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Ta.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let i=Ta.pop();i||(i=new Hu,i.texArray=new $u),i.texArray.count=0,i.start=0,i.size=0,i.type=Yn.TRIANGLES;let s=0,r=null,o=0,a=!1,l=Yn.TRIANGLES,h=0;this.drawCalls.push(i);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,l=a?Yn.LINES:Yn.TRIANGLES,r=null,s=d,n++),r!==p&&(r=p,p._batchEnabled!==n&&(s===d&&(n++,s=0,i.size>0&&(i=Ta.pop(),i||(i=new Hu,i.texArray=new $u),this.drawCalls.push(i)),i.start=h,i.size=0,i.texArray.count=0,i.type=l),p.touched=1,p._batchEnabled=n,p._batchLocation=s,p.wrapMode=Cs.REPEAT,i.texArray.elements[i.texArray.count++]=p,s++)),i.size+=u.size,h+=u.size,o=p._batchLocation,this.addColors(t,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(e,o,u.attribSize,u.attribStart)}_e._globalBatch=n,this.packAttributes()}packAttributes(){const n=this.points,t=this.uvs,e=this.colors,i=this.textureIds,s=new ArrayBuffer(3*n.length*4),r=new Float32Array(s),o=new Uint32Array(s);let a=0;for(let l=0;l<n.length/2;l++)r[a++]=n[2*l],r[a++]=n[2*l+1],r[a++]=t[2*l],r[a++]=t[2*l+1],o[a++]=e[l],r[a++]=i[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(n){n.holes.length?yd.triangulate(n,this):Th[n.type].triangulate(n,this)}processLine(n){vd(n,this);for(let t=0;t<n.holes.length;t++)vd(n.holes[t],this)}processHoles(n){for(let t=0;t<n.length;t++){const e=n[t];Th[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const n=this._bounds;n.clear(),n.addVertexData(this.points,0,this.points.length),n.pad(this.boundsPadding,this.boundsPadding)}transformPoints(n,t){for(let e=0;e<n.length/2;e++){const i=n[2*e],s=n[2*e+1];n[2*e]=t.a*i+t.c*s+t.tx,n[2*e+1]=t.b*i+t.d*s+t.ty}}addColors(n,t,e,i,s=0){const o=Ru((t>>16)+(65280&t)+((255&t)<<16),e);n.length=Math.max(n.length,s+i);for(let a=0;a<i;a++)n[s+a]=o}addTextureIds(n,t,e,i=0){n.length=Math.max(n.length,i+e);for(let s=0;s<e;s++)n[i+s]=t}addUvs(n,t,e,i,s,r=null){let o=0;const a=t.length,l=e.frame;for(;o<s;){let c=n[2*(i+o)],u=n[2*(i+o)+1];if(r){const d=r.a*c+r.c*u+r.tx;u=r.b*c+r.d*u+r.ty,c=d}o++,t.push(c/l.width,u/l.height)}const h=e.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(t,e,a,s)}adjustUvs(n,t,e,i){const s=t.baseTexture,r=1e-6,o=e+2*i,a=t.frame,l=a.width/s.width,h=a.height/s.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(n[e]+r),f=Math.floor(n[e+1]+r);for(let p=e+2;p<o;p+=2)d=Math.min(d,Math.floor(n[p]+r)),f=Math.min(f,Math.floor(n[p+1]+r));c-=d,u-=f;for(let p=e;p<o;p+=2)n[p]=(n[p]+c)*l,n[p+1]=(n[p+1]+u)*h}};let N_=F_;N_.BATCHABLE_SIZE=100;class Ah{constructor(){this.color=16777215,this.alpha=1,this.texture=Vt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ah;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Vt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class wd extends Ah{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=br.BUTT,this.join=Bs.MITER,this.miterLimit=10}clone(){const t=new wd;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const KR=new Float32Array(3),Md={},Ch=class extends cn{constructor(n=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ah,this._lineStyle=new wd,this._matrix=null,this._holeMode=!1,this.state=ds.for2d(),this._geometry=n||new N_,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ae.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ch(this._geometry)}set blendMode(n){this.state.blendMode=n}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(n){this._tint=n}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(n=null,t=0,e=1,i=.5,s=!1){return"number"==typeof n&&(n={width:n,color:t,alpha:e,alignment:i,native:s}),this.lineTextureStyle(n)}lineTextureStyle(n){n=Object.assign({width:0,texture:Vt.WHITE,color:n?.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:br.BUTT,join:Bs.MITER,miterLimit:10},n),this.currentPath&&this.startPoly();const t=n.width>0&&n.alpha>0;return t?(n.matrix&&(n.matrix=n.matrix.clone(),n.matrix.invert()),Object.assign(this._lineStyle,{visible:t},n)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const n=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new go,this.currentPath.closeStroke=!1,this.currentPath.points.push(n[t-2],n[t-1]))}else this.currentPath=new go,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(n,t){return this.startPoly(),this.currentPath.points[0]=n,this.currentPath.points[1]=t,this}lineTo(n,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points;return(e[e.length-2]!==n||e[e.length-1]!==t)&&e.push(n,t),this}_initCurve(n=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[n,t]):this.moveTo(n,t)}quadraticCurveTo(n,t,e,i){this._initCurve();const s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),Sh.curveTo(n,t,e,i,s),this}bezierCurveTo(n,t,e,i,s,r){return this._initCurve(),Mh.curveTo(n,t,e,i,s,r,this.currentPath.points),this}arcTo(n,t,e,i,s){this._initCurve(n,t);const o=xd.curveTo(n,t,e,i,s,this.currentPath.points);if(o){const{cx:a,cy:l,radius:h,startAngle:c,endAngle:u,anticlockwise:d}=o;this.arc(a,l,h,c,u,d)}return this}arc(n,t,e,i,s,r=!1){if(i===s)return this;if(!r&&s<=i?s+=jl:r&&i<=s&&(i+=jl),s-i==0)return this;const a=n+Math.cos(i)*e,l=t+Math.sin(i)*e,h=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(a,l)}else this.moveTo(a,l),c=this.currentPath.points;return xd.arc(a,l,n,t,e,i,s,r,c),this}beginFill(n=0,t=1){return this.beginTextureFill({texture:Vt.WHITE,color:n,alpha:t})}beginTextureFill(n){n=Object.assign({texture:Vt.WHITE,color:16777215,alpha:1,matrix:null},n),this.currentPath&&this.startPoly();const t=n.alpha>0;return t?(n.matrix&&(n.matrix=n.matrix.clone(),n.matrix.invert()),Object.assign(this._fillStyle,{visible:t},n)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(n,t,e,i){return this.drawShape(new Se(n,t,e,i))}drawRoundedRect(n,t,e,i,s){return this.drawShape(new Xu(n,t,e,i,s))}drawCircle(n,t,e){return this.drawShape(new Wu(n,t,e))}drawEllipse(n,t,e,i){return this.drawShape(new Vu(n,t,e,i))}drawPolygon(...n){let t,e=!0;const i=n[0];i.points?(e=i.closeStroke,t=i.points):t=Array.isArray(n[0])?n[0]:n;const s=new go(t);return s.closeStroke=e,this.drawShape(s),this}drawShape(n){return this._holeMode?this._geometry.drawHole(n,this._matrix):this._geometry.drawShape(n,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const n=this._geometry.graphicsData;return!(1!==n.length||n[0].shape.type!==Ni.RECT||n[0].matrix||n[0].holes.length||n[0].lineStyle.visible&&n[0].lineStyle.width)}_render(n){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(n)):(n.batch.flush(),this._renderDirect(n))}_populateBatches(){const n=this._geometry,t=this.blendMode,e=n.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=n.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(n.points);for(let i=0;i<e;i++){const s=n.batches[i],r=s.style.color,o=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),a=new Float32Array(n.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),h={vertexData:o,blendMode:t,indices:new Uint16Array(n.indicesUint16.buffer,2*s.start,s.size),uvs:a,_batchRGB:ca(r),_tintRGB:r,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[i]=h}}_renderBatched(n){if(this.batches.length){n.batch.setObjectRenderer(n.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,n.plugins[this.pluginName].render(i)}}}_renderDirect(n){const t=this._resolveDirectShader(n),e=this._geometry,i=this.tint,s=this.worldAlpha,r=t.uniforms,o=e.drawCalls;r.translationMatrix=this.transform.worldTransform,r.tint[0]=(i>>16&255)/255*s,r.tint[1]=(i>>8&255)/255*s,r.tint[2]=(255&i)/255*s,r.tint[3]=s,n.shader.bind(t),n.geometry.bind(e,t),n.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(n,e.drawCalls[a])}_renderDrawCallDirect(n,t){const{texArray:e,type:i,size:s,start:r}=t,o=e.count;for(let a=0;a<o;a++)n.texture.bind(e.elements[a],a);n.geometry.draw(i,s,r)}_resolveDirectShader(n){let t=this.shader;const e=this.pluginName;if(!t){if(!Md[e]){const{maxTextures:i}=n.plugins[e],s=new Int32Array(i);for(let a=0;a<i;a++)s[a]=a;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new ri,default:Ln.from({uSamplers:s},!0)};Md[e]=new jn(n.plugins[e]._shader.program,r)}t=Md[e]}return t}_calculateBounds(){this.finishPoly();const n=this._geometry;if(!n.graphicsData.length)return;const{minX:t,minY:e,maxX:i,maxY:s}=n.bounds;this._bounds.addFrame(this.transform,t,e,i,s)}containsPoint(n){return this.worldTransform.applyInverse(n,Ch._TEMP_POINT),this._geometry.containsPoint(Ch._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const n=ca(this.tint,KR);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],i=e._batchRGB,a=(n[0]*i[0]*255<<16)+(n[1]*i[1]*255<<8)+(0|n[2]*i[2]*255);e._tintRGB=(a>>16)+(65280&a)+((255&a)<<16)}}}calculateVertices(){const n=this.transform._worldID;if(this._transformID===n)return;this._transformID=n;const t=this.transform.worldTransform,e=t.a,i=t.b,s=t.c,r=t.d,o=t.tx,a=t.ty,l=this._geometry.points,h=this.vertexData;let c=0;for(let u=0;u<l.length;u+=2){const d=l[u],f=l[u+1];h[c++]=e*d+s*f+o,h[c++]=r*f+i*d+a}}closePath(){const n=this.currentPath;return n&&(n.closeStroke=!0,this.finishPoly()),this}setMatrix(n){return this._matrix=n,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(n){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(n)}};let To=Ch;To.curves=Mo,To._TEMP_POINT=new ne;class QR{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Sd=new ne,U_=new go,k_=class extends cn{constructor(n,t,e,i=Yn.TRIANGLES){super(),this.geometry=n,this.shader=t,this.state=e||ds.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Bt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(n){this._geometry!==n&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=n,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(n){this.shader=n}get material(){return this.shader}set blendMode(n){this.state.blendMode=n}get blendMode(){return this.state.blendMode}set roundPixels(n){this._roundPixels!==n&&(this._transformID=-1),this._roundPixels=n}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(n){this.shader.tint=n}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(n){this.shader.texture=n}_render(n){this.shader.batchable&&this.drawMode===Yn.TRIANGLES&&this.geometry.buffers[0].data.length<2*k_.BATCHABLE_SIZE?this._renderToBatch(n):this._renderDefault(n)}_renderDefault(n){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),n.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),n.shader.bind(t),n.state.set(this.state),n.geometry.bind(this.geometry,t),n.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(n){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const i=this.material.pluginName;n.batch.setObjectRenderer(n.plugins[i]),n.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,r=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=e[2*d],p=e[2*d+1];u[2*d]=r*f+a*p+h,u[2*d+1]=o*f+l*p+c}if(this._roundPixels){const d=Bt.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=i}calculateUvs(){const n=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=n.data:(this.batchUvs||(this.batchUvs=new QR(n,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(n){if(!this.getBounds().contains(n.x,n.y))return!1;this.worldTransform.applyInverse(n,Sd);const t=this.geometry.getBuffer("aVertexPosition").data,e=U_.points,i=this.geometry.getIndex().data,s=i.length,r=4===this.drawMode?3:1;for(let o=0;o+2<s;o+=r){const a=2*i[o],l=2*i[o+1],h=2*i[o+2];if(e[0]=t[a],e[1]=t[a+1],e[2]=t[l],e[3]=t[l+1],e[4]=t[h],e[5]=t[h+1],U_.contains(Sd.x,Sd.y))return!0}return!1}destroy(n){super.destroy(n),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Td=k_;Td.BATCHABLE_SIZE=100;class tP extends Rs{constructor(t,e,i){super();const s=new _i(t),r=new _i(e,!0),o=new _i(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,Qt.FLOAT).addAttribute("aTextureCoord",r,2,!1,Qt.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class G_ extends jn{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:ri.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||Dn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new Og(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){this._colorDirty&&(this._colorDirty=!1,ig(this._tint,this._alpha,this.uniforms.uColor,this.texture.baseTexture.alphaMode)),this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class z_{constructor(t,e,i){this.geometry=new Rs,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let r=t[s];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||Qt.FLOAT,offset:r.offset},e[s]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new _i(function gA(n,t=null){const e=6*n;if((t=t||new Uint16Array(e)).length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new _i(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new _i(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===Qt.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===Qt.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){const r=this.dynamicProperties[s];r.uploadFunction(t,e,i,r.type===Qt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){const r=this.staticProperties[s];r.uploadFunction(t,e,i,r.type===Qt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class H_ extends nh{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new ri,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Qt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=jn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ds.for2d()}render(t){const e=t.children,i=t._maxSize,s=t._batchSize,r=this.renderer;let o=e.length;if(0===o)return;o>i&&!t.autoResize&&(o=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const l=e[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=eg(t.blendMode,h),r.state.set(this.state);const c=r.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=function pA(n,t,e,i){return e=e||new Float32Array(4),i||void 0===i?(e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t):(e[0]=n[0],e[1]=n[1],e[2]=n[2]),e[3]=t,e}(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,h),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=s,p+=1){let m=o-f;m>s&&(m=s),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const g=a[p];g.uploadDynamic(e,f,m);const x=t._bufferUpdateIDs[p]||0;d=d||g._updateID<x,d&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),r.geometry.bind(g.geometry),c.drawElements(c.TRIANGLES,6*m,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,s=t._batchSize,r=t._properties;for(let o=0;o<i;o+=s)e.push(new z_(this.properties,r,s));return e}_generateOneMoreBuffer(t){return new z_(this.properties,t._properties,t._batchSize)}uploadVertices(t,e,i,s,r,o){let a=0,l=0,h=0,c=0;for(let u=0;u<i;++u){const d=t[e+u],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,x=f.orig;g?(l=g.x-d.anchor.x*x.width,a=l+g.width,c=g.y-d.anchor.y*x.height,h=c+g.height):(a=x.width*(1-d.anchor.x),l=x.width*-d.anchor.x,h=x.height*(1-d.anchor.y),c=x.height*-d.anchor.y),s[o]=l*p,s[o+1]=c*m,s[o+r]=a*p,s[o+r+1]=c*m,s[o+2*r]=a*p,s[o+2*r+1]=h*m,s[o+3*r]=l*p,s[o+3*r+1]=h*m,o+=4*r}}uploadPosition(t,e,i,s,r,o){for(let a=0;a<i;a++){const l=t[e+a].position;s[o]=l.x,s[o+1]=l.y,s[o+r]=l.x,s[o+r+1]=l.y,s[o+2*r]=l.x,s[o+2*r+1]=l.y,s[o+3*r]=l.x,s[o+3*r+1]=l.y,o+=4*r}}uploadRotation(t,e,i,s,r,o){for(let a=0;a<i;a++){const l=t[e+a].rotation;s[o]=l,s[o+r]=l,s[o+2*r]=l,s[o+3*r]=l,o+=4*r}}uploadUvs(t,e,i,s,r,o){for(let a=0;a<i;++a){const l=t[e+a]._texture._uvs;l?(s[o]=l.x0,s[o+1]=l.y0,s[o+r]=l.x1,s[o+r+1]=l.y1,s[o+2*r]=l.x2,s[o+2*r+1]=l.y2,s[o+3*r]=l.x3,s[o+3*r+1]=l.y3,o+=4*r):(s[o]=0,s[o+1]=0,s[o+r]=0,s[o+r+1]=0,s[o+2*r]=0,s[o+2*r+1]=0,s[o+3*r]=0,s[o+3*r+1]=0,o+=4*r)}}uploadTint(t,e,i,s,r,o){for(let a=0;a<i;++a){const l=t[e+a],h=l._texture.baseTexture.alphaMode>0,c=l.alpha,u=c<1&&h?Ru(l._tintRGB,c):l._tintRGB+(255*c<<24);s[o]=u,s[o+r]=u,s[o+2*r]=u,s[o+3*r]=u,o+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}H_.extension={name:"particle",type:Pt.RendererPlugin},Xt.add(H_);var Rh=(n=>(n[n.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",n[n.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",n))(Rh||{});const Ph={willReadFrequently:!0},Wt=class{static get experimentalLetterSpacingSupported(){let n=Wt._experimentalLetterSpacingSupported;if(void 0!==n){const t=Bt.ADAPTER.getCanvasRenderingContext2D().prototype;n=Wt._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return n}constructor(n,t,e,i,s,r,o,a,l){this.text=n,this.style=t,this.width=e,this.height=i,this.lines=s,this.lineWidths=r,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(n,t,e,i=Wt._canvas){e=e??t.wordWrap;const s=t.toFontString(),r=Wt.measureFont(s);0===r.fontSize&&(r.fontSize=t.fontSize,r.ascent=t.fontSize);const o=i.getContext("2d",Ph);o.font=s;const l=(e?Wt.wordWrap(n,t,i):n).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let c=0;for(let p=0;p<l.length;p++){const m=Wt._measureText(l[p],t.letterSpacing,o);h[p]=m,c=Math.max(c,m)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||r.fontSize+t.strokeThickness;let f=Math.max(d,r.fontSize+2*t.strokeThickness)+(l.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new Wt(n,t,u,f,l,h,d+t.leading,c,r)}static _measureText(n,t,e){let i=!1;Wt.experimentalLetterSpacingSupported&&(Wt.experimentalLetterSpacing?(e.letterSpacing=`${t}px`,e.textLetterSpacing=`${t}px`,i=!0):(e.letterSpacing="0px",e.textLetterSpacing="0px"));let s=e.measureText(n).width;return s>0&&(i?s-=t:s+=(Wt.graphemeSegmenter(n).length-1)*t),s}static wordWrap(n,t,e=Wt._canvas){const i=e.getContext("2d",Ph);let s=0,r="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:h}=t,c=Wt.collapseSpaces(h),u=Wt.collapseNewlines(h);let d=!c;const f=t.wordWrapWidth+l,p=Wt.tokenize(n);for(let m=0;m<p.length;m++){let g=p[m];if(Wt.isNewline(g)){if(!u){o+=Wt.addLine(r),d=!c,r="",s=0;continue}g=" "}if(c){const v=Wt.isBreakingSpace(g),y=Wt.isBreakingSpace(r[r.length-1]);if(v&&y)continue}const x=Wt.getFromCache(g,l,a,i);if(x>f)if(""!==r&&(o+=Wt.addLine(r),r="",s=0),Wt.canBreakWords(g,t.breakWords)){const v=Wt.wordWrapSplit(g);for(let y=0;y<v.length;y++){let b=v[y],M=b,S=1;for(;v[y+S];){const w=v[y+S];if(Wt.canBreakChars(M,w,g,y,t.breakWords))break;b+=w,M=w,S++}y+=S-1;const A=Wt.getFromCache(b,l,a,i);A+s>f&&(o+=Wt.addLine(r),d=!1,r="",s=0),r+=b,s+=A}}else r.length>0&&(o+=Wt.addLine(r),r="",s=0),o+=Wt.addLine(g,!(m===p.length-1)),d=!1,r="",s=0;else x+s>f&&(d=!1,o+=Wt.addLine(r),r="",s=0),(r.length>0||!Wt.isBreakingSpace(g)||d)&&(r+=g,s+=x)}return o+=Wt.addLine(r,!1),o}static addLine(n,t=!0){return n=Wt.trimRight(n),t?`${n}\n`:n}static getFromCache(n,t,e,i){let s=e[n];return"number"!=typeof s&&(s=Wt._measureText(n,t,i)+t,e[n]=s),s}static collapseSpaces(n){return"normal"===n||"pre-line"===n}static collapseNewlines(n){return"normal"===n}static trimRight(n){if("string"!=typeof n)return"";for(let t=n.length-1;t>=0&&Wt.isBreakingSpace(n[t]);t--)n=n.slice(0,-1);return n}static isNewline(n){return"string"==typeof n&&Wt._newlines.includes(n.charCodeAt(0))}static isBreakingSpace(n,t){return"string"==typeof n&&Wt._breakingSpaces.includes(n.charCodeAt(0))}static tokenize(n){const t=[];let e="";if("string"!=typeof n)return t;for(let i=0;i<n.length;i++){const s=n[i];Wt.isBreakingSpace(s,n[i+1])||Wt.isNewline(s)?(""!==e&&(t.push(e),e=""),t.push(s)):e+=s}return""!==e&&t.push(e),t}static canBreakWords(n,t){return t}static canBreakChars(n,t,e,i,s){return!0}static wordWrapSplit(n){return Wt.graphemeSegmenter(n)}static measureFont(n){if(Wt._fonts[n])return Wt._fonts[n];const t={ascent:0,descent:0,fontSize:0},e=Wt._canvas,i=Wt._context;i.font=n;const s=Wt.METRICS_STRING+Wt.BASELINE_SYMBOL,r=Math.ceil(i.measureText(s).width);let o=Math.ceil(i.measureText(Wt.BASELINE_SYMBOL).width);const a=Math.ceil(Wt.HEIGHT_MULTIPLIER*o);if(o=o*Wt.BASELINE_MULTIPLIER|0,0===r||0===a)return Wt._fonts[n]=t,t;e.width=r,e.height=a,i.fillStyle="#f00",i.fillRect(0,0,r,a),i.font=n,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(s,0,o);const l=i.getImageData(0,0,r,a).data,h=l.length,c=4*r;let u=0,d=0,f=!1;for(u=0;u<o;++u){for(let p=0;p<c;p+=4)if(255!==l[d+p]){f=!0;break}if(f)break;d+=c}for(t.ascent=o-u,d=h-c,f=!1,u=a;u>o;--u){for(let p=0;p<c;p+=4)if(255!==l[d+p]){f=!0;break}if(f)break;d-=c}return t.descent=u-o,t.fontSize=t.ascent+t.descent,Wt._fonts[n]=t,t}static clearMetrics(n=""){n?delete Wt._fonts[n]:Wt._fonts={}}static get _canvas(){if(!Wt.__canvas){let n;try{const t=new OffscreenCanvas(0,0);if(t.getContext("2d",Ph)?.measureText)return Wt.__canvas=t,t;n=Bt.ADAPTER.createCanvas()}catch{n=Bt.ADAPTER.createCanvas()}n.width=n.height=10,Wt.__canvas=n}return Wt.__canvas}static get _context(){return Wt.__context||(Wt.__context=Wt._canvas.getContext("2d",Ph)),Wt.__context}};let ki=Wt;ki.METRICS_STRING="|\xc9q\xc5",ki.BASELINE_SYMBOL="M",ki.BASELINE_MULTIPLIER=1.4,ki.HEIGHT_MULTIPLIER=2,ki.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const n=new Intl.Segmenter;return t=>[...n.segment(t)].map(e=>e.segment)}return n=>[...n]})(),ki.experimentalLetterSpacing=!1,ki._fonts={},ki._newlines=[10,13],ki._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const rP=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ea=class{constructor(n){this.styleID=0,this.reset(),Ad(this,n,n)}clone(){const n={};return Ad(n,this,Ea.defaultStyle),new Ea(n)}reset(){Ad(this,Ea.defaultStyle,Ea.defaultStyle)}get align(){return this._align}set align(n){this._align!==n&&(this._align=n,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(n){this._breakWords!==n&&(this._breakWords=n,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(n){this._dropShadow!==n&&(this._dropShadow=n,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(n){this._dropShadowAlpha!==n&&(this._dropShadowAlpha=n,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(n){this._dropShadowAngle!==n&&(this._dropShadowAngle=n,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(n){this._dropShadowBlur!==n&&(this._dropShadowBlur=n,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(n){const t=Ed(n);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(n){this._dropShadowDistance!==n&&(this._dropShadowDistance=n,this.styleID++)}get fill(){return this._fill}set fill(n){const t=Ed(n);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(n){this._fillGradientType!==n&&(this._fillGradientType=n,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(n){(function oP(n,t){if(!Array.isArray(n)||!Array.isArray(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0})(this._fillGradientStops,n)||(this._fillGradientStops=n,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(n){this.fontFamily!==n&&(this._fontFamily=n,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(n){this._fontSize!==n&&(this._fontSize=n,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(n){this._fontStyle!==n&&(this._fontStyle=n,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(n){this._fontVariant!==n&&(this._fontVariant=n,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(n){this._fontWeight!==n&&(this._fontWeight=n,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(n){this._letterSpacing!==n&&(this._letterSpacing=n,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(n){this._lineHeight!==n&&(this._lineHeight=n,this.styleID++)}get leading(){return this._leading}set leading(n){this._leading!==n&&(this._leading=n,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(n){this._lineJoin!==n&&(this._lineJoin=n,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(n){this._miterLimit!==n&&(this._miterLimit=n,this.styleID++)}get padding(){return this._padding}set padding(n){this._padding!==n&&(this._padding=n,this.styleID++)}get stroke(){return this._stroke}set stroke(n){const t=Ed(n);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(n){this._strokeThickness!==n&&(this._strokeThickness=n,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(n){this._textBaseline!==n&&(this._textBaseline=n,this.styleID++)}get trim(){return this._trim}set trim(n){this._trim!==n&&(this._trim=n,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(n){this._whiteSpace!==n&&(this._whiteSpace=n,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(n){this._wordWrap!==n&&(this._wordWrap=n,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(n){this._wordWrapWidth!==n&&(this._wordWrapWidth=n,this.styleID++)}toFontString(){const n="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let i=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!rP.includes(i)&&(i=`"${i}"`),t[e]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${n} ${t.join(",")}`}};let Mr=Ea;function W_(n){return"number"==typeof n?Qm(n):("string"==typeof n&&n.startsWith("0x")&&(n=n.replace("0x","#")),n)}function Ed(n){if(Array.isArray(n)){for(let t=0;t<n.length;++t)n[t]=W_(n[t]);return n}return W_(n)}function Ad(n,t,e){for(const i in e)n[i]=Array.isArray(t[i])?t[i].slice():t[i]}Mr.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Rh.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const aP={texture:!0,children:!1,baseTexture:!0},Cd=class extends va{constructor(n,t,e){let i=!1;e||(e=Bt.ADAPTER.createCanvas(),i=!0),e.width=3,e.height=3;const s=Vt.from(e);s.orig=new Se,s.trim=new Se,super(s),this._ownCanvas=i,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=Cd.defaultResolution??Bt.RESOLUTION,this._autoResolution=Cd.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=n,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ki.experimentalLetterSpacing}static set experimentalLetterSpacing(n){Be("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ki.experimentalLetterSpacing=n}updateText(n){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&n)return;this._font=this._style.toFontString();const e=this.context,i=ki.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=i.height,o=i.lines,a=i.lineHeight,l=i.lineWidths,h=i.maxLineWidth,c=i.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i.width)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+2*t.padding)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;const f=t.dropShadow?2:1;for(let p=0;p<f;++p){const m=t.dropShadow&&0===p,g=m?Math.ceil(Math.max(1,r)+2*t.padding):0,x=g*this._resolution;if(m){e.fillStyle="black",e.strokeStyle="black";const y=t.dropShadowColor,b=ca("number"==typeof y?y:Iu(y)),M=t.dropShadowBlur*this._resolution,S=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${255*b[0]},${255*b[1]},${255*b[2]},${t.dropShadowAlpha})`,e.shadowBlur=M,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*S,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*S+x}else e.fillStyle=this._generateFillStyle(t,o,i),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let v=(a-c.fontSize)/2;a-c.fontSize<0&&(v=0);for(let y=0;y<o.length;y++)u=t.strokeThickness/2,d=t.strokeThickness/2+y*a+c.ascent+v,"right"===t.align?u+=h-l[y]:"center"===t.align&&(u+=(h-l[y])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[y],u+t.padding,d+t.padding-g,!0),t.fill&&this.drawLetterSpacing(o[y],u+t.padding,d+t.padding-g)}this.updateTexture()}drawLetterSpacing(n,t,e,i=!1){const r=this._style.letterSpacing;let o=!1;if(ki.experimentalLetterSpacingSupported&&(ki.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||o)return void(i?this.context.strokeText(n,t,e):this.context.fillText(n,t,e));let a=t;const l=ki.graphemeSegmenter(n);let h=this.context.measureText(n).width,c=0;for(let u=0;u<l.length;++u){const d=l[u];i?this.context.strokeText(d,a,e):this.context.fillText(d,a,e);let f="";for(let p=u+1;p<l.length;++p)f+=l[p];c=this.context.measureText(f).width,a+=h-c+r,h=c}}updateTexture(){const n=this.canvas;if(this._style.trim){const r=function vA(n){const t=function xA(n){const{width:t,height:e}=n,i=n.getContext("2d",{willReadFrequently:!0});if(null===i)throw new TypeError("Failed to get canvas 2D context");const r=i.getImageData(0,0,t,e).data;let o=0,a=0,l=t-1,h=e-1;for(;a<e&&lg(r,t,a);)++a;if(a===e)return Du.EMPTY;for(;lg(r,t,h);)--h;for(;hg(r,t,o,a,h);)++o;for(;hg(r,t,l,a,h);)--l;return++l,++h,new Du(o,a,l,h)}(n),{width:e,height:i}=t;let s=null;if(!t.isEmpty()){const r=n.getContext("2d");if(null===r)throw new TypeError("Failed to get canvas 2D context");s=r.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}(n);r.data&&(n.width=r.width,n.height=r.height,this.context.putImageData(r.data,0,0))}const t=this._texture,e=this._style,i=e.trim?0:e.padding,s=t.baseTexture;t.trim.width=t._frame.width=n.width/this._resolution,t.trim.height=t._frame.height=n.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-2*i,t.orig.height=t._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(n.width,n.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(n){this._autoResolution&&this._resolution!==n.resolution&&(this._resolution=n.resolution,this.dirty=!0),this.updateText(!0),super._render(n)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(n,t){return this.updateText(!0),-1===this._textureID&&(n=!1),super.getBounds(n,t)}getLocalBounds(n){return this.updateText(!0),super.getLocalBounds.call(this,n)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(n,t,e){const i=n.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let s;const r=n.dropShadow?n.dropShadowDistance:0,o=n.padding||0,a=this.canvas.width/this._resolution-r-2*o,l=this.canvas.height/this._resolution-r-2*o,h=i.slice(),c=n.fillGradientStops.slice();if(!c.length){const u=h.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(h.unshift(i[0]),c.unshift(0),h.push(i[i.length-1]),c.push(1),n.fillGradientType===Rh.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,l+o);const u=e.fontProperties.fontSize+n.strokeThickness;for(let d=0;d<t.length;d++){const f=e.lineHeight*(d-1)+u,p=e.lineHeight*d;let m=p;d>0&&f>p&&(m=(p+f)/2);const g=p+u,x=e.lineHeight*(d+1);let v=g;d+1<t.length&&x<g&&(v=(g+x)/2);const y=(v-m)/l;for(let b=0;b<h.length;b++){let M=0;M="number"==typeof c[b]?c[b]:b/h.length;let S=Math.min(1,Math.max(0,m/l+M*y));S=Number(S.toFixed(5)),s.addColorStop(S,h[b])}}}else{s=this.context.createLinearGradient(o,l/2,a+o,l/2);const u=h.length+1;let d=1;for(let f=0;f<h.length;f++){let p;p="number"==typeof c[f]?c[f]:d/u,s.addColorStop(p,h[f]),d++}}return s}destroy(n){"boolean"==typeof n&&(n={children:n}),n=Object.assign({},aP,n),super.destroy(n),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(n){this.updateText(!0);const t=po(this.scale.x)||1;this.scale.x=t*n/this._texture.orig.width,this._width=n}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(n){this.updateText(!0);const t=po(this.scale.y)||1;this.scale.y=t*n/this._texture.orig.height,this._height=n}get style(){return this._style}set style(n){this._style=(n=n||{})instanceof Mr?n:new Mr(n),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(n){n=String(n??""),this._text!==n&&(this._text=n,this.dirty=!0)}get resolution(){return this._resolution}set resolution(n){this._autoResolution=!1,this._resolution!==n&&(this._resolution=n,this.dirty=!0)}};let Id=Cd;Id.defaultAutoResolution=!0;class lP{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function hP(n,t){let e=!1;if(n?._textures?.length)for(let i=0;i<n._textures.length;i++)if(n._textures[i]instanceof Vt){const s=n._textures[i].baseTexture;t.includes(s)||(t.push(s),e=!0)}return e}function cP(n,t){if(n.baseTexture instanceof _e){const e=n.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function uP(n,t){if(n._texture&&n._texture instanceof Vt){const e=n._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function dP(n,t){return t instanceof Id&&(t.updateText(!0),!0)}function fP(n,t){if(t instanceof Mr){const e=t.toFontString();return ki.measureFont(e),!0}return!1}function pP(n,t){if(n instanceof Id){t.includes(n.style)||t.push(n.style),t.includes(n)||t.push(n);const e=n._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function mP(n,t){return n instanceof Mr&&(t.includes(n)||t.push(n),!0)}const V_=class{constructor(n){this.limiter=new lP(V_.uploadsPerFrame),this.renderer=n,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(pP),this.registerFindHook(mP),this.registerFindHook(hP),this.registerFindHook(cP),this.registerFindHook(uP),this.registerUploadHook(dP),this.registerUploadHook(fP)}upload(n){return new Promise(t=>{n&&this.add(n),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,qi.system.addOnce(this.tick,this,xo.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const n=this.queue[0];let t=!1;if(n&&!n._destroyed)for(let e=0,i=this.uploadHooks.length;e<i;e++)if(this.uploadHooks[e](this.uploadHookHelper,n)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)qi.system.addOnce(this.tick,this,xo.UTILITY);else{this.ticking=!1;const n=this.completes.slice(0);this.completes.length=0;for(let t=0,e=n.length;t<e;t++)n[t]()}}registerFindHook(n){return n&&this.addHooks.push(n),this}registerUploadHook(n){return n&&this.uploadHooks.push(n),this}add(n){for(let t=0,e=this.addHooks.length;t<e&&!this.addHooks[t](n,this.queue);t++);if(n instanceof cn)for(let t=n.children.length-1;t>=0;t--)this.add(n.children[t]);return this}destroy(){this.ticking&&qi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Dh=V_;function X_(n,t){return t instanceof _e&&(t._glTextures[n.CONTEXT_UID]||n.texture.bind(t),!0)}function gP(n,t){if(!(t instanceof To))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let s=0;s<i.length;s++){const{texture:r}=i[s].style;r&&X_(n,r.baseTexture)}return e.batchable||n.geometry.bind(e,t._resolveDirectShader(n)),!0}function _P(n,t){return n instanceof To&&(t.push(n),!0)}Dh.uploadsPerFrame=4,Object.defineProperties(Bt,{UPLOADS_PER_FRAME:{get:()=>Dh.uploadsPerFrame,set(n){Be("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Dh.uploadsPerFrame=n}}});class Y_ extends Dh{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(_P),this.registerUploadHook(X_),this.registerUploadHook(gP)}}Y_.extension={name:"prepare",type:Pt.RendererSystem},Xt.add(Y_),new ne;var $_="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Lh=new ri;class q_ extends nh{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Ig,this.state=ds.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=jn.from($_,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?jn.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):jn.from($_,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-r,s[1]=s[3]=-o,s[2]=s[4]=1-r,s[5]=s[7]=1-o,i.invalidate();const a=t._texture,l=a.baseTexture,h=l.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[e.CONTEXT_UID]?d=l.wrapMode!==Cs.CLAMP:l.wrapMode===Cs.CLAMP&&(l.wrapMode=Cs.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=t._width,x=t._height;Lh.set(c.a*p/g,c.b*p/x,c.c*m/g,c.d*m/x,c.tx/g,c.ty/x),Lh.invert(),d?Lh.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=Lh.toArray(!0),f.uniforms.uColor=ig(t.tint,t.worldAlpha,f.uniforms.uColor,h),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(i),this.state.blendMode=eg(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}q_.extension={name:"tilingSprite",type:Pt.RendererPlugin},Xt.add(q_);const Ca=class{constructor(n,t,e=null){this.linkedSheets=[],this._texture=n instanceof Vt?n:null,this.baseTexture=n instanceof _e?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(e||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(n=null){const{scale:t}=this.data.meta;let e=Is(n,null);return null===e&&(e=parseFloat(t??"1")),1!==e&&this.baseTexture.setResolution(e),e}parse(){return new Promise(n=>{this._callback=n,this._batchIndex=0,this._frameKeys.length<=Ca.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(n){let t=n;const e=Ca.BATCH_SIZE;for(;t-n<e&&t<this._frameKeys.length;){const i=this._frameKeys[t],s=this._frames[i],r=s.frame;if(r){let o=null,a=null;const l=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,h=new Se(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o=s.rotated?new Se(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new Se(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(a=new Se(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[i]=new Vt(this.baseTexture,o,h,a,s.rotated?2:0,s.anchor),Vt.addToCache(this.textures[i],i)}t++}}_processAnimations(){const n=this.data.animations||{};for(const t in n){this.animations[t]=[];for(let e=0;e<n[t].length;e++)this.animations[t].push(this.textures[n[t][e]])}}_parseComplete(){const n=this._callback;this._callback=null,this._batchIndex=0,n.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ca.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ca.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(n=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,n&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Pd=Ca;Pd.BATCH_SIZE=1e3;const wP=["jpg","png","jpeg","avif","webp"];function j_(n,t,e){const i={};if(n.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[s]=t.textures[s]}),!e){const s=Fi.dirname(n[0]);t.linkedSheets.forEach((r,o)=>{const a=j_([`${s}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(i,a)})}return i}const MP={extension:Pt.Asset,cache:{test:n=>n instanceof Pd,getCacheableAssets:(n,t)=>j_(n,t,!1)},resolver:{test:n=>{const e=n.split("?")[0].split("."),i=e.pop(),s=e.pop();return"json"===i&&wP.includes(s)},parse:n=>{const t=n.split(".");return{resolution:parseFloat(Bt.RETINA_PREFIX.exec(n)?.[1]??"1"),format:t[t.length-2],src:n}}},loader:{extension:{type:Pt.LoadParser,priority:Jn.Normal},testParse:(n,t)=>(0,Nt.Z)(function*(){return".json"===Fi.extname(t.src).toLowerCase()&&!!n.frames})(),parse:(n,t,e)=>(0,Nt.Z)(function*(){let i=Fi.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let s=i+n.meta.image;s=pd(s,t.src);const o=(yield e.load([s]))[s],a=new Pd(o.baseTexture,n,t.src);yield a.parse();const l=n?.meta?.related_multi_packs;if(Array.isArray(l)){const h=[];for(const u of l){if("string"!=typeof u)continue;let d=i+u;t.data?.ignoreMultiPack||(d=pd(d,t.src),h.push(e.load({src:d,data:{ignoreMultiPack:!0}})))}const c=yield Promise.all(h);a.linkedSheets=c,c.forEach(u=>{u.linkedSheets=[a].concat(a.linkedSheets.filter(d=>d!==u))})}return a})(),unload(n){n.destroy(!0)}}};Xt.add(MP);class Oh{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Bh{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const r in e){const o=e[r].match(/^[a-z]+/gm)[0],a=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in a){const c=a[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[u]=p}i[o].push(l)}const s=new Oh;return i.info.forEach(r=>s.info.push({face:r.face,size:parseInt(r.size,10)})),i.common.forEach(r=>s.common.push({lineHeight:parseInt(r.lineHeight,10)})),i.page.forEach(r=>s.page.push({id:parseInt(r.id,10),file:r.file})),i.char.forEach(r=>s.char.push({id:parseInt(r.id,10),page:parseInt(r.page,10),x:parseInt(r.x,10),y:parseInt(r.y,10),width:parseInt(r.width,10),height:parseInt(r.height,10),xoffset:parseInt(r.xoffset,10),yoffset:parseInt(r.yoffset,10),xadvance:parseInt(r.xadvance,10)})),i.kerning.forEach(r=>s.kerning.push({first:parseInt(r.first,10),second:parseInt(r.second,10),amount:parseInt(r.amount,10)})),i.distanceField.forEach(r=>s.distanceField.push({distanceRange:parseInt(r.distanceRange,10),fieldType:r.fieldType})),s}}class Dd{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Oh,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)e.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<s.length;h++)e.common.push({lineHeight:parseInt(s[h].getAttribute("lineHeight"),10)});for(let h=0;h<r.length;h++)e.page.push({id:parseInt(r[h].getAttribute("id"),10)||0,file:r[h].getAttribute("file")});for(let h=0;h<o.length;h++){const c=o[h];e.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)e.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return e}}class Ld{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Dd.test(Bt.ADAPTER.parseXML(t))}static parse(t){return Dd.parse(Bt.ADAPTER.parseXML(t))}}const Od=[Bh,Dd,Ld];function EP(n,t,e,i,s,r,o){const a=e.text,l=e.fontProperties;t.translate(i,s),t.scale(r,r);const h=o.strokeThickness/2,c=-o.strokeThickness/2;if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=function TP(n,t,e,i,s,r){const o=e.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,c=n.width/i-l-2*h,u=n.height/i-l-2*h,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===Rh.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,h,c/2,u+h);let p=0;const g=(r.fontProperties.fontSize+e.strokeThickness)/u;for(let x=0;x<s.length;x++){const v=r.lineHeight*x;for(let y=0;y<d.length;y++){let b=0;b="number"==typeof f[y]?f[y]:y/d.length;let S=Math.max(p,v/u+b*g);S=Math.min(S,1),a.addColorStop(S,d[y]),p=S}}}else{a=t.createLinearGradient(h,u/2,c+h,u/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let x;x="number"==typeof f[g]?f[g]:m/p,a.addColorStop(x,d[g]),m++}}return a}(n,t,o,r,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=ca("number"==typeof u?u:Iu(u)),f=o.dropShadowBlur*r,p=o.dropShadowDistance*r;t.shadowColor=`rgba(${255*d[0]},${255*d[1]},${255*d[2]},${o.dropShadowAlpha})`,t.shadowBlur=f,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,h,c+e.lineHeight-l.descent),o.fill&&t.fillText(a,h,c+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function J_(n){return Array.from?Array.from(n):n.split("")}function Fh(n){return n.codePointAt?n.codePointAt(0):n.charCodeAt(0)}const kn=class{constructor(n,t,e){const[i]=n.info,[s]=n.common,[r]=n.page,[o]=n.distanceField,a=Is(r.file),l={};this._ownsTextures=e,this.font=i.face,this.size=i.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(let h=0;h<n.page.length;h++){const{id:c,file:u}=n.page[h];l[c]=t instanceof Array?t[h]:t[u],o?.fieldType&&"none"!==o.fieldType&&(l[c].baseTexture.alphaMode=In.NO_PREMULTIPLIED_ALPHA,l[c].baseTexture.mipmap=Zn.OFF)}for(let h=0;h<n.char.length;h++){const{id:c,page:u}=n.char[h];let{x:d,y:f,width:p,height:m,xoffset:g,yoffset:x,xadvance:v}=n.char[h];d/=a,f/=a,p/=a,m/=a,g/=a,x/=a,v/=a;const y=new Se(d+l[u].frame.x/a,f+l[u].frame.y/a,p,m);this.chars[c]={xOffset:g,yOffset:x,xAdvance:v,kerning:{},texture:new Vt(l[u].baseTexture,y),page:u}}for(let h=0;h<n.kerning.length;h++){let{first:c,second:u,amount:d}=n.kerning[h];c/=a,u/=a,d/=a,this.chars[u]&&(this.chars[u].kerning[c]=d)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const n in this.chars)this.chars[n].texture.destroy(),this.chars[n].texture=null;for(const n in this.pageTextures)this._ownsTextures&&this.pageTextures[n].destroy(!0),this.pageTextures[n]=null;this.chars=null,this.pageTextures=null}static install(n,t,e){let i;if(n instanceof Oh)i=n;else{const r=function SP(n){for(let t=0;t<Od.length;t++)if(Od[t].test(n))return Od[t];return null}(n);if(!r)throw new Error("Unrecognized data format for font.");i=r.parse(n)}t instanceof Vt&&(t=[t]);const s=new kn(i,t,e);return kn.available[s.font]=s,s}static uninstall(n){const t=kn.available[n];if(!t)throw new Error(`No font found named '${n}'`);t.destroy(),delete kn.available[n]}static from(n,t,e){if(!n)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:s,resolution:r,textureWidth:o,textureHeight:a,...l}=Object.assign({},kn.defaultOptions,e),h=function AP(n){"string"==typeof n&&(n=[n]);const t=[];for(let e=0,i=n.length;e<i;e++){const s=n[e];if(Array.isArray(s)){if(2!==s.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const r=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let a=r,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...J_(s))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(i),c=t instanceof Mr?t:new Mr(t),u=o,d=new Oh;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let m,g,x,f=0,p=0,v=0;const y=[],b=[];for(let S=0;S<h.length;S++){m||(m=Bt.ADAPTER.createCanvas(),m.width=o,m.height=a,g=m.getContext("2d"),x=new _e(m,{resolution:r,...l}),y.push(x),b.push(new Vt(x)),d.page.push({id:b.length-1,file:""}));const A=h[S],w=ki.measureText(A,c,!1,m),T=w.width,C=Math.ceil(w.height),F=Math.ceil(("italic"===c.fontStyle?2:1)*T);if(p>=a-C*r){if(0===p)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${A}')`);--S,m=null,g=null,x=null,p=0,f=0,v=0;continue}if(v=Math.max(C+w.fontProperties.descent,v),F*r+f>=u){if(0===f)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${A}')`);--S,p+=v*r,p=Math.ceil(p),f=0,v=0;continue}EP(m,g,w,f,p,r,c);const Y=Fh(w.text);d.char.push({id:Y,page:b.length-1,x:f/r,y:p/r,width:F,height:C,xoffset:0,yoffset:0,xadvance:T-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(F+2*s)*r,f=Math.ceil(f)}for(let S=0,A=h.length;S<A;S++){const w=h[S];for(let T=0;T<A;T++){const C=h[T],F=g.measureText(w).width,Y=g.measureText(C).width,D=g.measureText(w+C).width-(F+Y);D&&d.kerning.push({first:Fh(w),second:Fh(C),amount:D})}}const M=new kn(d,b,!0);return void 0!==kn.available[n]&&kn.uninstall(n),kn.available[n]=M,M}};let en=kn;en.ALPHA=[["a","z"],["A","Z"]," "],en.NUMERIC=[["0","9"]],en.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],en.ASCII=[[" ","~"]],en.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:kn.ALPHANUMERIC},en.available={};const K_=[],Q_=[],t0=[],e0=class extends cn{constructor(n,t={}){super(),this._tint=16777215;const{align:e,tint:i,maxWidth:s,letterSpacing:r,fontName:o,fontSize:a}=Object.assign({},e0.styleDefaults,t);if(!en.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=i,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=n,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new Ps(()=>{this.dirty=!0},this,0,0),this._roundPixels=Bt.ROUND_PIXELS,this.dirty=!0,this._resolution=Bt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const n=en.available[this._fontName],t=this.fontSize,e=t/n.size,i=new ne,s=[],r=[],o=[],l=J_(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*n.size/t,c="none"===n.distanceFieldType?K_:Q_;let u=null,d=0,f=0,p=0,m=-1,g=0,x=0,v=0,y=0;for(let C=0;C<l.length;C++){const F=l[C],Y=Fh(F);if(/(?:\s)/.test(F)&&(m=C,g=d,y++),"\r"===F||"\n"===F){r.push(d),o.push(-1),f=Math.max(f,d),++p,++x,i.x=0,i.y+=n.lineHeight,u=null,y=0;continue}const O=n.chars[Y];if(!O)continue;u&&O.kerning[u]&&(i.x+=O.kerning[u]);const D=t0.pop()||{texture:Vt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ne};D.texture=O.texture,D.line=p,D.charCode=Y,D.position.x=Math.round(i.x+O.xOffset+this._letterSpacing/2),D.position.y=Math.round(i.y+O.yOffset),D.prevSpaces=y,s.push(D),d=D.position.x+Math.max(O.xAdvance-O.xOffset,O.texture.orig.width),i.x+=O.xAdvance+this._letterSpacing,v=Math.max(v,O.yOffset+O.texture.height),u=Y,-1!==m&&h>0&&i.x>h&&(++x,fo(s,1+m-x,1+C-m),C=m,m=-1,r.push(g),o.push(s.length>0?s[s.length-1].prevSpaces:0),f=Math.max(f,g),p++,i.x=0,i.y+=n.lineHeight,u=null,y=0)}const b=l[l.length-1];"\r"!==b&&"\n"!==b&&(/(?:\s)/.test(b)&&(d=g),r.push(d),f=Math.max(f,d),o.push(-1));const M=[];for(let C=0;C<=p;C++){let F=0;"right"===this._align?F=f-r[C]:"center"===this._align?F=(f-r[C])/2:"justify"===this._align&&(F=o[C]<0?0:(f-r[C])/o[C]),M.push(F)}const S=s.length,A={},w=[],T=this._activePagesMeshData;c.push(...T);for(let C=0;C<S;C++){const F=s[C].texture,Y=F.baseTexture.uid;if(!A[Y]){let O=c.pop();if(!O){const V=new tP;let X,j;"none"===n.distanceFieldType?(X=new G_(Vt.EMPTY),j=ae.NORMAL):(X=new G_(Vt.EMPTY,{program:Dn.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),j=ae.NORMAL_NPM);const $=new Td(V,X);$.blendMode=j,O={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:$,vertices:null,uvs:null,indices:null}}O.index=0,O.indexCount=0,O.vertexCount=0,O.uvsCount=0,O.total=0;const{_textureCache:D}=this;D[Y]=D[Y]||new Vt(F.baseTexture),O.mesh.texture=D[Y],O.mesh.tint=this._tint,w.push(O),A[Y]=O}A[Y].total++}for(let C=0;C<T.length;C++)w.includes(T[C])||this.removeChild(T[C].mesh);for(let C=0;C<w.length;C++)w[C].mesh.parent!==this&&this.addChild(w[C].mesh);this._activePagesMeshData=w;for(const C in A){const F=A[C],Y=F.total;if(!(F.indices?.length>6*Y)||F.vertices.length<2*Td.BATCHABLE_SIZE)F.vertices=new Float32Array(8*Y),F.uvs=new Float32Array(8*Y),F.indices=new Uint16Array(6*Y);else{const D=F.vertices;for(let V=4*F.total*2;V<D.length;V++)D[V]=0}F.mesh.size=6*Y}for(let C=0;C<S;C++){const F=s[C];let Y=F.position.x+M[F.line]*("justify"===this._align?F.prevSpaces:1);this._roundPixels&&(Y=Math.round(Y));const O=Y*e,D=F.position.y*e,V=F.texture,X=A[V.baseTexture.uid],j=V.frame,$=V._uvs,et=X.index++;X.indices[6*et+0]=0+4*et,X.indices[6*et+1]=1+4*et,X.indices[6*et+2]=2+4*et,X.indices[6*et+3]=0+4*et,X.indices[6*et+4]=2+4*et,X.indices[6*et+5]=3+4*et,X.vertices[8*et+0]=O,X.vertices[8*et+1]=D,X.vertices[8*et+2]=O+j.width*e,X.vertices[8*et+3]=D,X.vertices[8*et+4]=O+j.width*e,X.vertices[8*et+5]=D+j.height*e,X.vertices[8*et+6]=O,X.vertices[8*et+7]=D+j.height*e,X.uvs[8*et+0]=$.x0,X.uvs[8*et+1]=$.y0,X.uvs[8*et+2]=$.x1,X.uvs[8*et+3]=$.y1,X.uvs[8*et+4]=$.x2,X.uvs[8*et+5]=$.y2,X.uvs[8*et+6]=$.x3,X.uvs[8*et+7]=$.y3}this._textWidth=f*e,this._textHeight=(i.y+n.lineHeight)*e;for(const C in A){const F=A[C];if(0!==this.anchor.x||0!==this.anchor.y){let V=0;const X=this._textWidth*this.anchor.x,j=this._textHeight*this.anchor.y;for(let $=0;$<F.total;$++)F.vertices[V++]-=X,F.vertices[V++]-=j,F.vertices[V++]-=X,F.vertices[V++]-=j,F.vertices[V++]-=X,F.vertices[V++]-=j,F.vertices[V++]-=X,F.vertices[V++]-=j}this._maxLineHeight=v*e;const Y=F.mesh.geometry.getBuffer("aVertexPosition"),O=F.mesh.geometry.getBuffer("aTextureCoord"),D=F.mesh.geometry.getIndex();Y.data=F.vertices,O.data=F.uvs,D.data=F.indices,Y.update(),O.update(),D.update()}for(let C=0;C<s.length;C++)t0.push(s[C]);this._font=n,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(n){this._autoResolution&&this._resolution!==n.resolution&&(this._resolution=n.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:i}=en.available[this._fontName];if("none"!==e){const{a:s,b:r,c:o,d:a}=this.worldTransform,l=Math.sqrt(s*s+r*r),h=Math.sqrt(o*o+a*a),c=(Math.abs(l)+Math.abs(h))/2,u=this.fontSize/i,d=n._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(n)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const n=en.available[this._fontName];if(!n)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==n&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(n){if(this._tint!==n){this._tint=n;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=n}}get align(){return this._align}set align(n){this._align!==n&&(this._align=n,this.dirty=!0)}get fontName(){return this._fontName}set fontName(n){if(!en.available[n])throw new Error(`Missing BitmapFont "${n}"`);this._fontName!==n&&(this._fontName=n,this.dirty=!0)}get fontSize(){return this._fontSize??en.available[this._fontName].size}set fontSize(n){this._fontSize!==n&&(this._fontSize=n,this.dirty=!0)}get anchor(){return this._anchor}set anchor(n){"number"==typeof n?this._anchor.set(n):this._anchor.copyFrom(n)}get text(){return this._text}set text(n){n=String(n??""),this._text!==n&&(this._text=n,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(n){this._maxWidth!==n&&(this._maxWidth=n,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(n){this._letterSpacing!==n&&(this._letterSpacing=n,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(n){n!==this._roundPixels&&(this._roundPixels=n,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(n){this._autoResolution=!1,this._resolution!==n&&(this._resolution=n,this.dirty=!0)}destroy(n){const{_textureCache:t}=this,i="none"===en.available[this._fontName].distanceFieldType?K_:Q_;i.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>t[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=Vt.EMPTY});for(const s in t)t[s].destroy(),delete t[s];this._font=null,this._textureCache=null,super.destroy(n)}};e0.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const PP=[".xml",".fnt"],DP={extension:{type:Pt.LoadParser,priority:Jn.Normal},test:n=>PP.includes(Fi.extname(n).toLowerCase()),testParse:n=>(0,Nt.Z)(function*(){return Bh.test(n)||Ld.test(n)})(),parse:(n,t,e)=>(0,Nt.Z)(function*(){const i=Bh.test(n)?Bh.parse(n):Ld.parse(n),{src:s}=t,{page:r}=i,o=[];for(let h=0;h<r.length;++h){const c=r[h].file;let u=Fi.join(Fi.dirname(s),c);u=pd(u,s),o.push(u)}const a=yield e.load(o),l=o.map(h=>a[h]);return en.install(i,l,!0)})(),load:(n,t)=>(0,Nt.Z)(function*(){return(yield Bt.ADAPTER.fetch(n)).text()})(),unload(n){n.destroy()}};Xt.add(DP);var Nh=st(3905);const n0=n=>-.07272727272727274*n+1.0727272727272728;var s0=st(9037),r0=st(9643),Gn=st(3238),zn=st(2687),o0=st(1281);const LP=["input"],OP=function(n){return{enterDuration:n}},BP=["*"],FP=new _.OlP("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})});let NP=0;const UP={provide:mt.JU,useExisting:(0,_.Gpc)(()=>a0),multi:!0};class kP{constructor(t,e){this.source=t,this.checked=e}}const GP=(0,Gn.sb)((0,Gn.pj)((0,Gn.Kr)((0,Gn.Id)(class{constructor(n){this._elementRef=n}}))));let zP=(()=>{class n extends GP{constructor(e,i,s,r,o,a,l){super(e),this._focusMonitor=i,this._changeDetectorRef=s,this.defaults=o,this._onChange=h=>{},this._onTouched=()=>{},this._required=!1,this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new _.vpe,this.toggleChange=new _.vpe,this.tabIndex=parseInt(r)||0,this.color=this.defaultColor=o.color||"accent",this._noopAnimations="NoopAnimations"===a,this.id=this._uniqueId=`${l}${++NP}`}get required(){return this._required}set required(e){this._required=(0,o0.Ig)(e)}get checked(){return this._checked}set checked(e){this._checked=(0,o0.Ig)(e),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{"keyboard"===e||"program"===e?this._focused=!0:e||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(e){this.checked=!!e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}}return n.\u0275fac=function(e){_.$Z()},n.\u0275dir=_.lG2({type:n,inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked"},outputs:{change:"change",toggleChange:"toggleChange"},features:[_.qOj]}),n})(),a0=(()=>{class n extends zP{constructor(e,i,s,r,o,a){super(e,i,s,r,o,a,"mat-slide-toggle-")}_createChangeEvent(e){return new kP(this,e)}_onChangeEvent(e){e.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(e){e.stopPropagation()}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(zn.tE),_.Y36(_.sBO),_.$8M("tabindex"),_.Y36(FP),_.Y36(_.QbO,8))},n.\u0275cmp=_.Xpm({type:n,selectors:[["mat-slide-toggle"]],viewQuery:function(e,i){if(1&e&&_.Gf(LP,5),2&e){let s;_.iGM(s=_.CRH())&&(i._inputElement=s.first)}},hostAttrs:[1,"mat-slide-toggle"],hostVars:13,hostBindings:function(e,i){2&e&&(_.Ikx("id",i.id),_.uIk("tabindex",null)("aria-label",null)("aria-labelledby",null)("name",null),_.ekj("mat-checked",i.checked)("mat-disabled",i.disabled)("mat-slide-toggle-label-before","before"==i.labelPosition)("_mat-animation-noopable",i._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matSlideToggle"],features:[_._Bn([UP]),_.qOj],ngContentSelectors:BP,decls:14,vars:20,consts:[[1,"mat-slide-toggle-label"],["label",""],[1,"mat-slide-toggle-bar"],["type","checkbox","role","switch",1,"mat-slide-toggle-input","cdk-visually-hidden",3,"id","required","tabIndex","checked","disabled","change","click"],["input",""],[1,"mat-slide-toggle-thumb-container"],[1,"mat-slide-toggle-thumb"],["mat-ripple","",1,"mat-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-slide-toggle-persistent-ripple"],[1,"mat-slide-toggle-content",3,"cdkObserveContent"],["labelContent",""],[2,"display","none"]],template:function(e,i){if(1&e&&(_.F$t(),_.TgZ(0,"label",0,1)(2,"span",2)(3,"input",3,4),_.NdJ("change",function(r){return i._onChangeEvent(r)})("click",function(r){return i._onInputClick(r)}),_.qZA(),_.TgZ(5,"span",5),_._UZ(6,"span",6),_.TgZ(7,"span",7),_._UZ(8,"span",8),_.qZA()()(),_.TgZ(9,"span",9,10),_.NdJ("cdkObserveContent",function(){return i._onLabelTextChange()}),_.TgZ(11,"span",11),_._uU(12,"\xa0"),_.qZA(),_.Hsn(13),_.qZA()()),2&e){const s=_.MAs(1),r=_.MAs(10);_.uIk("for",i.inputId),_.xp6(2),_.ekj("mat-slide-toggle-bar-no-side-margin",!r.textContent||!r.textContent.trim()),_.xp6(1),_.Q6J("id",i.inputId)("required",i.required)("tabIndex",i.tabIndex)("checked",i.checked)("disabled",i.disabled),_.uIk("name",i.name)("aria-checked",i.checked)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby),_.xp6(4),_.Q6J("matRippleTrigger",s)("matRippleDisabled",i.disableRipple||i.disabled)("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",_.VKq(18,OP,i._noopAnimations?0:150))}},dependencies:[Gn.wG,r0.wD],styles:['.mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%;display:block}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.mat-slide-toggle-input:focus~.mat-slide-toggle-thumb-container .mat-focus-indicator::before{content:""}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}'],encapsulation:2,changeDetection:0}),n})(),l0=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({}),n})(),VP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[l0,Gn.si,Gn.BQ,r0.Q8,l0,Gn.BQ]}),n})();const XP=["pixiContainer"];let h0=(()=>{class n{constructor(e,i,s){this.bsModalRef=e,this.warehouseService=i,this.store=s,this.title="",this.isRotated=!1,this.positionTypeBins=[],this.positionTypeDropDown=[],this.positionTypeSelected=void 0,this.accessSideDropdown=[{text:"Up",value:0},{text:"Right",value:1},{text:"Down",value:2},{text:"Left",value:3}],this.rows=1,this.columns=1,this.app=new ph({width:350,height:350,backgroundColor:15527148,antialias:!0})}ngAfterViewInit(){this.pixiContainer.nativeElement.appendChild(this.app.view),this.viewport=new mI({screenHeight:350,screenWidth:350,worldHeight:1e3,worldWidth:1e3,events:this.app.renderer.events}),this.app.stage.addChild(this.viewport),this.viewport.drag().pinch().wheel(),this.viewport.on("wheel",e=>{})}ngOnInit(){this.loadPositionTypeBins(),this.createTypeForm()}onSubmit(){if(!this.positionTypeSelected)return;const e=this.typeForm.value;e.totalDepth=this.positionTypeSelected.totalDepth,e.totalFront=this.positionTypeSelected.totalFront,this.store.dispatch((n=>({type:Cm.n.SetCurrentPositionTypeBin,payload:{currentPositionTypeBin:n}}))(e)),this.gameInstance.SendMessage("JavaScriptMessager","HandleSpawnMode","true"),this.closeModal()}closeModal(){this.bsModalRef.hide()}drawPreview(e,i){if(!this.positionTypeSelected)return;this.app.stage.children[0].removeChildren();const s=[];let r=100*this.positionTypeSelected.totalFront,o=100*this.positionTypeSelected.totalDepth;for(let l=1;l<=5&&(r>=this.app.view.width||o>=this.app.view.height);l++)r/=l,o/=l;let a=[this.app.view.width/2-r/2,this.app.view.height/2-o/2];for(let l=0;l<i;l++)for(let h=0;h<e;h++){const c=new To;c.lineStyle(2,0,1),c.beginFill(16439685),c.drawRect(0,0,r,o),c.endFill(),c.position.set(a[0]+r*l,a[1]+o*h),s.push(c),this.viewport.addChild(c)}if(e>1||i>1){const l=n0(e),h=n0(i);this.viewport.setZoom(l<h?l:h),this.viewport.moveCenter(s[Math.ceil(s.length/2)].position.x,s[Math.ceil(s.length/2)].position.y)}else this.viewport.setZoom(1),s[0]&&this.viewport.moveCenter(a[0]+s[0].getBounds().width/2,a[1]+s[0].getBounds().height/2)}createTypeForm(){this.typeForm=new mt.cw({positionTypeDescription:new mt.NI("",[mt.kI.required]),pickingAccess:new mt.NI("0",[mt.kI.required]),rowCount:new mt.NI("1",[mt.kI.required,mt.kI.min(1)]),columnCount:new mt.NI("1",[mt.kI.required,mt.kI.min(1)])}),this.typeForm.get("positionTypeDescription")?.valueChanges.subscribe(e=>{this.positionTypeSelected=this.positionTypeBins.find(i=>i.positionTypeDescription===e),this.drawPreview(1,1)}),this.typeForm.get("rowCount")?.valueChanges.subscribe(e=>{this.rows=+e,this.drawPreview(this.rows,this.columns)}),this.typeForm.get("columnCount")?.valueChanges.subscribe(e=>{this.columns=+e,this.drawPreview(this.rows,this.columns)})}rotate(){if(this.positionTypeSelected){if(this.isRotated){const i=this.positionTypeSelected.totalFront;this.positionTypeSelected.totalFront=this.positionTypeSelected.totalDepth,this.positionTypeSelected.totalDepth=i}else{const i=this.positionTypeSelected.totalFront;this.positionTypeSelected.totalFront=this.positionTypeSelected.totalDepth,this.positionTypeSelected.totalDepth=i}this.isRotated=!this.isRotated,this.drawPreview(1,1)}}loadPositionTypeBins(){var e=this;return(0,Nt.Z)(function*(){try{e.positionTypeBins=yield(0,Nh.z)(e.warehouseService.loadPositionTypeBins()),e.positionTypeBins.forEach(i=>{e.positionTypeDropDown.push({text:i.positionTypeDescription,value:i.positionTypeDescription})}),e.positionTypeSelected=e.positionTypeBins[0],e.drawPreview(1,1),e.typeForm.get("positionTypeDescription")?.setValue(e.positionTypeDropDown[0].value)}catch(i){console.error(i)}})()}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(cr.UZ),_.Y36(ur),_.Y36(Vl.yh))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-modal-select-type-address"]],viewQuery:function(e,i){if(1&e&&_.Gf(XP,7),2&e){let s;_.iGM(s=_.CRH())&&(i.pixiContainer=s.first)}},inputs:{title:"title",gameInstance:"gameInstance"},decls:24,vars:7,consts:[[1,"modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"grid-layout"],[1,"ui","form",3,"formGroup","ngSubmit"],["label","Type","formControlName","positionTypeDescription",3,"dropdown"],["label","Access Side","formControlName","pickingAccess",3,"dropdown"],["label","Rows","type","number","formControlName","rowCount"],["label","Column","type","number","formControlName","columnCount"],[2,"margin","5px"],["color","primary",3,"change"],["type","submit",1,"ui","button","primary","space-between-file",2,"margin-top","4%"],[2,"display","flex","flex-direction","row-reverse","align-content","baseline","flex-wrap","wrap"],["pixiContainer",""]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),_._uU(4,"Attendance"),_.qZA(),_.TgZ(5,"button",4),_.NdJ("click",function(){return i.closeModal()}),_.TgZ(6,"span",5),_._uU(7,"\xd7"),_.qZA()()(),_.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"form",8),_.NdJ("ngSubmit",function(){return i.onSubmit()}),_._UZ(12,"app-selection-dropdown",9)(13,"app-selection-dropdown",10)(14,"app-text-input",11)(15,"app-text-input",12),_.TgZ(16,"div",13)(17,"mat-slide-toggle",14),_.NdJ("change",function(){return i.rotate()}),_._uU(18,"Is Rotate ?"),_.qZA()(),_.TgZ(19,"button",15),_._uU(20," Save "),_.qZA()()(),_.TgZ(21,"div",16),_._UZ(22,"div",null,17),_.qZA()()()()()),2&e&&(_.xp6(11),_.Q6J("formGroup",i.typeForm),_.xp6(1),_.Akn("margin: 5px"),_.Q6J("dropdown",i.positionTypeDropDown),_.xp6(1),_.Akn("margin: 5px"),_.Q6J("dropdown",i.accessSideDropdown))},dependencies:[mt._Y,mt.JJ,mt.JL,mt.sg,mt.u,yu,s0.d,a0],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),n})();var $t=(()=>(function(n){n.isCameraMode="isCameraMode",n.isSpawnMode="isSpawnMode",n.isSelectionMode="isSelectionMode",n.isDragMode="isDragMode",n.isMetrics="isMetrics",n.isHeatMapFlow2DMode="isHeatMapFlow2DMode",n.isHeatMapPerAddress2DMode="isHeatMapPerAddress2DMode",n.isMiscellaneousMode="isMiscellaneousMode",n.isProductsChanges="isProductsChanges"}($t||($t={})),$t))();const YP=["pixiContainer"];let ZP=(()=>{class n{constructor(e,i,s){this.bsModalRef=e,this.warehouseService=i,this.store=s,this.title="",this.app=new ph({width:350,height:350,backgroundColor:15527148,antialias:!0}),this.miscellanousDropdown=[]}ngAfterViewInit(){this.pixiContainer.nativeElement.appendChild(this.app.view)}ngOnInit(){this.createMiscellaneousTypeForm()}onSubmit(){}closeModal(){this.bsModalRef.hide()}createMiscellaneousTypeForm(){this.miscellaneousForm=new mt.cw({miscellaneousType:new mt.NI("",[mt.kI.required]),sizeX:new mt.NI("0",[mt.kI.required,mt.kI.min(0)]),sizeY:new mt.NI("0",[mt.kI.required,mt.kI.min(0)]),rotation:new mt.NI("")}),this.miscellaneousForm.get("rotation")?.valueChanges.subscribe(e=>{})}drawPreview(){if(!this.miscellaneousTypeSelected)return;let e=100*this.miscellaneousTypeSelected.sizeX,i=100*this.miscellaneousTypeSelected.sizeY;for(let o=1;o<=5&&(e>=this.app.view.width||i>=this.app.view.height);o++)e/=o,i/=o;const s=[this.app.view.width/2-e/2,this.app.view.height/2-i/2],r=new To;r.lineStyle(2,0,1),r.beginFill(16439685),r.drawRect(s[0],s[1],e,i),r.endFill(),this.app.stage.addChild(r)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(cr.UZ),_.Y36(ur),_.Y36(Vl.yh))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-modal-select-miscellaneous-type"]],viewQuery:function(e,i){if(1&e&&_.Gf(YP,7),2&e){let s;_.iGM(s=_.CRH())&&(i.pixiContainer=s.first)}},inputs:{title:"title",gameInstance:"gameInstance"},decls:25,vars:2,consts:[[1,"modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"grid-layout"],[1,"ui","form",3,"formGroup","ngSubmit"],["label","Type","formControlName","miscellaneousType",3,"dropdown"],["label","Size X (m)","type","number","formControlName","sizeX"],["label","Size Y (m)","type","number","formControlName","sizeY"],[2,"margin","2.5%"],[1,"ui","checkbox"],["type","checkbox","name","example","formControlName","rotation"],["type","submit",1,"ui","button","primary","space-between-file"],[2,"display","flex","flex-direction","row-reverse","align-content","baseline","flex-wrap","wrap"],["pixiContainer",""]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),_._uU(4,"Attendance"),_.qZA(),_.TgZ(5,"button",4),_.NdJ("click",function(){return i.closeModal()}),_.TgZ(6,"span",5),_._uU(7,"\xd7"),_.qZA()()(),_.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"form",8),_.NdJ("ngSubmit",function(){return i.onSubmit()}),_._UZ(12,"app-selection-dropdown",9)(13,"app-text-input",10)(14,"app-text-input",11),_.TgZ(15,"div",12)(16,"div",13),_._UZ(17,"input",14),_.TgZ(18,"label"),_._uU(19,"Is Rotate"),_.qZA()()(),_.TgZ(20,"button",15),_._uU(21," Save "),_.qZA()()(),_.TgZ(22,"div",16),_._UZ(23,"div",null,17),_.qZA()()()()()),2&e&&(_.xp6(11),_.Q6J("formGroup",i.miscellaneousForm),_.xp6(1),_.Q6J("dropdown",i.miscellanousDropdown))},dependencies:[mt._Y,mt.Wl,mt.JJ,mt.JL,mt.sg,mt.u,yu,s0.d],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),n})();class ms{static handleCameraModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleCamera",e.toString())}static handleDragModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleDragMode",e.toString())}static handleSelectionModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleSelectionMode",e.toString())}static handleSpawnModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleSpawnMode",e.toString())}static handleMetricModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleMeasures",e.toString())}static handleHeatMapFlow2D(t,e,i){t.SendMessage("JavaScriptMessager","HandleHeatMapFlow2D",i)}static handleHeatMapPerAddress2D(t,e,i){t.SendMessage("JavaScriptMessager","HandleHeatMapPerAddress2D",i)}static handleProductChanges(t,e,i){t.SendMessage("JavaScriptMessager","HandleAddressScenarioChanges",i)}static handleMiscellaneous(t,e){}}var ui=(()=>(function(n){n.None="None",n.Picks="picks",n.CasesPicked="casespicked",n.Restocks="restocks",n.OutOfStocks="outofstock",n.HeatMap="heatMap",n.ProductsChange="productsChanges"}(ui||(ui={})),ui))(),$P=st(8907),Bd=st(9549),c0=st(1481),qP=st(8980),dn=st(7217),Le=st(4943);const jP={provide:mt.JU,useExisting:(0,_.Gpc)(()=>u0),multi:!0};let u0=(()=>{class n extends dn.Ay{constructor(e,i,s,r,o,a,l,h){super(e,i,s,r,l,h),this._watcherHelper=r,this._idh=o,this.touched=c=>{},this._createEventEmitters([{subscribe:"change",emit:"onChange"},{subscribe:"closed",emit:"onClosed"},{subscribe:"contentReady",emit:"onContentReady"},{subscribe:"copy",emit:"onCopy"},{subscribe:"cut",emit:"onCut"},{subscribe:"disposing",emit:"onDisposing"},{subscribe:"enterKey",emit:"onEnterKey"},{subscribe:"focusIn",emit:"onFocusIn"},{subscribe:"focusOut",emit:"onFocusOut"},{subscribe:"initialized",emit:"onInitialized"},{subscribe:"input",emit:"onInput"},{subscribe:"keyDown",emit:"onKeyDown"},{subscribe:"keyUp",emit:"onKeyUp"},{subscribe:"opened",emit:"onOpened"},{subscribe:"optionChanged",emit:"onOptionChanged"},{subscribe:"paste",emit:"onPaste"},{subscribe:"valueChanged",emit:"onValueChanged"},{emit:"acceptCustomValueChange"},{emit:"accessKeyChange"},{emit:"activeStateEnabledChange"},{emit:"adaptivityEnabledChange"},{emit:"applyButtonTextChange"},{emit:"applyValueModeChange"},{emit:"buttonsChange"},{emit:"calendarOptionsChange"},{emit:"cancelButtonTextChange"},{emit:"dateOutOfRangeMessageChange"},{emit:"dateSerializationFormatChange"},{emit:"deferRenderingChange"},{emit:"disabledChange"},{emit:"disabledDatesChange"},{emit:"displayFormatChange"},{emit:"dropDownButtonTemplateChange"},{emit:"dropDownOptionsChange"},{emit:"elementAttrChange"},{emit:"focusStateEnabledChange"},{emit:"heightChange"},{emit:"hintChange"},{emit:"hoverStateEnabledChange"},{emit:"inputAttrChange"},{emit:"intervalChange"},{emit:"invalidDateMessageChange"},{emit:"isValidChange"},{emit:"labelChange"},{emit:"labelModeChange"},{emit:"maxChange"},{emit:"maxLengthChange"},{emit:"minChange"},{emit:"nameChange"},{emit:"openedChange"},{emit:"openOnFieldClickChange"},{emit:"pickerTypeChange"},{emit:"placeholderChange"},{emit:"readOnlyChange"},{emit:"rtlEnabledChange"},{emit:"showAnalogClockChange"},{emit:"showClearButtonChange"},{emit:"showDropDownButtonChange"},{emit:"spellcheckChange"},{emit:"stylingModeChange"},{emit:"tabIndexChange"},{emit:"textChange"},{emit:"typeChange"},{emit:"useMaskBehaviorChange"},{emit:"validationErrorChange"},{emit:"validationErrorsChange"},{emit:"validationMessageModeChange"},{emit:"validationStatusChange"},{emit:"valueChange"},{emit:"valueChangeEventChange"},{emit:"visibleChange"},{emit:"widthChange"},{emit:"onBlur"}]),this._idh.setHost(this),a.setHost(this)}get acceptCustomValue(){return this._getOption("acceptCustomValue")}set acceptCustomValue(e){this._setOption("acceptCustomValue",e)}get accessKey(){return this._getOption("accessKey")}set accessKey(e){this._setOption("accessKey",e)}get activeStateEnabled(){return this._getOption("activeStateEnabled")}set activeStateEnabled(e){this._setOption("activeStateEnabled",e)}get adaptivityEnabled(){return this._getOption("adaptivityEnabled")}set adaptivityEnabled(e){this._setOption("adaptivityEnabled",e)}get applyButtonText(){return this._getOption("applyButtonText")}set applyButtonText(e){this._setOption("applyButtonText",e)}get applyValueMode(){return this._getOption("applyValueMode")}set applyValueMode(e){this._setOption("applyValueMode",e)}get buttons(){return this._getOption("buttons")}set buttons(e){this._setOption("buttons",e)}get calendarOptions(){return this._getOption("calendarOptions")}set calendarOptions(e){this._setOption("calendarOptions",e)}get cancelButtonText(){return this._getOption("cancelButtonText")}set cancelButtonText(e){this._setOption("cancelButtonText",e)}get dateOutOfRangeMessage(){return this._getOption("dateOutOfRangeMessage")}set dateOutOfRangeMessage(e){this._setOption("dateOutOfRangeMessage",e)}get dateSerializationFormat(){return this._getOption("dateSerializationFormat")}set dateSerializationFormat(e){this._setOption("dateSerializationFormat",e)}get deferRendering(){return this._getOption("deferRendering")}set deferRendering(e){this._setOption("deferRendering",e)}get disabled(){return this._getOption("disabled")}set disabled(e){this._setOption("disabled",e)}get disabledDates(){return this._getOption("disabledDates")}set disabledDates(e){this._setOption("disabledDates",e)}get displayFormat(){return this._getOption("displayFormat")}set displayFormat(e){this._setOption("displayFormat",e)}get dropDownButtonTemplate(){return this._getOption("dropDownButtonTemplate")}set dropDownButtonTemplate(e){this._setOption("dropDownButtonTemplate",e)}get dropDownOptions(){return this._getOption("dropDownOptions")}set dropDownOptions(e){this._setOption("dropDownOptions",e)}get elementAttr(){return this._getOption("elementAttr")}set elementAttr(e){this._setOption("elementAttr",e)}get focusStateEnabled(){return this._getOption("focusStateEnabled")}set focusStateEnabled(e){this._setOption("focusStateEnabled",e)}get height(){return this._getOption("height")}set height(e){this._setOption("height",e)}get hint(){return this._getOption("hint")}set hint(e){this._setOption("hint",e)}get hoverStateEnabled(){return this._getOption("hoverStateEnabled")}set hoverStateEnabled(e){this._setOption("hoverStateEnabled",e)}get inputAttr(){return this._getOption("inputAttr")}set inputAttr(e){this._setOption("inputAttr",e)}get interval(){return this._getOption("interval")}set interval(e){this._setOption("interval",e)}get invalidDateMessage(){return this._getOption("invalidDateMessage")}set invalidDateMessage(e){this._setOption("invalidDateMessage",e)}get isValid(){return this._getOption("isValid")}set isValid(e){this._setOption("isValid",e)}get label(){return this._getOption("label")}set label(e){this._setOption("label",e)}get labelMode(){return this._getOption("labelMode")}set labelMode(e){this._setOption("labelMode",e)}get max(){return this._getOption("max")}set max(e){this._setOption("max",e)}get maxLength(){return this._getOption("maxLength")}set maxLength(e){this._setOption("maxLength",e)}get min(){return this._getOption("min")}set min(e){this._setOption("min",e)}get name(){return this._getOption("name")}set name(e){this._setOption("name",e)}get opened(){return this._getOption("opened")}set opened(e){this._setOption("opened",e)}get openOnFieldClick(){return this._getOption("openOnFieldClick")}set openOnFieldClick(e){this._setOption("openOnFieldClick",e)}get pickerType(){return this._getOption("pickerType")}set pickerType(e){this._setOption("pickerType",e)}get placeholder(){return this._getOption("placeholder")}set placeholder(e){this._setOption("placeholder",e)}get readOnly(){return this._getOption("readOnly")}set readOnly(e){this._setOption("readOnly",e)}get rtlEnabled(){return this._getOption("rtlEnabled")}set rtlEnabled(e){this._setOption("rtlEnabled",e)}get showAnalogClock(){return this._getOption("showAnalogClock")}set showAnalogClock(e){this._setOption("showAnalogClock",e)}get showClearButton(){return this._getOption("showClearButton")}set showClearButton(e){this._setOption("showClearButton",e)}get showDropDownButton(){return this._getOption("showDropDownButton")}set showDropDownButton(e){this._setOption("showDropDownButton",e)}get spellcheck(){return this._getOption("spellcheck")}set spellcheck(e){this._setOption("spellcheck",e)}get stylingMode(){return this._getOption("stylingMode")}set stylingMode(e){this._setOption("stylingMode",e)}get tabIndex(){return this._getOption("tabIndex")}set tabIndex(e){this._setOption("tabIndex",e)}get text(){return this._getOption("text")}set text(e){this._setOption("text",e)}get type(){return this._getOption("type")}set type(e){this._setOption("type",e)}get useMaskBehavior(){return this._getOption("useMaskBehavior")}set useMaskBehavior(e){this._setOption("useMaskBehavior",e)}get validationError(){return this._getOption("validationError")}set validationError(e){this._setOption("validationError",e)}get validationErrors(){return this._getOption("validationErrors")}set validationErrors(e){this._setOption("validationErrors",e)}get validationMessageMode(){return this._getOption("validationMessageMode")}set validationMessageMode(e){this._setOption("validationMessageMode",e)}get validationStatus(){return this._getOption("validationStatus")}set validationStatus(e){this._setOption("validationStatus",e)}get value(){return this._getOption("value")}set value(e){this._setOption("value",e)}get valueChangeEvent(){return this._getOption("valueChangeEvent")}set valueChangeEvent(e){this._setOption("valueChangeEvent",e)}get visible(){return this._getOption("visible")}set visible(e){this._setOption("visible",e)}get width(){return this._getOption("width")}set width(e){this._setOption("width",e)}change(e){}get buttonsChildren(){return this._getOption("buttons")}set buttonsChildren(e){this.setChildren("buttons",e)}_createInstance(e,i){return new qP.Z(e,i)}writeValue(e){this.eventHelper.lockedValueChangeEvent=!0,this.value=e,this.eventHelper.lockedValueChangeEvent=!1}setDisabledState(e){this.disabled=e}registerOnChange(e){this.change=e}registerOnTouched(e){this.touched=e}_createWidget(e){super._createWidget(e),this.instance.on("focusOut",i=>{this.eventHelper.fireNgEvent("onBlur",[i])})}ngOnDestroy(){this._destroyWidget()}ngOnChanges(e){super.ngOnChanges(e),this.setupChanges("buttons",e),this.setupChanges("disabledDates",e),this.setupChanges("validationErrors",e)}setupChanges(e,i){e in this._optionsToUpdate||this._idh.setup(e,i)}ngDoCheck(){this._idh.doCheck("buttons"),this._idh.doCheck("disabledDates"),this._idh.doCheck("validationErrors"),this._watcherHelper.checkWatchers(),super.ngDoCheck(),super.clearChangedOptions()}_setOption(e,i){let s=this._idh.setupSingle(e,i),r=null!==this._idh.getChanges(e,i);(s||r)&&super._setOption(e,i)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(_.R0b),_.Y36(dn._5),_.Y36(dn._h),_.Y36(dn.i9),_.Y36(dn.al),_.Y36(c0.ki),_.Y36(_.Lbi))},n.\u0275cmp=_.Xpm({type:n,selectors:[["dx-date-box"]],contentQueries:function(e,i,s){if(1&e&&_.Suo(s,Le.k4o,4),2&e){let r;_.iGM(r=_.CRH())&&(i.buttonsChildren=r)}},hostBindings:function(e,i){1&e&&_.NdJ("valueChange",function(r){return i.change(r)})("onBlur",function(r){return i.touched(r)})},inputs:{acceptCustomValue:"acceptCustomValue",accessKey:"accessKey",activeStateEnabled:"activeStateEnabled",adaptivityEnabled:"adaptivityEnabled",applyButtonText:"applyButtonText",applyValueMode:"applyValueMode",buttons:"buttons",calendarOptions:"calendarOptions",cancelButtonText:"cancelButtonText",dateOutOfRangeMessage:"dateOutOfRangeMessage",dateSerializationFormat:"dateSerializationFormat",deferRendering:"deferRendering",disabled:"disabled",disabledDates:"disabledDates",displayFormat:"displayFormat",dropDownButtonTemplate:"dropDownButtonTemplate",dropDownOptions:"dropDownOptions",elementAttr:"elementAttr",focusStateEnabled:"focusStateEnabled",height:"height",hint:"hint",hoverStateEnabled:"hoverStateEnabled",inputAttr:"inputAttr",interval:"interval",invalidDateMessage:"invalidDateMessage",isValid:"isValid",label:"label",labelMode:"labelMode",max:"max",maxLength:"maxLength",min:"min",name:"name",opened:"opened",openOnFieldClick:"openOnFieldClick",pickerType:"pickerType",placeholder:"placeholder",readOnly:"readOnly",rtlEnabled:"rtlEnabled",showAnalogClock:"showAnalogClock",showClearButton:"showClearButton",showDropDownButton:"showDropDownButton",spellcheck:"spellcheck",stylingMode:"stylingMode",tabIndex:"tabIndex",text:"text",type:"type",useMaskBehavior:"useMaskBehavior",validationError:"validationError",validationErrors:"validationErrors",validationMessageMode:"validationMessageMode",validationStatus:"validationStatus",value:"value",valueChangeEvent:"valueChangeEvent",visible:"visible",width:"width"},outputs:{onChange:"onChange",onClosed:"onClosed",onContentReady:"onContentReady",onCopy:"onCopy",onCut:"onCut",onDisposing:"onDisposing",onEnterKey:"onEnterKey",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onInitialized:"onInitialized",onInput:"onInput",onKeyDown:"onKeyDown",onKeyUp:"onKeyUp",onOpened:"onOpened",onOptionChanged:"onOptionChanged",onPaste:"onPaste",onValueChanged:"onValueChanged",acceptCustomValueChange:"acceptCustomValueChange",accessKeyChange:"accessKeyChange",activeStateEnabledChange:"activeStateEnabledChange",adaptivityEnabledChange:"adaptivityEnabledChange",applyButtonTextChange:"applyButtonTextChange",applyValueModeChange:"applyValueModeChange",buttonsChange:"buttonsChange",calendarOptionsChange:"calendarOptionsChange",cancelButtonTextChange:"cancelButtonTextChange",dateOutOfRangeMessageChange:"dateOutOfRangeMessageChange",dateSerializationFormatChange:"dateSerializationFormatChange",deferRenderingChange:"deferRenderingChange",disabledChange:"disabledChange",disabledDatesChange:"disabledDatesChange",displayFormatChange:"displayFormatChange",dropDownButtonTemplateChange:"dropDownButtonTemplateChange",dropDownOptionsChange:"dropDownOptionsChange",elementAttrChange:"elementAttrChange",focusStateEnabledChange:"focusStateEnabledChange",heightChange:"heightChange",hintChange:"hintChange",hoverStateEnabledChange:"hoverStateEnabledChange",inputAttrChange:"inputAttrChange",intervalChange:"intervalChange",invalidDateMessageChange:"invalidDateMessageChange",isValidChange:"isValidChange",labelChange:"labelChange",labelModeChange:"labelModeChange",maxChange:"maxChange",maxLengthChange:"maxLengthChange",minChange:"minChange",nameChange:"nameChange",openedChange:"openedChange",openOnFieldClickChange:"openOnFieldClickChange",pickerTypeChange:"pickerTypeChange",placeholderChange:"placeholderChange",readOnlyChange:"readOnlyChange",rtlEnabledChange:"rtlEnabledChange",showAnalogClockChange:"showAnalogClockChange",showClearButtonChange:"showClearButtonChange",showDropDownButtonChange:"showDropDownButtonChange",spellcheckChange:"spellcheckChange",stylingModeChange:"stylingModeChange",tabIndexChange:"tabIndexChange",textChange:"textChange",typeChange:"typeChange",useMaskBehaviorChange:"useMaskBehaviorChange",validationErrorChange:"validationErrorChange",validationErrorsChange:"validationErrorsChange",validationMessageModeChange:"validationMessageModeChange",validationStatusChange:"validationStatusChange",valueChange:"valueChange",valueChangeEventChange:"valueChangeEventChange",visibleChange:"visibleChange",widthChange:"widthChange",onBlur:"onBlur"},features:[_._Bn([dn._5,dn._h,jP,dn.al,dn.i9]),_.qOj,_.TTD],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),JP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[[Le.idP,Le.UxI,Le.sRG,Le.o0O,Le.ggs,Le.IOm,Le.kOw,Le.weU,Le.D_l,Le.JxK,Le.zZW,Le.ynY,Le.lgR,Le.sni,Le.waX,Le.pxS,Le.pGy,dn.Lz,dn.ie,c0.Cu],Le.idP,Le.UxI,Le.sRG,Le.o0O,Le.ggs,Le.IOm,Le.kOw,Le.weU,Le.D_l,Le.JxK,Le.zZW,Le.ynY,Le.lgR,Le.sni,Le.waX,Le.pxS,Le.pGy,dn.ie]}),n})();var d0=st(4385);function KP(n,t){if(1&n&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&n){const e=t.$implicit;_.Q6J("value",e.scenarioName),_.xp6(1),_.hij(" ",e.scenarioName," ")}}function QP(n,t){if(1&n&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&n){const e=t.$implicit;_.Q6J("value",e.scenarioName),_.xp6(1),_.hij(" ",e.scenarioName," ")}}function t2(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"mat-option",34),_.NdJ("onSelectionChange",function(s){_.CHM(e);const r=_.oxw();return _.KtG(r.onAddressViewChange(s))}),_._uU(1),_.qZA()}if(2&n){const e=t.$implicit;_.Q6J("value",e.value),_.xp6(1),_.hij(" ",e.text," ")}}function e2(n,t){if(1&n){const e=_.EpF();_.ynx(0),_.TgZ(1,"div",35)(2,"div",36),_._uU(3,"Start"),_.qZA(),_.TgZ(4,"div",37)(5,"dx-date-box",38),_.NdJ("onValueChanged",function(s){_.CHM(e);const r=_.oxw();return _.KtG(r.onDateChange(!0,s))}),_.qZA()()(),_.TgZ(6,"div",35)(7,"div",36),_._uU(8,"End"),_.qZA(),_.TgZ(9,"div",37)(10,"dx-date-box",38),_.NdJ("onValueChanged",function(s){_.CHM(e);const r=_.oxw();return _.KtG(r.onDateChange(!1,s))}),_.qZA()()(),_.BQk()}if(2&n){const e=_.oxw();_.xp6(5),_.Q6J("value",e.startDate),_.xp6(5),_.Q6J("value",e.endDate)}}let i2=(()=>{class n{constructor(e,i,s,r){this.warehouseService=e,this.http=i,this.modalService=s,this.compareService=r,this.items=["Address","Miscellaneous"],this.expandedIndex=0,this.addresses=[],this.isNewPointsSelected=!1,this.indicatorTypesDropdown=[{text:"None",value:ui.None},{text:"Picks",value:ui.Picks},{text:"Cases Picked",value:ui.CasesPicked},{text:"Restocks",value:ui.Restocks},{text:"Out of Stocks",value:ui.OutOfStocks},{text:"Heat Map",value:ui.HeatMap},{text:"Products Changes",value:ui.ProductsChange}],this.indicatorSelected=ui.None,this.scenarioName="Actual",this.scenarioName2="None",this.scenarios=[],this.isCompare=!1,this.startDate=new Date,this.endDate=new Date}ngOnInit(){window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=e=>{const i=JSON.parse(e);i.forEach(s=>delete s.id),this.warehouseService.saveAddresess(i).subscribe()},window.unityEvents.load2D=()=>{const e=JSON.stringify(this.addresses);this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",e)},window.unityEvents.onKeyboardArrowsDownChange=e=>{this.formDropdown.get("selectIndicatorDropdown")?.setValue(e)},this.warehouseController={isCameraMode:{isEnable:!0,action:ms.handleCameraModeGameInstance},isDragMode:{isEnable:!1,action:ms.handleDragModeGameInstance},isSelectionMode:{isEnable:!1,action:ms.handleSelectionModeGameInstance},isSpawnMode:{isEnable:!1,action:ms.handleSpawnModeGameInstance},isMetrics:{isEnable:!1,action:ms.handleMetricModeGameInstance},isHeatMapFlow2DMode:{isEnable:!1,action:ms.handleHeatMapFlow2D},isHeatMapPerAddress2DMode:{isEnable:!1,action:ms.handleHeatMapPerAddress2D},isProductsChanges:{isEnable:!1,action:ms.handleProductChanges},isMiscellaneousMode:{isEnable:!1,action:ms.handleMiscellaneous}},this.compareService.loadScenarios().pipe((0,ye.U)(e=>e.map(i=>({id:i.id,scenarioName:i.scenarioName})))).subscribe(e=>{this.scenarios=e}),this.initFormControl()}initFormControl(){this.formDropdown=new mt.cw({selectIndicatorDropdown:new mt.NI("None"),selectScenarioDropdown:new mt.NI("current")}),this.formDropdown.get("selectIndicatorDropdown")?.valueChanges.subscribe(e=>{if(this.handleWarehouseControl([],[$t.isHeatMapPerAddress2DMode,$t.isHeatMapFlow2DMode,$t.isProductsChanges],[]),this.indicatorSelected=e,this.gameInstance)switch(this.indicatorSelected){case ui.ProductsChange:this.handleAddressChanges();break;case ui.None:this.handleWarehouseControl([],[$t.isHeatMapPerAddress2DMode,$t.isHeatMapFlow2DMode,$t.isProductsChanges],[]);break;case ui.CasesPicked:this.handleCasesPicked();break;case ui.HeatMap:this.handleHeatMapFlow();break;case ui.OutOfStocks:this.handleOutOfStock();break;case ui.Picks:this.handlePicks();break;case ui.Restocks:this.handleRestocks();break;default:this.handleWarehouseControl([],[$t.isHeatMapPerAddress2DMode,$t.isHeatMapFlow2DMode,$t.isProductsChanges],[])}})}load2DAreaPicking(e){this.warehouseService.loadAddresses(e),this.http.get("assets/miscellaneousLayout.json").subscribe(i=>{const s=JSON.stringify(i);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",s)})}onScenarioChange(e){this.scenarioName=e.source.value,this.load2DAreaPicking(this.scenarioName)}onScenario2Change(e){this.scenarioName2=e.source.value,"None"===this.scenarioName2&&(this.isCompare=!1,this.gameInstance.SendMessage("JavaScriptMessager","HandleRemoveCloneAreaPicking"))}compareScenarios(){this.isCompare=!0,"None"!==this.scenarioName2&&this.gameInstance.SendMessage("JavaScriptMessager","HandleCloneAreaPicking",JSON.stringify({areaPickingDescription1:this.scenarioName,AreaPickingDescription2:this.scenarioName2}))}openAddressTypeModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(h0,{class:"modal-lg",initialState:{title:"Address Type",gameInstance:this.gameInstance}})}openMiscellaneousTypeModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(ZP,{class:"modal-lg",initialState:{title:"Miscellaneous",gameInstance:this.gameInstance}})}handleCamera(){this.handleWarehouseControl([$t.isCameraMode],[])}handleSpawnMode(){this.handleWarehouseControl([$t.isSpawnMode],[$t.isSelectionMode,$t.isDragMode])}handleSelectionMode(){this.handleWarehouseControl([$t.isSelectionMode],[$t.isSpawnMode,$t.isDragMode,$t.isCameraMode])}handleDragMode(){this.handleWarehouseControl([$t.isDragMode],[$t.isCameraMode,$t.isSpawnMode])}handleMetrics(){this.handleWarehouseControl([$t.isMetrics],[$t.isSelectionMode,$t.isDragMode])}handleMiscellaneous(){this.handleWarehouseControl([$t.isMiscellaneousMode],[]),this.gameInstance.SendMessage("JavaScriptMessager","ClearMiscellaneous"),this.warehouseController.isMiscellaneousMode.isEnable?this.http.get("assets/miscellaneousLayoutParcial.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",i)}):this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",i)})}handleHeatMapFlow(){this.isCompare?(0,Ke.D)([this.warehouseService.loadStaicHeatmapFlowActual(),this.warehouseService.loadStaicHeatmapFlowScenario().pipe((0,ye.U)(e=>(e.forEach(i=>{i.Position.x+=60}),e)))]).subscribe(e=>{this.handleWarehouseControl([$t.isHeatMapFlow2DMode],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e[0].concat(e[1]))}):this.warehouseService.loadStaicHeatmapFlowActual().subscribe(e=>{this.handleWarehouseControl([$t.isHeatMapFlow2DMode],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e)})}handleOutOfStock(){this.warehouseService.loadStaticIndicators().pipe((0,ye.U)(e=>e.outOfStock)).subscribe(e=>{this.handleWarehouseControl([$t.isHeatMapPerAddress2DMode],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e)})}handleRestocks(){this.warehouseService.loadStaticIndicators().pipe((0,ye.U)(e=>e.restock)).subscribe(e=>{this.handleWarehouseControl([$t.isHeatMapPerAddress2DMode],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e)})}handlePicks(){this.warehouseService.loadStaticIndicators().pipe((0,ye.U)(e=>e.picks)).subscribe(e=>{this.handleWarehouseControl([$t.isHeatMapPerAddress2DMode],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e)})}handleCasesPicked(){this.warehouseService.loadStaticIndicators().pipe((0,ye.U)(e=>e.casesPicked)).subscribe(e=>{this.handleWarehouseControl([$t.isHeatMapPerAddress2DMode],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e)})}handleAddressChanges(){this.warehouseService.loadScenariosChanges(this.scenarioName).subscribe(e=>{this.handleWarehouseControl([$t.isProductsChanges],[$t.isMetrics,$t.isSelectionMode,$t.isSpawnMode],e)})}onAddressViewChange(e){}onDateChange(e,i){const s=i.value;switch(e?this.startDate=s:this.endDate=s,this.indicatorSelected){case ui.CasesPicked:this.handleCasesPicked();break;case ui.HeatMap:this.handleHeatMapFlow();break;case ui.OutOfStocks:this.handleOutOfStock();break;case ui.Picks:this.handlePicks();break;case ui.Restocks:this.handleRestocks()}}handleRemove(){this.gameInstance.SendMessage("JavaScriptMessager","HandleRemove")}saveAddressToDB(){this.gameInstance.SendMessage("JavaScriptMessager","SaveAddressToDB")}handleWarehouseControl(e,i,s){for(var r in this.warehouseController)e.includes(r)&&(this.warehouseController[r].isEnable=!this.warehouseController[r].isEnable,this.handleLogicInCaseOpitionalParameterIsNotOptional(r,s)),i.includes(r)&&(this.warehouseController[r].isEnable=!1,this.handleLogicInCaseOpitionalParameterIsNotOptional(r,s))}handleLogicInCaseOpitionalParameterIsNotOptional(e,i){i?this.warehouseController[e].action(this.gameInstance,this.warehouseController[e].isEnable,JSON.stringify({isActive:this.warehouseController[e].isEnable,data:i})):this.warehouseController[e].action(this.gameInstance,this.warehouseController[e].isEnable)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(ur),_.Y36(ho.eN),_.Y36(cr.tT),_.Y36($P.z))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-warehouse-menu"]],inputs:{gameInstance:"gameInstance",switchMenu:"switchMenu"},decls:97,vars:16,consts:[[2,"background-color","white","width","100%",3,"ngClass"],[1,"div-menu-style"],[1,"label-bottom",2,"position","relative"],[1,"div-button-style"],["tabindex","0",1,"ui","vertical","animated","button",3,"click"],[1,"hidden","content"],[1,"visible","content"],[1,"world","icon"],[1,"save","icon"],["tabindex","0",1,"ui","vertical","animated","button",3,"ngClass","click"],[1,"camera","icon"],[1,"th","icon"],[1,"plus","icon"],[1,"object","ungroup","icon"],[1,"mouse","pointer","icon"],[1,"hand","rock","icon"],[1,"align","left","icon"],["tabindex","0",1,"ui","vertical","animated","yellow","button",3,"click"],[1,"trash","alternate","icon"],[1,"div-menu-style",2,"grid-template-columns","100%"],[1,"label-bottom",2,"position","relative","bottom","-1%"],[2,"display","grid","grid-template-columns","100% 100% 80%","column-gap","15px"],["appearance","fill"],["placeholder","Actual","value","Actual",3,"selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["placeholder","None","value","None",3,"selectionChange"],[1,"ui","button","primary",2,"width","100%","height","50%",3,"click"],[3,"formGroup"],[2,"display","grid","grid-template-columns","100% 150%","column-gap","15px"],["appearance","fill",2,"width","100%"],["formControlName","selectIndicatorDropdown"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value","onSelectionChange"],[1,"dx-field"],[1,"dx-field-label"],[1,"dx-field-value"],["type","date",3,"value","onValueChanged"]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2),_._uU(3,"Master"),_.qZA(),_.TgZ(4,"div",3)(5,"div",4),_.NdJ("click",function(){return i.load2DAreaPicking(i.scenarioName)}),_.TgZ(6,"div",5),_._uU(7,"Load 2D"),_.qZA(),_.TgZ(8,"div",6),_._UZ(9,"i",7),_.qZA()(),_.TgZ(10,"div",4),_.NdJ("click",function(){return i.saveAddressToDB()}),_.TgZ(11,"div",5),_._uU(12,"Save"),_.qZA(),_.TgZ(13,"div",6),_._UZ(14,"i",8),_.qZA()(),_.TgZ(15,"div",9),_.NdJ("click",function(){return i.handleCamera()}),_.TgZ(16,"div",5),_._uU(17),_.qZA(),_.TgZ(18,"div",6),_._UZ(19,"i",10),_.qZA()(),_.TgZ(20,"div",9),_.NdJ("click",function(){return i.handleMiscellaneous()}),_.TgZ(21,"div",5),_._uU(22,"Miscellaneous"),_.qZA(),_.TgZ(23,"div",6),_._UZ(24,"i",11),_.qZA()(),_._UZ(25,"div")(26,"div"),_.qZA()(),_.TgZ(27,"div",1)(28,"div",2),_._uU(29,"Address"),_.qZA(),_.TgZ(30,"div",3)(31,"div",4),_.NdJ("click",function(){return i.openAddressTypeModal()}),_.TgZ(32,"div",5),_._uU(33,"Select Adress"),_.qZA(),_.TgZ(34,"div",6),_._UZ(35,"i",12),_.qZA()(),_.TgZ(36,"div",9),_.NdJ("click",function(){return i.handleSpawnMode()}),_.TgZ(37,"div",5),_._uU(38,"Place"),_.qZA(),_.TgZ(39,"div",6),_._UZ(40,"i",13),_.qZA()(),_.TgZ(41,"div",9),_.NdJ("click",function(){return i.handleSelectionMode()}),_.TgZ(42,"div",5),_._uU(43,"Selection"),_.qZA(),_.TgZ(44,"div",6),_._UZ(45,"i",14),_.qZA()(),_.TgZ(46,"div",9),_.NdJ("click",function(){return i.handleDragMode()}),_.TgZ(47,"div",5),_._uU(48,"Drag and Drop"),_.qZA(),_.TgZ(49,"div",6),_._UZ(50,"i",15),_.qZA()(),_.TgZ(51,"div",9),_.NdJ("click",function(){return i.handleMetrics()}),_.TgZ(52,"div",5),_._uU(53,"Metrics"),_.qZA(),_.TgZ(54,"div",6),_._UZ(55,"i",16),_.qZA()(),_.TgZ(56,"div",17),_.NdJ("click",function(){return i.handleRemove()}),_.TgZ(57,"div",5),_._uU(58,"Remove"),_.qZA(),_.TgZ(59,"div",6),_._UZ(60,"i",18),_.qZA()()()(),_.TgZ(61,"div",19)(62,"div",20),_._uU(63," Scenarios/Compare Scenarios "),_.qZA(),_.TgZ(64,"div",3)(65,"div",21)(66,"mat-form-field",22)(67,"mat-label"),_._uU(68,"Select a scenario"),_.qZA(),_.TgZ(69,"mat-select",23),_.NdJ("selectionChange",function(r){return i.onScenarioChange(r)}),_.TgZ(70,"mat-option",24),_._uU(71," Current "),_.qZA(),_.YNc(72,KP,2,2,"mat-option",25),_.qZA()(),_.TgZ(73,"mat-form-field",22)(74,"mat-label"),_._uU(75,"Select a scenario"),_.qZA(),_.TgZ(76,"mat-select",26),_.NdJ("selectionChange",function(r){return i.onScenario2Change(r)}),_.TgZ(77,"mat-option",24),_._uU(78," None "),_.qZA(),_.TgZ(79,"mat-option",24),_._uU(80," Current "),_.qZA(),_.YNc(81,QP,2,2,"mat-option",25),_.qZA()(),_.TgZ(82,"button",27),_.NdJ("click",function(){return i.compareScenarios()}),_._uU(83," Compare "),_.qZA()()()(),_.TgZ(84,"div",19)(85,"div",20),_._uU(86," Indicators "),_.qZA(),_.TgZ(87,"div",3)(88,"form",28)(89,"div",29)(90,"mat-form-field",30)(91,"mat-label"),_._uU(92,"Address View"),_.qZA(),_.TgZ(93,"mat-select",31),_.YNc(94,t2,2,2,"mat-option",32),_.qZA()(),_.TgZ(95,"div"),_.YNc(96,e2,11,2,"ng-container",33),_.qZA()()()()()()),2&e&&(_.Q6J("ngClass",i.switchMenu?"grid-layout-menu-2":"grid-layout-menu-3"),_.xp6(15),_.Q6J("ngClass",i.warehouseController.isCameraMode.isEnable?"red":""),_.xp6(2),_.hij(" Camera ",i.warehouseController.isCameraMode.isEnable?"enable":"disable"," "),_.xp6(3),_.Q6J("ngClass",i.warehouseController.isMiscellaneousMode.isEnable?"red":""),_.xp6(16),_.Q6J("ngClass",i.warehouseController.isSpawnMode.isEnable?"red":""),_.xp6(5),_.Q6J("ngClass",i.warehouseController.isSelectionMode.isEnable?"red":""),_.xp6(5),_.Q6J("ngClass",i.warehouseController.isDragMode.isEnable?"red":""),_.xp6(5),_.Q6J("ngClass",i.warehouseController.isMetrics.isEnable?"red":""),_.xp6(19),_.Q6J("value","Actual"),_.xp6(2),_.Q6J("ngForOf",i.scenarios),_.xp6(5),_.Q6J("value","None"),_.xp6(2),_.Q6J("value","Actual"),_.xp6(2),_.Q6J("ngForOf",i.scenarios),_.xp6(7),_.Q6J("formGroup",i.formDropdown),_.xp6(6),_.Q6J("ngForOf",i.indicatorTypesDropdown),_.xp6(2),_.Q6J("ngIf","None"!==i.indicatorSelected&&"productsChanges"!==i.indicatorSelected))},dependencies:[le.mk,le.sg,le.O5,mt._Y,mt.JJ,mt.JL,mt.sg,mt.u,Bd.KE,Bd.hX,u0,d0.gD,Gn.ey],styles:[".grid-layout-menu-3[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;margin-left:10px;display:grid;grid-template-columns:20% 30% 22% 23%;column-gap:15px}.grid-layout-menu-2[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;margin-left:10px;display:grid;grid-template-columns:20% 10% 15% 15%;column-gap:15px}.div-menu-style[_ngcontent-%COMP%]{border:1px solid lightgray;display:grid;border-radius:20px}.div-button-style[_ngcontent-%COMP%]{margin:10px;display:grid;grid-row-gap:2.5px;grid-template-columns:33% 33% 33%;grid-template-rows:50% 50%}.green[_ngcontent-%COMP%]{background-color:green}.red[_ngcontent-%COMP%]{background-color:red}.label-bottom[_ngcontent-%COMP%]{align-items:center;display:inherit;flex-direction:column;background-color:#d3d3d3;border-radius:20px 20px 0 0;font-weight:700;text-align:center}"]}),n})(),n2=(()=>{class n{constructor(e,i){var s=this;this.warehouseService=e,this.unitService=i,this.isReady=!1,this.progress=0,this.gameInstanceEvent=new _.vpe,this.switchMenuEvent=new _.vpe,this.switchMenu=!1,window.unityEvents||(window.unityEvents={}),window.unityEvents.load3D=(0,Nt.Z)(function*(){const r=yield(0,Nh.z)(s.warehouseService.load3dAddresses()),o=yield(0,Nh.z)(s.warehouseService.loadStaticMiscellaneousType()),a=yield(0,Nh.z)(s.warehouseService.loadStaticIndicators());s.localGameInstance.SendMessage("EventSystem","LoadIndicatorData",JSON.stringify(a)),s.localGameInstance.SendMessage("EventSystem","LoadAddress",JSON.stringify(r)),s.localGameInstance.SendMessage("EventSystem","LoadMiscellaneous",JSON.stringify(o))})}onRightClick(e){e.preventDefault()}onMouseEnter(){this.localGameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","true")}onMouseLeave(){this.localGameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false")}ngOnDestroy(){}ngOnInit(){const e=window.UnityLoader;this.unityInstance=e.instantiate("unityContainer","assets/build/Build/build.json",{onProgress:(i,s)=>{this.isReady=!0,this.localGameInstance=i,this.gameInstanceEvent.emit({gameInstance:this.localGameInstance}),this.localGameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.unitSystemSubscription=this.unitService.unit$.subscribe(r=>{this.localGameInstance.SendMessage("JavaScriptMessager","SetUnit",r?"in":"m")})}}),window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=i=>{const s=JSON.parse(i);s.forEach(r=>delete r.id),this.warehouseService.saveAddresess(s).subscribe()}}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(ur),_.Y36(Im._))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-warehouse-unity"]],hostBindings:function(e,i){1&e&&_.NdJ("contextmenu",function(r){return i.onRightClick(r)})("mouseenter",function(){return i.onMouseEnter()})("mouseleave",function(){return i.onMouseLeave()})},outputs:{gameInstanceEvent:"gameInstanceEvent",switchMenuEvent:"switchMenuEvent"},decls:1,vars:0,consts:[["id","unityContainer",1,"unity-container"]],template:function(e,i){1&e&&_._UZ(0,"div",0)},styles:[".unity-container[_ngcontent-%COMP%], .unity-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{background-color:#000;height:94vh;margin:auto!important}.button[_ngcontent-%COMP%]{position:absolute;width:80px;height:30px;margin-top:1%;right:0;border-radius:10px;margin-right:1%;z-index:10;background:lightgrey;border:1px solid lightgrey}"]}),n})();const s2=[{path:"",component:(()=>{class n{constructor(e,i,s,r){this.http=e,this.modalService=i,this.store=s,this.warehouseService=r,this.progress=0,this.isReady=!1,this.warehouseStore=this.store.select(o=>o.warehouse),this.addresses2d=[]}ngOnInit(){this.warehouseStore.subscribe(e=>{e.currentPositionTypeBin&&this.gameInstance?.SendMessage("JavaScriptMessager","RecvJsonWithAddressDim",JSON.stringify(e.currentPositionTypeBin)),this.gameInstance?.SendMessage("JavaScriptMessager","HandleKeyboard","false")}),this.warehouseStore.subscribe(({addresses:e})=>{const i=JSON.stringify(e);this.gameInstance&&this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",i)}),window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=e=>{const i=JSON.parse(e);i.forEach(s=>delete s.id),this.warehouseService.saveAddresess(i).subscribe()},window.unityEvents.onClick2DAddress=e=>{this.bsModalRef=this.modalService.show(Gm,{class:"modal-lg",initialState:{title:"Address Detail",id:e}})}}onClickLoadHeatMapFlowData(){this.http.get("assets/points.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapFlow",i)})}openModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(h0,{class:"modal-lg",initialState:{title:"Area Picking"}})}openModalDev(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(Gm,{class:"modal-lg",initialState:{title:"Address Detail"}})}onSave(){this.gameInstance.SendMessage("JavaScriptMessager","SaveAddressToDB")}onClickCreate3D(){this.http.get("assets/address_3d.json").subscribe(e=>{e.forEach(i=>{i.hostName="",(0,_.X6Q)()&&(i.hostName="http://localhost:5003")}),this.gameInstance.SendMessage("EventSystem","LoadAddress",JSON.stringify(e))}),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{this.gameInstance.SendMessage("EventSystem","LoadMiscellaneous",JSON.stringify(e))})}setGameInstance(e){this.gameInstance=e.gameInstance}setSwitch(e){this.switchMenu=e.switchMenu}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(ho.eN),_.Y36(cr.tT),_.Y36(Vl.yh),_.Y36(ur))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-warehouse"]],decls:4,vars:2,consts:[[1,"grid-layout-main"],[3,"gameInstance","switchMenu"],[3,"gameInstanceEvent","switchMenuEvent"]],template:function(e,i){1&e&&(_.TgZ(0,"div")(1,"div",0),_._UZ(2,"app-warehouse-menu",1),_.TgZ(3,"app-warehouse-unity",2),_.NdJ("gameInstanceEvent",function(r){return i.setGameInstance(r)})("switchMenuEvent",function(r){return i.setSwitch(r)}),_.qZA()()()),2&e&&(_.xp6(2),_.Q6J("gameInstance",i.gameInstance)("switchMenu",i.switchMenu))},dependencies:[i2,n2],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),n})()}];let r2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[ai.Bz.forChild(s2),ai.Bz]}),n})();var o2=st(5349),a2=st(4144),l2=st(8580),h2=st(266),c2=st(7392),fn=st(8184),Fd=st(3353),Kn=st(4080),Uh=st(9521),f0=st(9770),p0=st(445),m0=st(8675);function u2(n,t){}class kh{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let g0=(()=>{class n extends Kn.en{constructor(e,i,s,r,o,a,l,h){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=r,this._interactivityChecker=o,this._ngZone=a,this._overlayRef=l,this._focusMonitor=h,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=c=>{this._portalOutlet.hasAttached();const u=this._portalOutlet.attachDomPortal(c);return this._contentAttached(),u},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=s}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const s=()=>{e.removeEventListener("blur",s),e.removeEventListener("mousedown",s),e.removeAttribute("tabindex")};e.addEventListener("blur",s),e.addEventListener("mousedown",s)})),e.focus(i)}_focusByCssSelector(e,i){let s=this._elementRef.nativeElement.querySelector(e);s&&this._forceFocus(s,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const s=(0,Fd.ht)(),r=this._elementRef.nativeElement;(!s||s===this._document.body||s===r||r.contains(s))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=(0,Fd.ht)();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,Fd.ht)())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(zn.qV),_.Y36(le.K0,8),_.Y36(kh),_.Y36(zn.ic),_.Y36(_.R0b),_.Y36(fn.Iu),_.Y36(zn.tE))},n.\u0275cmp=_.Xpm({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&_.Gf(Kn.Pl,7),2&e){let s;_.iGM(s=_.CRH())&&(i._portalOutlet=s.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&_.uIk("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[_.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&_.YNc(0,u2,0,0,"ng-template",0)},dependencies:[Kn.Pl],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class Nd{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new me.x,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{i.keyCode===Uh.hY&&!this.disableClose&&!(0,Uh.Vb)(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const _0=new _.OlP("DialogScrollStrategy"),d2=new _.OlP("DialogData"),f2=new _.OlP("DefaultDialogConfig"),m2={provide:_0,deps:[fn.aV],useFactory:function p2(n){return()=>n.scrollStrategies.block()}};let g2=0,y0=(()=>{class n{constructor(e,i,s,r,o,a){this._overlay=e,this._injector=i,this._defaultOptions=s,this._parentDialog=r,this._overlayContainer=o,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new me.x,this._afterOpenedAtThisLevel=new me.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,f0.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,m0.O)(void 0))),this._scrollStrategy=a}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){(i={...this._defaultOptions||new kh,...i}).id=i.id||"cdk-dialog-"+g2++,i.id&&this.getDialogById(i.id);const r=this._getOverlayConfig(i),o=this._overlay.create(r),a=new Nd(o,i),l=this._attachContainer(o,a,i);return a.containerInstance=l,this._attachDialogContent(e,a,l,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(a),a.closed.subscribe(()=>this._removeOpenDialog(a,!0)),this.afterOpened.next(a),a}closeAll(){Ud(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){Ud(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),Ud(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new fn.X_({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,s){const r=s.injector||s.viewContainerRef?.injector,o=[{provide:kh,useValue:s},{provide:Nd,useValue:i},{provide:fn.Iu,useValue:e}];let a;s.container?"function"==typeof s.container?a=s.container:(a=s.container.type,o.push(...s.container.providers(s))):a=g0;const l=new Kn.C5(a,s.viewContainerRef,_.zs3.create({parent:r||this._injector,providers:o}),s.componentFactoryResolver);return e.attach(l).instance}_attachDialogContent(e,i,s,r){if(e instanceof _.Rgc){const o=this._createInjector(r,i,s,void 0);let a={$implicit:r.data,dialogRef:i};r.templateContext&&(a={...a,..."function"==typeof r.templateContext?r.templateContext():r.templateContext}),s.attachTemplatePortal(new Kn.UE(e,null,a,o))}else{const o=this._createInjector(r,i,s,this._injector),a=s.attachComponentPortal(new Kn.C5(e,r.viewContainerRef,o,r.componentFactoryResolver));i.componentInstance=a.instance}}_createInjector(e,i,s,r){const o=e.injector||e.viewContainerRef?.injector,a=[{provide:d2,useValue:e.data},{provide:Nd,useValue:i}];return e.providers&&("function"==typeof e.providers?a.push(...e.providers(i,e,s)):a.push(...e.providers)),e.direction&&(!o||!o.get(p0.Is,null,_.XFs.Optional))&&a.push({provide:p0.Is,useValue:{value:e.direction,change:(0,Ce.of)()}}),_.zs3.create({parent:o||r,providers:a})}_removeOpenDialog(e,i){const s=this.openDialogs.indexOf(e);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((r,o)=>{r?o.setAttribute("aria-hidden",r):o.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let s=i.length-1;s>-1;s--){const r=i[s];r!==e&&"SCRIPT"!==r.nodeName&&"STYLE"!==r.nodeName&&!r.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(r,r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(_.LFG(fn.aV),_.LFG(_.zs3),_.LFG(f2,8),_.LFG(n,12),_.LFG(fn.Xj),_.LFG(_0))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac}),n})();function Ud(n,t){let e=n.length;for(;e--;)t(n[e])}let _2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({providers:[y0,m2],imports:[fn.U8,Kn.eL,zn.rt,Kn.eL]}),n})();var y2=st(6451),kd=st(5698);function x2(n,t){}const Eo={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},v2={dialogContainer:(0,Xe.X$)("dialogContainer",[(0,Xe.SB)("void, exit",(0,Xe.oB)({opacity:0,transform:"scale(0.7)"})),(0,Xe.SB)("enter",(0,Xe.oB)({transform:"none"})),(0,Xe.eR)("* => enter",(0,Xe.ru)([(0,Xe.jt)("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",(0,Xe.oB)({transform:"none",opacity:1})),(0,Xe.IO)("@*",(0,Xe.pV)(),{optional:!0})]),Eo),(0,Xe.eR)("* => void, * => exit",(0,Xe.ru)([(0,Xe.jt)("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",(0,Xe.oB)({opacity:0})),(0,Xe.IO)("@*",(0,Xe.pV)(),{optional:!0})]),Eo)])};class Gh{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0,this.enterAnimationDuration=Eo.params.enterAnimationDuration,this.exitAnimationDuration=Eo.params.exitAnimationDuration}}let b2=(()=>{class n extends g0{constructor(e,i,s,r,o,a,l,h){super(e,i,s,r,o,a,l,h),this._animationStateChanged=new _.vpe}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(zn.qV),_.Y36(le.K0,8),_.Y36(Gh),_.Y36(zn.ic),_.Y36(_.R0b),_.Y36(fn.Iu),_.Y36(zn.tE))},n.\u0275cmp=_.Xpm({type:n,selectors:[["ng-component"]],features:[_.qOj],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),w2=(()=>{class n extends b2{constructor(e,i,s,r,o,a,l,h,c){super(e,i,s,r,o,a,l,c),this._changeDetectorRef=h,this._state="enter"}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||Eo.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||Eo.params.exitAnimationDuration}}}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(zn.qV),_.Y36(le.K0,8),_.Y36(Gh),_.Y36(zn.ic),_.Y36(_.R0b),_.Y36(fn.Iu),_.Y36(_.sBO),_.Y36(zn.tE))},n.\u0275cmp=_.Xpm({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-dialog-container"],hostVars:7,hostBindings:function(e,i){1&e&&_.WFA("@dialogContainer.start",function(r){return i._onAnimationStart(r)})("@dialogContainer.done",function(r){return i._onAnimationDone(r)}),2&e&&(_.Ikx("id",i._config.id),_.uIk("aria-modal",i._config.ariaModal)("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),_.d8E("@dialogContainer",i._getAnimationState()))},features:[_.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&_.YNc(0,x2,0,0,"ng-template",0)},dependencies:[Kn.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions.mat-dialog-actions-align-center,.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions.mat-dialog-actions-align-end,.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}"],encapsulation:2,data:{animation:[v2.dialogContainer]}}),n})();class M2{constructor(t,e,i){this._ref=t,this._containerInstance=i,this._afterOpened=new me.x,this._beforeClosed=new me.x,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe((0,oa.h)(s=>"opened"===s.state),(0,kd.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe((0,oa.h)(s=>"closed"===s.state),(0,kd.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),(0,y2.T)(this.backdropClick(),this.keydownEvents().pipe((0,oa.h)(s=>s.keyCode===Uh.hY&&!this.disableClose&&!(0,Uh.Vb)(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),function S2(n,t,e){n._closeInteractionType=t,n.close(e)}(this,"keydown"===s.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe((0,oa.h)(e=>"closing"===e.state),(0,kd.q)(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(t){let e=this._ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(t="",e=""){return this._ref.updateSize(t,e),this}addPanelClass(t){return this._ref.addPanelClass(t),this}removePanelClass(t){return this._ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}const T2=new _.OlP("MatDialogData"),E2=new _.OlP("mat-dialog-default-options"),x0=new _.OlP("mat-dialog-scroll-strategy"),C2={provide:x0,deps:[fn.aV],useFactory:function A2(n){return()=>n.scrollStrategies.block()}};let I2=0,R2=(()=>{class n{constructor(e,i,s,r,o,a,l,h,c,u){this._overlay=e,this._defaultOptions=s,this._parentDialog=r,this._dialogRefConstructor=l,this._dialogContainerType=h,this._dialogDataToken=c,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new me.x,this._afterOpenedAtThisLevel=new me.x,this._idPrefix="mat-dialog-",this.afterAllClosed=(0,f0.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,m0.O)(void 0))),this._scrollStrategy=a,this._dialog=i.get(y0)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let s;(i={...this._defaultOptions||new Gh,...i}).id=i.id||`${this._idPrefix}${I2++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy();const r=this._dialog.open(e,{...i,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:Gh,useValue:i},{provide:kh,useValue:i}]},templateContext:()=>({dialogRef:s}),providers:(o,a,l)=>(s=new this._dialogRefConstructor(o,i,l),s.updatePosition(i?.position),[{provide:this._dialogContainerType,useValue:l},{provide:this._dialogDataToken,useValue:a.data},{provide:this._dialogRefConstructor,useValue:s}])});return s.componentInstance=r.componentInstance,this.openDialogs.push(s),this.afterOpened.next(s),s.afterClosed().subscribe(()=>{const o=this.openDialogs.indexOf(s);o>-1&&(this.openDialogs.splice(o,1),this.openDialogs.length||this._getAfterAllClosed().next())}),s}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){_.$Z()},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac}),n})(),P2=(()=>{class n extends R2{constructor(e,i,s,r,o,a,l,h){super(e,i,r,a,l,o,M2,w2,T2,h)}}return n.\u0275fac=function(e){return new(e||n)(_.LFG(fn.aV),_.LFG(_.zs3),_.LFG(le.Ye,8),_.LFG(E2,8),_.LFG(x0),_.LFG(n,12),_.LFG(fn.Xj),_.LFG(_.QbO,8))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac}),n})(),D2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({providers:[P2,C2],imports:[_2,fn.U8,Kn.eL,Gn.BQ,Gn.BQ]}),n})();const v0={showDelay:0,hideDelay:0,touchGestures:"auto",position:"before",touchendHideDelay:0,disableTooltipInteractivity:!0};let L2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({providers:[cr.tT,ur,{provide:h2.Jm,useValue:v0}],imports:[le.ez,r2,o2.m,cr.zk,Bd.lN,a2.c,JP,mt.UX,l2.XD,dn.ie,uS,d0.LD,c2.Ps,D2,VP]}),n})()},5469:pi=>{"use strict";function ve(R,k,N){N=N||2;var dt,Ct,xt,ue,vt,Ut,we,it=k&&k.length,lt=it?k[0]*N:R.length,G=st(R,0,lt,N,!0),z=[];if(!G||G.next===G.prev)return z;if(it&&(G=function oe(R,k,N,it){var G,z,xt,lt=[];for(G=0,z=k.length;G<z;G++)(xt=st(R,k[G]*it,G<z-1?k[G+1]*it:R.length,it,!1))===xt.next&&(xt.steiner=!0),lt.push(Nt(xt));for(lt.sort(jt),G=0;G<lt.length;G++)N=fe(lt[G],N);return N}(R,k,G,N)),R.length>80*N){dt=xt=R[0],Ct=ue=R[1];for(var ie=N;ie<lt;ie+=N)(vt=R[ie])<dt&&(dt=vt),(Ut=R[ie+1])<Ct&&(Ct=Ut),vt>xt&&(xt=vt),Ut>ue&&(ue=Ut);we=0!==(we=Math.max(xt-dt,ue-Ct))?32767/we:0}return ai(G,z,N,dt,Ct,we,0),z}function st(R,k,N,it,lt){var G,z;if(lt===si(R,k,N,it)>0)for(G=k;G<N;G+=it)z=$e(G,R[G],R[G+1],z);else for(G=N-it;G>=k;G-=it)z=$e(G,R[G],R[G+1],z);return z&&Ri(z,z.next)&&(Ee(z),z=z.next),z}function le(R,k){if(!R)return R;k||(k=R);var it,N=R;do{if(it=!1,N.steiner||!Ri(N,N.next)&&0!==be(N.prev,N,N.next))N=N.next;else{if(Ee(N),(N=k=N.prev)===N.next)break;it=!0}}while(it||N!==k);return k}function ai(R,k,N,it,lt,G,z){if(R){!z&&G&&function Ce(R,k,N,it){var lt=R;do{0===lt.z&&(lt.z=Jt(lt.x,lt.y,k,N,it)),lt.prevZ=lt.prev,lt.nextZ=lt.next,lt=lt.next}while(lt!==R);lt.prevZ.nextZ=null,lt.prevZ=null,function Ke(R){var k,N,it,lt,G,z,dt,Ct,xt=1;do{for(N=R,R=null,G=null,z=0;N;){for(z++,it=N,dt=0,k=0;k<xt&&(dt++,it=it.nextZ);k++);for(Ct=xt;dt>0||Ct>0&&it;)0!==dt&&(0===Ct||!it||N.z<=it.z)?(lt=N,N=N.nextZ,dt--):(lt=it,it=it.nextZ,Ct--),G?G.nextZ=lt:R=lt,lt.prevZ=G,G=lt;N=it}G.nextZ=null,xt*=2}while(z>1)}(lt)}(R,it,lt,G);for(var Ct,xt,dt=R;R.prev!==R.next;)if(Ct=R.prev,xt=R.next,G?mt(R,it,lt,G):_(R))k.push(Ct.i/N|0),k.push(R.i/N|0),k.push(xt.i/N|0),Ee(R),R=xt.next,dt=xt.next;else if((R=xt)===dt){z?1===z?ai(R=ye(le(R),k,N),k,N,it,lt,G,2):2===z&&me(R,k,N,it,lt,G):ai(le(R),k,N,it,lt,G,1);break}}}function _(R){var k=R.prev,N=R,it=R.next;if(be(k,N,it)>=0)return!1;for(var lt=k.x,G=N.x,z=it.x,dt=k.y,Ct=N.y,xt=it.y,ue=lt<G?lt<z?lt:z:G<z?G:z,vt=dt<Ct?dt<xt?dt:xt:Ct<xt?Ct:xt,Ut=lt>G?lt>z?lt:z:G>z?G:z,we=dt>Ct?dt>xt?dt:xt:Ct>xt?Ct:xt,ie=it.next;ie!==k;){if(ie.x>=ue&&ie.x<=Ut&&ie.y>=vt&&ie.y<=we&&di(lt,dt,G,Ct,z,xt,ie.x,ie.y)&&be(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function mt(R,k,N,it){var lt=R.prev,G=R,z=R.next;if(be(lt,G,z)>=0)return!1;for(var dt=lt.x,Ct=G.x,xt=z.x,ue=lt.y,vt=G.y,Ut=z.y,we=dt<Ct?dt<xt?dt:xt:Ct<xt?Ct:xt,ie=ue<vt?ue<Ut?ue:Ut:vt<Ut?vt:Ut,Ve=dt>Ct?dt>xt?dt:xt:Ct>xt?Ct:xt,Ze=ue>vt?ue>Ut?ue:Ut:vt>Ut?vt:Ut,ei=Jt(we,ie,k,N,it),Qe=Jt(Ve,Ze,k,N,it),de=R.prevZ,ge=R.nextZ;de&&de.z>=ei&&ge&&ge.z<=Qe;){if(de.x>=we&&de.x<=Ve&&de.y>=ie&&de.y<=Ze&&de!==lt&&de!==z&&di(dt,ue,Ct,vt,xt,Ut,de.x,de.y)&&be(de.prev,de,de.next)>=0||(de=de.prevZ,ge.x>=we&&ge.x<=Ve&&ge.y>=ie&&ge.y<=Ze&&ge!==lt&&ge!==z&&di(dt,ue,Ct,vt,xt,Ut,ge.x,ge.y)&&be(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;de&&de.z>=ei;){if(de.x>=we&&de.x<=Ve&&de.y>=ie&&de.y<=Ze&&de!==lt&&de!==z&&di(dt,ue,Ct,vt,xt,Ut,de.x,de.y)&&be(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ge&&ge.z<=Qe;){if(ge.x>=we&&ge.x<=Ve&&ge.y>=ie&&ge.y<=Ze&&ge!==lt&&ge!==z&&di(dt,ue,Ct,vt,xt,Ut,ge.x,ge.y)&&be(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function ye(R,k,N){var it=R;do{var lt=it.prev,G=it.next.next;!Ri(lt,G)&&Hi(lt,it,it.next,G)&&tt(lt,G)&&tt(G,lt)&&(k.push(lt.i/N|0),k.push(it.i/N|0),k.push(G.i/N|0),Ee(it),Ee(it.next),it=R=G),it=it.next}while(it!==R);return le(it)}function me(R,k,N,it,lt,G){var z=R;do{for(var dt=z.next.next;dt!==z.prev;){if(z.i!==dt.i&&Pe(z,dt)){var Ct=q(z,dt);return z=le(z,z.next),Ct=le(Ct,Ct.next),ai(z,k,N,it,lt,G,0),void ai(Ct,k,N,it,lt,G,0)}dt=dt.next}z=z.next}while(z!==R)}function jt(R,k){return R.x-k.x}function fe(R,k){var N=function Ge(R,k){var z,N=k,it=R.x,lt=R.y,G=-1/0;do{if(lt<=N.y&&lt>=N.next.y&&N.next.y!==N.y){var dt=N.x+(lt-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(dt<=it&&dt>G&&(G=dt,z=N.x<N.next.x?N:N.next,dt===it))return z}N=N.next}while(N!==k);if(!z)return null;var Ut,Ct=z,xt=z.x,ue=z.y,vt=1/0;N=z;do{it>=N.x&&N.x>=xt&&it!==N.x&&di(lt<ue?it:G,lt,xt,ue,lt<ue?G:it,lt,N.x,N.y)&&(Ut=Math.abs(lt-N.y)/(it-N.x),tt(N,R)&&(Ut<vt||Ut===vt&&(N.x>z.x||N.x===z.x&&We(z,N)))&&(z=N,vt=Ut)),N=N.next}while(N!==Ct);return z}(R,k);if(!N)return k;var it=q(N,R);return le(it,it.next),le(N,N.next)}function We(R,k){return be(R.prev,R,k.prev)<0&&be(k.next,R,R.next)<0}function Jt(R,k,N,it,lt){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R=(R-N)*lt|0)|R<<8))|R<<4))|R<<2))|R<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k=(k-it)*lt|0)|k<<8))|k<<4))|k<<2))|k<<1))<<1}function Nt(R){var k=R,N=R;do{(k.x<N.x||k.x===N.x&&k.y<N.y)&&(N=k),k=k.next}while(k!==R);return N}function di(R,k,N,it,lt,G,z,dt){return(lt-z)*(k-dt)>=(R-z)*(G-dt)&&(R-z)*(it-dt)>=(N-z)*(k-dt)&&(N-z)*(G-dt)>=(lt-z)*(it-dt)}function Pe(R,k){return R.next.i!==k.i&&R.prev.i!==k.i&&!function Ao(R,k){var N=R;do{if(N.i!==R.i&&N.next.i!==R.i&&N.i!==k.i&&N.next.i!==k.i&&Hi(N,N.next,R,k))return!0;N=N.next}while(N!==R);return!1}(R,k)&&(tt(R,k)&&tt(k,R)&&function De(R,k){var N=R,it=!1,lt=(R.x+k.x)/2,G=(R.y+k.y)/2;do{N.y>G!=N.next.y>G&&N.next.y!==N.y&&lt<(N.next.x-N.x)*(G-N.y)/(N.next.y-N.y)+N.x&&(it=!it),N=N.next}while(N!==R);return it}(R,k)&&(be(R.prev,R,k.prev)||be(R,k.prev,k))||Ri(R,k)&&be(R.prev,R,R.next)>0&&be(k.prev,k,k.next)>0)}function be(R,k,N){return(k.y-R.y)*(N.x-k.x)-(k.x-R.x)*(N.y-k.y)}function Ri(R,k){return R.x===k.x&&R.y===k.y}function Hi(R,k,N,it){var lt=nn(be(R,k,N)),G=nn(be(R,k,it)),z=nn(be(N,it,R)),dt=nn(be(N,it,k));return!!(lt!==G&&z!==dt||0===lt&&Ti(R,N,k)||0===G&&Ti(R,it,k)||0===z&&Ti(N,R,it)||0===dt&&Ti(N,k,it))}function Ti(R,k,N){return k.x<=Math.max(R.x,N.x)&&k.x>=Math.min(R.x,N.x)&&k.y<=Math.max(R.y,N.y)&&k.y>=Math.min(R.y,N.y)}function nn(R){return R>0?1:R<0?-1:0}function tt(R,k){return be(R.prev,R,R.next)<0?be(R,k,R.next)>=0&&be(R,R.prev,k)>=0:be(R,k,R.prev)<0||be(R,R.next,k)<0}function q(R,k){var N=new yi(R.i,R.x,R.y),it=new yi(k.i,k.x,k.y),lt=R.next,G=k.prev;return R.next=k,k.prev=R,N.next=lt,lt.prev=N,it.next=N,N.prev=it,G.next=it,it.prev=G,it}function $e(R,k,N,it){var lt=new yi(R,k,N);return it?(lt.next=it.next,lt.prev=it,it.next.prev=lt,it.next=lt):(lt.prev=lt,lt.next=lt),lt}function Ee(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function yi(R,k,N){this.i=R,this.x=k,this.y=N,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function si(R,k,N,it){for(var lt=0,G=k,z=N-it;G<N;G+=it)lt+=(R[z]-R[G])*(R[G+1]+R[z+1]),z=G;return lt}pi.exports=ve,pi.exports.default=ve,ve.deviation=function(R,k,N,it){var lt=k&&k.length,z=Math.abs(si(R,0,lt?k[0]*N:R.length,N));if(lt)for(var dt=0,Ct=k.length;dt<Ct;dt++)z-=Math.abs(si(R,k[dt]*N,dt<Ct-1?k[dt+1]*N:R.length,N));var vt=0;for(dt=0;dt<it.length;dt+=3){var Ut=it[dt]*N,we=it[dt+1]*N,ie=it[dt+2]*N;vt+=Math.abs((R[Ut]-R[ie])*(R[we+1]-R[Ut+1])-(R[Ut]-R[we])*(R[ie+1]-R[Ut+1]))}return 0===z&&0===vt?0:Math.abs((vt-z)/z)},ve.flatten=function(R){for(var k=R[0][0].length,N={vertices:[],holes:[],dimensions:k},it=0,lt=0;lt<R.length;lt++){for(var G=0;G<R[lt].length;G++)for(var z=0;z<k;z++)N.vertices.push(R[lt][G][z]);lt>0&&N.holes.push(it+=R[lt-1].length)}return N}},2005:pi=>{"use strict";var ve=Object.prototype.hasOwnProperty,st="~";function le(){}function ai(me,oe,jt){this.fn=me,this.context=oe,this.once=jt||!1}function _(me,oe,jt,fe,Ge){if("function"!=typeof jt)throw new TypeError("The listener must be a function");var We=new ai(jt,fe||me,Ge),Ce=st?st+oe:oe;return me._events[Ce]?me._events[Ce].fn?me._events[Ce]=[me._events[Ce],We]:me._events[Ce].push(We):(me._events[Ce]=We,me._eventsCount++),me}function mt(me,oe){0==--me._eventsCount?me._events=new le:delete me._events[oe]}function ye(){this._events=new le,this._eventsCount=0}Object.create&&(le.prototype=Object.create(null),(new le).__proto__||(st=!1)),ye.prototype.eventNames=function(){var jt,fe,oe=[];if(0===this._eventsCount)return oe;for(fe in jt=this._events)ve.call(jt,fe)&&oe.push(st?fe.slice(1):fe);return Object.getOwnPropertySymbols?oe.concat(Object.getOwnPropertySymbols(jt)):oe},ye.prototype.listeners=function(oe){var fe=this._events[st?st+oe:oe];if(!fe)return[];if(fe.fn)return[fe.fn];for(var Ge=0,We=fe.length,Ce=new Array(We);Ge<We;Ge++)Ce[Ge]=fe[Ge].fn;return Ce},ye.prototype.listenerCount=function(oe){var fe=this._events[st?st+oe:oe];return fe?fe.fn?1:fe.length:0},ye.prototype.emit=function(oe,jt,fe,Ge,We,Ce){var Ke=st?st+oe:oe;if(!this._events[Ke])return!1;var di,Pe,Jt=this._events[Ke],Nt=arguments.length;if(Jt.fn){switch(Jt.once&&this.removeListener(oe,Jt.fn,void 0,!0),Nt){case 1:return Jt.fn.call(Jt.context),!0;case 2:return Jt.fn.call(Jt.context,jt),!0;case 3:return Jt.fn.call(Jt.context,jt,fe),!0;case 4:return Jt.fn.call(Jt.context,jt,fe,Ge),!0;case 5:return Jt.fn.call(Jt.context,jt,fe,Ge,We),!0;case 6:return Jt.fn.call(Jt.context,jt,fe,Ge,We,Ce),!0}for(Pe=1,di=new Array(Nt-1);Pe<Nt;Pe++)di[Pe-1]=arguments[Pe];Jt.fn.apply(Jt.context,di)}else{var Ri,be=Jt.length;for(Pe=0;Pe<be;Pe++)switch(Jt[Pe].once&&this.removeListener(oe,Jt[Pe].fn,void 0,!0),Nt){case 1:Jt[Pe].fn.call(Jt[Pe].context);break;case 2:Jt[Pe].fn.call(Jt[Pe].context,jt);break;case 3:Jt[Pe].fn.call(Jt[Pe].context,jt,fe);break;case 4:Jt[Pe].fn.call(Jt[Pe].context,jt,fe,Ge);break;default:if(!di)for(Ri=1,di=new Array(Nt-1);Ri<Nt;Ri++)di[Ri-1]=arguments[Ri];Jt[Pe].fn.apply(Jt[Pe].context,di)}}return!0},ye.prototype.on=function(oe,jt,fe){return _(this,oe,jt,fe,!1)},ye.prototype.once=function(oe,jt,fe){return _(this,oe,jt,fe,!0)},ye.prototype.removeListener=function(oe,jt,fe,Ge){var We=st?st+oe:oe;if(!this._events[We])return this;if(!jt)return mt(this,We),this;var Ce=this._events[We];if(Ce.fn)Ce.fn===jt&&(!Ge||Ce.once)&&(!fe||Ce.context===fe)&&mt(this,We);else{for(var Ke=0,Jt=[],Nt=Ce.length;Ke<Nt;Ke++)(Ce[Ke].fn!==jt||Ge&&!Ce[Ke].once||fe&&Ce[Ke].context!==fe)&&Jt.push(Ce[Ke]);Jt.length?this._events[We]=1===Jt.length?Jt[0]:Jt:mt(this,We)}return this},ye.prototype.removeAllListeners=function(oe){var jt;return oe?this._events[jt=st?st+oe:oe]&&mt(this,jt):(this._events=new le,this._eventsCount=0),this},ye.prototype.off=ye.prototype.removeListener,ye.prototype.addListener=ye.prototype.on,ye.prefixed=st,ye.EventEmitter=ye,pi.exports=ye},516:pi=>{"use strict";function ve(st,le){return Object.prototype.hasOwnProperty.call(st,le)}pi.exports=function(st,le,ai,_){ai=ai||"=";var mt={};if("string"!=typeof st||0===st.length)return mt;var ye=/\+/g;st=st.split(le=le||"&");var me=1e3;_&&"number"==typeof _.maxKeys&&(me=_.maxKeys);var oe=st.length;me>0&&oe>me&&(oe=me);for(var jt=0;jt<oe;++jt){var We,Ce,Ke,Jt,fe=st[jt].replace(ye,"%20"),Ge=fe.indexOf(ai);Ge>=0?(We=fe.substr(0,Ge),Ce=fe.substr(Ge+1)):(We=fe,Ce=""),Ke=decodeURIComponent(We),Jt=decodeURIComponent(Ce),ve(mt,Ke)?Array.isArray(mt[Ke])?mt[Ke].push(Jt):mt[Ke]=[mt[Ke],Jt]:mt[Ke]=Jt}return mt}},5776:pi=>{"use strict";var ve=function(st){switch(typeof st){case"string":return st;case"boolean":return st?"true":"false";case"number":return isFinite(st)?st:"";default:return""}};pi.exports=function(st,le,ai,_){return le=le||"&",ai=ai||"=",null===st&&(st=void 0),"object"==typeof st?Object.keys(st).map(function(mt){var ye=encodeURIComponent(ve(mt))+ai;return Array.isArray(st[mt])?st[mt].map(function(me){return ye+encodeURIComponent(ve(me))}).join(le):ye+encodeURIComponent(ve(st[mt]))}).join(le):_?encodeURIComponent(ve(_))+ai+encodeURIComponent(ve(st)):""}},7137:(pi,ve,st)=>{"use strict";ve.decode=ve.parse=st(516),ve.encode=ve.stringify=st(5776)},1308:function(pi,ve,st){var le;pi=st.nmd(pi),function(ai){"object"==typeof global&&global;var me,oe=2147483647,di=/^xn--/,Pe=/[^\x20-\x7E]/,be=/[\x2E\u3002\uFF0E\uFF61]/g,Ri={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Ti=Math.floor,nn=String.fromCharCode;function tt(G){throw RangeError(Ri[G])}function De(G,z){for(var dt=G.length,Ct=[];dt--;)Ct[dt]=z(G[dt]);return Ct}function q(G,z){var dt=G.split("@"),Ct="";return dt.length>1&&(Ct=dt[0]+"@",G=dt[1]),Ct+De((G=G.replace(be,".")).split("."),z).join(".")}function $e(G){for(var xt,ue,z=[],dt=0,Ct=G.length;dt<Ct;)(xt=G.charCodeAt(dt++))>=55296&&xt<=56319&&dt<Ct?56320==(64512&(ue=G.charCodeAt(dt++)))?z.push(((1023&xt)<<10)+(1023&ue)+65536):(z.push(xt),dt--):z.push(xt);return z}function Ee(G){return De(G,function(z){var dt="";return z>65535&&(dt+=nn((z-=65536)>>>10&1023|55296),z=56320|1023&z),dt+nn(z)}).join("")}function yi(G){return G-48<10?G-22:G-65<26?G-65:G-97<26?G-97:36}function si(G,z){return G+22+75*(G<26)-((0!=z)<<5)}function R(G,z,dt){var Ct=0;for(G=dt?Ti(G/700):G>>1,G+=Ti(G/z);G>455;Ct+=36)G=Ti(G/35);return Ti(Ct+36*G/(G+38))}function k(G){var Ct,Ut,we,ie,Ve,Ze,ei,Qe,de,ge,z=[],dt=G.length,xt=0,ue=128,vt=72;for((Ut=G.lastIndexOf("-"))<0&&(Ut=0),we=0;we<Ut;++we)G.charCodeAt(we)>=128&&tt("not-basic"),z.push(G.charCodeAt(we));for(ie=Ut>0?Ut+1:0;ie<dt;){for(Ve=xt,Ze=1,ei=36;ie>=dt&&tt("invalid-input"),((Qe=yi(G.charCodeAt(ie++)))>=36||Qe>Ti((oe-xt)/Ze))&&tt("overflow"),xt+=Qe*Ze,!(Qe<(de=ei<=vt?1:ei>=vt+26?26:ei-vt));ei+=36)Ze>Ti(oe/(ge=36-de))&&tt("overflow"),Ze*=ge;vt=R(xt-Ve,Ct=z.length+1,0==Ve),Ti(xt/Ct)>oe-ue&&tt("overflow"),ue+=Ti(xt/Ct),xt%=Ct,z.splice(xt++,0,ue)}return Ee(z)}function N(G){var z,dt,Ct,xt,ue,vt,Ut,we,ie,Ve,Ze,Qe,de,ge,Fs,ei=[];for(Qe=(G=$e(G)).length,z=128,dt=0,ue=72,vt=0;vt<Qe;++vt)(Ze=G[vt])<128&&ei.push(nn(Ze));for(Ct=xt=ei.length,xt&&ei.push("-");Ct<Qe;){for(Ut=oe,vt=0;vt<Qe;++vt)(Ze=G[vt])>=z&&Ze<Ut&&(Ut=Ze);for(Ut-z>Ti((oe-dt)/(de=Ct+1))&&tt("overflow"),dt+=(Ut-z)*de,z=Ut,vt=0;vt<Qe;++vt)if((Ze=G[vt])<z&&++dt>oe&&tt("overflow"),Ze==z){for(we=dt,ie=36;!(we<(Ve=ie<=ue?1:ie>=ue+26?26:ie-ue));ie+=36)ei.push(nn(si(Ve+(Fs=we-Ve)%(ge=36-Ve),0))),we=Ti(Fs/ge);ei.push(nn(si(we,0))),ue=R(dt,de,Ct==xt),dt=0,++Ct}++dt,++z}return ei.join("")}me={version:"1.3.2",ucs2:{decode:$e,encode:Ee},decode:k,encode:N,toASCII:function lt(G){return q(G,function(z){return Pe.test(z)?"xn--"+N(z):z})},toUnicode:function it(G){return q(G,function(z){return di.test(z)?k(z.slice(4).toLowerCase()):z})}},void 0!==(le=function(){return me}.call(ve,st,ve,pi))&&(pi.exports=le)}()},8762:(pi,ve,st)=>{"use strict";var ai=st(1308),_=st(796);function mt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}ve.Qc=Hi,ve.DB=function nn(tt,De){return Hi(tt,!1,!0).resolve(De)},ve.WU=function Ti(tt){return _.isString(tt)&&(tt=Hi(tt)),tt instanceof mt?tt.format():mt.prototype.format.call(tt)};var ye=/^([a-z0-9.+-]+:)/i,me=/:[0-9]*$/,oe=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,fe=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Ge=["'"].concat(fe),We=["%","/","?",";","#"].concat(Ge),Ce=["/","?","#"],Jt=/^[+a-z0-9A-Z_-]{0,63}$/,Nt=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,di={javascript:!0,"javascript:":!0},Pe={javascript:!0,"javascript:":!0},be={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Ri=st(7137);function Hi(tt,De,q){if(tt&&_.isObject(tt)&&tt instanceof mt)return tt;var $e=new mt;return $e.parse(tt,De,q),$e}mt.prototype.parse=function(tt,De,q){if(!_.isString(tt))throw new TypeError("Parameter 'url' must be a string, not "+typeof tt);var $e=tt.indexOf("?"),Ee=-1!==$e&&$e<tt.indexOf("#")?"?":"#",yi=tt.split(Ee);yi[0]=yi[0].replace(/\\/g,"/");var R=tt=yi.join(Ee);if(R=R.trim(),!q&&1===tt.split("#").length){var k=oe.exec(R);if(k)return this.path=R,this.href=R,this.pathname=k[1],k[2]?(this.search=k[2],this.query=De?Ri.parse(this.search.substr(1)):this.search.substr(1)):De&&(this.search="",this.query={}),this}var N=ye.exec(R);if(N){var it=(N=N[0]).toLowerCase();this.protocol=it,R=R.substr(N.length)}if(q||N||R.match(/^\/\/[^@\/]+@[^@\/]+/)){var lt="//"===R.substr(0,2);lt&&(!N||!Pe[N])&&(R=R.substr(2),this.slashes=!0)}if(!Pe[N]&&(lt||N&&!be[N])){for(var G=-1,z=0;z<Ce.length;z++)-1!==(dt=R.indexOf(Ce[z]))&&(-1===G||dt<G)&&(G=dt);var Ct,xt;for(-1!==(xt=-1===G?R.lastIndexOf("@"):R.lastIndexOf("@",G))&&(Ct=R.slice(0,xt),R=R.slice(xt+1),this.auth=decodeURIComponent(Ct)),G=-1,z=0;z<We.length;z++){var dt;-1!==(dt=R.indexOf(We[z]))&&(-1===G||dt<G)&&(G=dt)}-1===G&&(G=R.length),this.host=R.slice(0,G),R=R.slice(G),this.parseHost(),this.hostname=this.hostname||"";var ue="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ue)for(var vt=this.hostname.split(/\./),Ut=(z=0,vt.length);z<Ut;z++){var we=vt[z];if(we&&!we.match(Jt)){for(var ie="",Ve=0,Ze=we.length;Ve<Ze;Ve++)we.charCodeAt(Ve)>127?ie+="x":ie+=we[Ve];if(!ie.match(Jt)){var ei=vt.slice(0,z),Qe=vt.slice(z+1),de=we.match(Nt);de&&(ei.push(de[1]),Qe.unshift(de[2])),Qe.length&&(R="/"+Qe.join(".")+R),this.hostname=ei.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),ue||(this.hostname=ai.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,ue&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==R[0]&&(R="/"+R))}if(!di[it])for(z=0,Ut=Ge.length;z<Ut;z++){var Ns=Ge[z];if(-1!==R.indexOf(Ns)){var Co=encodeURIComponent(Ns);Co===Ns&&(Co=escape(Ns)),R=R.split(Ns).join(Co)}}var Io=R.indexOf("#");-1!==Io&&(this.hash=R.substr(Io),R=R.slice(0,Io));var ys=R.indexOf("?");return-1!==ys?(this.search=R.substr(ys),this.query=R.substr(ys+1),De&&(this.query=Ri.parse(this.query)),R=R.slice(0,ys)):De&&(this.search="",this.query={}),R&&(this.pathname=R),be[it]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},mt.prototype.format=function(){var tt=this.auth||"";tt&&(tt=(tt=encodeURIComponent(tt)).replace(/%3A/i,":"),tt+="@");var De=this.protocol||"",q=this.pathname||"",$e=this.hash||"",Ee=!1,yi="";this.host?Ee=tt+this.host:this.hostname&&(Ee=tt+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(Ee+=":"+this.port)),this.query&&_.isObject(this.query)&&Object.keys(this.query).length&&(yi=Ri.stringify(this.query));var si=this.search||yi&&"?"+yi||"";return De&&":"!==De.substr(-1)&&(De+=":"),this.slashes||(!De||be[De])&&!1!==Ee?(Ee="//"+(Ee||""),q&&"/"!==q.charAt(0)&&(q="/"+q)):Ee||(Ee=""),$e&&"#"!==$e.charAt(0)&&($e="#"+$e),si&&"?"!==si.charAt(0)&&(si="?"+si),De+Ee+(q=q.replace(/[?#]/g,function(R){return encodeURIComponent(R)}))+(si=si.replace("#","%23"))+$e},mt.prototype.resolve=function(tt){return this.resolveObject(Hi(tt,!1,!0)).format()},mt.prototype.resolveObject=function(tt){if(_.isString(tt)){var De=new mt;De.parse(tt,!1,!0),tt=De}for(var q=new mt,$e=Object.keys(this),Ee=0;Ee<$e.length;Ee++){var yi=$e[Ee];q[yi]=this[yi]}if(q.hash=tt.hash,""===tt.href)return q.href=q.format(),q;if(tt.slashes&&!tt.protocol){for(var si=Object.keys(tt),R=0;R<si.length;R++){var k=si[R];"protocol"!==k&&(q[k]=tt[k])}return be[q.protocol]&&q.hostname&&!q.pathname&&(q.path=q.pathname="/"),q.href=q.format(),q}if(tt.protocol&&tt.protocol!==q.protocol){if(!be[tt.protocol]){for(var N=Object.keys(tt),it=0;it<N.length;it++){var lt=N[it];q[lt]=tt[lt]}return q.href=q.format(),q}if(q.protocol=tt.protocol,tt.host||Pe[tt.protocol])q.pathname=tt.pathname;else{for(var Ut=(tt.pathname||"").split("/");Ut.length&&!(tt.host=Ut.shift()););tt.host||(tt.host=""),tt.hostname||(tt.hostname=""),""!==Ut[0]&&Ut.unshift(""),Ut.length<2&&Ut.unshift(""),q.pathname=Ut.join("/")}return q.search=tt.search,q.query=tt.query,q.host=tt.host||"",q.auth=tt.auth,q.hostname=tt.hostname||tt.host,q.port=tt.port,(q.pathname||q.search)&&(q.path=(q.pathname||"")+(q.search||"")),q.slashes=q.slashes||tt.slashes,q.href=q.format(),q}var dt=q.pathname&&"/"===q.pathname.charAt(0),Ct=tt.host||tt.pathname&&"/"===tt.pathname.charAt(0),xt=Ct||dt||q.host&&tt.pathname,ue=xt,vt=q.pathname&&q.pathname.split("/")||[],we=(Ut=tt.pathname&&tt.pathname.split("/")||[],q.protocol&&!be[q.protocol]);if(we&&(q.hostname="",q.port=null,q.host&&(""===vt[0]?vt[0]=q.host:vt.unshift(q.host)),q.host="",tt.protocol&&(tt.hostname=null,tt.port=null,tt.host&&(""===Ut[0]?Ut[0]=tt.host:Ut.unshift(tt.host)),tt.host=null),xt=xt&&(""===Ut[0]||""===vt[0])),Ct)q.host=tt.host||""===tt.host?tt.host:q.host,q.hostname=tt.hostname||""===tt.hostname?tt.hostname:q.hostname,q.search=tt.search,q.query=tt.query,vt=Ut;else if(Ut.length)vt||(vt=[]),vt.pop(),vt=vt.concat(Ut),q.search=tt.search,q.query=tt.query;else if(!_.isNullOrUndefined(tt.search))return we&&(q.hostname=q.host=vt.shift(),(ie=!!(q.host&&q.host.indexOf("@")>0)&&q.host.split("@"))&&(q.auth=ie.shift(),q.host=q.hostname=ie.shift())),q.search=tt.search,q.query=tt.query,(!_.isNull(q.pathname)||!_.isNull(q.search))&&(q.path=(q.pathname?q.pathname:"")+(q.search?q.search:"")),q.href=q.format(),q;if(!vt.length)return q.pathname=null,q.path=q.search?"/"+q.search:null,q.href=q.format(),q;for(var Ve=vt.slice(-1)[0],Ze=(q.host||tt.host||vt.length>1)&&("."===Ve||".."===Ve)||""===Ve,ei=0,Qe=vt.length;Qe>=0;Qe--)"."===(Ve=vt[Qe])?vt.splice(Qe,1):".."===Ve?(vt.splice(Qe,1),ei++):ei&&(vt.splice(Qe,1),ei--);if(!xt&&!ue)for(;ei--;ei)vt.unshift("..");xt&&""!==vt[0]&&(!vt[0]||"/"!==vt[0].charAt(0))&&vt.unshift(""),Ze&&"/"!==vt.join("/").substr(-1)&&vt.push("");var ie,de=""===vt[0]||vt[0]&&"/"===vt[0].charAt(0);return we&&(q.hostname=q.host=de?"":vt.length?vt.shift():"",(ie=!!(q.host&&q.host.indexOf("@")>0)&&q.host.split("@"))&&(q.auth=ie.shift(),q.host=q.hostname=ie.shift())),(xt=xt||q.host&&vt.length)&&!de&&vt.unshift(""),vt.length?q.pathname=vt.join("/"):(q.pathname=null,q.path=null),(!_.isNull(q.pathname)||!_.isNull(q.search))&&(q.path=(q.pathname?q.pathname:"")+(q.search?q.search:"")),q.auth=tt.auth||q.auth,q.slashes=q.slashes||tt.slashes,q.href=q.format(),q},mt.prototype.parseHost=function(){var tt=this.host,De=me.exec(tt);De&&(":"!==(De=De[0])&&(this.port=De.substr(1)),tt=tt.substr(0,tt.length-De.length)),tt&&(this.hostname=tt)}},796:pi=>{"use strict";pi.exports={isString:function(ve){return"string"==typeof ve},isObject:function(ve){return"object"==typeof ve&&null!==ve},isNull:function(ve){return null===ve},isNullOrUndefined:function(ve){return null==ve}}}}]);