(self.webpackChunkclient=self.webpackChunkclient||[]).push([[265],{265:(Wt,dt,B)=>{"use strict";B.r(dt),B.d(dt,{TooltipOptions:()=>eh,WarehouseModule:()=>lg});var q=B(6895),Lt=B(1669),h=B(4650);function mt(i,t,e,s,n,r,o){try{var a=i[r](o),l=a.value}catch(c){return void e(c)}a.done?t(l):Promise.resolve(l).then(s,n)}function X(i){return function(){var t=this,e=arguments;return new Promise(function(s,n){var r=i.apply(t,e);function o(l){mt(r,s,n,o,a,"next",l)}function a(l){mt(r,s,n,o,a,"throw",l)}o(void 0)})}}var L=B(4006),et=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(et||{}),rt=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(rt||{}),z=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(z||{}),pt=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(pt||{}),P=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(P||{}),Et=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Et||{}),F=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(F||{}),qt=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(qt||{}),At=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(At||{}),gt=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(gt||{}),ht=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(ht||{}),Rt=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(Rt||{}),Nt=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Nt||{}),jt=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(jt||{}),Ot=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Ot||{}),Ft=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Ft||{}),st=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(st||{}),S=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(S||{});const Xt={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>(new DOMParser).parseFromString(i,"text/xml")};var Ct=/iPhone/i,Kt=/iPod/i,Vt=/iPad/i,m=/\biOS-universal(?:.+)Mac\b/i,b=/\bAndroid(?:.+)Mobile\b/i,v=/Android/i,C=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,R=/Silk/i,y=/Windows Phone/i,w=/\bWindows(?:.+)ARM\b/i,D=/BlackBerry/i,Y=/BB10/i,U=/Opera Mini/i,ot=/\b(CriOS|Chrome)(?:.+)Mobile/i,G=/Mobile(?:.+)Firefox\b/i,Z=function(i){return typeof i<"u"&&"MacIntel"===i.platform&&"number"==typeof i.maxTouchPoints&&i.maxTouchPoints>1&&typeof MSStream>"u"};const vt=function nt(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:"string"==typeof i?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,s=e.split("[FBAN");typeof s[1]<"u"&&(e=s[0]),typeof(s=e.split("Twitter"))[1]<"u"&&(e=s[0]);var n=function ut(i){return function(t){return t.test(i)}}(e),r={apple:{phone:n(Ct)&&!n(y),ipod:n(Kt),tablet:!n(Ct)&&(n(Vt)||Z(t))&&!n(y),universal:n(m),device:(n(Ct)||n(Kt)||n(Vt)||n(m)||Z(t))&&!n(y)},amazon:{phone:n(C),tablet:!n(C)&&n(R),device:n(C)||n(R)},android:{phone:!n(y)&&n(C)||!n(y)&&n(b),tablet:!n(y)&&!n(C)&&!n(b)&&(n(R)||n(v)),device:!n(y)&&(n(C)||n(R)||n(b)||n(v))||n(/\bokhttp\b/i)},windows:{phone:n(y),tablet:n(w),device:n(y)||n(w)},other:{blackberry:n(D),blackberry10:n(Y),opera:n(U),firefox:n(G),chrome:n(ot),device:n(D)||n(Y)||n(U)||n(G)||n(ot)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}(globalThis.navigator),O={ADAPTER:Xt,MIPMAP_TEXTURES:ht.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:st.NONE,SPRITE_MAX_TEXTURES:function Dt(i){let t=!0;if(vt.tablet||vt.phone){if(vt.apple.device){const e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(vt.android.device){const e=navigator.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?i:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:jt.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:gt.CLAMP,SCALE_MODE:At.LINEAR,PRECISION_VERTEX:Ot.HIGH,PRECISION_FRAGMENT:vt.apple.device?Ot.HIGH:Ot.MEDIUM,CAN_UPLOAD_SAME_BUFFER:function It(){return!vt.apple.device}(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};O.PREFER_ENV=et.WEBGL2,O.STRICT_TEXTURE_CACHE=!1;var I=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(I||{});const at=i=>{if("function"==typeof i||"object"==typeof i&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={..."object"!=typeof i.extension?{type:i.extension}:i.extension,ref:i}}if("object"!=typeof i)throw new Error("Invalid extension type");return"string"==typeof(i={...i}).type&&(i.type=[i.type]),i},Be=(i,t)=>at(i).priority??t,K={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(at).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(at).forEach(t=>{t.type.forEach(e=>{const s=this._addHandlers,n=this._queue;s[e]?s[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(i,t,e){const s=this._addHandlers,n=this._removeHandlers;if(s[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);s[i]=t,n[i]=e;const r=this._queue;return r[i]&&(r[i].forEach(o=>t(o)),delete r[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,s=>{t.includes(s.ref)||(t.push(s.ref),t.sort((n,r)=>Be(r,e)-Be(n,e)))},s=>{const n=t.indexOf(s.ref);-1!==n&&t.splice(n,1)})}},Fe=2*Math.PI,Ti=180/Math.PI,ai=Math.PI/180;var Jt=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(Jt||{});class bt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new bt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const qi=[new bt,new bt,new bt,new bt];class yt{constructor(t=0,e=0,s=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(n),this.type=Jt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new yt(0,0,0,0)}clone(){return new yt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e)return!((this.right>t.right?t.right:this.right)<=(this.x<t.x?t.x:this.x))&&(this.bottom>t.bottom?t.bottom:this.bottom)>(this.y<t.y?t.y:this.y);const s=this.left,n=this.right,r=this.top,o=this.bottom;if(n<=s||o<=r)return!1;const a=qi[0].set(t.left,t.top),l=qi[1].set(t.left,t.bottom),c=qi[2].set(t.right,t.top),d=qi[3].set(t.right,t.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u||(e.apply(a,a),e.apply(l,l),e.apply(c,c),e.apply(d,d),Math.max(a.x,l.x,c.x,d.x)<=s||Math.min(a.x,l.x,c.x,d.x)>=n||Math.max(a.y,l.y,c.y,d.y)<=r||Math.min(a.y,l.y,c.y,d.y)>=o))return!1;const f=u*(l.y-a.y),p=u*(a.x-l.x),_=f*s+p*r,g=f*n+p*r,x=f*s+p*o,T=f*n+p*o;if(Math.max(_,g,x,T)<=f*a.x+p*a.y||Math.min(_,g,x,T)>=f*d.x+p*d.y)return!1;const k=u*(a.y-c.y),E=u*(c.x-a.x),M=k*s+E*r,J=k*n+E*r,Q=k*s+E*o,j=k*n+E*o;return!(Math.max(M,J,Q,j)<=k*a.x+E*a.y||Math.min(M,J,Q,j)>=k*d.x+E*d.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=n,this.height=Math.max(r-n,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=n,this.height=r-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Js{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.radius=s,this.type=Jt.CIRC}clone(){return new Js(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=this.radius*this.radius}getBounds(){return new yt(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Qs{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.width=s,this.height=n,this.type=Jt.ELIP}clone(){return new Qs(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,n=(e-this.y)/this.height;return s*=s,n*=n,s+n<=1}getBounds(){return new yt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class hi{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const s=[];for(let n=0,r=e.length;n<r;n++)s.push(e[n].x,e[n].y);e=s}this.points=e,this.type=Jt.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new hi(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let s=!1;const n=this.points.length/2;for(let r=0,o=n-1;r<n;o=r++){const a=this.points[2*r],l=this.points[2*r+1],c=this.points[2*o],d=this.points[2*o+1];l>e!=d>e&&t<(e-l)/(d-l)*(c-a)+a&&(s=!s)}return s}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}}class tn{constructor(t=0,e=0,s=0,n=0,r=20){this.x=t,this.y=e,this.width=s,this.height=n,this.radius=r,this.type=Jt.RREC}clone(){return new tn(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let n=t-(this.x+s),r=e-(this.y+s);const o=s*s;if(n*n+r*r<=o||(n=t-(this.x+this.width-s),n*n+r*r<=o)||(r=e-(this.y+this.height-s),n*n+r*r<=o)||(n=t-(this.x+s),n*n+r*r<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class ke{constructor(t,e,s=0,n=0){this._x=s,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new ke(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}class kt{constructor(t=1,e=0,s=0,n=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=n,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,n,r,o){return this.a=t,this.b=e,this.c=s,this.d=n,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new bt;const s=t.x,n=t.y;return e.x=this.a*s+this.c*n+this.tx,e.y=this.b*s+this.d*n+this.ty,e}applyInverse(t,e){e=e||new bt;const s=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*s*n+-this.c*s*r+(this.ty*this.c-this.tx*this.d)*s,e.y=this.a*s*r+-this.b*s*n+(-this.ty*this.a+this.tx*this.b)*s,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*s,this.b=n*s+this.b*e,this.c=r*e-this.d*s,this.d=r*s+this.d*e,this.tx=o*e-this.ty*s,this.ty=o*s+this.ty*e,this}append(t){const e=this.a,s=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*s+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*s+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*s+t.ty*r+this.ty,this}setTransform(t,e,s,n,r,o,a,l,c){return this.a=Math.cos(a+c)*r,this.b=Math.sin(a+c)*r,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(s*this.a+n*this.c),this.ty=e-(s*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const s=this.a,n=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,n=this.c,r=this.d,o=t.pivot,a=-Math.atan2(-n,r),l=Math.atan2(s,e),c=Math.abs(a+l);return c<1e-5||Math.abs(Fe-c)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*s+o.y*r),t}invert(){const t=this.a,e=this.b,s=this.c,n=this.d,r=this.tx,o=t*n-e*s;return this.a=n/o,this.b=-e/o,this.c=-s/o,this.d=t/o,this.tx=(s*this.ty-n*r)/o,this.ty=-(t*this.ty-e*r)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new kt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new kt}static get TEMP_MATRIX(){return new kt}}const Ye=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],We=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],je=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],$e=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],en=[],fr=[],Ki=Math.sign;!function oh(){for(let i=0;i<16;i++){const t=[];en.push(t);for(let e=0;e<16;e++){const s=Ki(Ye[i]*Ye[e]+je[i]*We[e]),n=Ki(We[i]*Ye[e]+$e[i]*We[e]),r=Ki(Ye[i]*je[e]+je[i]*$e[e]),o=Ki(We[i]*je[e]+$e[i]*$e[e]);for(let a=0;a<16;a++)if(Ye[a]===s&&We[a]===n&&je[a]===r&&$e[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new kt;t.set(Ye[i],We[i],je[i],$e[i],0,0),fr.push(t)}}();const Ut={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Ye[i],uY:i=>We[i],vX:i=>je[i],vY:i=>$e[i],inv:i=>8&i?15&i:7&-i,add:(i,t)=>en[i][t],sub:(i,t)=>en[i][Ut.inv(t)],rotate180:i=>4^i,isVertical:i=>2==(3&i),byDirection:(i,t)=>2*Math.abs(i)<=Math.abs(t)?t>=0?Ut.S:Ut.N:2*Math.abs(t)<=Math.abs(i)?i>0?Ut.E:Ut.W:t>0?i>0?Ut.SE:Ut.SW:i>0?Ut.NE:Ut.NW,matrixAppendRotationInv:(i,t,e=0,s=0)=>{const n=fr[Ut.inv(t)];n.tx=e,n.ty=s,i.append(n)}},pr=class{constructor(){this.worldTransform=new kt,this.localTransform=new kt,this.position=new ke(this.onChange,this,0,0),this.scale=new ke(this.onChange,this,1,1),this.pivot=new ke(this.onChange,this,0,0),this.skew=new ke(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,s=this.worldTransform;s.a=t.a*e.a+t.b*e.c,s.b=t.a*e.b+t.b*e.d,s.c=t.c*e.a+t.d*e.c,s.d=t.c*e.b+t.d*e.d,s.tx=t.tx*e.a+t.ty*e.c+e.tx,s.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let sn=pr;sn.IDENTITY=new pr;class fe{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,s,n,r,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:c,items:d}=this;this._aliasCount++;for(let u=0,f=d.length;u<f;u++)d[u][c](t,e,s,n,r,o,a,l);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(fe.prototype,{dispatch:{value:fe.prototype.emit},run:{value:fe.prototype.emit}}),O.TARGET_FPMS=.06;var li=(i=>(i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(li||{});class nn{constructor(t,e=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=s,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}class Zt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new nn(null,null,1/0),this.deltaMS=1/O.TARGET_FPMS,this.elapsedMS=1/O.TARGET_FPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=li.NORMAL){return this._addListener(new nn(t,e,s))}addOnce(t,e,s=li.NORMAL){return this._addListener(new nn(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}else t.connect(s);return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s=s.match(t,e)?s.destroy():s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*O.TARGET_FPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,e)/1e3,O.TARGET_FPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Zt._shared){const t=Zt._shared=new Zt;t.autoStart=!0,t._protected=!0}return Zt._shared}static get system(){if(!Zt._system){const t=Zt._system=new Zt;t.autoStart=!0,t._protected=!0}return Zt._system}}class _r{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,li.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Zt.shared:new Zt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}_r.extension=I.Application,K.add(_r);var Si=B(2005),ah=B(5469),rn=B(8762);const hh={parse:rn.Qc,format:rn.WU,resolve:rn.DB};function pe(i){if("string"!=typeof i)throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function mr(i){return i.split("?")[0].split("#")[0]}const te={toPosix:i=>function ch(i,t,e){return i.replace(new RegExp(function lh(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t),"g"),e)}(i,"\\","/"),isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl:i=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i),hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){pe(i),i=this.toPosix(i);let t="";const e=/^file:\/\/\//.exec(i),s=/^[^/:]+:\/\//.exec(i),n=/^[^/:]+:\//.exec(i);if(e||s||n){const r=e?.[0]||s?.[0]||n?.[0];t=r,i=i.slice(r.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;const s=mr(this.toPosix(t??O.ADAPTER.getBaseUrl())),n=mr(this.toPosix(e??this.rootname(s)));return pe(i),(i=this.toPosix(i)).startsWith("/")?te.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(s,i)},normalize(i){if(pe(i=this.toPosix(i)),0===i.length)return".";let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const s=i.endsWith("/");return i=function dh(i,t){let o,e="",s=0,n=-1,r=0;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(n!==a-1&&1!==r)if(n!==a-1&&2===r){if(e.length<2||2!==s||46!==e.charCodeAt(e.length-1)||46!==e.charCodeAt(e.length-2))if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){-1===l?(e="",s=0):(e=e.slice(0,l),s=e.length-1-e.lastIndexOf("/")),n=a,r=0;continue}}else if(2===e.length||1===e.length){e="",s=0,n=a,r=0;continue}t&&(e.length>0?e+="/..":e="..",s=2)}else e.length>0?e+=`/${i.slice(n+1,a)}`:e=i.slice(n+1,a),s=a-n-1;n=a,r=0}else 46===o&&-1!==r?++r:r=-1}return e}(i,!1),i.length>0&&s&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return pe(i),i=this.toPosix(i),!!this.hasProtocol(i)||i.startsWith("/")},join(...i){if(0===i.length)return".";let t;for(let e=0;e<i.length;++e){const s=i[e];pe(s),s.length>0&&(void 0===t?t=s:this.extname(i[e-1]??"")?t+=`/../${s}`:t+=`/${s}`)}return void 0===t?".":this.normalize(t)},dirname(i){if(pe(i),0===i.length)return".";let t=(i=this.toPosix(i)).charCodeAt(0);const e=47===t;let s=-1,n=!0;const r=this.getProtocol(i),o=i;for(let a=(i=i.slice(r.length)).length-1;a>=1;--a)if(t=i.charCodeAt(a),47===t){if(!n){s=a;break}}else n=!1;return-1===s?e?"/":this.isUrl(o)?r+i:r:e&&1===s?"//":r+i.slice(0,s)},rootname(i){pe(i);let t="";if(t=(i=this.toPosix(i)).startsWith("/")?"/":this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);t=-1!==e?i.slice(0,e):i,t.endsWith("/")||(t+="/")}return t},basename(i,t){pe(i),t&&pe(t),i=this.toPosix(i);let r,e=0,s=-1,n=!0;if(void 0!==t&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(r=i.length-1;r>=0;--r){const l=i.charCodeAt(r);if(47===l){if(!n){e=r+1;break}}else-1===a&&(n=!1,a=r+1),o>=0&&(l===t.charCodeAt(o)?-1==--o&&(s=r):(o=-1,s=a))}return e===s?s=a:-1===s&&(s=i.length),i.slice(e,s)}for(r=i.length-1;r>=0;--r)if(47===i.charCodeAt(r)){if(!n){e=r+1;break}}else-1===s&&(n=!1,s=r+1);return-1===s?"":i.slice(e,s)},extname(i){pe(i);let t=-1,e=0,s=-1,n=!0,r=0;for(let o=(i=this.toPosix(i)).length-1;o>=0;--o){const a=i.charCodeAt(o);if(47!==a)-1===s&&(n=!1,s=o+1),46===a?-1===t?t=o:1!==r&&(r=1):-1!==t&&(r=-1);else if(!n){e=o+1;break}}return-1===t||-1===s||0===r||1===r&&t===s-1&&t===e+1?"":i.slice(t,s)},parse(i){pe(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===i.length)return t;let e=(i=this.toPosix(i)).charCodeAt(0);const s=this.isAbsolute(i);let n;t.root=this.rootname(i),n=s||this.hasProtocol(i)?1:0;let o=-1,a=0,l=-1,c=!0,d=i.length-1,u=0;for(;d>=n;--d)if(e=i.charCodeAt(d),47!==e)-1===l&&(c=!1,l=d+1),46===e?-1===o?o=d:1!==u&&(u=1):-1!==o&&(u=-1);else if(!c){a=d+1;break}return-1===o||-1===l||0===u||1===u&&o===l-1&&o===a+1?-1!==l&&(t.base=t.name=i.slice(0===a&&s?1:a,l)):(0===a&&s?(t.name=i.slice(1,o),t.base=i.slice(1,l)):(t.name=i.slice(a,o),t.base=i.slice(a,l)),t.ext=i.slice(o,l)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};O.RETINA_PREFIX=/@([0-9\.]+)x/,O.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;const gr={};function ne(i,t,e=3){if(gr[t])return;let s=(new Error).stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${i}`):(s=s.split("\n").splice(e).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${i}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${i}`),console.warn(s))),gr[t]=!0}let on;var Qc={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Ei(i,t=[]){return t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(255&i)/255,t}function vr(i){let t=i.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function an(i){if("string"==typeof i&&("#"===(i=Qc[i.toLowerCase()]||i)[0]&&(i=i.slice(1)),3===i.length)){const[t,e,s]=i;i=t+t+e+e+s+s}return parseInt(i,16)}const yr=function td(){const i=[],t=[];for(let s=0;s<32;s++)i[s]=s,t[s]=s;i[z.NORMAL_NPM]=z.NORMAL,i[z.ADD_NPM]=z.ADD,i[z.SCREEN_NPM]=z.SCREEN,t[z.NORMAL]=z.NORMAL_NPM,t[z.ADD]=z.ADD_NPM,t[z.SCREEN]=z.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}();function xr(i,t){return yr[t?1:0][i]}function hn(i,t){if(1===t)return(255*t<<24)+i;if(0===t)return 0;let e=i>>16&255,s=i>>8&255,n=255&i;return e=e*t+.5|0,s=s*t+.5|0,n=n*t+.5|0,(255*t<<24)+(e<<16)+(s<<8)+n}function br(i,t,e,s){return(e=e||new Float32Array(4))[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(255&i)/255,(s||void 0===s)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function ln(i){if(4===i.BYTES_PER_ELEMENT)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===i.BYTES_PER_ELEMENT){if(i instanceof Uint16Array)return"Uint16Array"}else if(1===i.BYTES_PER_ELEMENT&&i instanceof Uint8Array)return"Uint8Array";return null}function Ji(i){return i+=0===i?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,1+(i|=i>>>16)}function wr(i){return!(i&i-1||!i)}function Tr(i){let t=(i>65535?1:0)<<4,e=((i>>>=t)>255?1:0)<<3;return t|=e,e=((i>>>=e)>15?1:0)<<2,t|=e,e=((i>>>=e)>3?1:0)<<1,t|=e,t|(i>>>=e)>>1}function ci(i,t,e){const s=i.length;let n;if(t>=s||0===e)return;const r=s-(e=t+e>s?s-t:e);for(n=t;n<r;++n)i[n]=i[n+e];i.length=r}function di(i){return 0===i?0:i<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let nd=0;function Ze(){return++nd}const Sr={},re=Object.create(null),le=Object.create(null);class Er{constructor(t,e,s){this.canvas=O.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=s||O.RESOLUTION,this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function Cr(i,t,e){for(let s=0,n=4*e*t;s<t;++s,n+=4)if(0!==i[n+3])return!1;return!0}function Ar(i,t,e,s,n){const r=4*t;for(let o=s,a=s*r+4*e;o<=n;++o,a+=r)if(0!==i[a+3])return!1;return!0}let Qi;function Le(i,t=1){const e=O.RETINA_PREFIX.exec(i);return e?parseFloat(e[1]):t}const cn=[];function Rr(i,t){if(!i)return null;let e="";if("string"==typeof i){const s=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);s&&(e=s[1].toLowerCase())}for(let s=cn.length-1;s>=0;--s){const n=cn[s];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ci{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new fe("setRealSize"),this.onUpdate=new fe("update"),this.onError=new fe("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Ai extends Ci{constructor(t,e){const{width:s,height:n}=e||{};if(!s||!n)throw new Error("BufferResource width or height invalid");super(s,n),this.data=t}upload(t,e,s){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Rt.UNPACK);const r=e.realWidth,o=e.realHeight;return s.width===r&&s.height===o?n.texSubImage2D(e.target,0,0,0,r,o,e.format,s.type,this.data):(s.width=r,s.height=o,n.texImage2D(e.target,0,s.internalFormat,r,o,0,e.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const hd={scaleMode:At.NEAREST,format:P.RGBA,alphaMode:Rt.NPM},Ri=class extends Si{constructor(i=null,t=null){super(),t=t||{};const{alphaMode:e,mipmap:s,anisotropicLevel:n,scaleMode:r,width:o,height:a,wrapMode:l,format:c,type:d,target:u,resolution:f,resourceOptions:p}=t;i&&!(i instanceof Ci)&&((i=Rr(i,p)).internal=!0),this.resolution=f||O.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=s??O.MIPMAP_TEXTURES,this.anisotropicLevel=n??O.ANISOTROPIC_LEVEL,this._wrapMode=l||O.WRAP_MODE,this._scaleMode=r??O.SCALE_MODE,this.format=c||P.RGBA,this.type=d||F.UNSIGNED_BYTE,this.target=u||Et.TEXTURE_2D,this.alphaMode=e??Rt.UNPACK,this.uid=Ze(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return void 0!==i&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return this.setRealSize(i*(e=e||this.resolution),t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=wr(this.realWidth)&&wr(this.realHeight)}setResolution(i){const t=this.resolution;return t===i||(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT()),this}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete le[this.cacheId],delete re[this.cacheId],this.cacheId=null),this.dispose(),Ri.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=O.STRICT_TEXTURE_CACHE){const s="string"==typeof i;let n=null;s?n=i:(i._pixiId||(i._pixiId=`${t?.pixiIdPrefix||"pixiid"}_${Ze()}`),n=i._pixiId);let r=le[n];if(s&&e&&!r)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return r||(r=new Ri(i,t),r.cacheId=n,Ri.addToCache(r,n)),r}static fromBuffer(i,t,e,s){i=i||new Float32Array(t*e*4);const n=new Ai(i,{width:t,height:e}),r=i instanceof Float32Array?F.FLOAT:F.UNSIGNED_BYTE;return new Ri(n,Object.assign({},hd,s||{width:t,height:e,type:r}))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),le[t]&&le[t]!==i&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),le[t]=i)}static removeFromCache(i){if("string"==typeof i){const t=le[i];if(t){const e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete le[i],t}}else if(i?.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete le[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}};let wt=Ri;wt._globalBatch=0;class Ir extends Ci{constructor(t,e){const{width:s,height:n}=e||{};super(s,n),this.items=[],this.itemDirtyIds=[];for(let r=0;r<t;r++){const o=new wt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let s=0;s<this.length;s++)!t[s]||(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):this.addResourceAt(t[s]instanceof Ci?t[s]:Rr(t[s],e),s))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(s=>s.resource).filter(s=>s).map(s=>s.load());return this._load=Promise.all(e).then(()=>{const{realWidth:s,realHeight:n}=this.items[0];return this.resize(s,n),Promise.resolve(this)}),this._load}}class Ne extends Ci{constructor(t){super(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,s){void 0!==s||e.startsWith("data:")?!1!==s&&(t.crossOrigin="string"==typeof s?s:"anonymous"):t.crossOrigin=function ad(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,Qi||(Qi=document.createElement("a")),Qi.href=i;const e=hh.parse(Qi.href);return e.hostname!==t.hostname||(e.port||""!==t.port)&&e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}(e)}upload(t,e,s,n){const r=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&0===n.buffered.length)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Rt.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||s.width!==o||s.height!==a?(s.width=o,s.height=a,r.texImage2D(e.target,0,s.internalFormat,e.format,s.type,n)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,s.type,n),!0}update(){if(this.destroyed)return;const t=this.source;this.resize(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),super.update()}dispose(){this.source=null}}const Ii=class extends Ir{constructor(i,t){const{width:e,height:s,autoLoad:n,linkBaseTexture:r}=t||{};if(i&&i.length!==Ii.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:s});for(let o=0;o<Ii.SIDES;o++)this.items[o].target=Et.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==r,i&&this.initFromArray(i,t),!1!==n&&this.load()}bind(i){super.bind(i),i.target=Et.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(void 0===e&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0){if(!i.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(i.resource,t)}else i.target=Et.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){const s=this.itemDirtyIds;for(let n=0;n<Ii.SIDES;n++){const r=this.items[n];(s[n]<r.dirtyId||e.dirtyId<t.dirtyId)&&(r.valid&&r.resource?(r.resource.upload(i,r,e),s[n]=r.dirtyId):s[n]<-1&&(i.gl.texImage2D(r.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),s[n]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===Ii.SIDES}};let Mr=Ii;Mr.SIDES=6;class Pr extends Ne{constructor(t,e){if(e=e||{},"string"==typeof t){const s=new Image;Ne.crossOrigin(s,t,e.crossorigin),s.src=t,t=s}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??O.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((e,s)=>{const n=this.source;this.url=n.src;const r=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,e(this.createBitmap?this.process():this))};n.complete&&n.src?r():(n.onload=r,n.onerror=o=>{s(o),this.onError.emit(o)})})),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap;return this._process=fetch(t.src,{mode:t.crossOrigin&&"anonymous"!==t.crossOrigin?"no-cors":"cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===Rt.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,s){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,s,this.bitmap),!this.preserveBitmap){let n=!0;const r=e._glTextures;for(const o in r){const a=r[o];if(a!==s&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}const ts=class extends Ne{constructor(i,t){t=t||{},super(O.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},ts.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const i=new Image;Ne.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{!this._resolve||(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;const t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,n=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/e*t,n=this._overrideHeight||this._overrideWidth/t*e),s=Math.round(s),n=Math.round(n);const r=this.source;r.width=s,r.height=n,r._pixiId=`canvas_${Ze()}`,r.getContext("2d").drawImage(i,0,0,t,e,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(i){const t=ts.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return"svg"===t||"string"==typeof i&&i.startsWith("data:image/svg+xml")||"string"==typeof i&&ts.SVG_XML.test(i)}};let Mi=ts;Mi.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Mi.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const dn=class extends Ne{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),"string"==typeof i&&(i=[i]),Ne.crossOrigin(e,i[0].src||i[0],t.crossorigin);for(let n=0;n<i.length;++n){const r=document.createElement("source");let{src:o,mime:a}=i[n];o=o||i[n];const l=o.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);a=a||dn.MIME_TYPES[c]||`video/${c}`,r.src=o,r.type=a,e.appendChild(r)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==t.autoLoad&&this.load()}update(i=0){this.destroyed||(this._msToNextUpdate=Math.floor(this._msToNextUpdate-Zt.shared.elapsedMS*this.source.playbackRate),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Zt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Zt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(Zt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Zt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Zt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||dn.TYPES.includes(t)}};let un=dn;un.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],un.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class ui extends Ne{constructor(t,e){var s=(...n)=>{super(...n)};e=e||{},"string"==typeof t?(s(ui.EMPTY),this.url=t):(s(t),this.url=null),this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){var t=this;return this._load||(this._load=new Promise(function(){var e=X(function*(s,n){if(null!==t.url)try{const r=yield O.ADAPTER.fetch(t.url,{mode:t.crossOrigin?"cors":"no-cors"});if(t.destroyed)return;const o=yield r.blob();if(t.destroyed)return;const a=yield createImageBitmap(o,{premultiplyAlpha:null===t.alphaMode||t.alphaMode===Rt.UNPACK?"premultiply":"none"});if(t.destroyed)return;t.source=a,t.update(),s(t)}catch(r){if(t.destroyed)return;n(r),t.onError.emit(r)}else s(t)});return function(s,n){return e.apply(this,arguments)}}())),this._load}upload(t,e,s){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,s)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return ui._EMPTY=ui._EMPTY??O.ADAPTER.createCanvas(0,0),ui._EMPTY}}cn.push(ui,Pr,class cd extends Ne{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},un,Mi,Ai,Mr,class ld extends Ir{constructor(t,e){const{width:s,height:n}=e||{};let r,o;Array.isArray(t)?(r=t,o=t.length):o=t,super(o,{width:s,height:n}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=Et.TEXTURE_2D_ARRAY}upload(t,e,s){const{length:n,itemDirtyIds:r,items:o}=this,{gl:a}=t;s.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,n,0,e.format,s.type,null);for(let l=0;l<n;l++){const c=o[l];r[l]<c.dirtyId&&(r[l]=c.dirtyId,c.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,c.resource.width,c.resource.height,1,e.format,s.type,c.resource.source))}return!0}});class dd extends Ai{upload(t,e,s){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Rt.UNPACK);const r=e.realWidth,o=e.realHeight;return s.width===r&&s.height===o?n.texSubImage2D(e.target,0,0,0,r,o,e.format,s.type,this.data):(s.width=r,s.height=o,n.texImage2D(e.target,0,s.internalFormat,r,o,0,e.format,s.type,this.data)),!0}}class fn{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new fe("disposeFramebuffer"),this.multisample=st.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new wt(null,{scaleMode:At.NEAREST,resolution:1,mipmap:ht.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new wt(new dd(null,{width:this.width,height:this.height}),{scaleMode:At.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ht.OFF,format:P.DEPTH_COMPONENT,type:F.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const n=this.colorTextures[s],r=n.resolution;n.setSize(t/r,e/r)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Dr extends wt{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=st.NONE),super(null,t),this.mipmap=ht.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new fn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Or{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,s){const n=e.width,r=e.height;if(s){const o=t.width/2/n,a=t.height/2/r,l=t.x/n+o,c=t.y/r+a;s=Ut.add(s,Ut.NW),this.x0=l+o*Ut.uX(s),this.y0=c+a*Ut.uY(s),s=Ut.add(s,2),this.x1=l+o*Ut.uX(s),this.y1=c+a*Ut.uY(s),s=Ut.add(s,2),this.x2=l+o*Ut.uX(s),this.y2=c+a*Ut.uY(s),s=Ut.add(s,2),this.x3=l+o*Ut.uX(s),this.y3=c+a*Ut.uY(s)}else this.x0=t.x/n,this.y0=t.y/r,this.x1=(t.x+t.width)/n,this.y1=t.y/r,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/r,this.x3=t.x/n,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Br=new Or;function es(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class tt extends Si{constructor(t,e,s,n,r,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new yt(0,0,1,1)),t instanceof tt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=Br,this.uvMatrix=null,this.orig=s||e,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new bt(o.x,o.y):new bt(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&re[e.url]&&tt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,tt.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),s=new tt(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(s._frame=t),s}updateUvs(){this._uvs===Br&&(this._uvs=new Or),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},s=O.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let r=null;n?r=t:t instanceof wt?(t.cacheId||(t.cacheId=`${e?.pixiIdPrefix||"pixiid"}-${Ze()}`,wt.addToCache(t,t.cacheId)),r=t.cacheId):(t._pixiId||(t._pixiId=`${e?.pixiIdPrefix||"pixiid"}_${Ze()}`),r=t._pixiId);let o=re[r];if(n&&s&&!o)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return o||t instanceof wt?!o&&t instanceof wt&&(o=new tt(t),tt.addToCache(o,r)):(e.resolution||(e.resolution=Le(t)),o=new tt(new wt(t,e)),o.baseTexture.cacheId=r,wt.addToCache(o.baseTexture,r),tt.addToCache(o,r)),o}static fromURL(t,e){const s=Object.assign({autoLoad:!1},e?.resourceOptions),n=tt.from(t,Object.assign({resourceOptions:s},e),!1),r=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):r.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,s,n){return new tt(wt.fromBuffer(t,e,s,n))}static fromLoader(t,e,s,n){const r=new wt(t,Object.assign({scaleMode:O.SCALE_MODE,resolution:Le(e)},n)),{resource:o}=r;o instanceof Pr&&(o.url=e);const a=new tt(r);return s||(s=e),wt.addToCache(a.baseTexture,s),tt.addToCache(a,s),s!==e&&(wt.addToCache(a.baseTexture,e),tt.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),re[e]&&re[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),re[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=re[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete re[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)re[t.textureCacheIds[e]]===t&&delete re[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:s,width:n,height:r}=t,o=e+n>this.baseTexture.width,a=s+r>this.baseTexture.height;if(o||a)throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width} ${o&&a?"and":"or"} Y: ${s} + ${r} = ${s+r} > ${this.baseTexture.height}`);this.valid=n&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return tt._EMPTY||(tt._EMPTY=new tt(new wt),es(tt._EMPTY),es(tt._EMPTY.baseTexture)),tt._EMPTY}static get WHITE(){if(!tt._WHITE){const t=O.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),tt._WHITE=new tt(wt.from(t)),es(tt._WHITE),es(tt._WHITE.baseTexture)}return tt._WHITE}}class Ue extends tt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,s=!0){const n=this.baseTexture.resolution,r=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=r>0&&o>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=o,s&&this.baseTexture.resize(r,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ue(new Dr(t))}}let ud=(()=>{class i{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,s,n=st.NONE){const r=new Dr(Object.assign({width:e,height:s,resolution:1,multisample:n},this.textureOptions));return new Ue(r)}getOptimalTexture(e,s,n=1,r=st.NONE){let o;e=Math.ceil(e*n-1e-6),s=Math.ceil(s*n-1e-6),this.enableFullScreen&&e===this._pixelsWidth&&s===this._pixelsHeight?o=r>1?-r:-1:(o=((65535&(e=Ji(e)))<<16|65535&(s=Ji(s)))>>>0,r>1&&(o+=4294967296*r)),this.texturePool[o]||(this.texturePool[o]=[]);let a=this.texturePool[o].pop();return a||(a=this.createTexture(e,s,r)),a.filterPoolKey=o,a.setResolution(n),a}getFilterTexture(e,s,n){const r=this.getOptimalTexture(e.width,e.height,s||e.resolution,n||st.NONE);return r.filterFrame=e.filterFrame,r}returnTexture(e){const s=e.filterPoolKey;e.filterFrame=null,this.texturePool[s].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const s in this.texturePool){const n=this.texturePool[s];if(n)for(let r=0;r<n.length;r++)n[r].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const s in this.texturePool){if(!(Number(s)<0))continue;const n=this.texturePool[s];if(n)for(let r=0;r<n.length;r++)n[r].destroy(!0);this.texturePool[s]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}return i.SCREEN_KEY=-1,i})();class is{constructor(t,e=0,s=!1,n=F.FLOAT,r,o,a){this.buffer=t,this.size=e,this.normalized=s,this.type=n,this.stride=r,this.start=o,this.instance=a}destroy(){this.buffer=null}static from(t,e,s,n,r){return new is(t,e,s,n,r)}}let fd=0;class $t{constructor(t,e=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=e,this.id=fd++,this.disposeRunner=new fe("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?S.ELEMENT_ARRAY_BUFFER:S.ARRAY_BUFFER}get index(){return this.type===S.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new $t(t)}}const pd={Float32Array,Uint32Array,Int32Array,Uint8Array},Fr={5126:4,5123:2,5121:1};let md=0;const gd={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ge{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=md++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new fe("disposeGeometry"),this.refCount=0}addAttribute(t,e,s=0,n=!1,r,o,a,l=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof $t||(e instanceof Array&&(e=new Float32Array(e)),e=new $t(e));const c=t.split("|");if(c.length>1){for(let u=0;u<c.length;u++)this.addAttribute(c[u],e,s,n,r);return this}let d=this.buffers.indexOf(e);return-1===d&&(this.buffers.push(e),d=this.buffers.length-1),this.attributes[t]=new is(d,s,n,r,o,a,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof $t||(t instanceof Array&&(t=new Uint16Array(t)),t=new $t(t)),t.type=S.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],s=new $t;let n;for(n in this.attributes){const r=this.attributes[n];t.push(this.buffers[r.buffer].data),e.push(r.size*Fr[r.type]/4),r.buffer=0}for(s.data=function _d(i,t){let e=0,s=0;const n={};for(let l=0;l<i.length;l++)s+=t[l],e+=i[l].length;const r=new ArrayBuffer(4*e);let o=null,a=0;for(let l=0;l<i.length;l++){const c=t[l],d=i[l],u=ln(d);n[u]||(n[u]=new pd[u](r)),o=n[u];for(let f=0;f<d.length;f++)o[(f/c|0)*s+a+f%c]=d[f];a+=c}return new Float32Array(r)}(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ge;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new $t(this.buffers[e].data.slice(0));for(const e in this.attributes){const s=this.attributes[e];t.attributes[e]=new is(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=S.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ge,s=[],n=[],r=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)n[l]=n[l]||0,n[l]+=o.buffers[l].data.length,r[l]=0}for(let a=0;a<o.buffers.length;a++)s[a]=new(gd[ln(o.buffers[a].data)])(n[a]),e.buffers[a]=new $t(s[a]);for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)s[l].set(o.buffers[l].data,r[l]),r[l]+=o.buffers[l].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=S.ELEMENT_ARRAY_BUFFER;let a=0,l=0,c=0,d=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){d=u;break}for(const u in o.attributes){const f=o.attributes[u];(0|f.buffer)===d&&(l+=f.size*Fr[f.type]/4)}for(let u=0;u<t.length;u++){const f=t[u].indexBuffer.data;for(let p=0;p<f.length;p++)e.indexBuffer.data[p+c]+=a;a+=t[u].buffers[d].data.length/l,c+=f.length}}return e}}class vd extends Ge{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class kr extends Ge{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new $t(this.vertices),this.uvBuffer=new $t(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let s=0,n=0;return this.uvs[0]=s,this.uvs[1]=n,this.uvs[2]=s+e.width/t.width,this.uvs[3]=n,this.uvs[4]=s+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=s,this.uvs[7]=n+e.height/t.height,s=e.x,n=e.y,this.vertices[0]=s,this.vertices[1]=n,this.vertices[2]=s+e.width,this.vertices[3]=n,this.vertices[4]=s+e.width,this.vertices[5]=n+e.height,this.vertices[6]=s,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let yd=0;class _e{constructor(t,e,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=yd++,this.static=!!e,this.ubo=!!s,t instanceof $t?(this.buffer=t,this.buffer.type=S.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new $t(new Float32Array(1)),this.buffer.type=S.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,s){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new _e(e,s)}static from(t,e,s){return new _e(t,e,s)}static uboFrom(t,e){return new _e(t,e??!0,!0)}}class xd{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=st.NONE,this.sourceFrame=new yt,this.destinationFrame=new yt,this.bindingSourceFrame=new yt,this.bindingDestinationFrame=new yt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ss=[new bt,new bt,new bt,new bt],pn=new kt;class Lr{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new ud,this.statePool=[],this.quad=new vd,this.quadUv=new kr,this.tempRect=new yt,this.activeState={},this.globalUniforms=new _e({outputFrame:new yt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const s=this.renderer,n=this.defaultFilterStack,r=this.statePool.pop()||new xd,o=this.renderer.renderTexture;let a=e[0].resolution,l=e[0].multisample,c=e[0].padding,d=e[0].autoFit,u=e[0].legacy??!0;for(let _=1;_<e.length;_++){const g=e[_];a=Math.min(a,g.resolution),l=Math.min(l,g.multisample),c=this.useMaxPadding?Math.max(c,g.padding):c+g.padding,d=d&&g.autoFit,u=u||(g.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(r),r.resolution=a,r.multisample=l,r.legacy=u,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(c);const f=this.tempRect.copyFrom(o.sourceFrame);s.projection.transform&&this.transformAABB(pn.copyFrom(s.projection.transform).invert(),f),d?(r.sourceFrame.fit(f),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(f)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,o.current?o.current.resolution:s.resolution,o.sourceFrame,o.destinationFrame,s.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,a,l),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=r.sourceFrame.width,p.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(o.sourceFrame),r.bindingDestinationFrame.copyFrom(o.destinationFrame),r.transform=s.projection.transform,s.projection.transform=null,o.bind(r.renderTexture,r.sourceFrame,p),s.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),s=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const r=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],o[0]=Math.round(r[0]*e.resolution),o[1]=Math.round(r[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*r[2]-.5*o[2],a[3]=e.sourceFrame.height*r[3]-.5*o[3],e.legacy){const c=n.filterArea;c[0]=e.destinationFrame.width,c[1]=e.destinationFrame.height,c[2]=e.sourceFrame.x,c[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===s.length)s[0].apply(this,e.renderTexture,l.renderTexture,Nt.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let c=e.renderTexture,d=this.getOptimalFilterTexture(c.width,c.height,e.resolution);d.filterFrame=c.filterFrame;let u=0;for(u=0;u<s.length-1;++u){1===u&&e.multisample>1&&(d=this.getOptimalFilterTexture(c.width,c.height,e.resolution),d.filterFrame=c.filterFrame),s[u].apply(this,c,d,Nt.CLEAR,e);const f=c;c=d,d=f}s[u].apply(this,c,l.renderTexture,Nt.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(d)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Nt.CLEAR){const{renderTexture:s,state:n}=this.renderer;if(this.renderer.projection.transform=t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.activeState.transform:null,t?.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,s.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);(e===Nt.CLEAR||e===Nt.BLIT&&(1&n.stateId||this.forceClear))&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,s,n){const r=this.renderer;r.state.set(t.state),this.bindAndClear(s,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(pt.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(pt.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:s,destinationFrame:n}=this.activeState,{orig:r}=e._texture,o=t.set(n.width,0,0,n.height,s.x,s.y),a=e.worldTransform.copyTo(kt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/r.width,1/r.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,s=1,n=st.NONE){return this.texturePool.getOptimalTexture(t,e,s,n)}getFilterTexture(t,e,s){if("number"==typeof t){const r=t;t=e,e=r}const n=this.texturePool.getOptimalTexture((t=t||this.activeState.renderTexture).width,t.height,e||t.resolution,s||st.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const s=ss[0],n=ss[1],r=ss[2],o=ss[3];s.set(e.left,e.top),n.set(e.left,e.bottom),r.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(s,s),t.apply(n,n),t.apply(r,r),t.apply(o,o);const a=Math.min(s.x,n.x,r.x,o.x),l=Math.min(s.y,n.y,r.y,o.y),c=Math.max(s.x,n.x,r.x,o.x),d=Math.max(s.y,n.y,r.y,o.y);e.x=a,e.y=l,e.width=c-a,e.height=d-l}roundFrame(t,e,s,n,r){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(r){const{a:o,b:a,c:l,d:c}=r;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}(r=r?pn.copyFrom(r):pn.identity()).translate(-s.x,-s.y).scale(n.width/s.width,n.height/s.height).translate(n.x,n.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}Lr.extension={type:I.RendererSystem,name:"filter"},K.add(Lr);class ns{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}class Nr{constructor(t){this.renderer=t,this.emptyRenderer=new ns(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:s}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=s[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,s,n){const{elements:r,ids:o,count:a}=t;let l=0;for(let c=0;c<a;c++){const d=r[c],u=d._batchLocation;if(u>=0&&u<n&&e[u]===d)o[c]=u;else for(;l<n;){const f=e[l];if(!f||f._batchEnabled!==s||f._batchLocation!==l){o[c]=l,d._batchLocation=l,e[l]=d;break}l++}}}destroy(){this.renderer=null}}Nr.extension={type:I.RendererSystem,name:"batch"},K.add(Nr);let Ur=0;class Gr{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Ur++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,s=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:s,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Ur++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let s;if(O.PREFER_ENV>=et.WEBGL2&&(s=t.getContext("webgl2",e)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Gr.extension={type:I.RendererSystem,name:"context"},K.add(Gr);class bd{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=st.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const wd=new yt;class Hr{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new fn(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new yt,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;O.PREFER_ENV===et.WEBGL_LEGACY&&(e=null,s=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,s=0){const{gl:n}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=s),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>s,l=o/e.width;this.setViewport(e.x*l,e.y*l,o,e.height>>s)}else this.setViewport(0,0,t.width>>s,t.height>>s)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,s,n){const r=this.viewport;t=Math.round(t),e=Math.round(e),s=Math.round(s),n=Math.round(n),(r.width!==s||r.height!==n||r.x!==t||r.y!==e)&&(r.x=t,r.y=e,r.width=s,r.height=n,this.gl.viewport(t,e,s,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,s,n,r=rt.COLOR|rt.DEPTH){const{gl:o}=this;o.clearColor(t,e,s,n),o.clear(r)}initFramebuffer(t){const{gl:e}=this,s=new bd(e.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:e}=this,s=t.glFramebuffers[this.CONTEXT_UID];s.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,s.stencil),s.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let r=n.length;e.drawBuffers||(r=Math.min(r,1));for(let o=0;o<r;o++){const a=n[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),0===o&&s.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,s.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:s}=this,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let o=r.length;s.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||s.createRenderbuffer():n.msaaBuffer&&(s.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const c=r[l],d=c.parentTextureArray||c;this.renderer.texture.bind(d,0),0===l&&n.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,n.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,n.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+l,c.target,d._glTextures[this.CONTEXT_UID].texture,e),a.push(s.COLOR_ATTACHMENT0+l))}if(a.length>1&&s.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const c=t.depthTexture;this.renderer.texture.bind(c,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?n.stencil&&(s.deleteRenderbuffer(n.stencil),n.stencil=null):(n.stencil=n.stencil||s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,n.stencil),n.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let s=st.NONE;if(t<=1||null===e)return s;for(let n=0;n<e.length;n++)if(e[n]<=t){s=e[n];break}return 1===s&&(s=st.NONE),s}blit(t,e,s){const{current:n,renderer:r,gl:o,CONTEXT_UID:a}=this;if(2!==r.context.webGLVersion||!n)return;const l=n.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;const d=n.colorTextures[0];if(!d)return;l.blitFramebuffer||(l.blitFramebuffer=new fn(n.width,n.height),l.blitFramebuffer.addColorTexture(0,d)),(t=l.blitFramebuffer).colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=wd).width=n.width,e.height=n.height),s||(s=e);const c=e.width===s.width&&e.height===s.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,s.left,s.top,s.right,s.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR)}disposeFramebuffer(t,e){const s=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&n.deleteRenderbuffer(s.msaaBuffer),s.stencil&&n.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&s.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<e.length;s++)this.disposeFramebuffer(e[s],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const s=t.width,n=t.height,r=this.gl,o=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,o),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,s,n):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,s,n),e.stencil=o,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new yt}destroy(){this.renderer=null}}Hr.extension={type:I.RendererSystem,name:"framebuffer"},K.add(Hr);const _n={5126:4,5123:2,5121:1};class Xr{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let s=this.renderer.context.extensions.vertexArrayObject;O.PREFER_ENV===et.WEBGL_LEGACY&&(s=null),s?(t.createVertexArray=()=>s.createVertexArrayOES(),t.bindVertexArray=n=>s.bindVertexArrayOES(n),t.deleteVertexArray=n=>s.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=(n,r)=>s.vertexAttribDivisorANGLE(n,r),t.drawElementsInstanced=(n,r,o,a,l)=>s.drawElementsInstancedANGLE(n,r,o,a,l),t.drawArraysInstanced=(n,r,o,a)=>s.drawArraysInstancedANGLE(n,r,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:s}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},r=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?s.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++)e.update(t.buffers[s])}checkCompatibility(t,e){const s=t.attributes,n=e.attributeData;for(const r in n)if(!s[r])throw new Error(`shader and geometry incompatible, geometry missing the "${r}" attribute`)}getSignature(t,e){const s=t.attributes,n=e.attributeData,r=["g",t.id];for(const o in s)n[o]&&r.push(o,n[o].location);return r.join("-")}initGeometryVao(t,e,s=!0){const n=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const l=this.getSignature(t,a),c=t.glVertexArrayObjects[this.CONTEXT_UID];let d=c[l];if(d)return c[a.id]=d,d;const u=t.buffers,f=t.attributes,p={},_={};for(const g in u)p[g]=0,_[g]=0;for(const g in f)!f[g].size&&a.attributeData[g]?f[g].size=a.attributeData[g].size:f[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),p[f[g].buffer]+=f[g].size*_n[f[g].type];for(const g in f){const x=f[g],T=x.size;void 0===x.stride&&(x.stride=p[x.buffer]===T*_n[x.type]?0:p[x.buffer]),void 0===x.start&&(x.start=_[x.buffer],_[x.buffer]+=T*_n[x.type])}d=n.createVertexArray(),n.bindVertexArray(d);for(let g=0;g<u.length;g++){const x=u[g];o.bind(x),s&&x._glBuffers[r].refCount++}return this.activateVao(t,a),c[a.id]=d,c[l]=d,n.bindVertexArray(null),o.unbind(S.ARRAY_BUFFER),d}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const s=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,r=t.buffers,o=this.renderer?.buffer;if(t.disposeRunner.remove(this),s){if(o)for(let a=0;a<r.length;a++){const l=r[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!e&&o.dispose(r[a],e))}if(!e)for(const a in s)if("g"===a[0]){const l=s[a];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let s=0;s<e.length;s++)this.disposeGeometry(this.managedGeometries[e[s]],t)}activateVao(t,e){const s=this.gl,n=this.CONTEXT_UID,r=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let l=null;for(const c in a){const d=a[c],u=o[d.buffer],f=u._glBuffers[n];if(e.attributeData[c]){l!==f&&(r.bind(u),l=f);const p=e.attributeData[c].location;if(s.enableVertexAttribArray(p),s.vertexAttribPointer(p,d.size,d.type||s.FLOAT,d.normalized,d.stride,d.start),d.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");s.vertexAttribDivisor(p,1)}}}}draw(t,e,s,n){const{gl:r}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=2===a?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?o.instanced?r.drawElementsInstanced(t,e||o.indexBuffer.data.length,l,(s||0)*a,n||1):r.drawElements(t,e||o.indexBuffer.data.length,l,(s||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?r.drawArraysInstanced(t,s,e||o.getSize(),n||1):r.drawArrays(t,s,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Xr.extension={type:I.RendererSystem,name:"geometry"},K.add(Xr);class Td{constructor(t=null){this.type=Ft.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=O.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ft.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}const Vr={};let os,rs=Vr;function zr(i,t,e){if("precision"!==i.substring(0,9)){let s=t;return t===Ot.HIGH&&e!==Ot.HIGH&&(s=Ot.MEDIUM),`precision ${s} float;\n${i}`}return e!==Ot.HIGH&&"precision highp"===i.substring(0,15)?i.replace("precision highp","precision mediump"):i}const Cd={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Yr(i){return Cd[i]}let as=null;const Wr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function jr(i,t){if(!as){const e=Object.keys(Wr);as={};for(let s=0;s<e.length;++s){const n=e[s];as[i[n]]=Wr[n]}}return as[t]}const fi=[{test:i=>"float"===i.type&&1===i.size&&!i.isArray,code:i=>`\n            if(uv["${i}"] !== ud["${i}"].value)\n            {\n                ud["${i}"].value = uv["${i}"]\n                gl.uniform1f(ud["${i}"].location, uv["${i}"])\n            }\n            `},{test:(i,t)=>!("sampler2D"!==i.type&&"samplerCube"!==i.type&&"sampler2DArray"!==i.type||1!==i.size||i.isArray||null!=t&&void 0===t.castToBaseTexture),code:i=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${i}"], t);\n\n            if(ud["${i}"].value !== t)\n            {\n                ud["${i}"].value = t;\n                gl.uniform1i(ud["${i}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(i,t)=>"mat3"===i.type&&1===i.size&&!i.isArray&&void 0!==t.a,code:i=>`\n            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));\n            `,codeUbo:i=>`\n                var ${i}_matrix = uv.${i}.toArray(true);\n\n                data[offset] = ${i}_matrix[0];\n                data[offset+1] = ${i}_matrix[1];\n                data[offset+2] = ${i}_matrix[2];\n        \n                data[offset + 4] = ${i}_matrix[3];\n                data[offset + 5] = ${i}_matrix[4];\n                data[offset + 6] = ${i}_matrix[5];\n        \n                data[offset + 8] = ${i}_matrix[6];\n                data[offset + 9] = ${i}_matrix[7];\n                data[offset + 10] = ${i}_matrix[8];\n            `},{test:(i,t)=>"vec2"===i.type&&1===i.size&&!i.isArray&&void 0!==t.x,code:i=>`\n                cv = ud["${i}"].value;\n                v = uv["${i}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${i}"].location, v.x, v.y);\n                }`,codeUbo:i=>`\n                v = uv.${i};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:i=>"vec2"===i.type&&1===i.size&&!i.isArray,code:i=>`\n                cv = ud["${i}"].value;\n                v = uv["${i}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);\n                }\n            `},{test:(i,t)=>"vec4"===i.type&&1===i.size&&!i.isArray&&void 0!==t.width,code:i=>`\n                cv = ud["${i}"].value;\n                v = uv["${i}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:i=>`\n                    v = uv.${i};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:i=>"vec4"===i.type&&1===i.size&&!i.isArray,code:i=>`\n                cv = ud["${i}"].value;\n                v = uv["${i}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])\n                }`}],Ad={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Rd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Md=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Pd(i){let t="";for(let e=0;e<i;++e)e>0&&(t+="\nelse "),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}let Fd=0;const hs={};class Ee{constructor(t,e,s="pixi-shader",n={}){this.extra={},this.id=Fd++,this.vertexSrc=t||Ee.defaultVertexSrc,this.fragmentSrc=e||Ee.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,"#version"!==this.vertexSrc.substring(0,8)&&(s=s.replace(/\s+/g,"-"),hs[s]?(hs[s]++,s+=`-${hs[s]}`):hs[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}\n${this.fragmentSrc}`,this.vertexSrc=zr(this.vertexSrc,O.PRECISION_VERTEX,Ot.HIGH),this.fragmentSrc=zr(this.fragmentSrc,O.PRECISION_FRAGMENT,function Ed(){if(!os){os=Ot.MEDIUM;const i=function Sd(){if(rs===Vr||rs?.isContextLost()){const i=O.ADAPTER.createCanvas();let t;O.PREFER_ENV>=et.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),rs=t}return rs}();i&&i.getShaderPrecisionFormat&&(os=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?Ot.HIGH:Ot.MEDIUM)}return os}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,s){const n=t+e;let r=Sr[n];return r||(Sr[n]=r=new Ee(t,e,s)),r}}class be{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof _e?e:new _e(e):new _e({}),this.disposeRunner=new fe("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const s in e.uniforms){const n=e.uniforms[s];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,s){const n=Ee.from(t,e);return new be(n,s)}}class Ce{constructor(){this.data=0,this.blendMode=z.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==z.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Ce;return t.depthTest=!1,t.blend=!0,t}}class me extends be{constructor(t,e,s){super(Ee.from(t||me.defaultVertexSrc,e||me.defaultFragmentSrc),s),this.padding=0,this.resolution=O.FILTER_RESOLUTION,this.multisample=O.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new Ce}apply(t,e,s,n,r){t.applyFilter(this,e,s,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}}const $r=new kt;class Zr{constructor(t,e){this._texture=t,this.mapCoord=new kt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const s=this.mapCoord;for(let n=0;n<t.length;n+=2){const r=t[n],o=t[n+1];e[n]=r*s.a+o*s.c+s.tx,e[n+1]=r*s.b+o*s.d+s.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const s=e._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const n=e.orig,r=e.trim;r&&($r.set(n.width/r.width,0,0,n.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append($r));const o=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,c=this.clampOffset;return a[0]=(e._frame.x+l+c)/o.width,a[1]=(e._frame.y+l+c)/o.height,a[2]=(e._frame.x+e._frame.width-l+c)/o.width,a[3]=(e._frame.y+e._frame.height-l+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0}}class Gd extends me{constructor(t,e,s){let n=null;"string"!=typeof t&&void 0===e&&void 0===s&&(n=t,t=void 0,e=void 0,s=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",s),this.maskSprite=n,this.maskMatrix=new kt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,s,n){const r=this._maskSprite,o=r._texture;!o.valid||(o.uvMatrix||(o.uvMatrix=new Zr(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,s,n))}}class qr{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let s=e;if(!s.isMaskData){const r=this.maskDataPool.pop()||new Td;r.pooled=!0,r.maskObject=e,s=r}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(n),s._colorMask=n?n._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==Ft.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case Ft.SCISSOR:this.renderer.scissor.push(s);break;case Ft.STENCIL:this.renderer.stencil.push(s);break;case Ft.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case Ft.COLOR:this.pushColorMask(s)}s.type===Ft.SPRITE&&this.maskStack.push(s)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case Ft.SCISSOR:this.renderer.scissor.pop(e);break;case Ft.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Ft.SPRITE:this.popSpriteMask(e);break;case Ft.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const s=this.maskStack[this.maskStack.length-1];s.type===Ft.SPRITE&&s._filters&&(s._filters[0].maskSprite=s.maskObject)}}}detect(t){const e=t.maskObject;t.type=e?e.isSprite?Ft.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?Ft.SCISSOR:Ft.STENCIL:Ft.COLOR}pushSpriteMask(t){const{maskObject:e}=t,s=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new Gd]));const r=this.renderer,o=r.renderTexture;let a,l;if(o.current){const d=o.current;a=t.resolution||d.resolution,l=t.multisample??d.multisample}else a=t.resolution||r.resolution,l=t.multisample??r.multisample;n[0].resolution=a,n[0].multisample=l,n[0].maskSprite=e;const c=s.filterArea;s.filterArea=e.getBounds(!0),r.filter.push(s,n),s.filterArea=c,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,s=t._colorMask=e&t.colorMask;s!==e&&this.renderer.gl.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))}popColorMask(t){const s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==t._colorMask&&this.renderer.gl.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))}destroy(){this.renderer=null}}qr.extension={type:I.RendererSystem,name:"mask"},K.add(qr);class Kr{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,s=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==s&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Jr=new kt,Qr=[],ls=class extends Kr{constructor(i){super(i),this.glConst=O.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){if(i._scissorRectLocal)return;const t=i._scissorRect,{maskObject:e}=i,{renderer:s}=this,n=s.renderTexture,r=e.getBounds(!0,Qr.pop()??new yt);this.roundFrameToPixels(r,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),t&&r.fit(t),i._scissorRectLocal=r}static isMatrixRotated(i){if(!i)return!1;const{a:t,b:e,c:s,d:n}=i;return(Math.abs(e)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(i){const{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||ls.isMatrixRotated(t.worldTransform)||ls.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,s,n){ls.isMatrixRotated(n)||((n=n?Jr.copyFrom(n):Jr.identity()).translate(-e.x,-e.y).scale(s.width/e.width,s.height/e.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,i),i.fit(s),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:t}=this.renderer;i&&Qr.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?i.y:this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}};let to=ls;to.extension={type:I.RendererSystem,name:"scissor"},K.add(to);class eo extends Kr{constructor(t){super(t),this.glConst=O.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:s}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;0!==r&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,n,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(t._colorMask=r,s.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=s?s._colorMask:15;0!==n&&(s._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(s._colorMask=n,e.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}eo.extension={type:I.RendererSystem,name:"stencil"},K.add(eo);class io{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new kt,this.transform=null}update(t,e,s,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,n),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,s,n){const r=this.projectionMatrix,o=n?-1:1;r.identity(),r.a=1/e.width*2,r.d=o*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-o-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}io.extension={type:I.RendererSystem,name:"projection"},K.add(io);const qe=new yt,Pi=new yt;class so{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new yt,this.destinationFrame=new yt,this.viewportFrame=new yt}bind(t=null,e,s){const n=this.renderer;let r,o,a;this.current=t,t?(r=t.baseTexture,a=r.resolution,e||(qe.width=t.frame.width,qe.height=t.frame.height,e=qe),s||(Pi.x=t.frame.x,Pi.y=t.frame.y,Pi.width=e.width,Pi.height=e.height,s=Pi),o=r.framebuffer):(a=n.resolution,e||(qe.width=n._view.screen.width,qe.height=n._view.screen.height,e=qe),s||((s=qe).width=e.width,s.height=e.height));const l=this.viewportFrame;l.x=s.x*a,l.y=s.y*a,l.width=s.width*a,l.height=s.height*a,t||(l.y=n.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(s,e,a,!o),this.renderer.mask.setMaskStack(t?r.maskStack:this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(s)}clear(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.renderer.background.colorRgba;const s=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,r=s.width!==n.width||s.height!==n.height;if(r){let{x:o,y:a,width:l,height:c}=this.viewportFrame;o=Math.round(o),a=Math.round(a),l=Math.round(l),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,a,l,c)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}function Hd(i,t,e,s,n){e.buffer.update(n)}so.extension={type:I.RendererSystem,name:"renderTexture"},K.add(so);const Xd={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},no={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};class Wd{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function ro(i,t,e){const s=i.createShader(t);return i.shaderSource(s,e),i.compileShader(s),s}function wn(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function oo(i,t){switch(i){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return wn(2*t);case"bvec3":return wn(3*t);case"bvec4":return wn(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function ao(i,t){const e=i.getShaderSource(t).split("\n").map((c,d)=>`${d}: ${c}`),s=i.getShaderInfoLog(t),n=s.split("\n"),r={},o=n.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>!(!c||r[c]||(r[c]=!0,0))),a=[""];o.forEach(c=>{e[c-1]=`%c${e[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=e.join("\n");a[0]=l,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}let Di,Jd=0;const cs={textureCount:0,uboCount:0};class ho{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Jd++}systemCheck(){if(!function Kd(){if("boolean"==typeof Di)return Di;try{Di=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{Di=!1}return Di}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,n=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(n.program)),e||(cs.textureCount=0,cs.uboCount=0,this.syncUniformGroup(t.uniformGroup,cs)),n}setUniforms(t){const e=this.shader.program;e.syncUniforms(e.glPrograms[this.renderer.CONTEXT_UID].uniformData,t,this.renderer)}syncUniformGroup(t,e){const s=this.getGlProgram();(!t.static||t.dirtyId!==s.uniformDirtyGroups[t.id])&&(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,e))}syncUniforms(t,e,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function Id(i,t){const e=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const s in i.uniforms){const n=t[s];if(!n){i.uniforms[s]?.group&&e.push(i.uniforms[s].ubo?`\n                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');\n                    `:`\n                        renderer.shader.syncUniformGroup(uv.${s}, syncData);\n                    `);continue}const r=i.uniforms[s];let o=!1;for(let a=0;a<fi.length;a++)if(fi[a].test(n,r)){e.push(fi[a].code(s,r)),o=!0;break}if(!o){const l=(1!==n.size||n.isArray?Rd:Ad)[n.type].replace("location",`ud["${s}"].location`);e.push(`\n            cu = ud["${s}"];\n            cv = cu.value;\n            v = uv["${s}"];\n            ${l};`)}}return new Function("ud","uv","renderer","syncData",e.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const s=this.getGlProgram();if(!t.static||0!==t.dirtyId||!s.uniformGroups[t.id]){t.dirtyId=0;const n=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,e);t.buffer.update(),n(s.uniformData,t.uniforms,this.renderer,cs,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[e])}createSyncBufferGroup(t,e,s){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,s);e.uniformBufferBindings[s]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=function Yd(i,t){if(!i.autoManage)return{size:0,syncFunc:Hd};const e=function zd(i,t){const e=[];for(const s in i)t[s]&&e.push(t[s]);return e.sort((s,n)=>s.index-n.index),e}(i.uniforms,t),{uboElements:s,size:n}=function Vd(i){const t=i.map(r=>({data:r,offset:0,dataLen:0,dirty:0}));let e=0,s=0,n=0;for(let r=0;r<t.length;r++){const o=t[r];if(e=no[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,s%e!=0&&s<16){const a=s%e%16;s+=a,n+=a}s+e>16?(n=16*Math.ceil(n/16),o.offset=n,n+=e,s=e):(o.offset=n,s+=e,n+=e)}return n=16*Math.ceil(n/16),{uboElements:t,size:n}}(e),r=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let o=0;o<s.length;o++){const a=s[o],l=i.uniforms[a.data.name],c=a.data.name;let d=!1;for(let u=0;u<fi.length;u++){const f=fi[u];if(f.codeUbo&&f.test(a.data,l)){r.push(`offset = ${a.offset/4};`,fi[u].codeUbo(a.data.name,l)),d=!0;break}}if(!d)if(a.data.size>1){const u=Yr(a.data.type),f=Math.max(no[a.data.type]/16,1),p=u/f;r.push(`\n                cv = ud.${c}.value;\n                v = uv.${c};\n                offset = ${a.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${a.data.size*f}; i++)\n                {\n                    for(var j = 0; j < ${p}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${(4-p%4)%4};\n                }\n\n                `)}else r.push(`\n                cv = ud.${c}.value;\n                v = uv.${c};\n                offset = ${a.offset/4};\n                ${Xd[a.data.type]};\n                `)}return r.push("\n       renderer.buffer.update(buffer);\n    "),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(a.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,s){const n=t.uniforms,r=[`${s}-`];for(const o in n)r.push(o),e[o]&&r.push(e[o].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const s=t.program,n=function qd(i,t){const e=ro(i,i.VERTEX_SHADER,t.vertexSrc),s=ro(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,s);const r=t.extra?.transformFeedbackVaryings;if(r&&("function"!=typeof i.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,r.names,"separate"===r.bufferMode?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||function Zd(i,t,e,s){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||ao(i,e),i.getShaderParameter(s,i.COMPILE_STATUS)||ao(i,s),console.error("PixiJS Error: Could not initialize shader."),""!==i.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}(i,n,e,s),t.attributeData=function jd(i,t){const e={},s=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<s;n++){const r=t.getActiveAttrib(i,n);if(r.name.startsWith("gl_"))continue;const o=jr(t,r.type),a={type:o,name:r.name,size:Yr(o),location:t.getAttribLocation(i,r.name)};e[r.name]=a}return e}(n,i),t.uniformData=function $d(i,t){const e={},s=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<s;n++){const r=t.getActiveUniform(i,n),o=r.name.replace(/\[.*?\]$/,""),a=!!r.name.match(/\[.*?\]$/),l=jr(t,r.type);e[o]={name:o,index:n,type:l,size:r.size,isArray:a,value:oo(l,r.size)}}return e}(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((c,d)=>c>d?1:-1);for(let c=0;c<l.length;c++)t.attributeData[l[c]].location=c,i.bindAttribLocation(n,c,l[c]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(s);const o={};for(const l in t.uniformData){const c=t.uniformData[l];o[l]={location:i.getUniformLocation(n,l),value:oo(c.type,c.size)}}return new Wd(n,o)}(this.gl,s);return s.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ho.extension={type:I.RendererSystem,name:"shader"},K.add(ho);const Tn=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=z.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Ce,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=function Qd(i,t=[]){return t[z.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.ADD]=[i.ONE,i.ONE],t[z.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.NONE]=[0,0],t[z.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[z.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[z.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[z.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[z.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[z.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[z.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[z.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[z.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[z.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[z.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}(i),this.set(this.defaultState),this.reset()}set(i){if(this.stateId!==(i=i||this.defaultState).data){let t=this.stateId^i.data,e=0;for(;t;)1&t&&this.map[e].call(this,!!(i.data&1<<e)),t>>=1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(Tn.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(Tn.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const t=this.blendModes[i],e=this.gl;2===t.length?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){const e=this.checks.indexOf(i);t&&-1===e?this.checks.push(i):!t&&-1!==e&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let lo=Tn;lo.extension={type:I.RendererSystem,name:"state"},K.add(lo);class co{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=O.GC_MAX_IDLE,this.checkCountMax=O.GC_MAX_CHECK_COUNT,this.mode=O.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==jt.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let s=!1;for(let n=0;n<e.length;n++){const r=e[n];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),e[n]=null,s=!0)}if(s){let n=0;for(let r=0;r<e.length;r++)null!==e[r]&&(e[n++]=e[r]);e.length=n}}unload(t){const s=t._texture;s&&!s.framebuffer&&this.renderer.texture.destroyTexture(s);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}}co.extension={type:I.RendererSystem,name:"textureGC"},K.add(co);class Sn{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=F.UNSIGNED_BYTE,this.internalFormat=P.RGBA,this.samplerType=0}}class uo{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new wt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function ou(i){let t;return t="WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?{[F.UNSIGNED_BYTE]:{[P.RGBA]:i.RGBA8,[P.RGB]:i.RGB8,[P.RG]:i.RG8,[P.RED]:i.R8,[P.RGBA_INTEGER]:i.RGBA8UI,[P.RGB_INTEGER]:i.RGB8UI,[P.RG_INTEGER]:i.RG8UI,[P.RED_INTEGER]:i.R8UI,[P.ALPHA]:i.ALPHA,[P.LUMINANCE]:i.LUMINANCE,[P.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[F.BYTE]:{[P.RGBA]:i.RGBA8_SNORM,[P.RGB]:i.RGB8_SNORM,[P.RG]:i.RG8_SNORM,[P.RED]:i.R8_SNORM,[P.RGBA_INTEGER]:i.RGBA8I,[P.RGB_INTEGER]:i.RGB8I,[P.RG_INTEGER]:i.RG8I,[P.RED_INTEGER]:i.R8I},[F.UNSIGNED_SHORT]:{[P.RGBA_INTEGER]:i.RGBA16UI,[P.RGB_INTEGER]:i.RGB16UI,[P.RG_INTEGER]:i.RG16UI,[P.RED_INTEGER]:i.R16UI,[P.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[F.SHORT]:{[P.RGBA_INTEGER]:i.RGBA16I,[P.RGB_INTEGER]:i.RGB16I,[P.RG_INTEGER]:i.RG16I,[P.RED_INTEGER]:i.R16I},[F.UNSIGNED_INT]:{[P.RGBA_INTEGER]:i.RGBA32UI,[P.RGB_INTEGER]:i.RGB32UI,[P.RG_INTEGER]:i.RG32UI,[P.RED_INTEGER]:i.R32UI,[P.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[F.INT]:{[P.RGBA_INTEGER]:i.RGBA32I,[P.RGB_INTEGER]:i.RGB32I,[P.RG_INTEGER]:i.RG32I,[P.RED_INTEGER]:i.R32I},[F.FLOAT]:{[P.RGBA]:i.RGBA32F,[P.RGB]:i.RGB32F,[P.RG]:i.RG32F,[P.RED]:i.R32F,[P.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[F.HALF_FLOAT]:{[P.RGBA]:i.RGBA16F,[P.RGB]:i.RGB16F,[P.RG]:i.RG16F,[P.RED]:i.R16F},[F.UNSIGNED_SHORT_5_6_5]:{[P.RGB]:i.RGB565},[F.UNSIGNED_SHORT_4_4_4_4]:{[P.RGBA]:i.RGBA4},[F.UNSIGNED_SHORT_5_5_5_1]:{[P.RGBA]:i.RGB5_A1},[F.UNSIGNED_INT_2_10_10_10_REV]:{[P.RGBA]:i.RGB10_A2,[P.RGBA_INTEGER]:i.RGB10_A2UI},[F.UNSIGNED_INT_10F_11F_11F_REV]:{[P.RGB]:i.R11F_G11F_B10F},[F.UNSIGNED_INT_5_9_9_9_REV]:{[P.RGB]:i.RGB9_E5},[F.UNSIGNED_INT_24_8]:{[P.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[F.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[P.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:{[F.UNSIGNED_BYTE]:{[P.RGBA]:i.RGBA,[P.RGB]:i.RGB,[P.ALPHA]:i.ALPHA,[P.LUMINANCE]:i.LUMINANCE,[P.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[F.UNSIGNED_SHORT_5_6_5]:{[P.RGB]:i.RGB},[F.UNSIGNED_SHORT_4_4_4_4]:{[P.RGBA]:i.RGBA},[F.UNSIGNED_SHORT_5_5_5_1]:{[P.RGBA]:i.RGBA}},t}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const s=new Sn(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Sn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:s}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<s.length;n++)s[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<s.length;n++)s[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),s[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:s,CONTEXT_UID:n}=this;if(s)for(let r=t-1;r>=0;--r){const o=e[r];o&&o._glTextures[n].samplerType!==qt.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new Sn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.type=2===this.webGLVersion&&t.type===F.HALF_FLOAT?this.gl.HALF_FLOAT:t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const s=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(s,t,e))e.samplerType!==qt.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,r=t.realHeight,o=s.gl;(e.width!==n||e.height!==r||e.dirtyId<0)&&(e.width=n,e.height=r,o.texImage2D(t.target,0,e.internalFormat,n,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:s}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);-1!==n&&ci(this.managedTextures,n,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];!e||(e.mipmap=!!(t.mipmap!==ht.POW2&&2===this.webGLVersion||t.isPowerOfTwo)&&t.mipmap>=1,e.wrapMode=2===this.webGLVersion||t.isPowerOfTwo?t.wrapMode:gt.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const s=this.gl;if(e.mipmap&&t.mipmap!==ht.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,e.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===At.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===At.LINEAR){const r=Math.min(t.anisotropicLevel,s.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===At.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===At.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}uo.extension={type:I.RendererSystem,name:"texture"},K.add(uo);const au=new sn;class fo{constructor(t){this.renderer=t,this._tempMatrix=new kt}generateTexture(t,e){const{region:s,...n}=e||{},r=s||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const o=Ue.create({width:r.width,height:r.height,...n});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const a=t.transform;return t.transform=au,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}fo.extension={type:[I.RendererSystem,I.CanvasRendererSystem],name:"textureGenerator"},K.add(fo);class po{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color="string"==typeof t.color?an(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=vr(t),Ei(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}po.extension={type:[I.RendererSystem,I.CanvasRendererSystem],name:"background"},K.add(po);class _o{constructor(t){this.renderer=t}init(t){this.screen=new yt(0,0,t.width,t.height),this.element=t.view||O.ADAPTER.createCanvas(),this.resolution=t.resolution||O.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const s=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=s,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",s,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}_o.extension={type:[I.RendererSystem,I.CanvasRendererSystem],name:"_view"},K.add(_o);class mo{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(ne("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(ne("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(ne("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}mo.extension={type:[I.RendererSystem,I.CanvasRendererSystem],name:"_plugin"},K.add(mo);class hu extends Si{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),s=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of s)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new fe(e)})}addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const n in this.runners)this.runners[n].add(s);return this}emitWithCustomOptions(t,e){const s=Object.keys(this._systemsHash);t.items.forEach(n=>{const r=s.find(o=>this._systemsHash[o]===n);n[t.name](e[r])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}class go{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.0.5 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}go.extension={type:[I.RendererSystem,I.CanvasRendererSystem],name:"startup"},K.add(go);class vo{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:s,renderer:n}=this;e&&n.shader.bind(e),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:s,CONTEXT_UID:n}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[n]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];!a||(s.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const s=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!e&&r.dispose(a,e))}!s||(e||n.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}vo.extension={type:I.RendererSystem,name:"transformFeedback"},K.add(vo);const yo=[];K.handleByList(I.Renderer,yo);const En=class extends hu{constructor(i){super(),i=Object.assign({},O.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new _e({projectionMatrix:new kt},!0),this.setup({runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:En.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]}),"useContextAlpha"in i&&(ne("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),i.premultipliedAlpha=i.useContextAlpha&&"notMultiplied"!==i.useContextAlpha,i.backgroundAlpha=!1===i.useContextAlpha?1:i.backgroundAlpha),this.startup.run({hello:i.hello,_plugin:En.__plugins,background:{alpha:i.backgroundAlpha,color:i.background??i.backgroundColor,clearBeforeRender:i.clearBeforeRender},_view:{height:i.height,width:i.width,autoDensity:i.autoDensity,resolution:i.resolution,view:i.view},context:{antialias:i.antialias,context:i.context,powerPreference:i.powerPreference,premultipliedAlpha:i.premultipliedAlpha,preserveDrawingBuffer:i.preserveDrawingBuffer}})}static test(i){return!i?.forceCanvas&&function uh(){return typeof on>"u"&&(on=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:O.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!O.ADAPTER.getWebGLRenderingContext())return!1;const e=O.ADAPTER.createCanvas();let s=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!(!s||!s.getContextAttributes().stencil);if(s){const r=s.getExtension("WEBGL_lose_context");r&&r.loseContext()}return s=null,n}catch{return!1}}()),on}()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(i){this._view.resolution=i,this.runners.resolutionChange.emit(i)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return ne("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return ne("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return ne("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return ne("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(i){ne("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=i}get backgroundAlpha(){return ne("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(i){ne("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=i}get powerPreference(){return ne("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}};let pi=En;pi.extension={type:I.Renderer,priority:1},pi.__plugins={},pi.__systems={},K.handleByMap(I.RendererPlugin,pi.__plugins),K.handleByMap(I.RendererSystem,pi.__systems),K.add(pi);class Cn{constructor(){this.texArray=null,this.blend=0,this.type=pt.TRIANGLES,this.start=0,this.size=0,this.data=null}}class An{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Rn{constructor(t){this.rawBinaryData="number"==typeof t?new ArrayBuffer(t):t instanceof Uint8Array?t.buffer:t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}class fu{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const s=new Int32Array(t);for(let r=0;r<t;r++)s[r]=r;this.defaultGroupCache[t]=_e.from({uSamplers:s},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ee(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new kt,default:this.defaultGroupCache[t]};return new be(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let s=0;s<t;s++)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(vTextureId < ${s}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${s}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class bo extends Ge{constructor(t=!1){super(),this._buffer=new $t(null,t,!1),this._indexBuffer=new $t(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,F.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,F.FLOAT).addAttribute("aColor",this._buffer,4,!0,F.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,F.FLOAT).addIndex(this._indexBuffer)}}const Ke=class extends ns{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=bo,this.vertexSize=6,this.state=Ce.for2d(),this.size=4*O.SPRITE_BATCH_SIZE,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:i=Ke.defaultVertexSrc,fragment:t=Ke.defaultFragmentTemplate}={}){this.shaderGenerator=new fu(i,t)}contextChange(){const i=this.renderer.gl;O.PREFER_ENV===et.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),O.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function Dd(i,t){if(0===i)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const s=Md.replace(/%forloop%/gi,Pd(i));if(t.shaderSource(e,s),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))break;i=i/2|0}return i}(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:t}=Ke,e=this.size/4,s=Math.floor(e/this.MAX_TEXTURES)+1;for(;i.length<e;)i.push(new Cn);for(;t.length<s;)t.push(new An);for(let n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(i){!i._texture.valid||(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,MAX_TEXTURES:t}=this,e=Ke._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,r=this.renderer.textureGC.count;let o=++wt._globalBatch,a=0,l=e[0],c=0;s.copyBoundTextures(n,t);for(let d=0;d<this._bufferSize;++d){const u=i[d];i[d]=null,u._batchEnabled!==o&&(l.count>=t&&(s.boundArray(l,n,o,t),this.buildDrawCalls(l,c,d),c=d,l=e[++a],++o),u._batchEnabled=o,u.touched=r,l.elements[l.count++]=u)}l.count>0&&(s.boundArray(l,n,o,t),this.buildDrawCalls(l,c,this._bufferSize),++a,++o);for(let d=0;d<n.length;d++)n[d]=null;wt._globalBatch=o}buildDrawCalls(i,t,e){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:r,vertexSize:o}=this,a=Ke._drawCallPool;let l=this._dcIndex,c=this._aIndex,d=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=i;for(let f=t;f<e;++f){const p=s[f],g=yr[p._texture.baseTexture.alphaMode?1:0][p.blendMode];s[f]=null,t<f&&u.blend!==g&&(u.size=d-u.start,t=f,u=a[++l],u.texArray=i,u.start=d),this.packInterleavedGeometry(p,n,r,c,d),c+=p.vertexData.length/2*o,d+=p.indices.length,u.blend=g}t<e&&(u.size=d-u.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=d}bindAndClearTexArray(i){const t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;O.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:t,state:e}=this.renderer,s=Ke._drawCallPool;let n=null;for(let r=0;r<i;r++){const{texArray:o,type:a,size:l,start:c,blend:d}=s[r];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=d,e.set(this.state),t.drawElements(a,l,t.UNSIGNED_SHORT,2*c)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),O.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const t=Ji(Math.ceil(i/8)),e=Tr(t),s=8*t;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new Rn(s*this.vertexSize*4)),n}getIndexBuffer(i){const t=Ji(Math.ceil(i/12)),e=Tr(t),s=12*t;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._iBuffers[e];return n||(this._iBuffers[e]=n=new Uint16Array(s)),n}packInterleavedGeometry(i,t,e,s,n){const{uint32View:r,float32View:o}=t,a=s/this.vertexSize,l=i.uvs,c=i.indices,d=i.vertexData,u=i._texture.baseTexture._batchLocation,f=Math.min(i.worldAlpha,1),p=f<1&&i._texture.baseTexture.alphaMode?hn(i._tintRGB,f):i._tintRGB+(255*f<<24);for(let _=0;_<d.length;_+=2)o[s++]=d[_],o[s++]=d[_+1],o[s++]=l[_],o[s++]=l[_+1],r[s++]=p,o[s++]=u;for(let _=0;_<c.length;_++)e[n++]=a+c[_]}};let ds=Ke;ds.extension={name:"batch",type:I.RendererPlugin},ds._drawCallPool=[],ds._textureArrayPool=[],K.add(ds);class mu{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class wo{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glBuffers[s]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:s,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,s.bindBufferBase(s.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,s){const{gl:n,CONTEXT_UID:r}=this;s=s||0;const o=t._glBuffers[r]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,256*s,256)}update(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),s&&(e||n.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let s=0;s<e.length;s++)this.dispose(this.managedBuffers[e[s]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:s}=this;return t._glBuffers[e]=new mu(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}wo.extension={type:I.RendererSystem,name:"buffer"},K.add(wo);class To{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}this.multisample=e>=st.HIGH?st.HIGH:e>=st.MEDIUM?st.MEDIUM:e>=st.LOW?st.LOW:st.NONE}destroy(){}}To.extension={type:I.RendererSystem,name:"_multisample"},K.add(To);class So{constructor(t){this.renderer=t}render(t,e){const s=this.renderer;let n,r,o,a;if(e&&(n=e.renderTexture,r=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=o,!s.context.isLost){if(n||(this.lastObjectRendered=t),!a){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}s.renderTexture.bind(n),s.batch.currentRenderer.start(),(r??s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),n&&(e.blit&&s.framebuffer.blit(),n.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}So.extension={type:I.RendererSystem,name:"objectRenderer"},K.add(So),["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Mn extends me{constructor(){super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",{m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1}),this.alpha=1}_loadMatrix(t,e=!1){let s=t;e&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,e,s){return t[0]=e[0]*s[0]+e[1]*s[5]+e[2]*s[10]+e[3]*s[15],t[1]=e[0]*s[1]+e[1]*s[6]+e[2]*s[11]+e[3]*s[16],t[2]=e[0]*s[2]+e[1]*s[7]+e[2]*s[12]+e[3]*s[17],t[3]=e[0]*s[3]+e[1]*s[8]+e[2]*s[13]+e[3]*s[18],t[4]=e[0]*s[4]+e[1]*s[9]+e[2]*s[14]+e[3]*s[19]+e[4],t[5]=e[5]*s[0]+e[6]*s[5]+e[7]*s[10]+e[8]*s[15],t[6]=e[5]*s[1]+e[6]*s[6]+e[7]*s[11]+e[8]*s[16],t[7]=e[5]*s[2]+e[6]*s[7]+e[7]*s[12]+e[8]*s[17],t[8]=e[5]*s[3]+e[6]*s[8]+e[7]*s[13]+e[8]*s[18],t[9]=e[5]*s[4]+e[6]*s[9]+e[7]*s[14]+e[8]*s[19]+e[9],t[10]=e[10]*s[0]+e[11]*s[5]+e[12]*s[10]+e[13]*s[15],t[11]=e[10]*s[1]+e[11]*s[6]+e[12]*s[11]+e[13]*s[16],t[12]=e[10]*s[2]+e[11]*s[7]+e[12]*s[12]+e[13]*s[17],t[13]=e[10]*s[3]+e[11]*s[8]+e[12]*s[13]+e[13]*s[18],t[14]=e[10]*s[4]+e[11]*s[9]+e[12]*s[14]+e[13]*s[19]+e[14],t[15]=e[15]*s[0]+e[16]*s[5]+e[17]*s[10]+e[18]*s[15],t[16]=e[15]*s[1]+e[16]*s[6]+e[17]*s[11]+e[18]*s[16],t[17]=e[15]*s[2]+e[16]*s[7]+e[17]*s[12]+e[18]*s[17],t[18]=e[15]*s[3]+e[16]*s[8]+e[17]*s[13]+e[18]*s[18],t[19]=e[15]*s[4]+e[16]*s[9]+e[17]*s[14]+e[18]*s[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)}tint(t,e){this._loadMatrix([(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0],e)}greyscale(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const s=Math.cos(t),n=Math.sin(t),o=1/3,a=(0,Math.sqrt)(o);this._loadMatrix([s+(1-s)*o,o*(1-s)-a*n,o*(1-s)+a*n,0,0,o*(1-s)+a*n,s+o*(1-s),o*(1-s)-a*n,0,0,o*(1-s)-a*n,o*(1-s)+a*n,s+o*(1-s),0,0,0,0,0,1,0],e)}contrast(t,e){const s=(t||0)+1,n=-.5*(s-1);this._loadMatrix([s,0,0,0,n,0,s,0,0,n,0,0,s,0,n,0,0,0,1,0],e)}saturate(t=0,e){const s=2*t/3+1,n=-.5*(s-1);this._loadMatrix([s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0],e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,s,n,r){const o=((s=s||16770432)>>16&255)/255,a=(s>>8&255)/255,l=(255&s)/255,c=((n=n||3375104)>>16&255)/255,d=(n>>8&255)/255,u=(255&n)/255;this._loadMatrix([.3,.59,.11,0,0,o,a,l,t=t||.2,0,c,d,u,e=e||.15,0,o-c,a-d,l-u,0,0],r)}night(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)}predator(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Mn.prototype.grayscale=Mn.prototype.greyscale,O.SORTABLE_CHILDREN=!1;class us{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?yt.EMPTY:((t=t||new yt(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:s,b:n,c:r,d:o,tx:a,ty:l}=t,c=s*e.x+r*e.y+a,d=n*e.x+o*e.y+l;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let e=this.minX,s=this.minY,n=this.maxX,r=this.maxY,o=t[0],a=t[1];e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,o=t[2],a=t[3],e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,o=t[4],a=t[5],e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,o=t[6],a=t[7],e=o<e?o:e,s=a<s?a:s,n=o>n?o:n,r=a>r?a:r,this.minX=e,this.minY=s,this.maxX=n,this.maxY=r}addFrame(t,e,s,n,r){this.addFrameMatrix(t.worldTransform,e,s,n,r)}addFrameMatrix(t,e,s,n,r){const o=t.a,a=t.b,l=t.c,c=t.d,d=t.tx,u=t.ty;let f=this.minX,p=this.minY,_=this.maxX,g=this.maxY,x=o*e+l*s+d,T=a*e+c*s+u;f=x<f?x:f,p=T<p?T:p,_=x>_?x:_,g=T>g?T:g,x=o*n+l*s+d,T=a*n+c*s+u,f=x<f?x:f,p=T<p?T:p,_=x>_?x:_,g=T>g?T:g,x=o*e+l*r+d,T=a*e+c*r+u,f=x<f?x:f,p=T<p?T:p,_=x>_?x:_,g=T>g?T:g,x=o*n+l*r+d,T=a*n+c*r+u,f=x<f?x:f,p=T<p?T:p,_=x>_?x:_,g=T>g?T:g,this.minX=f,this.minY=p,this.maxX=_,this.maxY=g}addVertexData(t,e,s){let n=this.minX,r=this.minY,o=this.maxX,a=this.maxY;for(let l=e;l<s;l+=2){const c=t[l],d=t[l+1];n=c<n?c:n,r=d<r?d:r,o=c>o?c:o,a=d>a?d:a}this.minX=n,this.minY=r,this.maxX=o,this.maxY=a}addVertices(t,e,s,n){this.addVerticesMatrix(t.worldTransform,e,s,n)}addVerticesMatrix(t,e,s,n,r=0,o=r){const a=t.a,l=t.b,c=t.c,d=t.d,u=t.tx,f=t.ty;let p=this.minX,_=this.minY,g=this.maxX,x=this.maxY;for(let T=s;T<n;T+=2){const k=e[T],E=e[T+1],M=a*k+c*E+u,J=d*E+l*k+f;p=Math.min(p,M-r),g=Math.max(g,M+r),_=Math.min(_,J-o),x=Math.max(x,J+o)}this.minX=p,this.minY=_,this.maxX=g,this.maxY=x}addBounds(t){const e=this.minX,s=this.minY,n=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const s=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(s<=r&&n<=o){const a=this.minX,l=this.minY,c=this.maxX,d=this.maxY;this.minX=s<a?s:a,this.minY=n<l?n:l,this.maxX=r>c?r:c,this.maxY=o>d?o:d}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const s=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(s<=r&&n<=o){const a=this.minX,l=this.minY,c=this.maxX,d=this.maxY;this.minX=s<a?s:a,this.minY=n<l?n:l,this.maxX=r>c?r:c,this.maxY=o>d?o:d}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,s,n,r,o){e-=o,s+=r,n+=o,this.minX=this.minX<(t-=r)?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Gt extends Si{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new sn,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new us,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let s=0;s<e.length;++s){const n=e[s];Object.defineProperty(Gt.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new yt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new yt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new us);const e=this.transform,s=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=s,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-r,o}toGlobal(t,e,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,s,n){return e&&(t=e.toGlobal(t,s,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,s=1,n=1,r=0,o=0,a=0,l=0,c=0){return this.position.x=t,this.position.y=e,this.scale.x=s||1,this.scale.y=n||1,this.rotation=r,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=c,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Bu),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ti}set angle(t){this.transform.rotation=t*ai}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class Bu extends Gt{constructor(){super(...arguments),this.sortDirty=null}}Gt.prototype.displayObjectUpdateTransform=Gt.prototype.updateTransform;const Fu=new kt;function ku(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}class ge extends Gt{constructor(){super(),this.children=[],this.sortableChildren=O.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const s=this.getChildIndex(t),n=this.getChildIndex(e);this.children[s]=e,this.children[n]=t,this.onChildrenChange(s<n?s:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(t);ci(this.children,s,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],s=this.children.indexOf(e);if(-1===s)return null;e.parent=null,e.transform._parentID=-1,ci(this.children,s,1),this._boundsID++,this.onChildrenChange(s),e.emit("removed",this),this.emit("childRemoved",e,this,s)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,ci(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=e-t;let o;if(r>0&&r<=e){o=this.children.splice(t,r);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,s=this.children.length;e<s;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&0!==n.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(ku),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const s=this.children[t];s.visible&&s.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const s=e._mask.isMaskData?e._mask.maskObject:e._mask;s?(s.calculateBounds(),this._bounds.addBoundsMask(e._bounds,s._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const s=super.getLocalBounds(t);if(!e)for(let n=0,r=this.children.length;n<r;++n){const o=this.children[n];o.visible&&o.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let s,n;this.cullArea?(s=this.cullArea,n=this.worldTransform):this._render!==ge.prototype._render&&(s=this.getBounds(!0));const r=t.projection.transform;if(r&&(n?(n=Fu.copyFrom(n),n.prepend(r)):n=r),s&&e.intersects(s,n))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const l=this.children[o],c=l.cullable;l.cullable=c||!this.cullArea,l.render(t),l.cullable=c}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,s=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r])}const n=e&&this._enabledFilters?.length||s&&(!s.isMaskData||s.enabled&&(s.autoDetect||s.type!==Ft.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),s&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let r=0,o=this.children.length;r<o;++r)this.children[r].render(t)}n&&t.batch.flush(),s&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,s=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<s.length;++n)s[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}ge.prototype.containerUpdateTransform=ge.prototype.updateTransform;const Oi=new bt,Lu=new Uint16Array([0,1,2,0,2,3]);class Bi extends ge{constructor(t){super(),this._anchor=new ke(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=z.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||tt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Lu,this.pluginName="batch",this.isSprite=!0,this._roundPixels=O.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=di(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=di(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,s=e.a,n=e.b,r=e.c,o=e.d,a=e.tx,l=e.ty,c=this.vertexData,d=t.trim,u=t.orig,f=this._anchor;let p=0,_=0,g=0,x=0;if(d?(_=d.x-f._x*u.width,p=_+d.width,x=d.y-f._y*u.height,g=x+d.height):(_=-f._x*u.width,p=_+u.width,x=-f._y*u.height,g=x+u.height),c[0]=s*_+r*x+a,c[1]=o*x+n*_+l,c[2]=s*p+r*x+a,c[3]=o*x+n*p+l,c[4]=s*p+r*g+a,c[5]=o*g+n*p+l,c[6]=s*_+r*g+a,c[7]=o*g+n*_+l,this._roundPixels){const T=O.RESOLUTION;for(let k=0;k<c.length;++k)c[k]=Math.round(c[k]*T)/T}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this.vertexTrimmedData,s=this._texture.orig,n=this._anchor,r=this.transform.worldTransform,o=r.a,a=r.b,l=r.c,c=r.d,d=r.tx,u=r.ty,f=-n._x*s.width,p=f+s.width,_=-n._y*s.height,g=_+s.height;e[0]=o*f+l*_+d,e[1]=c*_+a*f+u,e[2]=o*p+l*_+d,e[3]=c*_+a*p+u,e[4]=o*p+l*g+d,e[5]=c*g+a*p+u,e[6]=o*f+l*g+d,e[7]=c*g+a*f+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new us),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new yt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Oi);const e=this._texture.orig.width,s=this._texture.orig.height,n=-e*this.anchor.x;let r=0;return Oi.x>=n&&Oi.x<n+e&&(r=-s*this.anchor.y,Oi.y>=r&&Oi.y<r+s)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof t?t:t?.texture)&&this._texture.destroy(!!("boolean"==typeof t?t:t?.baseTexture)),this._texture=null}static from(t,e){const s=t instanceof tt?t:tt.from(t,e);return new Bi(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=di(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=di(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||tt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Eo=new kt;Gt.prototype._cacheAsBitmap=!1,Gt.prototype._cacheData=null,Gt.prototype._cacheAsBitmapResolution=null,Gt.prototype._cacheAsBitmapMultisample=null;class Nu{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Gt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;let t;this._cacheAsBitmap=i,i?(this._cacheData||(this._cacheData=new Nu),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),Gt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Gt.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const s=this.getLocalBounds(null,!0).clone();this.filters?.length&&s.pad(this.filters[0].padding),s.ceil(O.RESOLUTION);const n=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,l=Ue.create({width:s.width,height:s.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),c=`cacheAsBitmap_${Ze()}`;this._cacheData.textureCacheId=c,wt.addToCache(l.baseTexture,c),tt.addToCache(l,c);const d=this.transform.localTransform.copyTo(Eo).invert().translate(-s.x,-s.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(n,r,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new Bi(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-s.x/s.width,u.anchor.y=-s.y/s.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},Gt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Gt.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),s=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,r=t._projTransform;e.ceil(O.RESOLUTION);const o=Ue.create({width:e.width,height:e.height}),a=`cacheAsBitmap_${Ze()}`;this._cacheData.textureCacheId=a,wt.addToCache(o.baseTexture,a),tt.addToCache(o,a);const l=Eo;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const c=new Bi(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-e.x/e.width,c.anchor.y=-e.y/e.height,c.alpha=s,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},Gt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Gt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Gt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,wt.removeFromCache(this._cacheData.textureCacheId),tt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Gt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Gt.prototype.name=null,ge.prototype.getChildByName=function(t,e){for(let s=0,n=this.children.length;s<n;s++)if(this.children[s].name===t)return this.children[s];if(e)for(let s=0,n=this.children.length;s<n;s++){const r=this.children[s];if(!r.getChildByName)continue;const o=r.getChildByName(t,!0);if(o)return o}return null},Gt.prototype.getGlobalPosition=function(t=new bt,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};class Fi{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Fi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new bt,this.page=new bt,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,s,n,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class fs extends Fi{constructor(){super(...arguments),this.client=new bt,this.movement=new bt,this.offset=new bt,this.global=new bt,this.screen=new bt}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,s,n,r,o,a,l,c,d,u,f,p,_,g){throw new Error("Method not implemented.")}}class ve extends fs{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Pn extends fs{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const Hu=new bt,Dn=new bt;class Xu{constructor(t){this.dispatch=new Si,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((s,n)=>s.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let s=0,n=e.length;s<n;s++)e[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const s=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,Hu.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,r=s.length-1;n<r;n++)if(t.currentTarget=s[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=s.length-2;n>=0;n--)if(t.currentTarget=s[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,s=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=s.children;if(n)for(let r=0;r<n.length;r++)this.all(t,e,n[r]);t.currentTarget=s,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let s=0;s<2048&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,s,n,r){if(!t||!t.visible||r(t,s))return null;if(t.interactiveChildren&&t.children){const o=t.children;for(let a=o.length-1;a>=0;a--){const l=o[a],c=this.hitTestRecursive(l,e||l.interactive,s,n,r);if(c){if(c.length>0&&!c[c.length-1].parent)continue;return(c.length>0||t.interactive)&&c.push(t),c}}}return e&&n(t,s)?t.interactive?[t]:[]:null}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Dn),!t.hitArea.contains(Dn.x,Dn.y)))return!0;if(t._mask){const s=t._mask.isMaskData?t._mask.maskObject:t._mask;if(s&&!s.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!!t.containsPoint&&t.containsPoint(e)}notifyTarget(t,e){e=e??t.type,this.notifyListeners(t,t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof ve))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType?this.dispatchEvent(e,"touchstart"):"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.dispatchEvent(e,2===e.button?"rightdown":"mousedown"),this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof ve))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t),s="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.overTargets);if(n.overTargets&&r!==e.target){const l=this.createPointerEvent(t,"mousemove"===t.type?"mouseout":"pointerout",r);if(this.dispatchEvent(l,"pointerout"),s&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(r)){const c=this.createPointerEvent(t,"pointerleave",r);for(c.eventPhase=c.AT_TARGET;c.target&&!e.composedPath().includes(c.target);)c.currentTarget=c.target,this.notifyTarget(c),s&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(l)}if(r!==e.target){const l=this.clonePointerEvent(e,"mousemove"===t.type?"mouseover":"pointerover");this.dispatchEvent(l,"pointerover"),s&&this.dispatchEvent(l,"mouseover");let c=r?.parent;for(;c&&c!==this.rootTarget.parent&&c!==e.target;)c=c.parent;if(!c||c===this.rootTarget.parent){const u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==r&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),s&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}const o=this.moveOnAll?"all":"dispatchEvent";this[o](e,"pointermove"),"touch"===e.pointerType&&this[o](e,"touchmove"),s&&(this[o](e,"mousemove"),this.cursor=e.target?.cursor),n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof ve))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),s=this.createPointerEvent(t),n="mouse"===s.pointerType||"pen"===s.pointerType;this.dispatchEvent(s,"pointerover"),n&&this.dispatchEvent(s,"mouseover"),"mouse"===s.pointerType&&(this.cursor=s.target?.cursor);const r=this.clonePointerEvent(s,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof ve))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const s="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(r),s&&this.dispatchEvent(r,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof ve))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),s=this.createPointerEvent(t);this.dispatchEvent(s,"pointerup"),"touch"===s.pointerType?this.dispatchEvent(s,"touchend"):"mouse"!==s.pointerType&&"pen"!==s.pointerType||this.dispatchEvent(s,2===s.button?"rightup":"mouseup");const n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=r;if(r&&!s.composedPath().includes(r)){let a=r;for(;a&&!s.composedPath().includes(a);)s.currentTarget=a,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?this.notifyTarget(s,"touchendoutside"):"mouse"!==s.pointerType&&"pen"!==s.pointerType||this.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),a=a.parent;delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(s,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const l=n.clicksByButton[t.button];l.target===a.target&&e-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=e,a.detail=l.clickCount,"mouse"===a.pointerType?this.dispatchEvent(a,"click"):"touch"===a.pointerType&&this.dispatchEvent(a,"tap"),this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof ve))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),s=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(s){let r=s;for(;r;)n.currentTarget=r,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):("mouse"===n.pointerType||"pen"===n.pointerType)&&this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Pn))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let s=1;s<t.length&&t[s].parent===e;s++)e=t[s];return e}createPointerEvent(t,e,s){const n=this.allocateEvent(ve);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=s??this.hitTest(n.global.x,n.global.y),"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Pn);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const s=this.allocateEvent(ve);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=e??s.type,s}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof ve&&e instanceof ve&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof fs&&e instanceof fs&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const s=t.currentTarget._events[e];if(s)if("fn"in s)s.fn.call(s.context,t);else for(let n=0,r=s.length;n<r&&!t.propagationImmediatelyStopped;n++)s[n].fn.call(s[n].context,t)}}const zu={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Co{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Xu(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new ve(null),this.rootWheelEvent=new Pn(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];if(s)switch(typeof s){case"string":e&&(this.domElement.style.cursor=s);break;case"function":s(t);break;case"object":e&&Object.assign(this.domElement.style,s)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let s=0,n=e.length;s<n;s++){const o=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let s=0,n=e.length;s<n;s++){const r=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const s=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let r=0,o=n.length;r<o;r++){const a=this.bootstrapEvent(this.rootPointerEvent,n[r]);a.type+=s,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let s=0,n=e.length;s<n;s++){const r=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,s){let n;n=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=this.domElement.width/n.width*(e-n.left)*r,t.y=this.domElement.height/n.height*(s-n.top)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let s=0,n=t.changedTouches.length;s<n;s++){const r=t.changedTouches[s];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const s=t;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=1),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=zu[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}Co.extension={name:"events",type:[I.RendererSystem,I.CanvasRendererSystem]},K.add(Co);const Yu={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const n="function"==typeof t?void 0:t;this.on(i="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${i}capture`:i,t="function"==typeof t?t:t.handleEvent,n)},removeEventListener(i,t,e){const n="function"==typeof t?void 0:t;this.off(i="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${i}capture`:i,t="function"==typeof t?t:t.handleEvent,n)},dispatchEvent(i){if(!(i instanceof Fi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};Gt.mixin(Yu),Gt.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Io{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(vt.tablet||vt.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let s=0;s<e.length;s++)this.updateAccessibleObjects(e[s])}update(){const t=performance.now();if(vt.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:s,width:n,height:r}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,c=n/o*l,d=r/a*l;let u=this.div;u.style.left=`${e}px`,u.style.top=`${s}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let f=0;f<this.children.length;f++){const p=this.children[f];if(p.renderId!==this.renderId)p._accessibleActive=!1,ci(this.children,f,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,f--;else{u=p._accessibleDiv;let _=p.hitArea;const g=p.worldTransform;p.hitArea?(u.style.left=(g.tx+_.x*g.a)*c+"px",u.style.top=(g.ty+_.y*g.d)*d+"px",u.style.width=_.width*g.a*c+"px",u.style.height=_.height*g.d*d+"px"):(_=p.getBounds(),this.capHitArea(_),u.style.left=_.x*c+"px",u.style.top=_.y*d+"px",u.style.width=_.width*c+"px",u.style.height=_.height*d+"px",u.title!==p.accessibleTitle&&null!==p.accessibleTitle&&(u.title=p.accessibleTitle),u.getAttribute("aria-label")!==p.accessibleHint&&null!==p.accessibleHint&&u.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==u.title||p.tabIndex!==u.tabIndex)&&(u.title=p.accessibleTitle,u.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:s}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>s&&(t.height=s-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:s}=t.target,n=this.renderer.events.rootBoundary,r=Object.assign(new Fi(n),{target:s});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(r,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Io.extension={name:"accessibility",type:[I.RendererPlugin,I.CanvasRendererPlugin]},K.add(Io);const On=class{constructor(i){this.stage=new ge,i=Object.assign({forceCanvas:!1},i),this.renderer=function lu(i){for(const t of yo)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}(i),On._plugins.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,t){const e=On._plugins.slice(0);e.reverse(),e.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let _s=On;_s._plugins=[],K.handleByList(I.Application,_s._plugins);class Mo{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,s;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,s=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;e=n,s=r}this.renderer.resize(e,s),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Mo.extension=I.Application,K.add(Mo);class Ju{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){var t=this;return X(function*(){if(t._assetList.length&&t._isActive){t._isLoading=!0;const e=[],s=Math.min(t._assetList.length,t._maxConcurrent);for(let n=0;n<s;n++)e.push(t._assetList.pop());yield t._loader.load(e),t._isLoading=!1,t._next()}})()}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function ms(i,t){const e=i.split("?")[0],s=te.extname(e).toLowerCase();return Array.isArray(t)?t.includes(s.toLowerCase()):s.toLowerCase()===t}const Ae=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>"string"==typeof e?t(e):e):i),ki=new class Qu{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const s=Ae(t);let n;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(e)){n=l.getCacheableAssets(s,e);break}}n||(n={},s.forEach(a=>{n[a]=e}));const r=Object.keys(n),o={cacheKeys:r,keys:s};if(s.forEach(a=>{this._cacheMap.set(a,o)}),r.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof tt){const a=e;s.forEach(l=>{a.baseTexture!==tt.EMPTY.baseTexture&&wt.addToCache(a.baseTexture,l),tt.addToCache(a,l)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}},gs=i=>!Array.isArray(i);class tf{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){var s=this;const n={promise:null,parser:null};return n.promise=X(function*(){let r=null;for(let o=0;o<s.parsers.length;o++){const a=s.parsers[o];if(a.load&&a.test?.(t,e,s)){r=yield a.load(t,e,s),n.parser=a;break}}if(!n.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let o=0;o<s.parsers.length;o++){const a=s.parsers[o];a.parse&&a.parse&&(yield a.testParse?.(r,e,s))&&(r=(yield a.parse(r,e,s))||r,n.parser=a)}return r})(),n}load(t,e){var s=this;return X(function*(){let n=0;const r={},o=gs(t),a=Ae(t,d=>({src:d})),l=a.length,c=a.map(function(){var d=X(function*(u){const f=te.toAbsolute(u.src);if(!r[u.src])try{s.promiseCache[f]||(s.promiseCache[f]=s._getLoadPromiseAndParser(f,u)),r[u.src]=yield s.promiseCache[f].promise,e&&e(++n/l)}catch(p){throw delete s.promiseCache[f],delete r[u.src],new Error(`[Loader.load] Failed to load ${f}.\n${p}`)}});return function(u){return d.apply(this,arguments)}}());return yield Promise.all(c),o?r[a[0].src]:r})()}unload(t){var e=this;return X(function*(){const n=Ae(t,r=>({src:r})).map(function(){var r=X(function*(o){const a=te.toAbsolute(o.src),l=e.promiseCache[a];if(l){const c=yield l.promise;l.parser?.unload?.(c,o,e),delete e.promiseCache[a]}});return function(o){return r.apply(this,arguments)}}());yield Promise.all(n)})()}get parsers(){return this._parsers}}function Po(i,t,e,s,n){const r=t[e];for(let o=0;o<r.length;o++){const a=r[o];e<t.length-1?Po(i.replace(s[e],a),t,e+1,s,n):n.push(i.replace(s[e],a))}}function ef(i){const e=i.match(/\{(.*?)\}/g),s=[];if(e){const n=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");n.push(o)}),Po(i,n,0,e,s)}else s.push(i);return s}class sf{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const s=[];Array.isArray(e)?e.forEach(n=>{"string"==typeof n.name?s.push(n.name):s.push(...n.name),this.add(n.name,n.srcs)}):Object.keys(e).forEach(n=>{s.push(n),this.add(n,e[n])}),this._bundles[t]=s}add(t,e,s){const n=Ae(t);n.forEach(o=>{this._assetMap[o]&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(e)||(e="string"==typeof e?ef(e):[e]);const r=e.map(o=>{let a=o;if("string"==typeof o){let l=!1;for(let c=0;c<this._parsers.length;c++){const d=this._parsers[c];if(d.test(o)){a=d.parse(o),l=!0;break}}l||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=n),(this._basePath||this._rootPath)&&(a.src=te.toAbsolute(a.src,this._basePath,this._rootPath)),a.data=a.data??s,a});n.forEach(o=>{this._assetMap[o]=r})}resolveBundle(t){const e=gs(t);t=Ae(t);const s={};return t.forEach(n=>{const r=this._bundles[n];r&&(s[n]=this.resolve(r))}),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const s={};for(const n in e)s[n]=e[n].src;return s}return e.src}resolve(t){const e=gs(t);t=Ae(t);const s={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let r=this._assetMap[n];const o=this._getPreferredOrder(r),a=r[0];o?.priority.forEach(l=>{o.params[l].forEach(c=>{const d=r.filter(u=>!!u[l]&&u[l]===c);d.length&&(r=d)})}),this._resolverHash[n]=r[0]??a}else{let r=n;(this._basePath||this._rootPath)&&(r=te.toAbsolute(r,this._basePath,this._rootPath)),this._resolverHash[n]={src:r}}s[n]=this._resolverHash[n]}),e?s[t[0]]:s}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const s=t[0],n=this._preferredOrder.find(r=>r.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}}const vs=new class nf{constructor(){this._detections=[],this._initialized=!1,this.resolver=new sf,this.loader=new tf,this.cache=ki,this._backgroundLoader=new Ju(this.loader),this._backgroundLoader.active=!0,this.reset()}init(t={}){var e=this;return X(function*(){if(e._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(e._initialized=!0,t.basePath&&(e.resolver.basePath=t.basePath),t.manifest){let o=t.manifest;"string"==typeof o&&(o=yield e.load(o)),e.resolver.addManifest(o)}const s=t.texturePreference?.resolution??1,n="number"==typeof s?[s]:s;let r=[];if(t.texturePreference?.format){const o=t.texturePreference?.format;r="string"==typeof o?[o]:o;for(const a of e._detections)(yield a.test())||(r=yield a.remove(r))}else for(const o of e._detections)(yield o.test())&&(r=yield o.add(r));e.resolver.prefer({params:{format:r,resolution:n}})})()}add(t,e,s){this.resolver.add(t,e,s)}load(t,e){var s=this;return X(function*(){s._initialized||(yield s.init());const n=gs(t),r=Ae(t).map(l=>"string"!=typeof l?(s.resolver.add(l.src,l),l.src):l),o=s.resolver.resolve(r),a=yield s._mapLoadToResolve(o,e);return n?a[r[0]]:a})()}addBundle(t,e){this.resolver.addBundle(t,e)}loadBundle(t,e){var s=this;return X(function*(){s._initialized||(yield s.init());let n=!1;"string"==typeof t&&(n=!0,t=[t]);const r=s.resolver.resolveBundle(t),o={},a=Object.keys(r);let l=0,c=0;const d=()=>{e?.(++l/c)},u=a.map(f=>{const p=r[f];return c+=Object.keys(p).length,s._mapLoadToResolve(p,d).then(_=>{o[f]=_})});return yield Promise.all(u),n?o[t[0]]:o})()}backgroundLoad(t){var e=this;return X(function*(){e._initialized||(yield e.init()),"string"==typeof t&&(t=[t]);const s=e.resolver.resolve(t);e._backgroundLoader.add(Object.values(s))})()}backgroundLoadBundle(t){var e=this;return X(function*(){e._initialized||(yield e.init()),"string"==typeof t&&(t=[t]);const s=e.resolver.resolveBundle(t);Object.values(s).forEach(n=>{e._backgroundLoader.add(Object.values(n))})})()}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return ki.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=ki.get(t[s]);return e}_mapLoadToResolve(t,e){var s=this;return X(function*(){const n=Object.values(t),r=Object.keys(t);s._backgroundLoader.active=!1;const o=yield s.loader.load(n,e);s._backgroundLoader.active=!0;const a={};return n.forEach((l,c)=>{const d=o[l.src],u=[l.src];l.alias&&u.push(...l.alias),a[r[c]]=d,ki.set(u,d)}),a})()}unload(t){var e=this;return X(function*(){e._initialized||(yield e.init());const s=Ae(t).map(r=>"string"!=typeof r?r.src:r),n=e.resolver.resolve(s);yield e._unloadFromResolved(n)})()}unloadBundle(t){var e=this;return X(function*(){e._initialized||(yield e.init()),t=Ae(t);const s=e.resolver.resolveBundle(t),n=Object.keys(s).map(r=>e._unloadFromResolved(s[r]));yield Promise.all(n)})()}_unloadFromResolved(t){var e=this;return X(function*(){const s=Object.values(t);s.forEach(n=>{ki.remove(n.src)}),yield e.loader.unload(s)})()}get detections(){return this._detections}};K.handleByList(I.LoadParser,vs.loader.parsers).handleByList(I.ResolveParser,vs.resolver.parsers).handleByList(I.CacheParser,vs.cache.parsers).handleByList(I.DetectionParser,vs.detections);const Do={loader:I.LoadParser,resolver:I.ResolveParser,cache:I.CacheParser,detection:I.DetectionParser};K.handle(I.Asset,i=>{const t=i.ref;Object.entries(Do).filter(([e])=>!!t[e]).forEach(([e,s])=>K.add(Object.assign(t[e],{extension:t[e].extension??s})))},i=>{const t=i.ref;Object.keys(Do).filter(e=>!!t[e]).forEach(e=>K.remove(t[e]))});const rf={extension:I.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof tt),getCacheableAssets:(i,t)=>{const e={};return i.forEach(s=>{t.forEach((n,r)=>{e[s+(0===r?"":r+1)]=n})}),e}};K.add(rf);var we=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(we||{});const of={extension:{type:I.LoadParser,priority:we.Low},test:i=>te.extname(i).includes(".json"),load:i=>X(function*(){return yield(yield O.ADAPTER.fetch(i)).json()})()};K.add(of);const af={extension:{type:I.LoadParser,priority:we.Low},test:i=>te.extname(i).includes(".txt"),load:i=>X(function*(){return yield(yield O.ADAPTER.fetch(i)).text()})()};function Oo(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}K.add(af);const hf=["normal","bold","100","200","300","400","500","600","700","800","900"],lf=[".ttf",".otf",".woff",".woff2"],cf=["font/ttf","font/otf","font/woff","font/woff2"],uf={extension:{type:I.LoadParser,priority:we.Low},test:i=>Oo(i,cf)||ms(i,lf),load:(i,t)=>X(function*(){if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=O.ADAPTER.getFontFaceSet();if(e){const s=[],n=t.data?.family??function df(i){const t=te.extname(i);return te.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}(i),r=t.data?.weights?.filter(a=>hf.includes(a))??["normal"],o=t.data??{};for(let a=0;a<r.length;a++){const l=r[a],c=new FontFace(n,`url(${encodeURI(i)})`,{...o,weight:l});yield c.load(),e.add(c),s.push(c)}return 1===s.length?s[0]:s}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})(),unload(i){(Array.isArray(i)?i:[i]).forEach(t=>O.ADAPTER.getFontFaceSet().delete(t))}};K.add(uf);let Bn,Bo=0;const ff_code="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",pf_code="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let Fn;const Fo=new class _f{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([ff_code],{type:"application/javascript"})),s=new Worker(e);s.addEventListener("message",n=>{s.terminate(),URL.revokeObjectURL(e),t(n.data)})})),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}_initWorkers(){var t=this;return X(function*(){t._initialized||(t._initialized=!0)})()}getWorker(){void 0===Bn&&(Bn=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Bn&&(Fn||(Fn=URL.createObjectURL(new Blob([pf_code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Fn),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}_run(t,e){var s=this;return X(function*(){yield s._initWorkers();const n=new Promise((r,o)=>{s.queue.push({id:t,arguments:e,resolve:r,reject:o})});return s.next(),n})()}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),s=e.id;this.resolveHash[Bo]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Bo++,id:s})}};function ys(i,t,e){const s=new tt(i);return s.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),s}const mf=[".jpeg",".jpg",".png",".webp",".avif"],gf=["image/jpeg","image/png","image/webp","image/avif"];function kn(){return(kn=X(function*(i){const t=yield O.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=yield t.blob();return yield createImageBitmap(e)})).apply(this,arguments)}const Ln={extension:{type:I.LoadParser,priority:we.High},config:{preferWorkers:!0},test:i=>Oo(i,gf)||ms(i,mf),load(i,t,e){var s=this;return X(function*(){let n=null;n=globalThis.createImageBitmap?s.config.preferWorkers&&(yield Fo.isImageBitmapSupported())?yield Fo.loadImageBitmap(i):yield function vf(i){return kn.apply(this,arguments)}(i):yield new Promise(o=>{n=new Image,n.crossOrigin="anonymous",n.src=i,n.complete?o(n):n.onload=()=>{o(n)}});const r=new wt(n,{resolution:Le(i),...t.data});return r.resource.src=i,ys(r,e,i)})()},unload(i){i.destroy(!0)}};K.add(Ln);const yf={extension:I.ResolveParser,test:Ln.test,parse:i=>({resolution:parseFloat(O.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i})};K.add(yf);const xf={extension:{type:I.DetectionParser,priority:1},test:(i=X(function*(){if(!globalThis.createImageBitmap)return!1;const e=yield O.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(s=>s.blob());return createImageBitmap(e).then(()=>!0,()=>!1)}),function(){return i.apply(this,arguments)}),add:function(){var i=X(function*(t){return[...t,"avif"]});return function(e){return i.apply(this,arguments)}}(),remove:function(){var i=X(function*(t){return t.filter(e=>"avif"!==e)});return function(e){return i.apply(this,arguments)}}()};var i;K.add(xf);const bf={extension:{type:I.DetectionParser,priority:0},test:function(){var i=X(function*(){if(!globalThis.createImageBitmap)return!1;const e=yield O.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(s=>s.blob());return createImageBitmap(e).then(()=>!0,()=>!1)});return function(){return i.apply(this,arguments)}}(),add:function(){var i=X(function*(t){return[...t,"webp"]});return function(e){return i.apply(this,arguments)}}(),remove:function(){var i=X(function*(t){return t.filter(e=>"webp"!==e)});return function(e){return i.apply(this,arguments)}}()};K.add(bf);const ko=["png","jpg","jpeg"],wf={extension:{type:I.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:function(){var i=X(function*(t){return[...t,...ko]});return function(e){return i.apply(this,arguments)}}(),remove:function(){var i=X(function*(t){return t.filter(e=>!ko.includes(e))});return function(e){return i.apply(this,arguments)}}()};K.add(wf);var he=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(he||{});const xs={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};class Tf extends Ai{constructor(t,e={width:1,height:1,autoLoad:!0}){let s,n;"string"==typeof t?(s=t,n=new Uint8Array):(s=null,n=t),super(n,e),this.origin=s,this.buffer=n?new Rn(n):null,this.origin&&!1!==e.autoLoad&&this.load(),n?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){var t=this;return X(function*(){const n=yield(yield(yield fetch(t.origin)).blob()).arrayBuffer();return t.data=new Uint32Array(n),t.buffer=new Rn(n),t.loaded=!0,t.onBlobLoaded(n),t.update(),t})()}}class Je extends Tf{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Je._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Je._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,s){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:l,levelWidth:c,levelHeight:d,levelBuffer:u}=this._levelBuffers[o];n.compressedTexImage2D(n.TEXTURE_2D,l,this.format,c,d,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Je._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,s,n,r,o,a){const l=new Array(s);let c=t.byteOffset,d=o,u=a,f=d+n-1&~(n-1),p=u+r-1&~(r-1),_=f*p*xs[e];for(let g=0;g<s;g++)l[g]={levelID:g,levelWidth:s>1?d:f,levelHeight:s>1?u:p,levelBuffer:new Uint8Array(t.buffer,c,_)},c+=_,d=d>>1||1,u=u>>1||1,f=d+n-1&~(n-1),p=u+r-1&~(r-1),_=f*p*xs[e];return l}}let Re,_i;function Lo(){_i={s3tc:Re.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Re.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Re.getExtension("WEBGL_compressed_texture_etc"),etc1:Re.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Re.getExtension("WEBGL_compressed_texture_pvrtc")||Re.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Re.getExtension("WEBGL_compressed_texture_atc"),astc:Re.getExtension("WEBGL_compressed_texture_astc")}}const Sf={extension:{type:I.DetectionParser,priority:2},test:function(){var i=X(function*(){const e=O.ADAPTER.createCanvas().getContext("webgl");return e?(Re=e,!0):(console.warn("WebGL not available for compressed textures."),!1)});return function(){return i.apply(this,arguments)}}(),add:function(){var i=X(function*(t){_i||Lo();const e=[];for(const s in _i)!_i[s]||e.push(s);return[...e,...t]});return function(e){return i.apply(this,arguments)}}(),remove:function(){var i=X(function*(t){return _i||Lo(),t.filter(e=>!(e in _i))});return function(e){return i.apply(this,arguments)}}()};K.add(Sf);const Hf={827611204:he.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:he.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:he.COMPRESSED_RGBA_S3TC_DXT5_EXT},Xf={70:he.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:he.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:he.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:he.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:he.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:he.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:he.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:he.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:he.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},Uo=[171,75,84,88,32,49,49,187,13,10,26,10],Go={[F.UNSIGNED_BYTE]:1,[F.UNSIGNED_SHORT]:2,[F.INT]:4,[F.UNSIGNED_INT]:4,[F.FLOAT]:4,[F.HALF_FLOAT]:8},Yf={[P.RGBA]:4,[P.RGB]:3,[P.RG]:2,[P.RED]:1,[P.LUMINANCE]:1,[P.LUMINANCE_ALPHA]:2,[P.ALPHA]:1},Wf={[F.UNSIGNED_SHORT_4_4_4_4]:2,[F.UNSIGNED_SHORT_5_5_5_1]:2,[F.UNSIGNED_SHORT_5_6_5]:2};function Zf(i){switch(i){case P.RGBA:return P.RGBA_INTEGER;case P.RGB:return P.RGB_INTEGER;case P.RG:return P.RG_INTEGER;case P.RED:return P.RED_INTEGER;default:return i}}const Kf={extension:{type:I.LoadParser,priority:we.High},test:i=>ms(i,".dds"),load:(i,t,e)=>X(function*(){const o=function Vf(i){const t=new Uint32Array(i);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const s=new Uint32Array(i,0,124/Uint32Array.BYTES_PER_ELEMENT),n=s[3],r=s[4],o=s[7],a=new Uint32Array(i,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),l=a[1];if(4&l){const c=a[2];if(808540228!==c){const E=Hf[c],J=new Uint8Array(i,128);return[new Je(J,{format:E,width:r,height:n,levels:o})]}const u=new Uint32Array(t.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),f=u[0],p=u[1],_=u[2],g=u[3],x=Xf[f];if(void 0===x)throw new Error(`DDSParser cannot parse texture data with DXGI format ${f}`);if(4===_)throw new Error("DDSParser does not support cubemap textures");if(6===p)throw new Error("DDSParser does not supported 3D texture data");const T=new Array,k=148;if(1===g)T.push(new Uint8Array(i,k));else{const E=xs[x];let M=0,J=r,Q=n;for(let W=0;W<o;W++)M+=Math.max(1,J+3&-4)*Math.max(1,Q+3&-4)*E,J>>>=1,Q>>>=1;let j=k;for(let W=0;W<g;W++)T.push(new Uint8Array(i,j,M)),j+=M}return T.map(E=>new Je(E,{format:x,width:r,height:n,levels:o}))}throw 64&l?new Error("DDSParser does not support uncompressed texture data."):512&l?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&l?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&l?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(yield(yield O.ADAPTER.fetch(i)).arrayBuffer()).map(a=>ys(new wt(a,{mipmap:ht.OFF,alphaMode:Rt.NO_PREMULTIPLIED_ALPHA,resolution:Le(i),...t.data}),e,i));return 1===o.length?o[0]:o})(),unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};K.add(Kf);const Jf={extension:{type:I.LoadParser,priority:we.High},test:i=>ms(i,".ktx"),load:(i,t,e)=>X(function*(){const n=yield(yield O.ADAPTER.fetch(i)).arrayBuffer(),{compressed:r,uncompressed:o,kvData:a}=function jf(i,t,e=!1){const s=new DataView(t);if(!function $f(i,t){for(let e=0;e<Uo.length;e++)if(t.getUint8(e)!==Uo[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}(i,s))return null;const n=67305985===s.getUint32(12,!0),r=s.getUint32(16,n),o=s.getUint32(24,n),a=s.getUint32(28,n),l=s.getUint32(36,n),c=s.getUint32(40,n)||1,d=s.getUint32(44,n)||1,u=s.getUint32(48,n)||1,f=s.getUint32(52,n),p=s.getUint32(56,n),_=s.getUint32(60,n);if(0===c||1!==d)throw new Error("Only 2D textures are supported");if(1!==f)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const T=l+3&-4,k=c+3&-4,E=new Array(u);let J,M=l*c;if(0===r&&(M=T*k),J=0!==r?Go[r]?Go[r]*Yf[o]:Wf[r]:xs[a],void 0===J)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const Q=e?function qf(i,t,e){const s=new Map;let n=0;for(;n<t;){const r=i.getUint32(64+n,e),o=64+n+4,a=3-(r+3)%4;if(0===r||r>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<r&&0!==i.getUint8(o+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=(new TextDecoder).decode(new Uint8Array(i.buffer,o,l)),d=new DataView(i.buffer,o+l+1,r-l-1);s.set(c,d),n+=4+r+a}return s}(s,_,n):null;let W=M*J,lt=l,V=c,$=T,xt=k,N=64+_;for(let H=0;H<p;H++){const Mt=s.getUint32(N,n);let ft=N+4;for(let ct=0;ct<u;ct++){let Pt=E[ct];Pt||(Pt=E[ct]=new Array(p)),Pt[H]={levelID:H,levelWidth:p>1||0!==r?lt:$,levelHeight:p>1||0!==r?V:xt,levelBuffer:new Uint8Array(t,ft,W)},ft+=W}N+=Mt+4,N=N%4!=0?N+4-N%4:N,lt=lt>>1||1,V=V>>1||1,$=lt+4-1&-4,xt=V+4-1&-4,W=$*xt*J}return 0!==r?{uncompressed:E.map(H=>{let Mt=H[0].levelBuffer,ft=!1;return r===F.FLOAT?Mt=new Float32Array(H[0].levelBuffer.buffer,H[0].levelBuffer.byteOffset,H[0].levelBuffer.byteLength/4):r===F.UNSIGNED_INT?(ft=!0,Mt=new Uint32Array(H[0].levelBuffer.buffer,H[0].levelBuffer.byteOffset,H[0].levelBuffer.byteLength/4)):r===F.INT&&(ft=!0,Mt=new Int32Array(H[0].levelBuffer.buffer,H[0].levelBuffer.byteOffset,H[0].levelBuffer.byteLength/4)),{resource:new Ai(Mt,{width:H[0].levelWidth,height:H[0].levelHeight}),type:r,format:ft?Zf(o):o}}),kvData:Q}:{compressed:E.map(H=>new Je(null,{format:a,width:l,height:c,levels:p,levelBuffers:H})),kvData:Q}}(i,n),l=r??o,c={mipmap:ht.OFF,alphaMode:Rt.NO_PREMULTIPLIED_ALPHA,resolution:Le(i),...t.data},d=l.map(u=>{l===o&&Object.assign(c,{type:u.type,format:u.format});const f=new wt(u,c);return f.ktxKeyValueData=a,ys(f,e,i)});return 1===d.length?d[0]:d})(),unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};K.add(Jf);const Qf={extension:I.ResolveParser,test:i=>{const e=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:i=>{if("ktx"===i.split("?")[0].split(".").pop()){const s=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(s.some(n=>i.endsWith(n)))return{resolution:parseFloat(O.RETINA_PREFIX.exec(i)?.[1]??"1"),format:s.find(n=>i.endsWith(n)),src:i}}return{resolution:parseFloat(O.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i}}};K.add(Qf);const Ho=new yt,Gn=class{constructor(i){this.renderer=i}image(i,t,e){var s=this;return X(function*(){const n=new Image;return n.src=yield s.base64(i,t,e),n})()}base64(i,t,e){var s=this;return X(function*(){const n=s.canvas(i);if(void 0!==n.toDataURL)return n.toDataURL(t,e);if(void 0!==n.convertToBlob){const r=yield n.convertToBlob({type:t,quality:e});return yield new Promise(o=>{const a=new FileReader;a.onload=()=>o(a.result),a.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")})()}canvas(i,t){const e=this.renderer;let s,r,n=!1,o=!1;i&&(i instanceof Ue?r=i:(r=this.renderer.generateTexture(i),o=!0)),r?(s=r.baseTexture.resolution,t=t??r.frame,n=!1,e.renderTexture.bind(r)):(s=e.resolution,t||((t=Ho).width=e.width,t.height=e.height),n=!0,e.renderTexture.bind(null));const a=Math.round(t.width*s),l=Math.round(t.height*s);let c=new Er(a,l,1);const d=new Uint8Array(4*a*l),u=e.gl;u.readPixels(Math.round(t.x*s),Math.round(t.y*s),a,l,u.RGBA,u.UNSIGNED_BYTE,d);const f=c.context.getImageData(0,0,a,l);if(Gn.arrayPostDivide(d,f.data),c.context.putImageData(f,0,0),n){const p=new Er(c.width,c.height,1);p.context.scale(1,-1),p.context.drawImage(c.canvas,0,-l),c.destroy(),c=p}return o&&r.destroy(!0),c.canvas}pixels(i,t){const e=this.renderer;let s,n,r=!1;i&&(i instanceof Ue?n=i:(n=this.renderer.generateTexture(i),r=!0)),n?(s=n.baseTexture.resolution,t=t??n.frame,e.renderTexture.bind(n)):(s=e.resolution,t||((t=Ho).width=e.width,t.height=e.height),e.renderTexture.bind(null));const o=Math.round(t.width*s),a=Math.round(t.height*s),l=new Uint8Array(4*o*a),c=e.gl;return c.readPixels(Math.round(t.x*s),Math.round(t.y*s),o,a,c.RGBA,c.UNSIGNED_BYTE,l),r&&n.destroy(!0),Gn.arrayPostDivide(l,l),l}destroy(){this.renderer=null}static arrayPostDivide(i,t){for(let e=0;e<i.length;e+=4){const s=t[e+3]=i[e+3];0!==s?(t[e]=Math.round(Math.min(255*i[e]/s,255)),t[e+1]=Math.round(Math.min(255*i[e+1]/s,255)),t[e+2]=Math.round(Math.min(255*i[e+2]/s,255))):(t[e]=i[e],t[e+1]=i[e+1],t[e+2]=i[e+2])}}};let Vo=Gn;Vo.extension={name:"extract",type:I.RendererSystem},K.add(Vo);var He=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(He||{}),Qe=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Qe||{});const Li={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Ss{constructor(){this.color=16777215,this.alpha=1,this.texture=tt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ss;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=tt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function zo(i,t=!1){const e=i.length;if(e<6)return;let s=0;for(let n=0,r=i[e-2],o=i[e-1];n<e;n+=2){const a=i[n],l=i[n+1];s+=(a-r)*(l+o),r=a,o=l}if(!t&&s>0||t&&s<=0){const n=e/2;for(let r=n+n%2;r<e;r+=2){const o=e-r-2,a=e-r-1,l=r,c=r+1;[i[o],i[l]]=[i[l],i[o]],[i[a],i[c]]=[i[c],i[a]]}}}const Hn={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const s=i.holes,n=t.points,r=t.indices;if(e.length>=6){zo(e,!1);const o=[];for(let c=0;c<s.length;c++){const d=s[c];zo(d.points,!0),o.push(e.length/2),e=e.concat(d.points)}const a=ah(e,o,2);if(!a)return;const l=n.length/2;for(let c=0;c<a.length;c+=3)r.push(a[c]+l),r.push(a[c+1]+l),r.push(a[c+2]+l);for(let c=0;c<e.length;c++)n.push(e[c])}}},Ni={build(i){const t=i.points;let e,s,n,r,o,a;if(i.type===Jt.CIRC){const _=i.shape;e=_.x,s=_.y,o=a=_.radius,n=r=0}else if(i.type===Jt.ELIP){const _=i.shape;e=_.x,s=_.y,o=_.width,a=_.height,n=r=0}else{const _=i.shape,g=_.width/2,x=_.height/2;e=_.x+g,s=_.y+x,o=a=Math.max(0,Math.min(_.radius,Math.min(g,x))),n=g-o,r=x-a}if(!(o>=0&&a>=0&&n>=0&&r>=0))return void(t.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),c=8*l+(n?4:0)+(r?4:0);if(t.length=c,0===c)return;if(0===l)return t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=s+r,t[2]=t[4]=e-n,void(t[5]=t[7]=s-r);let d=0,u=4*l+(n?2:0)+2,f=u,p=c;{const _=n+o,g=r,x=e+_,T=e-_,k=s+g;if(t[d++]=x,t[d++]=k,t[--u]=k,t[--u]=T,r){const E=s-g;t[f++]=T,t[f++]=E,t[--p]=E,t[--p]=x}}for(let _=1;_<l;_++){const g=Math.PI/2*(_/l),x=n+Math.cos(g)*o,T=r+Math.sin(g)*a,k=e+x,E=e-x,M=s+T,J=s-T;t[d++]=k,t[d++]=M,t[--u]=M,t[--u]=E,t[f++]=E,t[f++]=J,t[--p]=J,t[--p]=k}{const g=r+a,x=e+n,T=e-n,k=s+g,E=s-g;t[d++]=x,t[d++]=k,t[--p]=E,t[--p]=x,n&&(t[d++]=T,t[d++]=k,t[--p]=E,t[--p]=T)}},triangulate(i,t){const e=i.points,s=t.points,n=t.indices;if(0===e.length)return;let r=s.length/2;const o=r;let a,l;if(i.type!==Jt.RREC){const d=i.shape;a=d.x,l=d.y}else{const d=i.shape;a=d.x+d.width/2,l=d.y+d.height/2}const c=i.matrix;s.push(i.matrix?c.a*a+c.c*l+c.tx:a,i.matrix?c.b*a+c.d*l+c.ty:l),r++,s.push(e[0],e[1]);for(let d=2;d<e.length;d+=2)s.push(e[d],e[d+1]),n.push(r++,o,r);n.push(o+1,o,r)}},Yo={build(i){const t=i.shape,e=t.x,s=t.y,n=t.width,r=t.height,o=i.points;o.length=0,n>=0&&r>=0&&o.push(e,s,e+n,s,e+n,s+r,e,s+r)},triangulate(i,t){const e=i.points,s=t.points;if(0===e.length)return;const n=s.length/2;s.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},Wo={build(i){Ni.build(i)},triangulate(i,t){Ni.triangulate(i,t)}};function jo(i,t,e,s,n,r,o,a){let f,p;o?(f=s,p=-e):(f=-s,p=e);const x=i+e*r+f,T=t+s*r+p;return a.push(i-e*n+f,t-s*n+p),a.push(x,T),2}function ti(i,t,e,s,n,r,o,a){const l=e-i,c=s-t;let d=Math.atan2(l,c),u=Math.atan2(n-i,r-t);a&&d<u?d+=2*Math.PI:!a&&d>u&&(u+=2*Math.PI);let f=d;const p=u-d,_=Math.abs(p),g=Math.sqrt(l*l+c*c),x=1+(15*_*Math.sqrt(g)/Math.PI>>0),T=p/x;if(f+=T,a){o.push(i,t),o.push(e,s);for(let k=1,E=f;k<x;k++,E+=T)o.push(i,t),o.push(i+Math.sin(E)*g,t+Math.cos(E)*g);o.push(i,t),o.push(n,r)}else{o.push(e,s),o.push(i,t);for(let k=1,E=f;k<x;k++,E+=T)o.push(i+Math.sin(E)*g,t+Math.cos(E)*g),o.push(i,t);o.push(n,r),o.push(i,t)}return 2*x}function Xn(i,t){i.lineStyle.native?function ep(i,t){let e=0;const s=i.shape,n=i.points||s.points,r=s.type!==Jt.POLY||s.closeStroke;if(0===n.length)return;const o=t.points,a=t.indices,l=n.length/2,c=o.length/2;let d=c;for(o.push(n[0],n[1]),e=1;e<l;e++)o.push(n[2*e],n[2*e+1]),a.push(d,d+1),d++;r&&a.push(d,c)}(i,t):function tp(i,t){const e=i.shape;let s=i.points||e.points.slice();const n=t.closePointEps;if(0===s.length)return;const r=i.lineStyle,o=new bt(s[0],s[1]),a=new bt(s[s.length-2],s[s.length-1]),l=e.type!==Jt.POLY||e.closeStroke,c=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(l){s=s.slice(),c&&(s.pop(),s.pop(),a.set(s[s.length-2],s[s.length-1]));const ct=.5*(o.x+a.x),Pt=.5*(a.y+o.y);s.unshift(ct,Pt),s.push(ct,Pt)}const d=t.points,u=s.length/2;let f=s.length;const p=d.length/2,_=r.width/2,g=_*_,x=r.miterLimit*r.miterLimit;let T=s[0],k=s[1],E=s[2],M=s[3],J=0,Q=0,j=-(k-M),W=T-E,lt=0,V=0,$=Math.sqrt(j*j+W*W);j/=$,W/=$,j*=_,W*=_;const xt=r.alignment,N=2*(1-xt),H=2*xt;l||(r.cap===Qe.ROUND?f+=ti(T-j*(N-H)*.5,k-W*(N-H)*.5,T-j*N,k-W*N,T+j*H,k+W*H,d,!0)+2:r.cap===Qe.SQUARE&&(f+=jo(T,k,j,W,N,H,!0,d))),d.push(T-j*N,k-W*N),d.push(T+j*H,k+W*H);for(let ct=1;ct<u-1;++ct){T=s[2*(ct-1)],k=s[2*(ct-1)+1],E=s[2*ct],M=s[2*ct+1],J=s[2*(ct+1)],Q=s[2*(ct+1)+1],j=-(k-M),W=T-E,$=Math.sqrt(j*j+W*W),j/=$,W/=$,j*=_,W*=_,lt=-(M-Q),V=E-J,$=Math.sqrt(lt*lt+V*V),lt/=$,V/=$,lt*=_,V*=_;const Pt=E-T,Tt=k-M,ji=E-J,$i=Q-M,ih=Pt*ji+Tt*$i,Zs=Tt*ji-$i*Pt,Zi=Zs<0;if(Math.abs(Zs)<.001*Math.abs(ih)){d.push(E-j*N,M-W*N),d.push(E+j*H,M+W*H),ih>=0&&(f+=r.join===He.ROUND?ti(E,M,E-j*N,M-W*N,E-lt*N,M-V*N,d,!1)+4:2,d.push(E-lt*H,M-V*H),d.push(E+lt*N,M+V*N));continue}const sh=(-j+T)*(-W+M)-(-j+E)*(-W+k),nh=(-lt+J)*(-V+M)-(-lt+E)*(-V+Q),qs=(Pt*nh-ji*sh)/Zs,Ks=($i*sh-Tt*nh)/Zs,ur=(qs-E)*(qs-E)+(Ks-M)*(Ks-M),si=E+(qs-E)*N,ni=M+(Ks-M)*N,ri=E-(qs-E)*H,oi=M-(Ks-M)*H,rh=Zi?N:H;ur<=Math.min(Pt*Pt+Tt*Tt,ji*ji+$i*$i)+rh*rh*g?r.join===He.BEVEL||ur/g>x?(Zi?(d.push(si,ni),d.push(E+j*H,M+W*H),d.push(si,ni),d.push(E+lt*H,M+V*H)):(d.push(E-j*N,M-W*N),d.push(ri,oi),d.push(E-lt*N,M-V*N),d.push(ri,oi)),f+=2):r.join===He.ROUND?Zi?(d.push(si,ni),d.push(E+j*H,M+W*H),f+=ti(E,M,E+j*H,M+W*H,E+lt*H,M+V*H,d,!0)+4,d.push(si,ni),d.push(E+lt*H,M+V*H)):(d.push(E-j*N,M-W*N),d.push(ri,oi),f+=ti(E,M,E-j*N,M-W*N,E-lt*N,M-V*N,d,!1)+4,d.push(E-lt*N,M-V*N),d.push(ri,oi)):(d.push(si,ni),d.push(ri,oi)):(d.push(E-j*N,M-W*N),d.push(E+j*H,M+W*H),r.join===He.ROUND?f+=Zi?ti(E,M,E+j*H,M+W*H,E+lt*H,M+V*H,d,!0)+2:ti(E,M,E-j*N,M-W*N,E-lt*N,M-V*N,d,!1)+2:r.join===He.MITER&&ur/g<=x&&(Zi?(d.push(ri,oi),d.push(ri,oi)):(d.push(si,ni),d.push(si,ni)),f+=2),d.push(E-lt*N,M-V*N),d.push(E+lt*H,M+V*H),f+=2)}T=s[2*(u-2)],k=s[2*(u-2)+1],E=s[2*(u-1)],M=s[2*(u-1)+1],j=-(k-M),W=T-E,$=Math.sqrt(j*j+W*W),j/=$,W/=$,j*=_,W*=_,d.push(E-j*N,M-W*N),d.push(E+j*H,M+W*H),l||(r.cap===Qe.ROUND?f+=ti(E-j*(N-H)*.5,M-W*(N-H)*.5,E-j*N,M-W*N,E+j*H,M+W*H,d,!1)+2:r.cap===Qe.SQUARE&&(f+=jo(E,M,j,W,N,H,!1,d)));const Mt=t.indices,ft=Li.epsilon*Li.epsilon;for(let ct=p;ct<f+p-2;++ct)T=d[2*ct],k=d[2*ct+1],E=d[2*(ct+1)],M=d[2*(ct+1)+1],J=d[2*(ct+2)],Q=d[2*(ct+2)+1],!(Math.abs(T*(M-Q)+E*(Q-k)+J*(k-M))<ft)&&Mt.push(ct,ct+1,ct+2)}(i,t)}class Vn{static curveTo(t,e,s,n,r,o){const c=o[o.length-1]-e,d=o[o.length-2]-t,u=n-e,f=s-t,p=Math.abs(c*f-d*u);if(p<1e-8||0===r)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const _=c*c+d*d,g=u*u+f*f,x=c*u+d*f,T=r*Math.sqrt(_)/p,k=r*Math.sqrt(g)/p,E=T*x/_,M=k*x/g,J=T*f+k*d,Q=T*u+k*c,lt=f*(T+M),V=u*(T+M);return{cx:J+t,cy:Q+e,radius:r,startAngle:Math.atan2(c*(k+E)-Q,d*(k+E)-J),endAngle:Math.atan2(V-Q,lt-J),anticlockwise:d*u>f*c}}static arc(t,e,s,n,r,o,a,l,c){const d=a-o,u=Li._segmentsCount(Math.abs(d)*r,40*Math.ceil(Math.abs(d)/Fe)),f=d/(2*u),p=2*f,_=Math.cos(f),g=Math.sin(f),x=u-1,T=x%1/x;for(let k=0;k<=x;++k){const M=f+o+p*(k+T*k),J=Math.cos(M),Q=-Math.sin(M);c.push((_*J+g*Q)*r+s,(_*-Q+g*J)*r+n)}}}class Es{static curveLength(t,e,s,n,r,o,a,l){let d=0,u=0,f=0,p=0,_=0,g=0,x=0,T=0,k=0,E=0,M=0,J=t,Q=e;for(let j=1;j<=10;++j)u=j/10,f=u*u,p=f*u,_=1-u,g=_*_,x=g*_,T=x*t+3*g*u*s+3*_*f*r+p*a,k=x*e+3*g*u*n+3*_*f*o+p*l,E=J-T,M=Q-k,J=T,Q=k,d+=Math.sqrt(E*E+M*M);return d}static curveTo(t,e,s,n,r,o,a){const l=a[a.length-2],c=a[a.length-1];a.length-=2;const d=Li._segmentsCount(Es.curveLength(l,c,t,e,s,n,r,o));let u=0,f=0,p=0,_=0,g=0;a.push(l,c);for(let x=1,T=0;x<=d;++x)T=x/d,u=1-T,f=u*u,p=f*u,_=T*T,g=_*T,a.push(p*l+3*f*T*t+3*u*_*s+g*r,p*c+3*f*T*e+3*u*_*n+g*o)}}class Cs{static curveLength(t,e,s,n,r,o){const a=t-2*s+r,l=e-2*n+o,c=2*s-2*t,d=2*n-2*e,u=4*(a*a+l*l),f=4*(a*c+l*d),p=c*c+d*d,_=2*Math.sqrt(u+f+p),g=Math.sqrt(u),x=2*u*g,T=2*Math.sqrt(p),k=f/g;return(x*_+g*f*(_-T)+(4*p*u-f*f)*Math.log((2*g+k+_)/(k+T)))/(4*x)}static curveTo(t,e,s,n,r){const o=r[r.length-2],a=r[r.length-1],l=Li._segmentsCount(Cs.curveLength(o,a,t,e,s,n));let c=0,d=0;for(let u=1;u<=l;++u){const f=u/l;c=o+(t-o)*f,d=a+(e-a)*f,r.push(c+(t+(s-t)*f-c)*f,d+(e+(n-e)*f-d)*f)}}}const As={[Jt.POLY]:Hn,[Jt.CIRC]:Ni,[Jt.ELIP]:Ni,[Jt.RECT]:Yo,[Jt.RREC]:Wo},zn=[],Ui=[];class Rs{constructor(t,e=null,s=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Rs(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class $o{constructor(){this.reset()}begin(t,e,s){this.reset(),this.style=t,this.start=e,this.attribStart=s}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const mi=new bt,Zo=class extends bo{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new us,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),Ui.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t.reset(),zn.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,t=null,e=null,s=null){const n=new Rs(i,t,e,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(i,t=null){if(!this.graphicsData.length)return null;const e=new Rs(i,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=s.lineStyle,s.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const t=this.graphicsData;for(let e=0;e<t.length;++e){const s=t[e];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(i,mi):mi.copyFrom(i),s.shape.contains(mi.x,mi.y))){let n=!1;if(s.holes)for(let r=0;r<s.holes.length;r++)if(s.holes[r].shape.contains(mi.x,mi.y)){n=!0;break}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,t=this.graphicsData;let e=null,s=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],s=e.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const l=t[a],c=l.fillStyle,d=l.lineStyle;As[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(c.visible||d.visible)&&this.processHoles(l.holes);for(let f=0;f<2;f++){const p=0===f?c:d;if(!p.visible)continue;const g=this.indices.length,x=this.points.length/2;p.texture.baseTexture.wrapMode=gt.REPEAT,0===f?this.processFill(l):this.processLine(l);const T=this.points.length/2-x;0!==T&&(e&&!this._compareStyles(s,p)&&(e.end(g,x),e=null),e||(e=zn.pop()||new $o,e.begin(p,g,x),this.batches.push(e),s=p),this.addUvs(this.points,i,p.texture,x,T,p.matrix))}}const r=this.points.length/2;if(e&&e.end(this.indices.length,r),0===this.batches.length)return void(this.batchable=!0);const o=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,t){return!(!i||!t||i.texture.baseTexture!==t.texture.baseTexture||i.color+i.alpha!==t.color+t.alpha||!!i.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,t=this.graphicsData.length;i<t;i++){const e=this.graphicsData[i],s=e.fillStyle,n=e.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let t=0,e=i.length;t<e;t++){const s=i[t];for(let n=0;n<s.size;n++){const r=s.start+n;this.indicesUint16[r]=this.indicesUint16[r]-s.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const i=this.batches;for(let t=0;t<i.length;t++)if(i[t].style.native)return!1;return this.points.length<2*Zo.BATCHABLE_SIZE}buildDrawCalls(){let i=++wt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Ui.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let s=Ui.pop();s||(s=new Cn,s.texArray=new An),s.texArray.count=0,s.start=0,s.size=0,s.type=pt.TRIANGLES;let n=0,r=null,o=0,a=!1,l=pt.TRIANGLES,c=0;this.drawCalls.push(s);for(let d=0;d<this.batches.length;d++){const u=this.batches[d],f=8,p=u.style,_=p.texture.baseTexture;a!==!!p.native&&(a=!!p.native,l=a?pt.LINES:pt.TRIANGLES,r=null,n=f,i++),r!==_&&(r=_,_._batchEnabled!==i&&(n===f&&(i++,n=0,s.size>0&&(s=Ui.pop(),s||(s=new Cn,s.texArray=new An),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=l),_.touched=1,_._batchEnabled=i,_._batchLocation=n,_.wrapMode=gt.REPEAT,s.texArray.elements[s.texArray.count++]=_,n++)),s.size+=u.size,c+=u.size,o=_._batchLocation,this.addColors(t,p.color,p.alpha,u.attribSize,u.attribStart),this.addTextureIds(e,o,u.attribSize,u.attribStart)}wt._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,t=this.uvs,e=this.colors,s=this.textureIds,n=new ArrayBuffer(3*i.length*4),r=new Float32Array(n),o=new Uint32Array(n);let a=0;for(let l=0;l<i.length/2;l++)r[a++]=i[2*l],r[a++]=i[2*l+1],r[a++]=t[2*l],r[a++]=t[2*l+1],o[a++]=e[l],r[a++]=s[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?Hn.triangulate(i,this):As[i.type].triangulate(i,this)}processLine(i){Xn(i,this);for(let t=0;t<i.holes.length;t++)Xn(i.holes[t],this)}processHoles(i){for(let t=0;t<i.length;t++){const e=i[t];As[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,t){for(let e=0;e<i.length/2;e++){const s=i[2*e],n=i[2*e+1];i[2*e]=t.a*s+t.c*n+t.tx,i[2*e+1]=t.b*s+t.d*n+t.ty}}addColors(i,t,e,s,n=0){const o=hn((t>>16)+(65280&t)+((255&t)<<16),e);i.length=Math.max(i.length,n+s);for(let a=0;a<s;a++)i[n+a]=o}addTextureIds(i,t,e,s=0){i.length=Math.max(i.length,s+e);for(let n=0;n<e;n++)i[s+n]=t}addUvs(i,t,e,s,n,r=null){let o=0;const a=t.length,l=e.frame;for(;o<n;){let d=i[2*(s+o)],u=i[2*(s+o)+1];if(r){const f=r.a*d+r.c*u+r.tx;u=r.b*d+r.d*u+r.ty,d=f}o++,t.push(d/l.width,u/l.height)}const c=e.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(t,e,a,n)}adjustUvs(i,t,e,s){const n=t.baseTexture,r=1e-6,o=e+2*s,a=t.frame,l=a.width/n.width,c=a.height/n.height;let d=a.x/a.width,u=a.y/a.height,f=Math.floor(i[e]+r),p=Math.floor(i[e+1]+r);for(let _=e+2;_<o;_+=2)f=Math.min(f,Math.floor(i[_]+r)),p=Math.min(p,Math.floor(i[_+1]+r));d-=f,u-=p;for(let _=e;_<o;_+=2)i[_]=(i[_]+d)*l,i[_+1]=(i[_+1]+u)*c}};let qo=Zo;qo.BATCHABLE_SIZE=100;class Yn extends Ss{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Qe.BUTT,this.join=He.MITER,this.miterLimit=10}clone(){const t=new Yn;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const ip=new Float32Array(3),Wn={},Is=class extends ge{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ss,this._lineStyle=new Yn,this._matrix=null,this._holeMode=!1,this.state=Ce.for2d(),this._geometry=i||new qo,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=z.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Is(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(i){this._tint=i}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,t=0,e=1,s=.5,n=!1){return"number"==typeof i&&(i={width:i,color:t,alpha:e,alignment:s,native:n}),this.lineTextureStyle(i)}lineTextureStyle(i){i=Object.assign({width:0,texture:tt.WHITE,color:i?.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Qe.BUTT,join:He.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();const t=i.width>0&&i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:t},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new hi,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[t-2],i[t-1]))}else this.currentPath=new hi,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,t){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=t,this}lineTo(i,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points;return(e[e.length-2]!==i||e[e.length-1]!==t)&&e.push(i,t),this}_initCurve(i=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[i,t]):this.moveTo(i,t)}quadraticCurveTo(i,t,e,s){this._initCurve();const n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),Cs.curveTo(i,t,e,s,n),this}bezierCurveTo(i,t,e,s,n,r){return this._initCurve(),Es.curveTo(i,t,e,s,n,r,this.currentPath.points),this}arcTo(i,t,e,s,n){this._initCurve(i,t);const o=Vn.curveTo(i,t,e,s,n,this.currentPath.points);if(o){const{cx:a,cy:l,radius:c,startAngle:d,endAngle:u,anticlockwise:f}=o;this.arc(a,l,c,d,u,f)}return this}arc(i,t,e,s,n,r=!1){if(s===n)return this;if(!r&&n<=s?n+=Fe:r&&s<=n&&(s+=Fe),n-s==0)return this;const a=i+Math.cos(s)*e,l=t+Math.sin(s)*e,c=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const u=Math.abs(d[d.length-2]-a),f=Math.abs(d[d.length-1]-l);u<c&&f<c||d.push(a,l)}else this.moveTo(a,l),d=this.currentPath.points;return Vn.arc(a,l,i,t,e,s,n,r,d),this}beginFill(i=0,t=1){return this.beginTextureFill({texture:tt.WHITE,color:i,alpha:t})}beginTextureFill(i){i=Object.assign({texture:tt.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();const t=i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:t},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,t,e,s){return this.drawShape(new yt(i,t,e,s))}drawRoundedRect(i,t,e,s,n){return this.drawShape(new tn(i,t,e,s,n))}drawCircle(i,t,e){return this.drawShape(new Js(i,t,e))}drawEllipse(i,t,e,s){return this.drawShape(new Qs(i,t,e,s))}drawPolygon(...i){let t,e=!0;const s=i[0];s.points?(e=s.closeStroke,t=s.points):t=Array.isArray(i[0])?i[0]:i;const n=new hi(t);return n.closeStroke=e,this.drawShape(n),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return!(1!==i.length||i[0].shape.type!==Jt.RECT||i[0].matrix||i[0].holes.length||i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,t=this.blendMode,e=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(i.points);for(let s=0;s<e;s++){const n=i.batches[s],r=n.style.color,o=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),a=new Float32Array(i.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),c={vertexData:o,blendMode:t,indices:new Uint16Array(i.indicesUint16.buffer,2*n.start,n.size),uvs:a,_batchRGB:Ei(r),_tintRGB:r,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=c}}_renderBatched(i){if(this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,i.plugins[this.pluginName].render(s)}}}_renderDirect(i){const t=this._resolveDirectShader(i),e=this._geometry,s=this.tint,n=this.worldAlpha,r=t.uniforms,o=e.drawCalls;r.translationMatrix=this.transform.worldTransform,r.tint[0]=(s>>16&255)/255*n,r.tint[1]=(s>>8&255)/255*n,r.tint[2]=(255&s)/255*n,r.tint[3]=n,i.shader.bind(t),i.geometry.bind(e,t),i.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(i,e.drawCalls[a])}_renderDrawCallDirect(i,t){const{texArray:e,type:s,size:n,start:r}=t,o=e.count;for(let a=0;a<o;a++)i.texture.bind(e.elements[a],a);i.geometry.draw(s,n,r)}_resolveDirectShader(i){let t=this.shader;const e=this.pluginName;if(!t){if(!Wn[e]){const{MAX_TEXTURES:s}=i.plugins[e],n=new Int32Array(s);for(let a=0;a<s;a++)n[a]=a;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new kt,default:_e.from({uSamplers:n},!0)};Wn[e]=new be(i.plugins[e]._shader.program,r)}t=Wn[e]}return t}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:t,minY:e,maxX:s,maxY:n}=i.bounds;this._bounds.addFrame(this.transform,t,e,s,n)}containsPoint(i){return this.worldTransform.applyInverse(i,Is._TEMP_POINT),this._geometry.containsPoint(Is._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const i=Ei(this.tint,ip);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],s=e._batchRGB,a=(i[0]*s[0]*255<<16)+(i[1]*s[1]*255<<8)+(0|i[2]*s[2]*255);e._tintRGB=(a>>16)+(65280&a)+((255&a)<<16)}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const t=this.transform.worldTransform,e=t.a,s=t.b,n=t.c,r=t.d,o=t.tx,a=t.ty,l=this._geometry.points,c=this.vertexData;let d=0;for(let u=0;u<l.length;u+=2){const f=l[u],p=l[u+1];c[d++]=e*f+n*p+o,c[d++]=r*p+s*f+a}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let Gi=Is;Gi._TEMP_POINT=new bt;class sp{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const jn=new bt,Ko=new hi,Jo=class extends ge{constructor(i,t,e,s=pt.TRIANGLES){super(),this.geometry=i,this.shader=t,this.state=e||Ce.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=O.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){this.shader.batchable&&this.drawMode===pt.TRIANGLES&&this.geometry.buffers[0].data.length<2*Jo.BATCHABLE_SIZE?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),i.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(t),i.state.set(this.state),i.geometry.bind(this.geometry,t),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const s=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[s]),i.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,r=n.a,o=n.b,a=n.c,l=n.d,c=n.tx,d=n.ty,u=this.vertexData;for(let f=0;f<u.length/2;f++){const p=e[2*f],_=e[2*f+1];u[2*f]=r*p+a*_+c,u[2*f+1]=o*p+l*_+d}if(this._roundPixels){const f=O.RESOLUTION;for(let p=0;p<u.length;++p)u[p]=Math.round(u[p]*f)/f}this.vertexDirty=s}calculateUvs(){const i=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new sp(i,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,jn);const t=this.geometry.getBuffer("aVertexPosition").data,e=Ko.points,s=this.geometry.getIndex().data,n=s.length,r=4===this.drawMode?3:1;for(let o=0;o+2<n;o+=r){const a=2*s[o],l=2*s[o+1],c=2*s[o+2];if(e[0]=t[a],e[1]=t[a+1],e[2]=t[l],e[3]=t[l+1],e[4]=t[c],e[5]=t[c+1],Ko.contains(jn.x,jn.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let $n=Jo;$n.BATCHABLE_SIZE=100;class Qo extends be{constructor(t,e){const s={uSampler:t,alpha:1,uTextureMatrix:kt.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(s,e.uniforms),super(e.program||Ee.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),s),this._colorDirty=!1,this.uvMatrix=new Zr(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){this._colorDirty&&(this._colorDirty=!1,br(this._tint,this._alpha,this.uniforms.uColor,this.texture.baseTexture.alphaMode)),this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class op extends Ge{constructor(t,e,s){super();const n=new $t(t),r=new $t(e,!0),o=new $t(s,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,F.FLOAT).addAttribute("aTextureCoord",r,2,!1,F.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class ta{constructor(t,e,s){this.geometry=new Ge,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let r=t[n];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||F.FLOAT,offset:r.offset},e[n]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new $t(function id(i,t=null){const e=6*i;if((t=t||new Uint16Array(e)).length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let s=0,n=0;s<e;s+=6,n+=4)t[s+0]=n+0,t[s+1]=n+1,t[s+2]=n+2,t[s+3]=n+0,t[s+4]=n+2,t[s+5]=n+3;return t}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new $t(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new $t(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===F.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===F.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)}}uploadDynamic(t,e,s){for(let n=0;n<this.dynamicProperties.length;n++){const r=this.dynamicProperties[n];r.uploadFunction(t,e,s,r.type===F.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,s){for(let n=0;n<this.staticProperties.length;n++){const r=this.staticProperties[n];r.uploadFunction(t,e,s,r.type===F.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class ea extends ns{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new kt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:F.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=be.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Ce.for2d()}render(t){const e=t.children,s=t._maxSize,n=t._batchSize,r=this.renderer;let o=e.length;if(0===o)return;o>s&&!t.autoResize&&(o=s);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const l=e[0]._texture.baseTexture,c=l.alphaMode>0;this.state.blendMode=xr(t.blendMode,c),r.state.set(this.state);const d=r.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=function ed(i,t,e,s){return e=e||new Float32Array(4),s||void 0===s?(e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t):(e[0]=i[0],e[1]=i[1],e[2]=i[2]),e[3]=t,e}(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,c),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let f=!1;for(let p=0,_=0;p<o;p+=n,_+=1){let g=o-p;g>n&&(g=n),_>=a.length&&a.push(this._generateOneMoreBuffer(t));const x=a[_];x.uploadDynamic(e,p,g);const T=t._bufferUpdateIDs[_]||0;f=f||x._updateID<T,f&&(x._updateID=t._updateID,x.uploadStatic(e,p,g)),r.geometry.bind(x.geometry),d.drawElements(d.TRIANGLES,6*g,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],s=t._maxSize,n=t._batchSize,r=t._properties;for(let o=0;o<s;o+=n)e.push(new ta(this.properties,r,n));return e}_generateOneMoreBuffer(t){return new ta(this.properties,t._properties,t._batchSize)}uploadVertices(t,e,s,n,r,o){let a=0,l=0,c=0,d=0;for(let u=0;u<s;++u){const f=t[e+u],p=f._texture,_=f.scale.x,g=f.scale.y,x=p.trim,T=p.orig;x?(l=x.x-f.anchor.x*T.width,a=l+x.width,d=x.y-f.anchor.y*T.height,c=d+x.height):(a=T.width*(1-f.anchor.x),l=T.width*-f.anchor.x,c=T.height*(1-f.anchor.y),d=T.height*-f.anchor.y),n[o]=l*_,n[o+1]=d*g,n[o+r]=a*_,n[o+r+1]=d*g,n[o+2*r]=a*_,n[o+2*r+1]=c*g,n[o+3*r]=l*_,n[o+3*r+1]=c*g,o+=4*r}}uploadPosition(t,e,s,n,r,o){for(let a=0;a<s;a++){const l=t[e+a].position;n[o]=l.x,n[o+1]=l.y,n[o+r]=l.x,n[o+r+1]=l.y,n[o+2*r]=l.x,n[o+2*r+1]=l.y,n[o+3*r]=l.x,n[o+3*r+1]=l.y,o+=4*r}}uploadRotation(t,e,s,n,r,o){for(let a=0;a<s;a++){const l=t[e+a].rotation;n[o]=l,n[o+r]=l,n[o+2*r]=l,n[o+3*r]=l,o+=4*r}}uploadUvs(t,e,s,n,r,o){for(let a=0;a<s;++a){const l=t[e+a]._texture._uvs;l?(n[o]=l.x0,n[o+1]=l.y0,n[o+r]=l.x1,n[o+r+1]=l.y1,n[o+2*r]=l.x2,n[o+2*r+1]=l.y2,n[o+3*r]=l.x3,n[o+3*r+1]=l.y3,o+=4*r):(n[o]=0,n[o+1]=0,n[o+r]=0,n[o+r+1]=0,n[o+2*r]=0,n[o+2*r+1]=0,n[o+3*r]=0,n[o+3*r+1]=0,o+=4*r)}}uploadTint(t,e,s,n,r,o){for(let a=0;a<s;++a){const l=t[e+a],c=l._texture.baseTexture.alphaMode>0,d=l.alpha,u=d<1&&c?hn(l._tintRGB,d):l._tintRGB+(255*d<<24);n[o]=u,n[o+r]=u,n[o+2*r]=u,n[o+3*r]=u,o+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ea.extension={name:"particle",type:I.RendererPlugin},K.add(ea),O.UPLOADS_PER_FRAME=4;var Ps=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Ps||{});const Zn={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ps.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},lp=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class Xe{constructor(t){this.styleID=0,this.reset(),Kn(this,t,t)}clone(){const t={};return Kn(t,this,Zn),new Xe(t)}reset(){Kn(this,Zn,Zn)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=qn(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=qn(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function cp(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=qn(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let n=e[s].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!lp.includes(n)&&(n=`"${n}"`),e[s]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}}function ia(i){return"number"==typeof i?vr(i):("string"==typeof i&&i.startsWith("0x")&&(i=i.replace("0x","#")),i)}function qn(i){if(Array.isArray(i)){for(let t=0;t<i.length;++t)i[t]=ia(i[t]);return i}return ia(i)}function Kn(i,t,e){for(const s in e)i[s]=Array.isArray(t[s])?t[s].slice():t[s]}const Ds={willReadFrequently:!0};let Jn=(()=>{class i{constructor(e,s,n,r,o,a,l,c,d){this.text=e,this.style=s,this.width=n,this.height=r,this.lines=o,this.lineWidths=a,this.lineHeight=l,this.maxLineWidth=c,this.fontProperties=d}static measureText(e,s,n,r=i._canvas){n=n??s.wordWrap;const o=s.toFontString(),a=i.measureFont(o);0===a.fontSize&&(a.fontSize=s.fontSize,a.ascent=s.fontSize);const l=r.getContext("2d",Ds);l.font=o;const d=(n?i.wordWrap(e,s,r):e).split(/(?:\r\n|\r|\n)/),u=new Array(d.length);let f=0;for(let x=0;x<d.length;x++){const T=l.measureText(d[x]).width+(d[x].length-1)*s.letterSpacing;u[x]=T,f=Math.max(f,T)}let p=f+s.strokeThickness;s.dropShadow&&(p+=s.dropShadowDistance);const _=s.lineHeight||a.fontSize+s.strokeThickness;let g=Math.max(_,a.fontSize+2*s.strokeThickness)+(d.length-1)*(_+s.leading);return s.dropShadow&&(g+=s.dropShadowDistance),new i(e,s,p,g,d,u,_+s.leading,f,a)}static wordWrap(e,s,n=i._canvas){const r=n.getContext("2d",Ds);let o=0,a="",l="";const c=Object.create(null),{letterSpacing:d,whiteSpace:u}=s,f=i.collapseSpaces(u),p=i.collapseNewlines(u);let _=!f;const g=s.wordWrapWidth+d,x=i.tokenize(e);for(let T=0;T<x.length;T++){let k=x[T];if(i.isNewline(k)){if(!p){l+=i.addLine(a),_=!f,a="",o=0;continue}k=" "}if(f){const M=i.isBreakingSpace(k),J=i.isBreakingSpace(a[a.length-1]);if(M&&J)continue}const E=i.getFromCache(k,d,c,r);if(E>g)if(""!==a&&(l+=i.addLine(a),a="",o=0),i.canBreakWords(k,s.breakWords)){const M=i.wordWrapSplit(k);for(let J=0;J<M.length;J++){let Q=M[J],j=1;for(;M[J+j];){const lt=M[J+j];if(i.canBreakChars(Q[Q.length-1],lt,k,J,s.breakWords))break;Q+=lt,j++}J+=Q.length-1;const W=i.getFromCache(Q,d,c,r);W+o>g&&(l+=i.addLine(a),_=!1,a="",o=0),a+=Q,o+=W}}else a.length>0&&(l+=i.addLine(a),a="",o=0),l+=i.addLine(k,!(T===x.length-1)),_=!1,a="",o=0;else E+o>g&&(_=!1,l+=i.addLine(a),a="",o=0),(a.length>0||!i.isBreakingSpace(k)||_)&&(a+=k,o+=E)}return l+=i.addLine(a,!1),l}static addLine(e,s=!0){return e=i.trimRight(e),s?`${e}\n`:e}static getFromCache(e,s,n,r){let o=n[e];if("number"!=typeof o){const a=e.length*s;o=r.measureText(e).width+a,n[e]=o}return o}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(e){if("string"!=typeof e)return"";for(let s=e.length-1;s>=0&&i.isBreakingSpace(e[s]);s--)e=e.slice(0,-1);return e}static isNewline(e){return"string"==typeof e&&i._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,s){return"string"==typeof e&&i._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const s=[];let n="";if("string"!=typeof e)return s;for(let r=0;r<e.length;r++){const o=e[r];i.isBreakingSpace(o,e[r+1])||i.isNewline(o)?(""!==n&&(s.push(n),n=""),s.push(o)):n+=o}return""!==n&&s.push(n),s}static canBreakWords(e,s){return s}static canBreakChars(e,s,n,r,o){return!0}static wordWrapSplit(e){return e.split("")}static measureFont(e){if(i._fonts[e])return i._fonts[e];const s={ascent:0,descent:0,fontSize:0},n=i._canvas,r=i._context;r.font=e;const o=i.METRICS_STRING+i.BASELINE_SYMBOL,a=Math.ceil(r.measureText(o).width);let l=Math.ceil(r.measureText(i.BASELINE_SYMBOL).width);const c=Math.ceil(i.HEIGHT_MULTIPLIER*l);l=l*i.BASELINE_MULTIPLIER|0,n.width=a,n.height=c,r.fillStyle="#f00",r.fillRect(0,0,a,c),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(o,0,l);const d=r.getImageData(0,0,a,c).data,u=d.length,f=4*a;let p=0,_=0,g=!1;for(p=0;p<l;++p){for(let x=0;x<f;x+=4)if(255!==d[_+x]){g=!0;break}if(g)break;_+=f}for(s.ascent=l-p,_=u-f,g=!1,p=c;p>l;--p){for(let x=0;x<f;x+=4)if(255!==d[_+x]){g=!0;break}if(g)break;_-=f}return s.descent=p-l,s.fontSize=s.ascent+s.descent,i._fonts[e]=s,s}static clearMetrics(e=""){e?delete i._fonts[e]:i._fonts={}}static get _canvas(){if(!i.__canvas){let e;try{const s=new OffscreenCanvas(0,0);if(s.getContext("2d",Ds)?.measureText)return i.__canvas=s,s;e=O.ADAPTER.createCanvas()}catch{e=O.ADAPTER.createCanvas()}e.width=e.height=10,i.__canvas=e}return i.__canvas}static get _context(){return i.__context||(i.__context=i._canvas.getContext("2d",Ds)),i.__context}}return i._fonts={},i.METRICS_STRING="|\xc9q\xc5",i.BASELINE_SYMBOL="M",i.BASELINE_MULTIPLIER=1.4,i.HEIGHT_MULTIPLIER=2,i._newlines=[10,13],i._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],i})();const dp={texture:!0,children:!1,baseTexture:!0},sa=class extends Bi{constructor(i,t,e){let s=!1;e||(e=O.ADAPTER.createCanvas(),s=!0),e.width=3,e.height=3;const n=tt.from(e);n.orig=new yt,n.trim=new yt,super(n),this._ownCanvas=s,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=O.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=t,this.localStyleID=-1}updateText(i){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const e=this.context,s=Jn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.height,o=s.lines,a=s.lineHeight,l=s.lineWidths,c=s.maxLineWidth,d=s.fontProperties;let u,f;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s.width)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+2*t.padding)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;const p=t.dropShadow?2:1;for(let _=0;_<p;++_){const g=t.dropShadow&&0===_,x=g?Math.ceil(Math.max(1,r)+2*t.padding):0,T=x*this._resolution;if(g){e.fillStyle="black",e.strokeStyle="black";const E=t.dropShadowColor,M=Ei("number"==typeof E?E:an(E)),J=t.dropShadowBlur*this._resolution,Q=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${255*M[0]},${255*M[1]},${255*M[2]},${t.dropShadowAlpha})`,e.shadowBlur=J,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*Q,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*Q+T}else e.fillStyle=this._generateFillStyle(t,o,s),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let k=(a-d.fontSize)/2;a-d.fontSize<0&&(k=0);for(let E=0;E<o.length;E++)u=t.strokeThickness/2,f=t.strokeThickness/2+E*a+d.ascent+k,"right"===t.align?u+=c-l[E]:"center"===t.align&&(u+=(c-l[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[E],u+t.padding,f+t.padding-x,!0),t.fill&&this.drawLetterSpacing(o[E],u+t.padding,f+t.padding-x)}this.updateTexture()}drawLetterSpacing(i,t,e,s=!1){const r=this._style.letterSpacing,o=sa.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(0===r||o)return o&&(this.context.letterSpacing=r,this.context.textLetterSpacing=r),void(s?this.context.strokeText(i,t,e):this.context.fillText(i,t,e));let a=t;const l=Array.from?Array.from(i):i.split("");let c=this.context.measureText(i).width,d=0;for(let u=0;u<l.length;++u){const f=l[u];s?this.context.strokeText(f,a,e):this.context.fillText(f,a,e);let p="";for(let _=u+1;_<l.length;++_)p+=l[_];d=this.context.measureText(p).width,a+=c-d+r,c=d}}updateTexture(){const i=this.canvas;if(this._style.trim){const r=function rd(i){let{width:t,height:e}=i;const s=i.getContext("2d",{willReadFrequently:!0}),r=s.getImageData(0,0,t,e).data;let o=0,a=e-1,l=0,c=t-1;for(;o<e&&Cr(r,t,o);)++o;if(o===e)return{width:0,height:0,data:null};for(;Cr(r,t,a);)--a;for(;Ar(r,t,l,o,a);)++l;for(;Ar(r,t,c,o,a);)--c;return t=c-l+1,e=a-o+1,{width:t,height:e,data:s.getImageData(l,o,t,e)}}(i);r.data&&(i.width=r.width,i.height=r.height,this.context.putImageData(r.data,0,0))}const t=this._texture,e=this._style,s=e.trim?0:e.padding,n=t.baseTexture;t.trim.width=t._frame.width=i.width/this._resolution,t.trim.height=t._frame.height=i.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-2*s,t.orig.height=t._frame.height-2*s,this._onTextureUpdate(),n.setRealSize(i.width,i.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,t){return this.updateText(!0),-1===this._textureID&&(i=!1),super.getBounds(i,t)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,t,e){const s=i.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];let n;const r=i.dropShadow?i.dropShadowDistance:0,o=i.padding||0,a=this.canvas.width/this._resolution-r-2*o,l=this.canvas.height/this._resolution-r-2*o,c=s.slice(),d=i.fillGradientStops.slice();if(!d.length){const u=c.length+1;for(let f=1;f<u;++f)d.push(f/u)}if(c.unshift(s[0]),d.unshift(0),c.push(s[s.length-1]),d.push(1),i.fillGradientType===Ps.LINEAR_VERTICAL){n=this.context.createLinearGradient(a/2,o,a/2,l+o);const u=e.fontProperties.fontSize+i.strokeThickness;for(let f=0;f<t.length;f++){const p=e.lineHeight*(f-1)+u,_=e.lineHeight*f;let g=_;f>0&&p>_&&(g=(_+p)/2);const x=_+u,T=e.lineHeight*(f+1);let k=x;f+1<t.length&&T<x&&(k=(x+T)/2);const E=(k-g)/l;for(let M=0;M<c.length;M++){let J=0;J="number"==typeof d[M]?d[M]:M/c.length;let Q=Math.min(1,Math.max(0,g/l+J*E));Q=Number(Q.toFixed(5)),n.addColorStop(Q,c[M])}}}else{n=this.context.createLinearGradient(o,l/2,a+o,l/2);const u=c.length+1;let f=1;for(let p=0;p<c.length;p++){let _;_="number"==typeof d[p]?d[p]:f/u,n.addColorStop(_,c[p]),f++}}return n}destroy(i){"boolean"==typeof i&&(i={children:i}),i=Object.assign({},dp,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const t=di(this.scale.x)||1;this.scale.x=t*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const t=di(this.scale.y)||1;this.scale.y=t*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){this._style=(i=i||{})instanceof Xe?i:new Xe(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Qn=sa;Qn.experimentalLetterSpacing=!1;class up{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function fp(i,t){let e=!1;if(i?._textures?.length)for(let s=0;s<i._textures.length;s++)if(i._textures[s]instanceof tt){const n=i._textures[s].baseTexture;t.includes(n)||(t.push(n),e=!0)}return e}function pp(i,t){if(i.baseTexture instanceof wt){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function _p(i,t){if(i._texture&&i._texture instanceof tt){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function mp(i,t){return t instanceof Qn&&(t.updateText(!0),!0)}function gp(i,t){if(t instanceof Xe){const e=t.toFontString();return Jn.measureFont(e),!0}return!1}function vp(i,t){if(i instanceof Qn){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function yp(i,t){return i instanceof Xe&&(t.includes(i)||t.push(i),!0)}function na(i,t){return t instanceof wt&&(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0)}function bp(i,t){if(!(t instanceof Gi))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:s}=e;for(let n=0;n<s.length;n++){const{texture:r}=s[n].style;r&&na(i,r.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function wp(i,t){return i instanceof Gi&&(t.push(i),!0)}class ra extends class xp{constructor(t){this.limiter=new up(O.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(vp),this.registerFindHook(yp),this.registerFindHook(fp),this.registerFindHook(pp),this.registerFindHook(_p),this.registerUploadHook(mp),this.registerUploadHook(gp)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Zt.system.addOnce(this.tick,this,li.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let s=0,n=this.uploadHooks.length;s<n;s++)if(this.uploadHooks[s](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Zt.system.addOnce(this.tick,this,li.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,s=t.length;e<s;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,s=this.addHooks.length;e<s&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ge)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Zt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(wp),this.registerUploadHook(na),this.registerUploadHook(bp)}}ra.extension={name:"prepare",type:I.RendererSystem},K.add(ra);const Hi=class{constructor(i,t,e=null){this.linkedSheets=[],this._texture=i instanceof tt?i:null,this.baseTexture=i instanceof wt?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const s=this.baseTexture.resource;this.resolution=this._updateResolution(e||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:t}=this.data.meta;let e=Le(i,null);return null===e&&(e=parseFloat(t??"1")),1!==e&&this.baseTexture.setResolution(e),e}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=Hi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let t=i;const e=Hi.BATCH_SIZE;for(;t-i<e&&t<this._frameKeys.length;){const s=this._frameKeys[t],n=this._frames[s],r=n.frame;if(r){let o=null,a=null;const l=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,c=new yt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o=n.rotated?new yt(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new yt(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(a=new yt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[s]=new tt(this.baseTexture,o,c,a,n.rotated?2:0,n.anchor),tt.addToCache(this.textures[s],s)}t++}}_processAnimations(){const i=this.data.animations||{};for(const t in i){this.animations[t]=[];for(let e=0;e<i[t].length;e++)this.animations[t].push(this.textures[i[t][e]])}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Hi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Hi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let tr=Hi;tr.BATCH_SIZE=1e3;const Tp=["jpg","png","jpeg","avif","webp"];function oa(i,t,e){const s={};if(i.forEach(n=>{s[n]=t}),Object.keys(t.textures).forEach(n=>{s[n]=t.textures[n]}),!e){const n=te.dirname(i[0]);t.linkedSheets.forEach((r,o)=>{const a=oa([`${n}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(s,a)})}return s}const Sp={extension:I.Asset,cache:{test:i=>i instanceof tr,getCacheableAssets:(i,t)=>oa(i,t,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),s=e.pop(),n=e.pop();return"json"===s&&Tp.includes(n)},parse:i=>{const t=i.split(".");return{resolution:parseFloat(O.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t[t.length-2],src:i}}},loader:{extension:{type:I.LoadParser,priority:we.Normal},testParse:(i,t)=>X(function*(){return te.extname(t.src).includes(".json")&&!!i.frames})(),parse:(i,t,e)=>X(function*(){let s=te.dirname(t.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");const n=s+i.meta.image,o=(yield e.load([n]))[n],a=new tr(o.baseTexture,i,t.src);yield a.parse();const l=i?.meta?.related_multi_packs;if(Array.isArray(l)){const c=[];for(const u of l){if("string"!=typeof u)continue;const f=s+u;t.data?.ignoreMultiPack||c.push(e.load({src:f,data:{ignoreMultiPack:!0}}))}const d=yield Promise.all(c);a.linkedSheets=d,d.forEach(u=>{u.linkedSheets=[a].concat(a.linkedSheets.filter(f=>f!==u))})}return a})(),unload(i){i.destroy(!0)}}};K.add(Sp),new bt;var ha="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Os=new kt;class la extends ns{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new kr,this.state=Ce.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=be.from(ha,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?be.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):be.from(ha,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,s=this.quad;let n=s.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=s.uvs,n[0]=n[6]=-r,n[1]=n[3]=-o,n[2]=n[4]=1-r,n[5]=n[7]=1-o,s.invalidate();const a=t._texture,l=a.baseTexture,c=l.alphaMode>0,d=t.tileTransform.localTransform,u=t.uvMatrix;let f=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;f&&(l._glTextures[e.CONTEXT_UID]?f=l.wrapMode!==gt.CLAMP:l.wrapMode===gt.CLAMP&&(l.wrapMode=gt.REPEAT));const p=f?this.simpleShader:this.shader,_=a.width,g=a.height,x=t._width,T=t._height;Os.set(d.a*_/x,d.b*_/T,d.c*g/x,d.d*g/T,d.tx/x,d.ty/T),Os.invert(),f?Os.prepend(u.mapCoord):(p.uniforms.uMapCoord=u.mapCoord.toArray(!0),p.uniforms.uClampFrame=u.uClampFrame,p.uniforms.uClampOffset=u.uClampOffset),p.uniforms.uTransform=Os.toArray(!0),p.uniforms.uColor=br(t.tint,t.worldAlpha,p.uniforms.uColor,c),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=a,e.shader.bind(p),e.geometry.bind(s),this.state.blendMode=xr(t.blendMode,c),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}la.extension={name:"tilingSprite",type:I.RendererPlugin},K.add(la);class Bs{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Fs{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const r in e){const o=e[r].match(/^[a-z]+/gm)[0],a=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const c in a){const d=a[c].split("="),u=d[0],f=d[1].replace(/"/gm,""),p=parseFloat(f),_=isNaN(p)?f:p;l[u]=_}s[o].push(l)}const n=new Bs;return s.info.forEach(r=>n.info.push({face:r.face,size:parseInt(r.size,10)})),s.common.forEach(r=>n.common.push({lineHeight:parseInt(r.lineHeight,10)})),s.page.forEach(r=>n.page.push({id:parseInt(r.id,10),file:r.file})),s.char.forEach(r=>n.char.push({id:parseInt(r.id,10),page:parseInt(r.page,10),x:parseInt(r.x,10),y:parseInt(r.y,10),width:parseInt(r.width,10),height:parseInt(r.height,10),xoffset:parseInt(r.xoffset,10),yoffset:parseInt(r.yoffset,10),xadvance:parseInt(r.xadvance,10)})),s.kerning.forEach(r=>n.kerning.push({first:parseInt(r.first,10),second:parseInt(r.second,10),amount:parseInt(r.amount,10)})),s.distanceField.forEach(r=>n.distanceField.push({distanceRange:parseInt(r.distanceRange,10),fieldType:r.fieldType})),n}}class ir{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Bs,s=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let c=0;c<s.length;c++)e.info.push({face:s[c].getAttribute("face"),size:parseInt(s[c].getAttribute("size"),10)});for(let c=0;c<n.length;c++)e.common.push({lineHeight:parseInt(n[c].getAttribute("lineHeight"),10)});for(let c=0;c<r.length;c++)e.page.push({id:parseInt(r[c].getAttribute("id"),10)||0,file:r[c].getAttribute("file")});for(let c=0;c<o.length;c++){const d=o[c];e.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let c=0;c<a.length;c++)e.kerning.push({first:parseInt(a[c].getAttribute("first"),10),second:parseInt(a[c].getAttribute("second"),10),amount:parseInt(a[c].getAttribute("amount"),10)});for(let c=0;c<l.length;c++)e.distanceField.push({fieldType:l[c].getAttribute("fieldType"),distanceRange:parseInt(l[c].getAttribute("distanceRange"),10)});return e}}class sr{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&ir.test(O.ADAPTER.parseXML(t))}static parse(t){return ir.parse(O.ADAPTER.parseXML(t))}}const nr=[Fs,ir,sr];function Pp(i,t,e,s,n,r,o){const a=e.text,l=e.fontProperties;t.translate(s,n),t.scale(r,r);const c=o.strokeThickness/2,d=-o.strokeThickness/2;if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=function Mp(i,t,e,s,n,r){const o=e.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=e.dropShadow?e.dropShadowDistance:0,c=e.padding||0,d=i.width/s-l-2*c,u=i.height/s-l-2*c,f=o.slice(),p=e.fillGradientStops.slice();if(!p.length){const _=f.length+1;for(let g=1;g<_;++g)p.push(g/_)}if(f.unshift(o[0]),p.unshift(0),f.push(o[o.length-1]),p.push(1),e.fillGradientType===Ps.LINEAR_VERTICAL){a=t.createLinearGradient(d/2,c,d/2,u+c);let _=0;const x=(r.fontProperties.fontSize+e.strokeThickness)/u;for(let T=0;T<n.length;T++){const k=r.lineHeight*T;for(let E=0;E<f.length;E++){let M=0;M="number"==typeof p[E]?p[E]:E/f.length;let Q=Math.max(_,k/u+M*x);Q=Math.min(Q,1),a.addColorStop(Q,f[E]),_=Q}}}else{a=t.createLinearGradient(c,u/2,d+c,u/2);const _=f.length+1;let g=1;for(let x=0;x<f.length;x++){let T;T="number"==typeof p[x]?p[x]:g/_,a.addColorStop(T,f[x]),g++}}return a}(i,t,o,r,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,f=Ei("number"==typeof u?u:an(u)),p=o.dropShadowBlur*r,_=o.dropShadowDistance*r;t.shadowColor=`rgba(${255*f[0]},${255*f[1]},${255*f[2]},${o.dropShadowAlpha})`,t.shadowBlur=p,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*_,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*_}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,c,d+e.lineHeight-l.descent),o.fill&&t.fillText(a,c,d+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function ca(i){return Array.from?Array.from(i):i.split("")}function ks(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}const xe=class{constructor(i,t,e){const[s]=i.info,[n]=i.common,[r]=i.page,[o]=i.distanceField,a=Le(r.file),l={};this._ownsTextures=e,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/a,this.chars={},this.pageTextures=l;for(let c=0;c<i.page.length;c++){const{id:d,file:u}=i.page[c];l[d]=t instanceof Array?t[c]:t[u],o?.fieldType&&"none"!==o.fieldType&&(l[d].baseTexture.alphaMode=Rt.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=ht.OFF)}for(let c=0;c<i.char.length;c++){const{id:d,page:u}=i.char[c];let{x:f,y:p,width:_,height:g,xoffset:x,yoffset:T,xadvance:k}=i.char[c];f/=a,p/=a,_/=a,g/=a,x/=a,T/=a,k/=a;const E=new yt(f+l[u].frame.x/a,p+l[u].frame.y/a,_,g);this.chars[d]={xOffset:x,yOffset:T,xAdvance:k,kerning:{},texture:new tt(l[u].baseTexture,E),page:u}}for(let c=0;c<i.kerning.length;c++){let{first:d,second:u,amount:f}=i.kerning[c];d/=a,u/=a,f/=a,this.chars[u]&&(this.chars[u].kerning[d]=f)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,t,e){let s;if(i instanceof Bs)s=i;else{const r=function Ip(i){for(let t=0;t<nr.length;t++)if(nr[t].test(i))return nr[t];return null}(i);if(!r)throw new Error("Unrecognized data format for font.");s=r.parse(i)}t instanceof tt&&(t=[t]);const n=new xe(s,t,e);return xe.available[n.font]=n,n}static uninstall(i){const t=xe.available[i];if(!t)throw new Error(`No font found named '${i}'`);t.destroy(),delete xe.available[i]}static from(i,t,e){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:n,resolution:r,textureWidth:o,textureHeight:a,...l}=Object.assign({},xe.defaultOptions,e),c=function Dp(i){"string"==typeof i&&(i=[i]);const t=[];for(let e=0,s=i.length;e<s;e++){const n=i[e];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const r=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let a=r,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...ca(n))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(s),d=t instanceof Xe?t:new Xe(t),u=o,f=new Bs;f.info[0]={face:d.fontFamily,size:d.fontSize},f.common[0]={lineHeight:d.fontSize};let g,x,T,p=0,_=0,k=0;const E=[],M=[];for(let Q=0;Q<c.length;Q++){g||(g=O.ADAPTER.createCanvas(),g.width=o,g.height=a,x=g.getContext("2d"),T=new wt(g,{resolution:r,...l}),E.push(T),M.push(new tt(T)),f.page.push({id:M.length-1,file:""}));const j=c[Q],W=Jn.measureText(j,d,!1,g),lt=W.width,V=Math.ceil(W.height),$=Math.ceil(("italic"===d.fontStyle?2:1)*lt);if(_>=a-V*r){if(0===_)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${j}')`);--Q,g=null,x=null,T=null,_=0,p=0,k=0;continue}if(k=Math.max(V+W.fontProperties.descent,k),$*r+p>=u){if(0===p)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${j}')`);--Q,_+=k*r,_=Math.ceil(_),p=0,k=0;continue}Pp(g,x,W,p,_,r,d);const xt=ks(W.text);f.char.push({id:xt,page:M.length-1,x:p/r,y:_/r,width:$,height:V,xoffset:0,yoffset:0,xadvance:Math.ceil(lt-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))}),p+=($+2*n)*r,p=Math.ceil(p)}for(let Q=0,j=c.length;Q<j;Q++){const W=c[Q];for(let lt=0;lt<j;lt++){const V=c[lt],$=x.measureText(W).width,xt=x.measureText(V).width,H=x.measureText(W+V).width-($+xt);H&&f.kerning.push({first:ks(W),second:ks(V),amount:H})}}const J=new xe(f,M,!0);return void 0!==xe.available[i]&&xe.uninstall(i),xe.available[i]=J,J}};let oe=xe;oe.ALPHA=[["a","z"],["A","Z"]," "],oe.NUMERIC=[["0","9"]],oe.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],oe.ASCII=[[" ","~"]],oe.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:xe.ALPHANUMERIC},oe.available={};const da=[],ua=[],fa=[],pa=class extends ge{constructor(i,t={}){super(),this._tint=16777215;const{align:e,tint:s,maxWidth:n,letterSpacing:r,fontName:o,fontSize:a}=Object.assign({},pa.styleDefaults,t);if(!oe.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=s,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=i,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new ke(()=>{this.dirty=!0},this,0,0),this._roundPixels=O.ROUND_PIXELS,this.dirty=!0,this._resolution=O.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const i=oe.available[this._fontName],t=this.fontSize,e=t/i.size,s=new bt,n=[],r=[],o=[],l=ca(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),c=this._maxWidth*i.size/t,d="none"===i.distanceFieldType?da:ua;let u=null,f=0,p=0,_=0,g=-1,x=0,T=0,k=0,E=0;for(let V=0;V<l.length;V++){const $=l[V],xt=ks($);if(/(?:\s)/.test($)&&(g=V,x=f,E++),"\r"===$||"\n"===$){r.push(f),o.push(-1),p=Math.max(p,f),++_,++T,s.x=0,s.y+=i.lineHeight,u=null,E=0;continue}const N=i.chars[xt];if(!N)continue;u&&N.kerning[u]&&(s.x+=N.kerning[u]);const H=fa.pop()||{texture:tt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new bt};H.texture=N.texture,H.line=_,H.charCode=xt,H.position.x=s.x+N.xOffset+this._letterSpacing/2,H.position.y=s.y+N.yOffset,H.prevSpaces=E,n.push(H),f=H.position.x+Math.max(N.xAdvance-N.xOffset,N.texture.orig.width),s.x+=N.xAdvance+this._letterSpacing,k=Math.max(k,N.yOffset+N.texture.height),u=xt,-1!==g&&c>0&&s.x>c&&(++T,ci(n,1+g-T,1+V-g),V=g,g=-1,r.push(x),o.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,x),_++,s.x=0,s.y+=i.lineHeight,u=null,E=0)}const M=l[l.length-1];"\r"!==M&&"\n"!==M&&(/(?:\s)/.test(M)&&(f=x),r.push(f),p=Math.max(p,f),o.push(-1));const J=[];for(let V=0;V<=_;V++){let $=0;"right"===this._align?$=p-r[V]:"center"===this._align?$=(p-r[V])/2:"justify"===this._align&&($=o[V]<0?0:(p-r[V])/o[V]),J.push($)}const Q=n.length,j={},W=[],lt=this._activePagesMeshData;d.push(...lt);for(let V=0;V<Q;V++){const $=n[V].texture,xt=$.baseTexture.uid;if(!j[xt]){let N=d.pop();if(!N){const Mt=new op;let ft,ct;"none"===i.distanceFieldType?(ft=new Qo(tt.EMPTY),ct=z.NORMAL):(ft=new Qo(tt.EMPTY,{program:Ee.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),ct=z.NORMAL_NPM);const Pt=new $n(Mt,ft);Pt.blendMode=ct,N={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Pt,vertices:null,uvs:null,indices:null}}N.index=0,N.indexCount=0,N.vertexCount=0,N.uvsCount=0,N.total=0;const{_textureCache:H}=this;H[xt]=H[xt]||new tt($.baseTexture),N.mesh.texture=H[xt],N.mesh.tint=this._tint,W.push(N),j[xt]=N}j[xt].total++}for(let V=0;V<lt.length;V++)W.includes(lt[V])||this.removeChild(lt[V].mesh);for(let V=0;V<W.length;V++)W[V].mesh.parent!==this&&this.addChild(W[V].mesh);this._activePagesMeshData=W;for(const V in j){const $=j[V],xt=$.total;if(!($.indices?.length>6*xt)||$.vertices.length<2*$n.BATCHABLE_SIZE)$.vertices=new Float32Array(8*xt),$.uvs=new Float32Array(8*xt),$.indices=new Uint16Array(6*xt);else{const H=$.vertices;for(let Mt=4*$.total*2;Mt<H.length;Mt++)H[Mt]=0}$.mesh.size=6*xt}for(let V=0;V<Q;V++){const $=n[V];let xt=$.position.x+J[$.line]*("justify"===this._align?$.prevSpaces:1);this._roundPixels&&(xt=Math.round(xt));const N=xt*e,H=$.position.y*e,Mt=$.texture,ft=j[Mt.baseTexture.uid],ct=Mt.frame,Pt=Mt._uvs,Tt=ft.index++;ft.indices[6*Tt+0]=0+4*Tt,ft.indices[6*Tt+1]=1+4*Tt,ft.indices[6*Tt+2]=2+4*Tt,ft.indices[6*Tt+3]=0+4*Tt,ft.indices[6*Tt+4]=2+4*Tt,ft.indices[6*Tt+5]=3+4*Tt,ft.vertices[8*Tt+0]=N,ft.vertices[8*Tt+1]=H,ft.vertices[8*Tt+2]=N+ct.width*e,ft.vertices[8*Tt+3]=H,ft.vertices[8*Tt+4]=N+ct.width*e,ft.vertices[8*Tt+5]=H+ct.height*e,ft.vertices[8*Tt+6]=N,ft.vertices[8*Tt+7]=H+ct.height*e,ft.uvs[8*Tt+0]=Pt.x0,ft.uvs[8*Tt+1]=Pt.y0,ft.uvs[8*Tt+2]=Pt.x1,ft.uvs[8*Tt+3]=Pt.y1,ft.uvs[8*Tt+4]=Pt.x2,ft.uvs[8*Tt+5]=Pt.y2,ft.uvs[8*Tt+6]=Pt.x3,ft.uvs[8*Tt+7]=Pt.y3}this._textWidth=p*e,this._textHeight=(s.y+i.lineHeight)*e;for(const V in j){const $=j[V];if(0!==this.anchor.x||0!==this.anchor.y){let Mt=0;const ft=this._textWidth*this.anchor.x,ct=this._textHeight*this.anchor.y;for(let Pt=0;Pt<$.total;Pt++)$.vertices[Mt++]-=ft,$.vertices[Mt++]-=ct,$.vertices[Mt++]-=ft,$.vertices[Mt++]-=ct,$.vertices[Mt++]-=ft,$.vertices[Mt++]-=ct,$.vertices[Mt++]-=ft,$.vertices[Mt++]-=ct}this._maxLineHeight=k*e;const xt=$.mesh.geometry.getBuffer("aVertexPosition"),N=$.mesh.geometry.getBuffer("aTextureCoord"),H=$.mesh.geometry.getIndex();xt.data=$.vertices,N.data=$.uvs,H.data=$.indices,xt.update(),N.update(),H.update()}for(let V=0;V<n.length;V++)fa.push(n[V]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:s}=oe.available[this._fontName];if("none"!==e){const{a:n,b:r,c:o,d:a}=this.worldTransform,l=Math.sqrt(n*n+r*r),c=Math.sqrt(o*o+a*a),d=(Math.abs(l)+Math.abs(c))/2,u=this.fontSize/s,f=i._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=d*t*u*f}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=oe.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(i){if(this._tint!==i){this._tint=i;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!oe.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){return this._fontSize??oe.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){"number"==typeof i?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:t}=this,s="none"===oe.available[this._fontName].distanceFieldType?da:ua;s.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],s.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=tt.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(i)}};pa.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const kp=[".xml",".fnt"],Lp={extension:{type:I.LoadParser,priority:we.Normal},test:i=>kp.includes(te.extname(i)),testParse:i=>X(function*(){return Fs.test(i)||sr.test(i)})(),parse:(i,t,e)=>X(function*(){const s=Fs.test(i)?Fs.parse(i):sr.parse(i),{src:n}=t,{page:r}=s,o=[];for(let c=0;c<r.length;++c){const d=r[c].file,u=te.join(te.dirname(n),d);o.push(u)}const a=yield e.load(o),l=o.map(c=>a[c]);return oe.install(s,l,!0)})(),load:(i,t)=>X(function*(){return(yield O.ADAPTER.fetch(i)).text()})(),unload(i){i.destroy()}};K.add(Lp);var Np=B(6805),Up=B(930);function Ls(i,t){const e="object"==typeof t;return new Promise((s,n)=>{const r=new Up.Hp({next:o=>{s(o),r.unsubscribe()},error:n,complete:()=>{e?s(t.defaultValue):n(new Np.K)}});i.subscribe(r)})}var Gp=B(8060),gi=B(9886),Xp=B(4766),vi=B(529);let yi=(()=>{class i{constructor(e){this.http=e,this.baseUrl=Xp.N.rpwebAPI}loadPositionTypeBins(){return this.http.get(`${this.baseUrl}/PositionTypeBinMaster`)}loadMiscellaneousType(){return this.http.get(`${this.baseUrl}/miscellaneous`)}saveAddresess(e){return this.http.post(`${this.baseUrl}/address`,e)}loadAddresses(){return this.http.get(`${this.baseUrl}/address`)}loadStatic3dAddresses(){return this.http.get("/assets/address_3d_demo.json")}loadStaticMiscellaneousType(){return this.http.get("/assets/miscellaneousLayout.json")}loadStatic2dAddresses(){return this.http.get("/assets/addressLayout.json")}loadStaticIndicators(){return this.http.get("/assets/indicatorData.json")}}return i.\u0275fac=function(e){return new(e||i)(h.LFG(vi.eN))},i.\u0275prov=h.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var rr=B(1831);const Vp=["input"];function zp(i,t){if(1&i&&(h.TgZ(0,"div",5)(1,"div",6),h._uU(2,"*Required"),h.qZA(),h.TgZ(3,"p"),h._uU(4),h.qZA()()),2&i){const e=h.oxw();h.xp6(4),h.hij("",e.label," is missing!")}}let _a=(()=>{class i{constructor(e){this.controlDir=e,this.type="",this.label="",this.controlDir.valueAccessor=this}ngOnInit(){const e=this.controlDir.control;e.setValidators(e.validator?[e.validator]:[]),e.updateValueAndValidity()}onChange(e){}onTouched(){}writeValue(e){this.input.nativeElement.value=e||""}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}getValue(e){return e.target.value}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(L.a5,2))},i.\u0275cmp=h.Xpm({type:i,selectors:[["app-text-input"]],viewQuery:function(e,s){if(1&e&&h.Gf(Vp,7),2&e){let n;h.iGM(n=h.CRH())&&(s.input=n.first)}},inputs:{type:"type",label:"label"},features:[h._Bn([],[{provide:L.gN,useExisting:L.sg}])],decls:7,vars:6,consts:[[1,"space-between"],[3,"ngClass"],[3,"type","placeholder","id","input","blur"],["input",""],["class","ui error message",4,"ngIf"],[1,"ui","error","message"],[1,"header"]],template:function(e,s){1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"label"),h._uU(3),h.qZA(),h.TgZ(4,"input",2,3),h.NdJ("input",function(r){return s.onChange(s.getValue(r))})("blur",function(){return s.onTouched()}),h.qZA()(),h.YNc(6,zp,5,1,"div",4),h.qZA()),2&e&&(h.xp6(1),h.Q6J("ngClass",s.controlDir&&s.controlDir.control&&s.controlDir.control.touched?s.controlDir.control.valid?"field":"field error":null),h.xp6(2),h.Oqu(s.label),h.xp6(1),h.s9C("type",s.type),h.s9C("placeholder",s.label),h.s9C("id",s.label),h.xp6(2),h.Q6J("ngIf",s.controlDir&&s.controlDir.control&&!s.controlDir.control.valid&&s.controlDir.control.touched))},dependencies:[q.mk,q.O5],styles:[".space-between[_ngcontent-%COMP%]{margin:2.5%}"]}),i})();var ma=B(9037);const Yp=["pixiContainer"];let ga=(()=>{class i{constructor(e,s,n){this.bsModalRef=e,this.warehouseService=s,this.store=n,this.title="",this.positionTypeBins=[],this.positionTypeDropDown=[],this.positionTypeSelected=void 0,this.accessSideDropdown=[{text:"Up",value:0},{text:"Right",value:1},{text:"Down",value:2},{text:"Left",value:3}],this.app=new _s({width:350,height:350,backgroundColor:15527148,antialias:!0})}ngAfterViewInit(){this.pixiContainer.nativeElement.appendChild(this.app.view)}ngOnInit(){this.loadPositionTypeBins(),this.createTypeForm()}onSubmit(){if(!this.positionTypeSelected)return;const e=this.typeForm.value;e.totalDepth=this.positionTypeSelected.totalDepth,e.totalFront=this.positionTypeSelected.totalFront,this.store.dispatch((i=>({type:Gp.n.SetCurrentPositionTypeBin,payload:{currentPositionTypeBin:i}}))(e)),this.gameInstance.SendMessage("JavaScriptMessager","HandleSpawnMode","true"),this.closeModal()}closeModal(){this.bsModalRef.hide()}drawPreview(){if(!this.positionTypeSelected)return;this.app.stage.removeChildren();let e=100*this.positionTypeSelected.totalFront,s=100*this.positionTypeSelected.totalDepth;for(let o=1;o<=5&&(e>=this.app.view.width||s>=this.app.view.height);o++)e/=o,s/=o;const n=[this.app.view.width/2-e/2,this.app.view.height/2-s/2],r=new Gi;r.lineStyle(2,0,1),r.beginFill(16439685),r.drawRect(n[0],n[1],e,s),r.endFill(),this.app.stage.addChild(r)}createTypeForm(){this.typeForm=new L.cw({positionTypeDescription:new L.NI("",[L.kI.required]),pickingAccess:new L.NI("0",[L.kI.required]),rowCount:new L.NI("1",[L.kI.required]),columnCount:new L.NI("1",[L.kI.required,L.kI.min(1)]),stepByColumn:new L.NI("1",[L.kI.required,L.kI.min(1)]),stepByRow:new L.NI("1",[L.kI.required,L.kI.min(1)]),stepByRowSize:new L.NI("0",[L.kI.required,L.kI.min(0)]),stepByColumnSize:new L.NI("0",[L.kI.required,L.kI.min(0)])}),this.typeForm.get("positionTypeDescription")?.valueChanges.subscribe(e=>{this.positionTypeSelected=this.positionTypeBins.find(s=>s.positionTypeDescription===e),this.drawPreview()})}loadPositionTypeBins(){var e=this;return X(function*(){try{e.positionTypeBins=yield Ls(e.warehouseService.loadPositionTypeBins()),e.positionTypeBins.forEach(s=>{e.positionTypeDropDown.push({text:s.positionTypeDescription,value:s.positionTypeDescription})}),e.positionTypeSelected=e.positionTypeBins[0],e.drawPreview(),e.typeForm.get("positionTypeDescription")?.setValue(e.positionTypeDropDown[0].value)}catch(s){console.error(s)}})()}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(gi.UZ),h.Y36(yi),h.Y36(rr.yh))},i.\u0275cmp=h.Xpm({type:i,selectors:[["app-modal-select-type-address"]],viewQuery:function(e,s){if(1&e&&h.Gf(Yp,7),2&e){let n;h.iGM(n=h.CRH())&&(s.pixiContainer=n.first)}},inputs:{title:"title",gameInstance:"gameInstance"},decls:25,vars:3,consts:[[1,"modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"grid-layout"],[1,"ui","form",3,"formGroup","ngSubmit"],["label","Type","formControlName","positionTypeDescription",3,"dropdown"],["label","Access Side","formControlName","pickingAccess",3,"dropdown"],["label","Rows","type","number","formControlName","rowCount"],["label","Column","type","number","formControlName","columnCount"],["label","Step by Column","type","number","formControlName","stepByColumn"],["label","Step by Row","type","number","formControlName","stepByRow"],["label","Step by Row Size (cm)","type","number","formControlName","stepByRowSize"],["label","Step by Column Size (cm)","type","number","formControlName","stepByColumnSize"],["type","submit",1,"ui","button","primary","space-between-file"],[2,"display","flex","flex-direction","row-reverse","align-content","baseline","flex-wrap","wrap"],["pixiContainer",""]],template:function(e,s){1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),h._uU(4,"Attendance"),h.qZA(),h.TgZ(5,"button",4),h.NdJ("click",function(){return s.closeModal()}),h.TgZ(6,"span",5),h._uU(7,"\xd7"),h.qZA()()(),h.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"form",8),h.NdJ("ngSubmit",function(){return s.onSubmit()}),h._UZ(12,"app-selection-dropdown",9)(13,"app-selection-dropdown",10)(14,"app-text-input",11)(15,"app-text-input",12)(16,"app-text-input",13)(17,"app-text-input",14)(18,"app-text-input",15)(19,"app-text-input",16),h.TgZ(20,"button",17),h._uU(21," Save "),h.qZA()()(),h.TgZ(22,"div",18),h._UZ(23,"div",null,19),h.qZA()()()()()),2&e&&(h.xp6(11),h.Q6J("formGroup",s.typeForm),h.xp6(1),h.Q6J("dropdown",s.positionTypeDropDown),h.xp6(1),h.Q6J("dropdown",s.accessSideDropdown))},dependencies:[L._Y,L.JJ,L.JL,L.sg,L.u,_a,ma.d],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),i})();var Bt=(()=>(function(i){i.isCameraMode="isCameraMode",i.isSpawnMode="isSpawnMode",i.isSelectionMode="isSelectionMode",i.isDragMode="isDragMode",i.isMetrics="isMetrics",i.isHeatMapFlow2DMode="isHeatMapFlow2DMode",i.isHeatMapPerAddress2DMode="isHeatMapPerAddress2DMode",i.isFlyMode="isFlyMode",i.isHeatMapPerAddress3DMode="isHeatMapPerAddress3DMode",i.isMiscellaneousMode="isMiscellaneousMode"}(Bt||(Bt={})),Bt))();const Wp=["pixiContainer"];let jp=(()=>{class i{constructor(e,s,n){this.bsModalRef=e,this.warehouseService=s,this.store=n,this.title="",this.app=new _s({width:350,height:350,backgroundColor:15527148,antialias:!0}),this.miscellanousDropdown=[]}ngAfterViewInit(){this.pixiContainer.nativeElement.appendChild(this.app.view)}ngOnInit(){this.createMiscellaneousTypeForm()}onSubmit(){}closeModal(){this.bsModalRef.hide()}createMiscellaneousTypeForm(){this.miscellaneousForm=new L.cw({miscellaneousType:new L.NI("",[L.kI.required]),sizeX:new L.NI("0",[L.kI.required,L.kI.min(0)]),sizeY:new L.NI("0",[L.kI.required,L.kI.min(0)]),rotation:new L.NI("")}),this.miscellaneousForm.get("rotation")?.valueChanges.subscribe(e=>{})}drawPreview(){if(!this.miscellaneousTypeSelected)return;let e=100*this.miscellaneousTypeSelected.sizeX,s=100*this.miscellaneousTypeSelected.sizeY;for(let o=1;o<=5&&(e>=this.app.view.width||s>=this.app.view.height);o++)e/=o,s/=o;const n=[this.app.view.width/2-e/2,this.app.view.height/2-s/2],r=new Gi;r.lineStyle(2,0,1),r.beginFill(16439685),r.drawRect(n[0],n[1],e,s),r.endFill(),this.app.stage.addChild(r)}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(gi.UZ),h.Y36(yi),h.Y36(rr.yh))},i.\u0275cmp=h.Xpm({type:i,selectors:[["app-modal-select-miscellaneous-type"]],viewQuery:function(e,s){if(1&e&&h.Gf(Wp,7),2&e){let n;h.iGM(n=h.CRH())&&(s.pixiContainer=n.first)}},inputs:{title:"title",gameInstance:"gameInstance"},decls:25,vars:2,consts:[[1,"modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"grid-layout"],[1,"ui","form",3,"formGroup","ngSubmit"],["label","Type","formControlName","miscellaneousType",3,"dropdown"],["label","Size X (m)","type","number","formControlName","sizeX"],["label","Size Y (m)","type","number","formControlName","sizeY"],[2,"margin","2.5%"],[1,"ui","checkbox"],["type","checkbox","name","example","formControlName","rotation"],["type","submit",1,"ui","button","primary","space-between-file"],[2,"display","flex","flex-direction","row-reverse","align-content","baseline","flex-wrap","wrap"],["pixiContainer",""]],template:function(e,s){1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),h._uU(4,"Attendance"),h.qZA(),h.TgZ(5,"button",4),h.NdJ("click",function(){return s.closeModal()}),h.TgZ(6,"span",5),h._uU(7,"\xd7"),h.qZA()()(),h.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"form",8),h.NdJ("ngSubmit",function(){return s.onSubmit()}),h._UZ(12,"app-selection-dropdown",9)(13,"app-text-input",10)(14,"app-text-input",11),h.TgZ(15,"div",12)(16,"div",13),h._UZ(17,"input",14),h.TgZ(18,"label"),h._uU(19,"Is Rotate"),h.qZA()()(),h.TgZ(20,"button",15),h._uU(21," Save "),h.qZA()()(),h.TgZ(22,"div",16),h._UZ(23,"div",null,17),h.qZA()()()()()),2&e&&(h.xp6(11),h.Q6J("formGroup",s.miscellaneousForm),h.xp6(1),h.Q6J("dropdown",s.miscellanousDropdown))},dependencies:[L._Y,L.Wl,L.JJ,L.JL,L.sg,L.u,_a,ma.d],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),i})();class ce{static handleCameraModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleCamera",e.toString())}static handleDragModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleDragMode",e.toString())}static handleSelectionModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleSelectionMode",e.toString())}static handleSpawnModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleSpawnMode",e.toString())}static handleMetricModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleMeasures",e.toString())}static handleHeatMapFlow2D(t,e){t.SendMessage("JavaScriptMessager","HandleHeatMapFlow2D",e.toString())}static handleHeatMapPerAddress2D(t,e){t.SendMessage("JavaScriptMessager","HandleHeatMapPerAddress2D",e.toString())}static handleFlyMode(t,e){t.SendMessage("EventSystem","HandleFlyMode",e.toString())}static handleHeatMapPerAddress3D(t,e){console.log(new Error("Method not implemented."))}static handleMiscellaneous(t,e){}}var xi=B(4151),St=B(7340),Ns=B(559),_t=B(7507),Ve=B(9751),ze=B(9646),zt=B(7579);class Zp{constructor(t=!1,e,s=!0){this._multiple=t,this._emitChanges=s,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new zt.x,this.onChange=this.changed,e&&e.length&&(t?e.forEach(n=>this._markSelected(n)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(e=>this._markSelected(e)),this._emitChangeEvent()}deselect(...t){this._verifyValueAssignment(t),t.forEach(e=>this._unmarkSelected(e)),this._emitChangeEvent()}toggle(t){this.isSelected(t)?this.deselect(t):this.select(t)}clear(){this._unmarkAll(),this._emitChangeEvent()}isSelected(t){return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){if(t.length>1&&!this._multiple)throw function qp(){return Error("Cannot pass multiple values into SelectionModel with single-value mode.")}()}}class Ie{constructor(){this._listeners=[]}notify(t,e){for(let s of this._listeners)s(t,e)}listen(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(e=>t!==e)}}ngOnDestroy(){this._listeners=[]}}Ie.\u0275fac=function(t){return new(t||Ie)},Ie.\u0275prov=h.Yz7({token:Ie,factory:Ie.\u0275fac,providedIn:"root"}),Ie.ngInjectableDef=(0,h.Ez6)({factory:function(){return new Ie},token:Ie,providedIn:"root"});var Qt=B(7528),Us=B(4968),Vi=(B(6406),B(6451)),ya=B(1884),or=B(9225),ar=B(9300),ee=B(2722),Gs=B(8675);B(4482),B(5403);var xa=B(3900);B(6063);var ba=B(3099),Ht=B(6142),Me=B(2362);class ie{constructor(t,e){this._ngZone=t,this._platform=e,this._scrolled=new zt.x,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map}register(t){const e=t.elementScrolled().subscribe(()=>this._scrolled.next(t));this.scrollContainers.set(t,e)}deregister(t){const e=this.scrollContainers.get(t);e&&(e.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?Ve.y.create(e=>{this._globalSubscription||this._addGlobalListener();const s=t>0?this._scrolled.pipe((0,or.e)(t)).subscribe(e):this._scrolled.subscribe(e);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,ze.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,e)=>this.deregister(e)),this._scrolled.complete()}ancestorScrolled(t,e){const s=this.getAncestorScrollContainers(t);return this.scrolled(e).pipe((0,ar.h)(n=>!n||s.indexOf(n)>-1))}getAncestorScrollContainers(t){const e=[];return this.scrollContainers.forEach((s,n)=>{this._scrollableContainsElement(n,t)&&e.push(n)}),e}_scrollableContainsElement(t,e){let s=e.nativeElement,n=t.getElementRef().nativeElement;do{if(s==n)return!0}while(s=s.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>(0,Us.R)(window.document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}ie.\u0275fac=function(t){return new(t||ie)(h.LFG(h.R0b),h.LFG(Ht.t4))},ie.\u0275prov=h.Yz7({token:ie,factory:ie.\u0275fac,providedIn:"root"}),ie.ngInjectableDef=(0,h.Ez6)({factory:function(){return new ie((0,h.f3M)(h.R0b),(0,h.f3M)(Ht.t4))},token:ie,providedIn:"root"});let Hs=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({imports:[Me.vT,Ht.ud,Me.vT]}),i})();class se{constructor(t,e){this._platform=t,e.runOutsideAngular(()=>{this._change=t.isBrowser?(0,Vi.T)((0,Us.R)(window,"resize"),(0,Us.R)(window,"orientationchange")):(0,ze.of)(),this._invalidateCache=this.change().subscribe(()=>this._updateViewportSize())})}ngOnDestroy(){this._invalidateCache.unsubscribe()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:e,height:s}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+s,right:t.left+e,height:s,width:e}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=document.documentElement,e=t.getBoundingClientRect();return{top:-e.top||document.body.scrollTop||window.scrollY||t.scrollTop||0,left:-e.left||document.body.scrollLeft||window.scrollX||t.scrollLeft||0}}change(t=20){return t>0?this._change.pipe((0,or.e)(t)):this._change}_updateViewportSize(){this._viewportSize=this._platform.isBrowser?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0}}}se.\u0275fac=function(t){return new(t||se)(h.LFG(Ht.t4),h.LFG(h.R0b))},se.\u0275prov=h.Yz7({token:se,factory:se.\u0275fac,providedIn:"root"}),se.ngInjectableDef=(0,h.Ez6)({factory:function(){return new se((0,h.f3M)(Ht.t4),(0,h.f3M)(h.R0b))},token:se,providedIn:"root"});var Xs=B(727),bi=B(5698);function Ta(){throw Error("Host already has a portal attached")}class Sa{attach(t){return null==t&&function x_(){throw Error("Attempting to attach a portal to a null PortalOutlet")}(),t.hasAttached()&&Ta(),this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null==t?function b_(){throw Error("Attempting to detach a portal that is not attached to a host")}():(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class Ea extends Sa{constructor(t,e,s,n){super(),this.component=t,this.viewContainerRef=e,this.injector=s,this.componentFactoryResolver=n}}class hr extends Sa{constructor(t,e,s){super(),this.templateRef=t,this.viewContainerRef=e,this.context=s}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class w_ extends class Ca{constructor(){this._isDisposed=!1}hasAttached(){return!!this._attachedPortal}attach(t){return t||function g_(){throw Error("Must provide a portal to attach")}(),this.hasAttached()&&Ta(),this._isDisposed&&function v_(){throw Error("This PortalOutlet has already been disposed")}(),t instanceof Ea?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof hr?(this._attachedPortal=t,this.attachTemplatePortal(t)):void function y_(){throw Error("Attempting to attach an unknown Portal type. BasePortalOutlet accepts either a ComponentPortal or a TemplatePortal.")}()}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(t,e,s,n){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=s,this._defaultInjector=n}attachComponentPortal(t){const s=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let n;return t.viewContainerRef?(n=t.viewContainerRef.createComponent(s,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>n.destroy())):(n=s.create(t.injector||this._defaultInjector),this._appRef.attachView(n.hostView),this.setDisposeFn(()=>{this._appRef.detachView(n.hostView),n.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(n)),n}attachTemplatePortal(t){let e=t.viewContainerRef,s=e.createEmbeddedView(t.templateRef,t.context);return s.detectChanges(),s.rootNodes.forEach(n=>this.outletElement.appendChild(n)),this.setDisposeFn(()=>{let n=e.indexOf(s);-1!==n&&e.remove(n)}),s}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let T_=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({}),i})();class S_{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=(0,_t.HM)(-this._previousScrollPosition.left),t.style.top=(0,_t.HM)(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,s=t.style,n=this._document.body.style,r=s.scrollBehavior||"",o=n.scrollBehavior||"";this._isEnabled=!1,s.left=this._previousHTMLStyles.left,s.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),s.scrollBehavior=n.scrollBehavior="auto",window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),s.scrollBehavior=r,n.scrollBehavior=o}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,s=this._viewportRuler.getViewportSize();return e.scrollHeight>s.height||e.scrollWidth>s.width}}function Aa(){return Error("Scroll strategy has already been attached.")}class E_{constructor(t,e,s,n){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=s,this._config=n,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){if(this._overlayRef)throw Aa();this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}}class Ra{enable(){}disable(){}attach(){}}function lr(i,t){return t.some(e=>i.bottom<e.top||i.top>e.bottom||i.right<e.left||i.left>e.right)}function Ia(i,t){return t.some(e=>i.top<e.top||i.bottom>e.bottom||i.left<e.left||i.right>e.right)}class C_{constructor(t,e,s,n){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=s,this._config=n,this._scrollSubscription=null}attach(t){if(this._overlayRef)throw Aa();this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:s,height:n}=this._viewportRuler.getViewportSize();lr(e,[{width:s,height:n,bottom:n,right:s,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}}class Pe{constructor(t,e,s,n){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=s,this.noop=()=>new Ra,this.close=r=>new E_(this._scrollDispatcher,this._ngZone,this._viewportRuler,r),this.block=()=>new S_(this._viewportRuler,this._document),this.reposition=r=>new C_(this._scrollDispatcher,this._viewportRuler,this._ngZone,r),this._document=n}}Pe.\u0275fac=function(t){return new(t||Pe)(h.LFG(ie),h.LFG(se),h.LFG(h.R0b),h.LFG(q.K0))},Pe.\u0275prov=h.Yz7({token:Pe,factory:Pe.\u0275fac,providedIn:"root"}),Pe.ngInjectableDef=(0,h.Ez6)({factory:function(){return new Pe((0,h.f3M)(ie),(0,h.f3M)(se),(0,h.f3M)(h.R0b),(0,h.f3M)(q.K0))},token:Pe,providedIn:"root"});class Ma{constructor(t){this.scrollStrategy=new Ra,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t&&Object.keys(t).forEach(e=>{typeof t[e]<"u"&&(this[e]=t[e])})}}class A_{constructor(t,e,s,n,r){this.offsetX=s,this.offsetY=n,this.panelClass=r,this.originX=t.originX,this.originY=t.originY,this.overlayX=e.overlayX,this.overlayY=e.overlayY}}class R_{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}function Pa(i,t){if("top"!==t&&"bottom"!==t&&"center"!==t)throw Error(`ConnectedPosition: Invalid ${i} "${t}". Expected "top", "bottom" or "center".`)}function Da(i,t){if("start"!==t&&"end"!==t&&"center"!==t)throw Error(`ConnectedPosition: Invalid ${i} "${t}". Expected "start", "end" or "center".`)}class de{constructor(t){this._attachedOverlays=[],this._keydownListener=e=>{const s=this._attachedOverlays;for(let n=s.length-1;n>-1;n--)if(s[n]._keydownEventSubscriptions>0){s[n]._keydownEvents.next(e);break}},this._document=t}ngOnDestroy(){this._detach()}add(t){this.remove(t),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener,!0),this._isAttached=!0),this._attachedOverlays.push(t)}remove(t){const e=this._attachedOverlays.indexOf(t);e>-1&&this._attachedOverlays.splice(e,1),0===this._attachedOverlays.length&&this._detach()}_detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener,!0),this._isAttached=!1)}}de.\u0275fac=function(t){return new(t||de)(h.LFG(q.K0))},de.\u0275prov=h.Yz7({token:de,factory:de.\u0275fac,providedIn:"root"}),de.ngInjectableDef=(0,h.Ez6)({factory:function(){return new de((0,h.f3M)(q.K0))},token:de,providedIn:"root"});class ae{constructor(t){this._document=t}ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t=this._document.createElement("div");t.classList.add("cdk-overlay-container"),this._document.body.appendChild(t),this._containerElement=t}}ae.\u0275fac=function(t){return new(t||ae)(h.LFG(q.K0))},ae.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac,providedIn:"root"}),ae.ngInjectableDef=(0,h.Ez6)({factory:function(){return new ae((0,h.f3M)(q.K0))},token:ae,providedIn:"root"});class O_{constructor(t,e,s,n,r,o,a,l){this._portalOutlet=t,this._host=e,this._pane=s,this._config=n,this._ngZone=r,this._keyboardDispatcher=o,this._document=a,this._location=l,this._backdropElement=null,this._backdropClick=new zt.x,this._attachments=new zt.x,this._detachments=new zt.x,this._locationChanges=Xs.w0.EMPTY,this._keydownEventsObservable=Ve.y.create(c=>{const d=this._keydownEvents.subscribe(c);return this._keydownEventSubscriptions++,()=>{d.unsubscribe(),this._keydownEventSubscriptions--}}),this._keydownEvents=new zt.x,this._keydownEventSubscriptions=0,n.scrollStrategy&&n.scrollStrategy.attach(this),this._positionStrategy=n.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){let e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._config.scrollStrategy&&this._config.scrollStrategy.enable(),this._ngZone.onStable.asObservable().pipe((0,bi.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&this._location&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._config.scrollStrategy&&this._config.scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._config.scrollStrategy&&this._config.scrollStrategy.disable(),this.detachBackdrop(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick.asObservable()}attachments(){return this._attachments.asObservable()}detachments(){return this._detachments.asObservable()}keydownEvents(){return this._keydownEventsObservable}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign({},this._config,t),this._updateElementSize()}setDirection(t){this._config=Object.assign({},this._config,{direction:t}),this._updateElementDirection()}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){const t=this._pane.style;t.width=(0,_t.HM)(this._config.width),t.height=(0,_t.HM)(this._config.height),t.minWidth=(0,_t.HM)(this._config.minWidth),t.minHeight=(0,_t.HM)(this._config.minHeight),t.maxWidth=(0,_t.HM)(this._config.maxWidth),t.maxHeight=(0,_t.HM)(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"auto":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",e=>this._backdropClick.next(e)),typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let t=this._backdropElement;if(t){let e,s=()=>{t&&t.parentNode&&t.parentNode.removeChild(t),this._backdropElement==t&&(this._backdropElement=null),clearTimeout(e)};t.classList.remove("cdk-overlay-backdrop-showing"),this._config.backdropClass&&this._toggleClasses(t,this._config.backdropClass,!1),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",s)}),t.style.pointerEvents="none",e=this._ngZone.runOutsideAngular(()=>setTimeout(s,500))}}_toggleClasses(t,e,s){const n=t.classList;(0,_t.Eq)(e).forEach(r=>{s?n.add(r):n.remove(r)})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.asObservable().pipe((0,ee.R)((0,Vi.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),t.unsubscribe())})})}}const Oa="cdk-overlay-connected-position-bounding-box";class Ba{constructor(t,e,s,n,r){this._viewportRuler=e,this._document=s,this._platform=n,this._overlayContainer=r,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this.scrollables=[],this._preferredPositions=[],this._positionChanges=new zt.x,this._resizeSubscription=Xs.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._positionChangeSubscriptions=0,this._appliedPanelClasses=[],this.positionChanges=Ve.y.create(o=>{const a=this._positionChanges.subscribe(o);return this._positionChangeSubscriptions++,()=>{a.unsubscribe(),this._positionChangeSubscriptions--}}),this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){if(this._overlayRef&&t!==this._overlayRef)throw Error("This position strategy is already attached to an overlay");this._validatePositions(),t.hostElement.classList.add(Oa),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||this._platform&&!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._origin.getBoundingClientRect(),this._overlayRect=this._pane.getBoundingClientRect();const t=this._originRect,e=this._overlayRect,s=this._viewportRect,n=[];let r;for(let o of this._preferredPositions){let a=this._getOriginPoint(t,o),l=this._getOverlayPoint(a,e,o),c=this._getOverlayFit(l,e,s,o);if(c.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(o,a);this._canFitWithFlexibleDimensions(c,l,s)?n.push({position:o,origin:a,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(a,o)}):(!r||r.overlayFit.visibleArea<c.visibleArea)&&(r={overlayFit:c,overlayPoint:l,originPoint:a,position:o,overlayRect:e})}if(n.length){let o=null,a=-1;for(const l of n){const c=l.boundingBoxRect.width*l.boundingBoxRect.height*(l.position.weight||1);c>a&&(a=c,o=l)}return this._isPushed=!1,void this._applyPosition(o.position,o.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(r.position,r.originPoint);this._applyPosition(r.position,r.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&ei(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Oa),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._origin.getBoundingClientRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const t=this._lastPosition||this._preferredPositions[0],e=this._getOriginPoint(this._originRect,t);this._applyPosition(t,e)}}withScrollableContainers(t){this.scrollables=t}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t instanceof h.SBq?t.nativeElement:t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e){let s,n;if("center"==e.originX)s=t.left+t.width/2;else{const r=this._isRtl()?t.right:t.left,o=this._isRtl()?t.left:t.right;s="start"==e.originX?r:o}return n="center"==e.originY?t.top+t.height/2:"top"==e.originY?t.top:t.bottom,{x:s,y:n}}_getOverlayPoint(t,e,s){let n,r;return n="center"==s.overlayX?-e.width/2:"start"===s.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,r="center"==s.overlayY?-e.height/2:"top"==s.overlayY?0:-e.height,{x:t.x+n,y:t.y+r}}_getOverlayFit(t,e,s,n){let{x:r,y:o}=t,a=this._getOffset(n,"x"),l=this._getOffset(n,"y");a&&(r+=a),l&&(o+=l);let u=0-o,f=o+e.height-s.height,p=this._subtractOverflows(e.width,0-r,r+e.width-s.width),_=this._subtractOverflows(e.height,u,f),g=p*_;return{visibleArea:g,isCompletelyWithinViewport:e.width*e.height===g,fitsInViewportVertically:_===e.height,fitsInViewportHorizontally:p==e.width}}_canFitWithFlexibleDimensions(t,e,s){if(this._hasFlexibleDimensions){const n=s.bottom-e.y,r=s.right-e.x,o=this._overlayRef.getConfig().minHeight,a=this._overlayRef.getConfig().minWidth,c=t.fitsInViewportHorizontally||null!=a&&a<=r;return(t.fitsInViewportVertically||null!=o&&o<=n)&&c}}_pushOverlayOnScreen(t,e,s){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const n=this._viewportRect,r=Math.max(t.x+e.width-n.right,0),o=Math.max(t.y+e.height-n.bottom,0),a=Math.max(n.top-s.top-t.y,0),l=Math.max(n.left-s.left-t.x,0);let c=0,d=0;return c=e.width<n.width?l||-r:t.x<this._viewportMargin?n.left-s.left-t.x:0,d=e.height<n.height?a||-o:t.y<this._viewportMargin?n.top-s.top-t.y:0,this._previousPushAmount={x:c,y:d},{x:t.x+c,y:t.y+d}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChangeSubscriptions>0){const s=this._getScrollVisibility(),n=new R_(t,s);this._positionChanges.next(n)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let s,n=t.overlayY;s="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let r=0;r<e.length;r++)e[r].style.transformOrigin=`${s} ${n}`}_calculateBoundingBoxRect(t,e){const s=this._viewportRect,n=this._isRtl();let r,o,a,d,u,f;if("top"===e.overlayY)o=t.y,r=s.bottom-t.y;else if("bottom"===e.overlayY)a=s.height-t.y+2*this._viewportMargin,r=s.height-a+this._viewportMargin;else{const p=Math.min(s.bottom-t.y+s.top,t.y),_=this._lastBoundingBoxSize.height;r=2*p,o=t.y-p,r>_&&!this._isInitialRender&&!this._growAfterOpen&&(o=t.y-_/2)}if("end"===e.overlayX&&!n||"start"===e.overlayX&&n)f=s.right-t.x+this._viewportMargin,d=t.x-s.left;else if("start"===e.overlayX&&!n||"end"===e.overlayX&&n)u=t.x,d=s.right-t.x;else{const p=Math.min(s.right-t.x+s.left,t.x),_=this._lastBoundingBoxSize.width;d=2*p,u=t.x-p,d>_&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.x-_/2)}return{top:o,left:u,bottom:a,right:f,width:d,height:r}}_setBoundingBoxStyles(t,e){const s=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(s.height=Math.min(s.height,this._lastBoundingBoxSize.height),s.width=Math.min(s.width,this._lastBoundingBoxSize.width));const n={};if(this._hasExactPosition())n.top=n.left="0",n.bottom=n.right="",n.width=n.height="100%";else{const r=this._overlayRef.getConfig().maxHeight,o=this._overlayRef.getConfig().maxWidth;n.height=(0,_t.HM)(s.height),n.top=(0,_t.HM)(s.top),n.bottom=(0,_t.HM)(s.bottom),n.width=(0,_t.HM)(s.width),n.left=(0,_t.HM)(s.left),n.right=(0,_t.HM)(s.right),n.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",n.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",r&&(n.maxHeight=(0,_t.HM)(r)),o&&(n.maxWidth=(0,_t.HM)(o))}this._lastBoundingBoxSize=s,ei(this._boundingBox.style,n)}_resetBoundingBoxStyles(){ei(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){ei(this._pane.style,{top:"",left:"",bottom:"",right:"",position:""})}_setOverlayElementStyles(t,e){const s={};if(this._hasExactPosition()){const a=this._viewportRuler.getViewportScrollPosition();ei(s,this._getExactOverlayY(e,t,a)),ei(s,this._getExactOverlayX(e,t,a))}else s.position="static";let n="",r=this._getOffset(e,"x"),o=this._getOffset(e,"y");r&&(n+=`translateX(${r}px) `),o&&(n+=`translateY(${o}px)`),s.transform=n.trim(),this._hasFlexibleDimensions&&this._overlayRef.getConfig().maxHeight&&(s.maxHeight=""),this._hasFlexibleDimensions&&this._overlayRef.getConfig().maxWidth&&(s.maxWidth=""),ei(this._pane.style,s)}_getExactOverlayY(t,e,s){let n={top:null,bottom:null},r=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,s));let o=this._overlayContainer?this._overlayContainer.getContainerElement().getBoundingClientRect().top:0;return r.y-=o,"bottom"===t.overlayY?n.bottom=this._document.documentElement.clientHeight-(r.y+this._overlayRect.height)+"px":n.top=(0,_t.HM)(r.y),n}_getExactOverlayX(t,e,s){let o,n={left:null,right:null},r=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,s)),o=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===o?n.right=this._document.documentElement.clientWidth-(r.x+this._overlayRect.width)+"px":n.left=(0,_t.HM)(r.x),n}_getScrollVisibility(){const t=this._origin.getBoundingClientRect(),e=this._pane.getBoundingClientRect(),s=this.scrollables.map(n=>n.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Ia(t,s),isOriginOutsideView:lr(t,s),isOverlayClipped:Ia(e,s),isOverlayOutsideView:lr(e,s)}}_subtractOverflows(t,...e){return e.reduce((s,n)=>s-Math.max(n,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,s=this._viewportRuler.getViewportScrollPosition();return{top:s.top+this._viewportMargin,left:s.left+this._viewportMargin,right:s.left+t-this._viewportMargin,bottom:s.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?t.offsetX??this._offsetX:t.offsetY??this._offsetY}_validatePositions(){if(!this._preferredPositions.length)throw Error("FlexibleConnectedPositionStrategy: At least one position is required.");this._preferredPositions.forEach(t=>{Da("originX",t.originX),Pa("originY",t.originY),Da("overlayX",t.overlayX),Pa("overlayY",t.overlayY)})}_addPanelClasses(t){this._pane&&(0,_t.Eq)(t).forEach(e=>{-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>this._pane.classList.remove(t)),this._appliedPanelClasses=[])}}function ei(i,t){for(let e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i}class B_{constructor(t,e,s,n,r,o){this._preferredPositions=[],this._positionStrategy=new Ba(s,n,r,o).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(t,e)}get _isRtl(){return"rtl"===this._overlayRef.getDirection()}get onPositionChange(){return this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(t){this._overlayRef=t,this._positionStrategy.attach(t),this._direction&&(t.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(t){this._positionStrategy.withScrollableContainers(t)}withFallbackPosition(t,e,s,n){const r=new A_(t,e,s,n);return this._preferredPositions.push(r),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(t){return this._overlayRef?this._overlayRef.setDirection(t):this._direction=t,this}withOffsetX(t){return this._positionStrategy.withDefaultOffsetX(t),this}withOffsetY(t){return this._positionStrategy.withDefaultOffsetY(t),this}withLockedPosition(t){return this._positionStrategy.withLockedPosition(t),this}withPositions(t){return this._preferredPositions=t.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(t){return this._positionStrategy.setOrigin(t),this}}const Fa="cdk-global-overlay-wrapper";class F_{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(Fa),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._rightOffset="",this._leftOffset=t,this._justifyContent="flex-start",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._leftOffset="",this._rightOffset=t,this._justifyContent="flex-end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._justifyContent="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,s=this._overlayRef.getConfig();t.position=this._cssPosition,t.marginLeft="100%"===s.width?"0":this._leftOffset,t.marginTop="100%"===s.height?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=this._rightOffset,"100%"===s.width?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems="100%"===s.height?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,s=e.style;e.classList.remove(Fa),s.justifyContent=s.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}class Te{constructor(t,e,s,n){this._viewportRuler=t,this._document=e,this._platform=s,this._overlayContainer=n}global(){return new F_}connectedTo(t,e,s){return new B_(e,s,t,this._viewportRuler,this._document)}flexibleConnectedTo(t){return new Ba(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}Te.\u0275fac=function(t){return new(t||Te)(h.LFG(se),h.LFG(q.K0),h.LFG(Ht.t4,8),h.LFG(ae,8))},Te.\u0275prov=h.Yz7({token:Te,factory:Te.\u0275fac,providedIn:"root"}),Te.ngInjectableDef=(0,h.Ez6)({factory:function(){return new Te((0,h.f3M)(se),(0,h.f3M)(q.K0),(0,h.f3M)(Ht.t4,8),(0,h.f3M)(ae,8))},token:Te,providedIn:"root"});let k_=0,ii=(()=>{class i{constructor(e,s,n,r,o,a,l,c,d,u){this.scrollStrategies=e,this._overlayContainer=s,this._componentFactoryResolver=n,this._positionBuilder=r,this._keyboardDispatcher=o,this._injector=a,this._ngZone=l,this._document=c,this._directionality=d,this._location=u}create(e){const s=this._createHostElement(),n=this._createPaneElement(s),r=this._createPortalOutlet(n),o=new Ma(e);return o.direction=o.direction||this._directionality.value,new O_(r,s,n,o,this._ngZone,this._keyboardDispatcher,this._document,this._location)}position(){return this._positionBuilder}_createPaneElement(e){const s=this._document.createElement("div");return s.id="cdk-overlay-"+k_++,s.classList.add("cdk-overlay-pane"),e.appendChild(s),s}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(h.z2F)),new w_(e,this._componentFactoryResolver,this._appRef,this._injector)}}return i.\u0275fac=function(e){return new(e||i)(h.LFG(Pe),h.LFG(ae),h.LFG(h._Vd),h.LFG(Te),h.LFG(de),h.LFG(h.zs3),h.LFG(h.R0b),h.LFG(q.K0),h.LFG(Me.Is),h.LFG(q.Ye,8))},i.\u0275prov=h.Yz7({token:i,factory:i.\u0275fac}),i})();const L_=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],ka=new h.OlP("cdk-connected-overlay-scroll-strategy");let N_=(()=>{class i{constructor(e){this.elementRef=e}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(h.SBq))},i.\u0275dir=h.lG2({type:i,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),i})(),La=(()=>{class i{constructor(e,s,n,r,o){this._overlay=e,this._dir=o,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=Xs.w0.EMPTY,this.viewportMargin=0,this.open=!1,this.backdropClick=new h.vpe,this.positionChange=new h.vpe,this.attach=new h.vpe,this.detach=new h.vpe,this.overlayKeydown=new h.vpe,this._templatePortal=new hr(s,n),this._scrollStrategyFactory=r,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=(0,_t.Ig)(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=(0,_t.Ig)(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=(0,_t.Ig)(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=(0,_t.Ig)(e)}get push(){return this._push}set push(e){this._push=(0,_t.Ig)(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._destroyOverlay()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=L_),this._overlayRef=this._overlay.create(this._buildConfig()),this._overlayRef.keydownEvents().subscribe(e=>{this.overlayKeydown.next(e),e.keyCode===Qt.hY&&this._detachOverlay()})}_buildConfig(){const e=this._position=this._createPositionStrategy(),s=new Ma({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(s.width=this.width),(this.height||0===this.height)&&(s.height=this.height),(this.minWidth||0===this.minWidth)&&(s.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(s.minHeight=this.minHeight),this.backdropClass&&(s.backdropClass=this.backdropClass),this.panelClass&&(s.panelClass=this.panelClass),s}_updatePositionStrategy(e){const s=this.positions.map(n=>({originX:n.originX,originY:n.originY,overlayX:n.overlayX,overlayY:n.overlayY,offsetX:n.offsetX||this.offsetX,offsetY:n.offsetY||this.offsetY}));return e.setOrigin(this.origin.elementRef).withPositions(s).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.origin.elementRef);return this._updatePositionStrategy(e),e.positionChanges.subscribe(s=>this.positionChange.emit(s)),e}_attachOverlay(){this._overlayRef?this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}):this._createOverlay(),this._overlayRef.hasAttached()||(this._overlayRef.attach(this._templatePortal),this.attach.emit()),this.hasBackdrop&&(this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}))}_detachOverlay(){this._overlayRef&&(this._overlayRef.detach(),this.detach.emit()),this._backdropSubscription.unsubscribe()}_destroyOverlay(){this._overlayRef&&this._overlayRef.dispose(),this._backdropSubscription.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(ii),h.Y36(h.Rgc),h.Y36(h.s_b),h.Y36(ka),h.Y36(Me.Is,8))},i.\u0275dir=h.lG2({type:i,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],open:["cdkConnectedOverlayOpen","open"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"],positions:["cdkConnectedOverlayPositions","positions"],origin:["cdkConnectedOverlayOrigin","origin"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown"},exportAs:["cdkConnectedOverlay"],features:[h.TTD]}),i})();const Na={provide:ka,deps:[ii],useFactory:function U_(i){return()=>i.scrollStrategies.reposition()}};let Ua=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({providers:[ii,Na],imports:[Me.vT,T_,Hs,Hs]}),i})();var Yt=B(5727),G_=B(9770),De=B(4004);const H_=["trigger"],X_=["panel"];function V_(i,t){if(1&i&&(h.TgZ(0,"span",8),h._uU(1),h.qZA()),2&i){const e=h.oxw();h.xp6(1),h.Oqu(e.placeholder||"\xa0")}}function z_(i,t){if(1&i&&(h.TgZ(0,"span"),h._uU(1),h.qZA()),2&i){const e=h.oxw(2);h.xp6(1),h.Oqu(e.triggerValue||"\xa0")}}function Y_(i,t){1&i&&h.Hsn(0,0,["*ngSwitchCase","true"])}function W_(i,t){if(1&i&&(h.TgZ(0,"span",9),h.YNc(1,z_,2,1,"span",10),h.YNc(2,Y_,1,0,"ng-content",11),h.qZA()),2&i){const e=h.oxw();h.Q6J("ngSwitch",!!e.customTrigger),h.xp6(2),h.Q6J("ngSwitchCase",!0)}}function j_(i,t){if(1&i){const e=h.EpF();h.TgZ(0,"div",12,13),h.NdJ("@transformPanel.done",function(n){h.CHM(e);const r=h.oxw();return h.KtG(r._panelDoneAnimatingStream.next(n.toState))})("keydown",function(n){h.CHM(e);const r=h.oxw();return h.KtG(r._handleKeydown(n))}),h.Hsn(2,1),h.qZA()}if(2&i){const e=h.oxw();h.Gre("mat-select-panel ",e._getPanelTheme(),""),h.Udp("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),h.Q6J("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing")}}const $_=[[["mat-select-trigger"]],"*"],Z_=["mat-select-trigger","*"],cr={transformPanel:(0,St.X$)("transformPanel",[(0,St.SB)("void",(0,St.oB)({transform:"scaleY(0.8)",minWidth:"100%",opacity:0})),(0,St.SB)("showing",(0,St.oB)({opacity:1,minWidth:"calc(100% + 32px)",transform:"scaleY(1)"})),(0,St.SB)("showing-multiple",(0,St.oB)({opacity:1,minWidth:"calc(100% + 64px)",transform:"scaleY(1)"})),(0,St.eR)("void => *",(0,St.jt)("120ms cubic-bezier(0, 0, 0.2, 1)")),(0,St.eR)("* => void",(0,St.jt)("100ms 25ms linear",(0,St.oB)({opacity:0})))]),fadeInContent:(0,St.X$)("fadeInContent",[(0,St.SB)("showing",(0,St.oB)({opacity:1})),(0,St.eR)("void => showing",[(0,St.oB)({opacity:0}),(0,St.jt)("150ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let Q_=0,Vs=0;const Ga=new h.OlP("mat-select-scroll-strategy"),sm={provide:Ga,deps:[ii],useFactory:function im(i){return()=>i.scrollStrategies.reposition()}};class nm{constructor(t,e){this.source=t,this.value=e}}class rm{constructor(t,e,s,n,r){this._elementRef=t,this._defaultErrorStateMatcher=e,this._parentForm=s,this._parentFormGroup=n,this.ngControl=r}}const om=(0,Yt.Kr)((0,Yt.sb)((0,Yt.Id)((0,Yt.FD)(rm))));let am=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275dir=h.lG2({type:i,selectors:[["mat-select-trigger"]]}),i})(),hm=(()=>{class i extends om{constructor(e,s,n,r,o,a,l,c,d,u,f,p){super(o,r,l,c,u),this._viewportRuler=e,this._changeDetectorRef=s,this._ngZone=n,this._dir=a,this._parentFormField=d,this.ngControl=u,this._panelOpen=!1,this._required=!1,this._scrollTop=0,this._multiple=!1,this._compareWith=(_,g)=>_===g,this._uid="mat-select-"+Q_++,this._destroy=new zt.x,this._triggerFontSize=0,this._onChange=()=>{},this._onTouched=()=>{},this._optionIds="",this._transformOrigin="top",this._panelDoneAnimatingStream=new zt.x,this._offsetY=0,this._positions=[{originX:"start",originY:"top",overlayX:"start",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"bottom"}],this._disableOptionCentering=!1,this._focused=!1,this.controlType="mat-select",this.ariaLabel="",this.optionSelectionChanges=(0,G_.P)(()=>this.options?(0,Vi.T)(...this.options.map(_=>_.onSelectionChange)):this._ngZone.onStable.asObservable().pipe((0,bi.q)(1),(0,xa.w)(()=>this.optionSelectionChanges))),this.openedChange=new h.vpe,this._openedStream=this.openedChange.pipe((0,ar.h)(_=>_),(0,De.U)(()=>{})),this._closedStream=this.openedChange.pipe((0,ar.h)(_=>!_),(0,De.U)(()=>{})),this.selectionChange=new h.vpe,this.valueChange=new h.vpe,this.ngControl&&(this.ngControl.valueAccessor=this),this._scrollStrategyFactory=p,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(f)||0,this.id=this.id}get focused(){return this._focused||this._panelOpen}set focused(e){this._focused=e}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){return this._required}set required(e){this._required=(0,_t.Ig)(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){if(this._selectionModel)throw function q_(){return Error("Cannot change `multiple` mode of select after initialization.")}();this._multiple=(0,_t.Ig)(e)}get disableOptionCentering(){return this._disableOptionCentering}set disableOptionCentering(e){this._disableOptionCentering=(0,_t.Ig)(e)}get compareWith(){return this._compareWith}set compareWith(e){if("function"!=typeof e)throw function J_(){return Error("`compareWith` must be a function.")}();this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){e!==this._value&&(this.writeValue(e),this._value=e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new Zp(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe((0,ya.x)(),(0,ee.R)(this._destroy)).subscribe(()=>{this.panelOpen?(this._scrollTop=0,this.openedChange.emit(!0)):(this.openedChange.emit(!1),this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.onChange.pipe((0,ee.R)(this._destroy)).subscribe(e=>{e.added.forEach(s=>s.select()),e.removed.forEach(s=>s.deselect())}),this.options.changes.pipe((0,Gs.O)(null),(0,ee.R)(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){this.ngControl&&this.updateErrorState()}ngOnChanges(e){e.disabled&&this.stateChanges.next()}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this.disabled||!this.options||!this.options.length||this._panelOpen||(this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this.trigger.nativeElement).fontSize||"0"),this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._calculateOverlayPosition(),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._ngZone.onStable.asObservable().pipe((0,bi.q)(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`)}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this.options&&this._setSelectionByValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel.selected:this._selectionModel.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const e=this._selectionModel.selected.map(s=>s.viewValue);return this._isRtl()&&e.reverse(),e.join(", ")}return this._selectionModel.selected[0].viewValue}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const s=e.keyCode,o=this._keyManager;s===Qt.K5||s===Qt.L_||(this.multiple||e.altKey)&&(s===Qt.JH||s===Qt.LH||s===Qt.oh||s===Qt.SV)?(e.preventDefault(),this.open()):this.multiple||(s===Qt.Sd||s===Qt.uR?(s===Qt.Sd?o.setFirstItemActive():o.setLastItemActive(),e.preventDefault()):o.onKeydown(e))}_handleOpenKeydown(e){const s=e.keyCode,n=s===Qt.JH||s===Qt.LH,r=this._keyManager;if(s===Qt.Sd||s===Qt.uR)e.preventDefault(),s===Qt.Sd?r.setFirstItemActive():r.setLastItemActive();else if(n&&e.altKey)e.preventDefault(),this.close();else if(s!==Qt.K5&&s!==Qt.L_||!r.activeItem)if(this._multiple&&s===Qt.A&&e.ctrlKey){e.preventDefault();const o=this.options.some(a=>!a.disabled&&!a.selected);this.options.forEach(a=>{a.disabled||(o?a.select():a.deselect())})}else{const o=r.activeItemIndex;r.onKeydown(e),this._multiple&&n&&e.shiftKey&&r.activeItem&&r.activeItemIndex!==o&&r.activeItem._selectViaInteraction()}else e.preventDefault(),r.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe((0,bi.q)(1)).subscribe(()=>{this._setPseudoCheckboxPaddingSize(),this._changeDetectorRef.detectChanges(),this._calculateOverlayOffsetX(),this.panel.nativeElement.scrollTop=this._scrollTop})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}_setPseudoCheckboxPaddingSize(){if(!Vs&&this.multiple){const e=this.panel.nativeElement.querySelector(".mat-pseudo-checkbox");e&&(Vs=24+e.offsetWidth)}}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this._setSelectionByValue(this.ngControl?this.ngControl.value:this._value)})}_setSelectionByValue(e){if(this.multiple&&e){if(!Array.isArray(e))throw function K_(){return Error("Value must be an array in multiple-selection mode.")}();this._selectionModel.clear(),e.forEach(s=>this._selectValue(s)),this._sortValues()}else{this._selectionModel.clear();const s=this._selectValue(e);s&&this._keyManager.setActiveItem(s)}this._changeDetectorRef.markForCheck()}_selectValue(e){const s=this.options.find(n=>{try{return null!=n.value&&this._compareWith(n.value,e)}catch(r){return(0,h.X6Q)()&&console.warn(r),!1}});return s&&this._selectionModel.select(s),s}_initKeyManager(){this._keyManager=new Ns.s1(this.options).withTypeAhead().withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._keyManager.tabOut.pipe((0,ee.R)(this._destroy)).subscribe(()=>{this.focus(),this.close()}),this._keyManager.change.pipe((0,ee.R)(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollActiveOptionIntoView():!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=(0,Vi.T)(this.options.changes,this._destroy);this.optionSelectionChanges.pipe((0,ee.R)(e)).subscribe(s=>{this._onSelect(s.source,s.isUserInput),s.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),(0,Vi.T)(...this.options.map(s=>s._stateChanges)).pipe((0,ee.R)(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()}),this._setOptionIds()}_onSelect(e,s){const n=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e),s&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),s&&this.focus())):(e.deselect(),this._selectionModel.clear(),this._propagateChanges(e.value)),n!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((s,n)=>this.sortComparator?this.sortComparator(s,n,e):e.indexOf(s)-e.indexOf(n)),this.stateChanges.next()}}_propagateChanges(e){let s=null;s=this.multiple?this.selected.map(n=>n.value):this.selected?this.selected.value:e,this._value=s,this.valueChange.emit(s),this._onChange(s),this.selectionChange.emit(new nm(this,s)),this._changeDetectorRef.markForCheck()}_setOptionIds(){this._optionIds=this.options.map(e=>e.id).join(" ")}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_scrollActiveOptionIntoView(){const e=this._keyManager.activeItemIndex||0,s=(0,Yt.CB)(e,this.options,this.optionGroups);this.panel.nativeElement.scrollTop=(0,Yt.jH)(e+s,this._getItemHeight(),this.panel.nativeElement.scrollTop,256)}focus(){this._elementRef.nativeElement.focus()}_getOptionIndex(e){return this.options.reduce((s,n,r)=>void 0===s?e===n?r:void 0:s,void 0)}_calculateOverlayPosition(){const e=this._getItemHeight(),s=this._getItemCount(),n=Math.min(s*e,256),o=s*e-n;let a=this.empty?0:this._getOptionIndex(this._selectionModel.selected[0]);a+=(0,Yt.CB)(a,this.options,this.optionGroups);const l=n/2;this._scrollTop=this._calculateOverlayScroll(a,l,o),this._offsetY=this._calculateOverlayOffsetY(a,l,o),this._checkOverlayWithinViewport(o)}_calculateOverlayScroll(e,s,n){const r=this._getItemHeight();return Math.min(Math.max(0,r*e-s+r/2),n)}_getAriaLabel(){return this.ariaLabelledby?null:this.ariaLabel||this.placeholder}_getAriaLabelledby(){return this.ariaLabelledby?this.ariaLabelledby:this._parentFormField&&this._parentFormField._hasFloatingLabel()&&!this._getAriaLabel()&&this._parentFormField._labelId||null}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_calculateOverlayOffsetX(){const e=this.overlayDir.overlayRef.overlayElement.getBoundingClientRect(),s=this._viewportRuler.getViewportSize(),n=this._isRtl(),r=this.multiple?Vs+16:32;let o;if(this.multiple)o=Vs;else{let c=this._selectionModel.selected[0]||this.options.first;o=c&&c.group?32:16}n||(o*=-1);const a=0-(e.left+o-(n?r:0)),l=e.right+o-s.width+(n?0:r);a>0?o+=a+8:l>0&&(o-=l+8),this.overlayDir.offsetX=Math.round(o),this.overlayDir.overlayRef.updatePosition()}_calculateOverlayOffsetY(e,s,n){const r=this._getItemHeight(),o=(r-this._triggerRect.height)/2,a=Math.floor(256/r);let l;return this._disableOptionCentering?0:(l=0===this._scrollTop?e*r:this._scrollTop===n?(e-(this._getItemCount()-a))*r+(r-(this._getItemCount()*r-256)%r):s-r/2,Math.round(-1*l-o))}_checkOverlayWithinViewport(e){const s=this._getItemHeight(),n=this._viewportRuler.getViewportSize(),r=this._triggerRect.top-8,o=n.height-this._triggerRect.bottom-8,a=Math.abs(this._offsetY),c=Math.min(this._getItemCount()*s,256)-a-this._triggerRect.height;c>o?this._adjustPanelUp(c,o):a>r?this._adjustPanelDown(a,r,e):this._transformOrigin=this._getOriginBasedOnOption()}_adjustPanelUp(e,s){const n=Math.round(e-s);this._scrollTop-=n,this._offsetY-=n,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop<=0&&(this._scrollTop=0,this._offsetY=0,this._transformOrigin="50% bottom 0px")}_adjustPanelDown(e,s,n){const r=Math.round(e-s);if(this._scrollTop+=r,this._offsetY+=r,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop>=n)return this._scrollTop=n,this._offsetY=0,void(this._transformOrigin="50% top 0px")}_getOriginBasedOnOption(){const e=this._getItemHeight(),s=(e-this._triggerRect.height)/2;return`50% ${Math.abs(this._offsetY)-s+e/2}px 0px`}_getItemCount(){return this.options.length+this.optionGroups.length}_getItemHeight(){return 3*this._triggerFontSize}setDescribedByIds(e){this._ariaDescribedby=e.join(" ")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this._panelOpen||!this.empty}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(se),h.Y36(h.sBO),h.Y36(h.R0b),h.Y36(Yt.rD),h.Y36(h.SBq),h.Y36(Me.Is,8),h.Y36(L.F,8),h.Y36(L.sg,8),h.Y36(xi.KE,8),h.Y36(L.a5,10),h.$8M("tabindex"),h.Y36(Ga))},i.\u0275cmp=h.Xpm({type:i,selectors:[["mat-select"]],contentQueries:function(e,s,n){if(1&e&&(h.Suo(n,am,5),h.Suo(n,Yt.ey,5),h.Suo(n,Yt.Nv,4)),2&e){let r;h.iGM(r=h.CRH())&&(s.customTrigger=r.first),h.iGM(r=h.CRH())&&(s.options=r),h.iGM(r=h.CRH())&&(s.optionGroups=r)}},viewQuery:function(e,s){if(1&e&&(h.Gf(H_,5),h.Gf(X_,5),h.Gf(La,5)),2&e){let n;h.iGM(n=h.CRH())&&(s.trigger=n.first),h.iGM(n=h.CRH())&&(s.panel=n.first),h.iGM(n=h.CRH())&&(s.overlayDir=n.first)}},hostAttrs:["role","listbox",1,"mat-select"],hostVars:19,hostBindings:function(e,s){1&e&&h.NdJ("keydown",function(r){return s._handleKeydown(r)})("focus",function(){return s._onFocus()})("blur",function(){return s._onBlur()}),2&e&&(h.uIk("id",s.id)("tabindex",s.tabIndex)("aria-label",s._getAriaLabel())("aria-labelledby",s._getAriaLabelledby())("aria-required",s.required.toString())("aria-disabled",s.disabled.toString())("aria-invalid",s.errorState)("aria-owns",s.panelOpen?s._optionIds:null)("aria-multiselectable",s.multiple)("aria-describedby",s._ariaDescribedby||null)("aria-activedescendant",s._getAriaActiveDescendant()),h.ekj("mat-select-disabled",s.disabled)("mat-select-invalid",s.errorState)("mat-select-required",s.required)("mat-select-empty",s.empty))},inputs:{disabled:"disabled",disableRipple:"disableRipple",tabIndex:"tabIndex",ariaLabel:["aria-label","ariaLabel"],id:"id",placeholder:"placeholder",required:"required",multiple:"multiple",disableOptionCentering:"disableOptionCentering",compareWith:"compareWith",value:"value",panelClass:"panelClass",ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",sortComparator:"sortComparator"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["matSelect"],features:[h._Bn([{provide:xi.Eo,useExisting:i},{provide:Yt.HF,useExisting:i}]),h.qOj,h.TTD],ngContentSelectors:Z_,decls:9,vars:9,consts:[["cdk-overlay-origin","","aria-hidden","true",1,"mat-select-trigger",3,"click"],["origin","cdkOverlayOrigin","trigger",""],[1,"mat-select-value",3,"ngSwitch"],["class","mat-select-placeholder",4,"ngSwitchCase"],["class","mat-select-value-text",3,"ngSwitch",4,"ngSwitchCase"],[1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayMinWidth","cdkConnectedOverlayOffsetY","backdropClick","attach","detach"],[1,"mat-select-placeholder"],[1,"mat-select-value-text",3,"ngSwitch"],[4,"ngSwitchDefault"],[4,"ngSwitchCase"],[3,"ngClass","keydown"],["panel",""]],template:function(e,s){if(1&e&&(h.F$t($_),h.TgZ(0,"div",0,1),h.NdJ("click",function(){return s.toggle()}),h.TgZ(3,"div",2),h.YNc(4,V_,2,1,"span",3),h.YNc(5,W_,3,2,"span",4),h.qZA(),h.TgZ(6,"div",5),h._UZ(7,"div",6),h.qZA()(),h.YNc(8,j_,3,9,"ng-template",7),h.NdJ("backdropClick",function(){return s.close()})("attach",function(){return s._onAttached()})("detach",function(){return s.close()})),2&e){const n=h.MAs(1);h.xp6(3),h.Q6J("ngSwitch",s.empty),h.xp6(1),h.Q6J("ngSwitchCase",!0),h.xp6(1),h.Q6J("ngSwitchCase",!1),h.xp6(3),h.Q6J("cdkConnectedOverlayScrollStrategy",s._scrollStrategy)("cdkConnectedOverlayOrigin",n)("cdkConnectedOverlayOpen",s.panelOpen)("cdkConnectedOverlayPositions",s._positions)("cdkConnectedOverlayMinWidth",null==s._triggerRect?null:s._triggerRect.width)("cdkConnectedOverlayOffsetY",s._offsetY)}},dependencies:[q.mk,q.RF,q.n9,q.ED,La,N_],styles:[".mat-select{display:inline-block;width:100%;outline:0}.mat-select-trigger{display:inline-table;cursor:pointer;position:relative;box-sizing:border-box}.mat-select-disabled .mat-select-trigger{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.mat-select-value{display:table-cell;max-width:0;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-select-arrow-wrapper{display:table-cell;vertical-align:middle}.mat-form-field-appearance-fill .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-outline .mat-select-arrow-wrapper{transform:translateY(-25%)}.mat-form-field-appearance-standard .mat-select:not(.mat-select-empty) .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:transform .4s cubic-bezier(.25,.8,.25,1)}._mat-animation-noopable.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:none}.mat-select-arrow{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;margin:0 4px}.mat-select-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;padding-top:0;padding-bottom:0;max-height:256px;min-width:100%;border-radius:4px}@media screen and (-ms-high-contrast:active){.mat-select-panel{outline:solid 1px}}.mat-select-panel .mat-optgroup-label,.mat-select-panel .mat-option{font-size:inherit;line-height:3em;height:3em}.mat-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-form-field-flex{cursor:pointer}.mat-form-field-type-mat-select .mat-form-field-label{width:calc(100% - 18px)}.mat-select-placeholder{transition:color .4s .133s cubic-bezier(.25,.8,.25,1)}._mat-animation-noopable .mat-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-select-placeholder{color:transparent;-webkit-text-fill-color:transparent;transition:none;display:block}"],encapsulation:2,data:{animation:[cr.transformPanel]},changeDetection:0}),i})(),lm=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({providers:[sm],imports:[q.ez,Ua,Yt.Ng,Yt.BQ,xi.lN,Yt.Ng,Yt.BQ]}),i})();function cm(i,t){if(1&i&&(h.TgZ(0,"mat-option",22),h._uU(1),h.qZA()),2&i){const e=t.$implicit;h.Q6J("value",e.value),h.xp6(1),h.hij(" ",e.text," ")}}function dm(i,t){if(1&i){const e=h.EpF();h.ynx(0),h.TgZ(1,"div",1)(2,"div",2),h._uU(3,"3D Handle"),h.qZA(),h.TgZ(4,"div",13)(5,"div",9),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleFlyMode())}),h.TgZ(6,"div",5),h._uU(7,"Fly Mode"),h.qZA(),h.TgZ(8,"div",6),h._UZ(9,"i",14),h.qZA()(),h._UZ(10,"div")(11,"div"),h.TgZ(12,"div",15),h._uU(13,"a"),h.qZA(),h._UZ(14,"div")(15,"div"),h.qZA()(),h.TgZ(16,"div",16)(17,"div",17),h._uU(18," Indicators "),h.qZA(),h.TgZ(19,"div",3)(20,"form",18)(21,"mat-form-field",19)(22,"mat-label"),h._uU(23,"Address View"),h.qZA(),h.TgZ(24,"mat-select",20),h.YNc(25,cm,2,2,"mat-option",21),h.qZA()()()()(),h.BQk()}if(2&i){const e=h.oxw();h.xp6(5),h.Q6J("ngClass",e.warehouseController.isFlyMode.isEnable?"red":""),h.xp6(15),h.Q6J("formGroup",e.formDropdown),h.xp6(5),h.Q6J("ngForOf",e.indicatorTypesDropdown)}}function um(i,t){if(1&i&&(h.TgZ(0,"mat-option",22),h._uU(1),h.qZA()),2&i){const e=t.$implicit;h.Q6J("value",e.value),h.xp6(1),h.hij(" ",e.text," ")}}function fm(i,t){if(1&i){const e=h.EpF();h.ynx(0),h.TgZ(1,"div",1)(2,"div",2),h._uU(3,"Address"),h.qZA(),h.TgZ(4,"div",3)(5,"div",4),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.openAddressTypeModal())}),h.TgZ(6,"div",5),h._uU(7,"Select Adress"),h.qZA(),h.TgZ(8,"div",6),h._UZ(9,"i",23),h.qZA()(),h.TgZ(10,"div",9),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleSpawnMode())}),h.TgZ(11,"div",5),h._uU(12,"Place"),h.qZA(),h.TgZ(13,"div",6),h._UZ(14,"i",24),h.qZA()(),h.TgZ(15,"div",9),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleSelectionMode())}),h.TgZ(16,"div",5),h._uU(17,"Selection"),h.qZA(),h.TgZ(18,"div",6),h._UZ(19,"i",25),h.qZA()(),h.TgZ(20,"div",9),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleDragMode())}),h.TgZ(21,"div",5),h._uU(22,"Drag and Drop"),h.qZA(),h.TgZ(23,"div",6),h._UZ(24,"i",26),h.qZA()(),h.TgZ(25,"div",9),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleMetrics())}),h.TgZ(26,"div",5),h._uU(27,"Metrics"),h.qZA(),h.TgZ(28,"div",6),h._UZ(29,"i",27),h.qZA()(),h.TgZ(30,"div",28),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleRemove())}),h.TgZ(31,"div",5),h._uU(32,"Remove"),h.qZA(),h.TgZ(33,"div",6),h._UZ(34,"i",29),h.qZA()()()(),h.TgZ(35,"div",16)(36,"div",17),h._uU(37," Indicators "),h.qZA(),h.TgZ(38,"div",3)(39,"form",18)(40,"mat-form-field",19)(41,"mat-label"),h._uU(42,"Address View"),h.qZA(),h.TgZ(43,"mat-select",20),h.YNc(44,um,2,2,"mat-option",21),h.qZA()()()()(),h.TgZ(45,"div",16)(46,"div",17),h._uU(47," Reports "),h.qZA(),h.TgZ(48,"div",3)(49,"div",9),h.NdJ("click",function(){h.CHM(e);const n=h.oxw();return h.KtG(n.handleHeatMapFlow2D())}),h.TgZ(50,"div",5),h._uU(51,"Heat Map"),h.qZA(),h.TgZ(52,"div",6),h._UZ(53,"i",30),h.qZA()(),h._UZ(54,"div")(55,"div"),h.TgZ(56,"div",15),h._uU(57,"a"),h.qZA(),h._UZ(58,"div")(59,"div"),h.qZA()(),h.BQk()}if(2&i){const e=h.oxw();h.xp6(10),h.Q6J("ngClass",e.warehouseController.isSpawnMode.isEnable?"red":""),h.xp6(5),h.Q6J("ngClass",e.warehouseController.isSelectionMode.isEnable?"red":""),h.xp6(5),h.Q6J("ngClass",e.warehouseController.isDragMode.isEnable?"red":""),h.xp6(5),h.Q6J("ngClass",e.warehouseController.isMetrics.isEnable?"red":""),h.xp6(14),h.Q6J("formGroup",e.formDropdown),h.xp6(5),h.Q6J("ngForOf",e.indicatorTypesDropdown),h.xp6(5),h.Q6J("ngClass",e.warehouseController.isHeatMapFlow2DMode.isEnable?"red":"")}}let pm=(()=>{class i{constructor(e,s,n){this.warehouseService=e,this.http=s,this.modalService=n,this.items=["Address","Miscellaneous"],this.expandedIndex=0,this.addresses=[],this.indicatorTypesDropdown=[{text:"None",value:"None"},{text:"Picks",value:"picks"},{text:"Cases Picked",value:"casespicked"},{text:"Restock",value:"restock"},{text:"Out of Stocks",value:"outofstock"}]}ngOnInit(){window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=e=>{const s=JSON.parse(e);s.forEach(n=>delete n.id),this.warehouseService.saveAddresess(s).subscribe()},window.unityEvents.load2D=()=>{const e=JSON.stringify(this.addresses);this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",e)},this.warehouseController={isCameraMode:{isEnable:!0,action:ce.handleCameraModeGameInstance},isDragMode:{isEnable:!1,action:ce.handleDragModeGameInstance},isSelectionMode:{isEnable:!1,action:ce.handleSelectionModeGameInstance},isSpawnMode:{isEnable:!1,action:ce.handleSpawnModeGameInstance},isMetrics:{isEnable:!1,action:ce.handleMetricModeGameInstance},isHeatMapFlow2DMode:{isEnable:!1,action:ce.handleHeatMapFlow2D},isHeatMapPerAddress2DMode:{isEnable:!1,action:ce.handleHeatMapPerAddress2D},isFlyMode:{isEnable:!1,action:ce.handleFlyMode},isHeatMapPerAddress3DMode:{isEnable:!1,action:ce.handleHeatMapPerAddress3D},isMiscellaneousMode:{isEnable:!1,action:ce.handleMiscellaneous}},this.initFormControl()}initFormControl(){this.formDropdown=new L.cw({selectIndicatorDropdown:new L.NI("None")}),this.formDropdown.get("selectIndicatorDropdown")?.valueChanges.subscribe(e=>{this.switchMenu?this.handleHeatMapPerAddress3D(e):this.handleHeatMapPerAddress2D(e)})}load2DAreaPicking(){this.warehouseService.loadStatic2dAddresses().subscribe(e=>{this.addresses=e;const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",s)}),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",s)}),this.http.get("assets/points.json").subscribe(e=>{const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapFlow",s)})}openAddressTypeModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(ga,{class:"modal-lg",initialState:{title:"Address Type",gameInstance:this.gameInstance}})}openMiscellaneousTypeModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(jp,{class:"modal-lg",initialState:{title:"Miscellaneous",gameInstance:this.gameInstance}})}handleCamera(){this.handleWarehouseControl([Bt.isCameraMode],[])}handleSpawnMode(){this.handleWarehouseControl([Bt.isSpawnMode],[Bt.isSelectionMode,Bt.isDragMode])}handleSelectionMode(){this.handleWarehouseControl([Bt.isSelectionMode],[Bt.isSpawnMode,Bt.isDragMode,Bt.isCameraMode])}handleDragMode(){this.handleWarehouseControl([Bt.isDragMode],[Bt.isCameraMode,Bt.isSpawnMode])}handleMetrics(){this.handleWarehouseControl([Bt.isMetrics],[Bt.isSelectionMode,Bt.isDragMode])}handleHeatMapFlow2D(){this.handleWarehouseControl([Bt.isHeatMapFlow2DMode],[Bt.isSelectionMode,Bt.isDragMode])}handleHeatMapPerAddress2D(e){"None"!==e?this.http.get(`assets/${e}.json`).subscribe(s=>{const n=JSON.stringify(s);this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapPerAddress2DData",n),this.handleWarehouseControl([],[Bt.isSelectionMode,Bt.isDragMode]),ce.handleHeatMapPerAddress2D(this.gameInstance,!0)}):ce.handleHeatMapPerAddress2D(this.gameInstance,!1)}handleFlyMode(){this.handleWarehouseControl([Bt.isFlyMode],[])}handleHeatMapPerAddress3D(e){this.handleWarehouseControl([Bt.isHeatMapPerAddress3DMode],[]),"None"===e?this.gameInstance.SendMessage("EventSystem","DisableHeatMapPerAddress3D"):this.gameInstance.SendMessage("EventSystem","LoadHeatMapPerAddress3D",e)}handleMiscellaneous(){this.handleWarehouseControl([Bt.isMiscellaneousMode],[]),this.gameInstance.SendMessage("JavaScriptMessager","ClearMiscellaneous"),this.warehouseController.isMiscellaneousMode.isEnable?this.http.get("assets/miscellaneousLayoutParcial.json").subscribe(e=>{const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",s)}):this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",s)})}handleRemove(){this.gameInstance.SendMessage("JavaScriptMessager","HandleRemove")}saveAddressToDB(){this.gameInstance.SendMessage("JavaScriptMessager","SaveAddressToDB")}handleWarehouseControl(e,s){for(var n in this.warehouseController)e.includes(n)&&(console.log("b"),this.warehouseController[n].isEnable=!this.warehouseController[n].isEnable,this.warehouseController[n].action(this.gameInstance,this.warehouseController[n].isEnable)),s.includes(n)&&(this.warehouseController[n].isEnable=!1,this.warehouseController[n].action(this.gameInstance,this.warehouseController[n].isEnable))}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(yi),h.Y36(vi.eN),h.Y36(gi.tT))},i.\u0275cmp=h.Xpm({type:i,selectors:[["app-warehouse-menu"]],inputs:{gameInstance:"gameInstance",switchMenu:"switchMenu"},decls:29,vars:6,consts:[[2,"background-color","white","width","100%",3,"ngClass"],[1,"div-menu-style"],[1,"label-bottom",2,"position","relative"],[1,"div-button-style"],["tabindex","0",1,"ui","vertical","animated","button",3,"click"],[1,"hidden","content"],[1,"visible","content"],[1,"world","icon"],[1,"save","icon"],["tabindex","0",1,"ui","vertical","animated","button",3,"ngClass","click"],[1,"camera","icon"],[1,"th","icon"],[4,"ngIf"],[1,"div-button-style",2,"grid-template-columns","50% 50%"],[1,"paper","plane","icon"],[2,"color","azure"],[1,"div-menu-style",2,"grid-template-columns","100%"],[1,"label-bottom",2,"position","relative","bottom","-1%"],[3,"formGroup"],["appearance","fill",2,"width","300%"],["formControlName","selectIndicatorDropdown"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"plus","icon"],[1,"object","ungroup","icon"],[1,"mouse","pointer","icon"],[1,"hand","rock","icon"],[1,"align","left","icon"],["tabindex","0",1,"ui","vertical","animated","yellow","button",3,"click"],[1,"trash","alternate","icon"],[1,"map","icon"]],template:function(e,s){1&e&&(h.TgZ(0,"div",0)(1,"div",1)(2,"div",2),h._uU(3,"Master"),h.qZA(),h.TgZ(4,"div",3)(5,"div",4),h.NdJ("click",function(){return s.load2DAreaPicking()}),h.TgZ(6,"div",5),h._uU(7,"Load 2D"),h.qZA(),h.TgZ(8,"div",6),h._UZ(9,"i",7),h.qZA()(),h.TgZ(10,"div",4),h.NdJ("click",function(){return s.saveAddressToDB()}),h.TgZ(11,"div",5),h._uU(12,"Save"),h.qZA(),h.TgZ(13,"div",6),h._UZ(14,"i",8),h.qZA()(),h.TgZ(15,"div",9),h.NdJ("click",function(){return s.handleCamera()}),h.TgZ(16,"div",5),h._uU(17),h.qZA(),h.TgZ(18,"div",6),h._UZ(19,"i",10),h.qZA()(),h.TgZ(20,"div",9),h.NdJ("click",function(){return s.handleMiscellaneous()}),h.TgZ(21,"div",5),h._uU(22,"Miscellaneous"),h.qZA(),h.TgZ(23,"div",6),h._UZ(24,"i",11),h.qZA()(),h._UZ(25,"div")(26,"div"),h.qZA()(),h.YNc(27,dm,26,3,"ng-container",12),h.YNc(28,fm,60,7,"ng-container",12),h.qZA()),2&e&&(h.Q6J("ngClass",s.switchMenu?"grid-layout-menu-2":"grid-layout-menu-3"),h.xp6(15),h.Q6J("ngClass",s.warehouseController.isCameraMode.isEnable?"red":""),h.xp6(2),h.hij(" Camera is ",s.warehouseController.isCameraMode.isEnable?"enable":"disable"," "),h.xp6(3),h.Q6J("ngClass",s.warehouseController.isMiscellaneousMode.isEnable?"red":""),h.xp6(7),h.Q6J("ngIf",s.switchMenu),h.xp6(1),h.Q6J("ngIf",!s.switchMenu))},dependencies:[q.mk,q.sg,q.O5,L._Y,L.JJ,L.JL,L.sg,L.u,xi.KE,xi.hX,hm,Yt.ey],styles:[".grid-layout-menu-3[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;margin-left:10px;display:grid;grid-template-columns:20% 35% 15% 15%;column-gap:15px}.grid-layout-menu-2[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;margin-left:10px;display:grid;grid-template-columns:20% 10% 15%;column-gap:15px}.div-menu-style[_ngcontent-%COMP%]{border:1px solid lightgray;display:grid;border-radius:20px}.div-button-style[_ngcontent-%COMP%]{margin:10px;display:grid;grid-row-gap:2.5px;grid-template-columns:33% 33% 33%;grid-template-rows:50% 50%}.green[_ngcontent-%COMP%]{background-color:green}.red[_ngcontent-%COMP%]{background-color:red}.label-bottom[_ngcontent-%COMP%]{align-items:center;display:inherit;flex-direction:column;background-color:#d3d3d3;border-radius:20px 20px 0 0;font-weight:700;text-align:center}"]}),i})(),_m=(()=>{class i{constructor(e){var s=this;this.warehouseService=e,this.isReady=!1,this.progress=0,this.gameInstanceEvent=new h.vpe,this.switchMenuEvent=new h.vpe,this.switchMenu=!1,window.unityEvents||(window.unityEvents={}),window.unityEvents.load3D=X(function*(){const n=yield Ls(s.warehouseService.loadStatic3dAddresses()),r=yield Ls(s.warehouseService.loadStaticMiscellaneousType()),o=yield Ls(s.warehouseService.loadStaticIndicators());s.localGameInstance.SendMessage("EventSystem","LoadAddress",JSON.stringify(n)),s.localGameInstance.SendMessage("EventSystem","LoadMiscellaneous",JSON.stringify(r)),s.localGameInstance.SendMessage("EventSystem","LoadIndicatorData",JSON.stringify(o))})}ngOnInit(){const e=window.UnityLoader;this.unityInstance=e.instantiate("unityContainer","assets/build/Build/build.json",{onProgress:(s,n)=>{this.isReady=!0,this.localGameInstance=s,this.gameInstanceEvent.emit({gameInstance:this.localGameInstance})}}),window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=s=>{const n=JSON.parse(s);n.forEach(r=>delete r.id),this.warehouseService.saveAddresess(n).subscribe()}}Load3D(){this.switchMenu=!this.switchMenu,this.switchMenuEvent.emit({switchMenu:this.switchMenu}),this.switchMenu?this.localGameInstance.SendMessage("JavaScriptMessager","Load3DScene"):this.localGameInstance.SendMessage("EventSystem","Load2DScene")}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(yi))},i.\u0275cmp=h.Xpm({type:i,selectors:[["app-warehouse-unity"]],outputs:{gameInstanceEvent:"gameInstanceEvent",switchMenuEvent:"switchMenuEvent"},decls:3,vars:1,consts:[[1,"button",3,"click"],["id","unityContainer",1,"unity-container"]],template:function(e,s){1&e&&(h.TgZ(0,"button",0),h.NdJ("click",function(){return s.Load3D()}),h._uU(1),h.qZA(),h._UZ(2,"div",1)),2&e&&(h.xp6(1),h.hij(" ",s.switchMenu?"3D":"2D","\n"))},styles:[".unity-container[_ngcontent-%COMP%], .unity-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{background-color:#000;height:94vh;margin:auto!important}.button[_ngcontent-%COMP%]{position:absolute;width:80px;height:30px;margin-top:1%;right:0;border-radius:10px;margin-right:1%;z-index:10;background:lightgrey;border:1px solid lightgrey}"]}),i})();const mm=[{path:"",component:(()=>{class i{constructor(e,s,n,r){this.http=e,this.modalService=s,this.store=n,this.warehouseService=r,this.progress=0,this.isReady=!1,this.warehouseStore=this.store.select(o=>o.warehouse),this.addresses2d=[]}ngOnInit(){this.warehouseStore.subscribe(e=>{this.gameInstance?.SendMessage("JavaScriptMessager","RecvJsonWithAddressDim",JSON.stringify(e.currentPositionTypeBin)),this.gameInstance?.SendMessage("JavaScriptMessager","HandleKeyboard","true")}),window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=e=>{const s=JSON.parse(e);s.forEach(n=>delete n.id),this.warehouseService.saveAddresess(s).subscribe()}}onClickCreate2D(){this.warehouseService.loadAddresses().subscribe(e=>{const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",s)}),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const s=JSON.stringify(e);console.log(s),this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",s)})}onClickLoadHeatMapFlowData(){this.http.get("assets/points.json").subscribe(e=>{const s=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapFlow",s)})}openModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(ga,{class:"modal-lg",initialState:{title:"Area Picking"}})}onSave(){this.gameInstance.SendMessage("JavaScriptMessager","SaveAddressToDB")}onClickCreate3D(){this.http.get("assets/address_3d.json").subscribe(e=>{e.forEach(s=>{s.hostName="",(0,h.X6Q)()&&(s.hostName="http://localhost:5003")}),this.gameInstance.SendMessage("EventSystem","LoadAddress",JSON.stringify(e))}),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{this.gameInstance.SendMessage("EventSystem","LoadMiscellaneous",JSON.stringify(e))})}setGameInstance(e){this.gameInstance=e.gameInstance}setSwitch(e){this.switchMenu=e.switchMenu}}return i.\u0275fac=function(e){return new(e||i)(h.Y36(vi.eN),h.Y36(gi.tT),h.Y36(rr.yh),h.Y36(yi))},i.\u0275cmp=h.Xpm({type:i,selectors:[["app-warehouse"]],decls:4,vars:2,consts:[[1,"grid-layout-main"],[3,"gameInstance","switchMenu"],[3,"gameInstanceEvent","switchMenuEvent"]],template:function(e,s){1&e&&(h.TgZ(0,"div")(1,"div",0),h._UZ(2,"app-warehouse-menu",1),h.TgZ(3,"app-warehouse-unity",2),h.NdJ("gameInstanceEvent",function(r){return s.setGameInstance(r)})("switchMenuEvent",function(r){return s.setSwitch(r)}),h.qZA()()()),2&e&&(h.xp6(2),h.Q6J("gameInstance",s.gameInstance)("switchMenu",s.switchMenu))},dependencies:[pm,_m],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),i})()}];let gm=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({imports:[Lt.Bz.forChild(mm),Lt.Bz]}),i})();var vm=B(5349),ym=B(3390);let Tm=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({}),i})();var Sm=B(7217),Ys=B(1481),Em=B(2843),Cm=B(4128),Xa=B(8505),Am=B(262),Rm=B(8746);function Va(i){return Error(`Unable to find icon with the name "${i}"`)}function za(i){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${i}".`)}function Ya(i){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${i}".`)}class Wi{constructor(t){t.nodeName?this.svgElement=t:this.url=t}}class ue{constructor(t,e,s){this._httpClient=t,this._sanitizer=e,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._defaultFontSetClass="material-icons",this._document=s}addSvgIcon(t,e){return this.addSvgIconInNamespace("",t,e)}addSvgIconLiteral(t,e){return this.addSvgIconLiteralInNamespace("",t,e)}addSvgIconInNamespace(t,e,s){return this._addSvgIconConfig(t,e,new Wi(s))}addSvgIconLiteralInNamespace(t,e,s){const n=this._sanitizer.sanitize(h.q3G.HTML,s);if(!n)throw Ya(s);const r=this._createSvgElementForSingleIcon(n);return this._addSvgIconConfig(t,e,new Wi(r))}addSvgIconSet(t){return this.addSvgIconSetInNamespace("",t)}addSvgIconSetLiteral(t){return this.addSvgIconSetLiteralInNamespace("",t)}addSvgIconSetInNamespace(t,e){return this._addSvgIconSetConfig(t,new Wi(e))}addSvgIconSetLiteralInNamespace(t,e){const s=this._sanitizer.sanitize(h.q3G.HTML,e);if(!s)throw Ya(e);const n=this._svgElementFromString(s);return this._addSvgIconSetConfig(t,new Wi(n))}registerFontClassAlias(t,e=t){return this._fontCssClassesByAlias.set(t,e),this}classNameForFontAlias(t){return this._fontCssClassesByAlias.get(t)||t}setDefaultFontSetClass(t){return this._defaultFontSetClass=t,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(t){const e=this._sanitizer.sanitize(h.q3G.RESOURCE_URL,t);if(!e)throw za(t);const s=this._cachedIconsByUrl.get(e);return s?(0,ze.of)(Ws(s)):this._loadSvgIconFromConfig(new Wi(t)).pipe((0,Xa.b)(n=>this._cachedIconsByUrl.set(e,n)),(0,De.U)(n=>Ws(n)))}getNamedSvgIcon(t,e=""){const s=Wa(e,t),n=this._svgIconConfigs.get(s);if(n)return this._getSvgFromConfig(n);const r=this._iconSetConfigs.get(e);return r?this._getSvgFromIconSetConfigs(t,r):(0,Em._)(Va(s))}_getSvgFromConfig(t){return t.svgElement?(0,ze.of)(Ws(t.svgElement)):this._loadSvgIconFromConfig(t).pipe((0,Xa.b)(e=>t.svgElement=e),(0,De.U)(e=>Ws(e)))}_getSvgFromIconSetConfigs(t,e){const s=this._extractIconWithNameFromAnySet(t,e);if(s)return(0,ze.of)(s);const n=e.filter(r=>!r.svgElement).map(r=>this._loadSvgIconSetFromConfig(r).pipe((0,Am.K)(o=>{const a=this._sanitizer.sanitize(h.q3G.RESOURCE_URL,r.url);return console.error(`Loading icon set URL: ${a} failed: ${o.message}`),(0,ze.of)(null)})));return(0,Cm.D)(n).pipe((0,De.U)(()=>{const r=this._extractIconWithNameFromAnySet(t,e);if(!r)throw Va(t);return r}))}_extractIconWithNameFromAnySet(t,e){for(let s=e.length-1;s>=0;s--){const n=e[s];if(n.svgElement){const r=this._extractSvgIconFromSet(n.svgElement,t);if(r)return r}}return null}_loadSvgIconFromConfig(t){return this._fetchUrl(t.url).pipe((0,De.U)(e=>this._createSvgElementForSingleIcon(e)))}_loadSvgIconSetFromConfig(t){return t.svgElement?(0,ze.of)(t.svgElement):this._fetchUrl(t.url).pipe((0,De.U)(e=>(t.svgElement||(t.svgElement=this._svgElementFromString(e)),t.svgElement)))}_createSvgElementForSingleIcon(t){const e=this._svgElementFromString(t);return this._setSvgAttributes(e),e}_extractSvgIconFromSet(t,e){const s=t.querySelector("#"+e);if(!s)return null;const n=s.cloneNode(!0);if(n.removeAttribute("id"),"svg"===n.nodeName.toLowerCase())return this._setSvgAttributes(n);if("symbol"===n.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(n));const r=this._svgElementFromString("<svg></svg>");return r.appendChild(n),this._setSvgAttributes(r)}_svgElementFromString(t){const e=this._document.createElement("DIV");e.innerHTML=t;const s=e.querySelector("svg");if(!s)throw Error("<svg> tag not found");return s}_toSvgElement(t){let e=this._svgElementFromString("<svg></svg>");for(let s=0;s<t.childNodes.length;s++)t.childNodes[s].nodeType===this._document.ELEMENT_NODE&&e.appendChild(t.childNodes[s].cloneNode(!0));return e}_setSvgAttributes(t){return t.setAttribute("fit",""),t.setAttribute("height","100%"),t.setAttribute("width","100%"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.setAttribute("focusable","false"),t}_fetchUrl(t){if(!this._httpClient)throw function Mm(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==t)throw Error(`Cannot fetch icon from URL "${t}".`);const e=this._sanitizer.sanitize(h.q3G.RESOURCE_URL,t);if(!e)throw za(t);const s=this._inProgressUrlFetches.get(e);if(s)return s;const n=this._httpClient.get(e,{responseType:"text"}).pipe((0,Rm.x)(()=>this._inProgressUrlFetches.delete(e)),(0,ba.B)());return this._inProgressUrlFetches.set(e,n),n}_addSvgIconConfig(t,e,s){return this._svgIconConfigs.set(Wa(t,e),s),this}_addSvgIconSetConfig(t,e){const s=this._iconSetConfigs.get(t);return s?s.push(e):this._iconSetConfigs.set(t,[e]),this}}function Ws(i){return i.cloneNode(!0)}function Wa(i,t){return i+":"+t}ue.\u0275fac=function(t){return new(t||ue)(h.LFG(vi.eN,8),h.LFG(Ys.H7),h.LFG(q.K0,8))},ue.\u0275prov=h.Yz7({token:ue,factory:ue.\u0275fac,providedIn:"root"}),ue.ngInjectableDef=(0,h.Ez6)({factory:function(){return new ue((0,h.f3M)(vi.eN,8),(0,h.f3M)(Ys.H7),(0,h.f3M)(q.K0,8))},token:ue,providedIn:"root"});let Um=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({imports:[Yt.BQ,Yt.BQ]}),i})();var Gm=B(9841),Hm=B(4408);let dr,Xm=1;const js={};function $a(i){return i in js&&(delete js[i],!0)}const Vm={setImmediate(i){const t=Xm++;return js[t]=!0,dr||(dr=Promise.resolve()),dr.then(()=>$a(t)&&i()),t},clearImmediate(i){$a(i)}},{setImmediate:zm,clearImmediate:Ym}=Vm,$s={setImmediate(...i){const{delegate:t}=$s;return(t?.setImmediate||zm)(...i)},clearImmediate(i){const{delegate:t}=$s;return(t?.clearImmediate||Ym)(i)},delegate:void 0};var jm=B(7565);const Zm=new class $m extends jm.v{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let n;t=t||s.shift();do{if(n=t.execute(t.state,t.delay))break}while((t=s[0])&&t.id===e&&s.shift());if(this._active=!1,n){for(;(t=s[0])&&t.id===e&&s.shift();)t.unsubscribe();throw n}}}(class Wm extends Hm.o{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,s=0){return null!==s&&s>0?super.requestAsyncId(t,e,s):(t.actions.push(this),t._scheduled||(t._scheduled=$s.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,s=0){var n;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(t,e,s);const{actions:r}=t;null!=e&&(null===(n=r[r.length-1])||void 0===n?void 0:n.id)!==e&&($s.clearImmediate(e),t._scheduled=void 0)}});var qm=B(576),Km=B(3268);function Za(i,t,e){return e?Za(i,t).pipe((0,Km.Z)(e)):new Ve.y(s=>{const n=(...o)=>s.next(1===o.length?o[0]:o),r=i(n);return(0,qm.m)(t)?()=>t(n,r):void 0})}var Jm=B(8372);const qa=new Set;let wi;class Se{constructor(t){this.platform=t,this._matchMedia=this.platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):tg}matchMedia(t){return this.platform.WEBKIT&&function Qm(i){if(!qa.has(i))try{wi||(wi=document.createElement("style"),wi.setAttribute("type","text/css"),document.head.appendChild(wi)),wi.sheet&&(wi.sheet.insertRule(`@media ${i} {.fx-query-test{ }}`,0),qa.add(i))}catch(t){console.error(t)}}(t),this._matchMedia(t)}}function tg(i){return{matches:"all"===i||""===i,media:i,addListener:()=>{},removeListener:()=>{}}}Se.\u0275fac=function(t){return new(t||Se)(h.LFG(Ht.t4))},Se.\u0275prov=h.Yz7({token:Se,factory:Se.\u0275fac,providedIn:"root"}),Se.ngInjectableDef=(0,h.Ez6)({factory:function(){return new Se((0,h.f3M)(Ht.t4))},token:Se,providedIn:"root"});class Oe{constructor(t,e){this.mediaMatcher=t,this.zone=e,this._queries=new Map,this._destroySubject=new zt.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return Ka((0,_t.Eq)(t)).some(s=>this._registerQuery(s).mql.matches)}observe(t){const s=Ka((0,_t.Eq)(t)).map(n=>this._registerQuery(n).observable);return(0,Gm.a)(s).pipe((0,Jm.b)(0,Zm),(0,De.U)(n=>{const r={matches:!1,breakpoints:{}};return n.forEach(o=>{r.matches=r.matches||o.matches,r.breakpoints[o.query]=o.matches}),r}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const e=this.mediaMatcher.matchMedia(t);let s;const r={observable:Za(o=>{s=a=>this.zone.run(()=>o(a)),e.addListener(s)},()=>e.removeListener(s)).pipe((0,ee.R)(this._destroySubject),(0,Gs.O)(e),(0,De.U)(o=>({query:t,matches:o.matches}))),mql:e};return this._queries.set(t,r),r}}function Ka(i){return i.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}Oe.\u0275fac=function(t){return new(t||Oe)(h.LFG(Se),h.LFG(h.R0b))},Oe.\u0275prov=h.Yz7({token:Oe,factory:Oe.\u0275fac,providedIn:"root"}),Oe.ngInjectableDef=(0,h.Ez6)({factory:function(){return new Oe((0,h.f3M)(Se),(0,h.f3M)(h.R0b))},token:Oe,providedIn:"root"});const th=new h.OlP("mat-tooltip-default-options",{providedIn:"root",factory:function ag(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),eh={showDelay:0,hideDelay:0,touchGestures:"auto",position:"before",touchendHideDelay:0,disableTooltipInteractivity:!0};let lg=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=h.oAB({type:i}),i.\u0275inj=h.cJS({providers:[gi.tT,yi,{provide:th,useValue:eh}],imports:[q.ez,gm,vm.m,gi.zk,xi.lN,ym.c,lm,L.UX,Tm,Um,Sm.ie]}),i})()},5469:Wt=>{"use strict";function dt(m,b,v){v=v||2;var D,Y,U,ot,G,Z,ut,C=b&&b.length,R=C?b[0]*v:m.length,y=B(m,0,R,v,!0),w=[];if(!y||y.next===y.prev)return w;if(C&&(y=function et(m,b,v,C){var y,w,U,R=[];for(y=0,w=b.length;y<w;y++)(U=B(m,b[y]*C,y<w-1?b[y+1]*C:m.length,C,!1))===U.next&&(U.steiner=!0),R.push(qt(U));for(R.sort(it),y=0;y<R.length;y++)v=rt(R[y],v);return v}(m,b,y,v)),m.length>80*v){D=U=m[0],Y=ot=m[1];for(var nt=v;nt<R;nt+=v)(G=m[nt])<D&&(D=G),(Z=m[nt+1])<Y&&(Y=Z),G>U&&(U=G),Z>ot&&(ot=Z);ut=0!==(ut=Math.max(U-D,ot-Y))?32767/ut:0}return Lt(y,w,v,D,Y,ut,0),w}function B(m,b,v,C,R){var y,w;if(R===Vt(m,b,v,C)>0)for(y=b;y<v;y+=C)w=Xt(y,m[y],m[y+1],w);else for(y=v-C;y>=b;y-=C)w=Xt(y,m[y],m[y+1],w);return w&&Rt(w,w.next)&&(Ct(w),w=w.next),w}function q(m,b){if(!m)return m;b||(b=m);var C,v=m;do{if(C=!1,v.steiner||!Rt(v,v.next)&&0!==ht(v.prev,v,v.next))v=v.next;else{if(Ct(v),(v=b=v.prev)===v.next)break;C=!0}}while(C||v!==b);return b}function Lt(m,b,v,C,R,y,w){if(m){!w&&y&&function P(m,b,v,C){var R=m;do{0===R.z&&(R.z=F(R.x,R.y,b,v,C)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next}while(R!==m);R.prevZ.nextZ=null,R.prevZ=null,function Et(m){var b,v,C,R,y,w,D,Y,U=1;do{for(v=m,m=null,y=null,w=0;v;){for(w++,C=v,D=0,b=0;b<U&&(D++,C=C.nextZ);b++);for(Y=U;D>0||Y>0&&C;)0!==D&&(0===Y||!C||v.z<=C.z)?(R=v,v=v.nextZ,D--):(R=C,C=C.nextZ,Y--),y?y.nextZ=R:m=R,R.prevZ=y,y=R;v=C}y.nextZ=null,U*=2}while(w>1)}(R)}(m,C,R,y);for(var Y,U,D=m;m.prev!==m.next;)if(Y=m.prev,U=m.next,y?mt(m,C,R,y):h(m))b.push(Y.i/v|0),b.push(m.i/v|0),b.push(U.i/v|0),Ct(m),m=U.next,D=U.next;else if((m=U)===D){w?1===w?Lt(m=X(q(m),b,v),b,v,C,R,y,2):2===w&&L(m,b,v,C,R,y):Lt(q(m),b,v,C,R,y,1);break}}}function h(m){var b=m.prev,v=m,C=m.next;if(ht(b,v,C)>=0)return!1;for(var R=b.x,y=v.x,w=C.x,D=b.y,Y=v.y,U=C.y,ot=R<y?R<w?R:w:y<w?y:w,G=D<Y?D<U?D:U:Y<U?Y:U,Z=R>y?R>w?R:w:y>w?y:w,ut=D>Y?D>U?D:U:Y>U?Y:U,nt=C.next;nt!==b;){if(nt.x>=ot&&nt.x<=Z&&nt.y>=G&&nt.y<=ut&&At(R,D,y,Y,w,U,nt.x,nt.y)&&ht(nt.prev,nt,nt.next)>=0)return!1;nt=nt.next}return!0}function mt(m,b,v,C){var R=m.prev,y=m,w=m.next;if(ht(R,y,w)>=0)return!1;for(var D=R.x,Y=y.x,U=w.x,ot=R.y,G=y.y,Z=w.y,ut=D<Y?D<U?D:U:Y<U?Y:U,nt=ot<G?ot<Z?ot:Z:G<Z?G:Z,vt=D>Y?D>U?D:U:Y>U?Y:U,It=ot>G?ot>Z?ot:Z:G>Z?G:Z,Dt=F(ut,nt,b,v,C),O=F(vt,It,b,v,C),I=m.prevZ,at=m.nextZ;I&&I.z>=Dt&&at&&at.z<=O;){if(I.x>=ut&&I.x<=vt&&I.y>=nt&&I.y<=It&&I!==R&&I!==w&&At(D,ot,Y,G,U,Z,I.x,I.y)&&ht(I.prev,I,I.next)>=0||(I=I.prevZ,at.x>=ut&&at.x<=vt&&at.y>=nt&&at.y<=It&&at!==R&&at!==w&&At(D,ot,Y,G,U,Z,at.x,at.y)&&ht(at.prev,at,at.next)>=0))return!1;at=at.nextZ}for(;I&&I.z>=Dt;){if(I.x>=ut&&I.x<=vt&&I.y>=nt&&I.y<=It&&I!==R&&I!==w&&At(D,ot,Y,G,U,Z,I.x,I.y)&&ht(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;at&&at.z<=O;){if(at.x>=ut&&at.x<=vt&&at.y>=nt&&at.y<=It&&at!==R&&at!==w&&At(D,ot,Y,G,U,Z,at.x,at.y)&&ht(at.prev,at,at.next)>=0)return!1;at=at.nextZ}return!0}function X(m,b,v){var C=m;do{var R=C.prev,y=C.next.next;!Rt(R,y)&&Nt(R,C,C.next,y)&&A(R,y)&&A(y,R)&&(b.push(R.i/v|0),b.push(C.i/v|0),b.push(y.i/v|0),Ct(C),Ct(C.next),C=m=y),C=C.next}while(C!==m);return q(C)}function L(m,b,v,C,R,y){var w=m;do{for(var D=w.next.next;D!==w.prev;){if(w.i!==D.i&&gt(w,D)){var Y=S(w,D);return w=q(w,w.next),Y=q(Y,Y.next),Lt(w,b,v,C,R,y,0),void Lt(Y,b,v,C,R,y,0)}D=D.next}w=w.next}while(w!==m)}function it(m,b){return m.x-b.x}function rt(m,b){var v=function z(m,b){var w,v=b,C=m.x,R=m.y,y=-1/0;do{if(R<=v.y&&R>=v.next.y&&v.next.y!==v.y){var D=v.x+(R-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(D<=C&&D>y&&(y=D,w=v.x<v.next.x?v:v.next,D===C))return w}v=v.next}while(v!==b);if(!w)return null;var Z,Y=w,U=w.x,ot=w.y,G=1/0;v=w;do{C>=v.x&&v.x>=U&&C!==v.x&&At(R<ot?C:y,R,U,ot,R<ot?y:C,R,v.x,v.y)&&(Z=Math.abs(R-v.y)/(C-v.x),A(v,m)&&(Z<G||Z===G&&(v.x>w.x||v.x===w.x&&pt(w,v)))&&(w=v,G=Z)),v=v.next}while(v!==Y);return w}(m,b);if(!v)return b;var C=S(v,m);return q(C,C.next),q(v,v.next)}function pt(m,b){return ht(m.prev,m,b.prev)<0&&ht(b.next,m,m.next)<0}function F(m,b,v,C,R){return(m=1431655765&((m=858993459&((m=252645135&((m=16711935&((m=(m-v)*R|0)|m<<8))|m<<4))|m<<2))|m<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=(b-C)*R|0)|b<<8))|b<<4))|b<<2))|b<<1))<<1}function qt(m){var b=m,v=m;do{(b.x<v.x||b.x===v.x&&b.y<v.y)&&(v=b),b=b.next}while(b!==m);return v}function At(m,b,v,C,R,y,w,D){return(R-w)*(b-D)>=(m-w)*(y-D)&&(m-w)*(C-D)>=(v-w)*(b-D)&&(v-w)*(y-D)>=(R-w)*(C-D)}function gt(m,b){return m.next.i!==b.i&&m.prev.i!==b.i&&!function Ft(m,b){var v=m;do{if(v.i!==m.i&&v.next.i!==m.i&&v.i!==b.i&&v.next.i!==b.i&&Nt(v,v.next,m,b))return!0;v=v.next}while(v!==m);return!1}(m,b)&&(A(m,b)&&A(b,m)&&function st(m,b){var v=m,C=!1,R=(m.x+b.x)/2,y=(m.y+b.y)/2;do{v.y>y!=v.next.y>y&&v.next.y!==v.y&&R<(v.next.x-v.x)*(y-v.y)/(v.next.y-v.y)+v.x&&(C=!C),v=v.next}while(v!==m);return C}(m,b)&&(ht(m.prev,m,b.prev)||ht(m,b.prev,b))||Rt(m,b)&&ht(m.prev,m,m.next)>0&&ht(b.prev,b,b.next)>0)}function ht(m,b,v){return(b.y-m.y)*(v.x-b.x)-(b.x-m.x)*(v.y-b.y)}function Rt(m,b){return m.x===b.x&&m.y===b.y}function Nt(m,b,v,C){var R=Ot(ht(m,b,v)),y=Ot(ht(m,b,C)),w=Ot(ht(v,C,m)),D=Ot(ht(v,C,b));return!!(R!==y&&w!==D||0===R&&jt(m,v,b)||0===y&&jt(m,C,b)||0===w&&jt(v,m,C)||0===D&&jt(v,b,C))}function jt(m,b,v){return b.x<=Math.max(m.x,v.x)&&b.x>=Math.min(m.x,v.x)&&b.y<=Math.max(m.y,v.y)&&b.y>=Math.min(m.y,v.y)}function Ot(m){return m>0?1:m<0?-1:0}function A(m,b){return ht(m.prev,m,m.next)<0?ht(m,b,m.next)>=0&&ht(m,m.prev,b)>=0:ht(m,b,m.prev)<0||ht(m,m.next,b)<0}function S(m,b){var v=new Kt(m.i,m.x,m.y),C=new Kt(b.i,b.x,b.y),R=m.next,y=b.prev;return m.next=b,b.prev=m,v.next=R,R.prev=v,C.next=v,v.prev=C,y.next=C,C.prev=y,C}function Xt(m,b,v,C){var R=new Kt(m,b,v);return C?(R.next=C.next,R.prev=C,C.next.prev=R,C.next=R):(R.prev=R,R.next=R),R}function Ct(m){m.next.prev=m.prev,m.prev.next=m.next,m.prevZ&&(m.prevZ.nextZ=m.nextZ),m.nextZ&&(m.nextZ.prevZ=m.prevZ)}function Kt(m,b,v){this.i=m,this.x=b,this.y=v,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Vt(m,b,v,C){for(var R=0,y=b,w=v-C;y<v;y+=C)R+=(m[w]-m[y])*(m[y+1]+m[w+1]),w=y;return R}Wt.exports=dt,Wt.exports.default=dt,dt.deviation=function(m,b,v,C){var R=b&&b.length,w=Math.abs(Vt(m,0,R?b[0]*v:m.length,v));if(R)for(var D=0,Y=b.length;D<Y;D++)w-=Math.abs(Vt(m,b[D]*v,D<Y-1?b[D+1]*v:m.length,v));var G=0;for(D=0;D<C.length;D+=3){var Z=C[D]*v,ut=C[D+1]*v,nt=C[D+2]*v;G+=Math.abs((m[Z]-m[nt])*(m[ut+1]-m[Z+1])-(m[Z]-m[ut])*(m[nt+1]-m[Z+1]))}return 0===w&&0===G?0:Math.abs((G-w)/w)},dt.flatten=function(m){for(var b=m[0][0].length,v={vertices:[],holes:[],dimensions:b},C=0,R=0;R<m.length;R++){for(var y=0;y<m[R].length;y++)for(var w=0;w<b;w++)v.vertices.push(m[R][y][w]);R>0&&v.holes.push(C+=m[R-1].length)}return v}},2005:Wt=>{"use strict";var dt=Object.prototype.hasOwnProperty,B="~";function q(){}function Lt(L,et,it){this.fn=L,this.context=et,this.once=it||!1}function h(L,et,it,rt,z){if("function"!=typeof it)throw new TypeError("The listener must be a function");var pt=new Lt(it,rt||L,z),P=B?B+et:et;return L._events[P]?L._events[P].fn?L._events[P]=[L._events[P],pt]:L._events[P].push(pt):(L._events[P]=pt,L._eventsCount++),L}function mt(L,et){0==--L._eventsCount?L._events=new q:delete L._events[et]}function X(){this._events=new q,this._eventsCount=0}Object.create&&(q.prototype=Object.create(null),(new q).__proto__||(B=!1)),X.prototype.eventNames=function(){var it,rt,et=[];if(0===this._eventsCount)return et;for(rt in it=this._events)dt.call(it,rt)&&et.push(B?rt.slice(1):rt);return Object.getOwnPropertySymbols?et.concat(Object.getOwnPropertySymbols(it)):et},X.prototype.listeners=function(et){var rt=this._events[B?B+et:et];if(!rt)return[];if(rt.fn)return[rt.fn];for(var z=0,pt=rt.length,P=new Array(pt);z<pt;z++)P[z]=rt[z].fn;return P},X.prototype.listenerCount=function(et){var rt=this._events[B?B+et:et];return rt?rt.fn?1:rt.length:0},X.prototype.emit=function(et,it,rt,z,pt,P){var Et=B?B+et:et;if(!this._events[Et])return!1;var At,gt,F=this._events[Et],qt=arguments.length;if(F.fn){switch(F.once&&this.removeListener(et,F.fn,void 0,!0),qt){case 1:return F.fn.call(F.context),!0;case 2:return F.fn.call(F.context,it),!0;case 3:return F.fn.call(F.context,it,rt),!0;case 4:return F.fn.call(F.context,it,rt,z),!0;case 5:return F.fn.call(F.context,it,rt,z,pt),!0;case 6:return F.fn.call(F.context,it,rt,z,pt,P),!0}for(gt=1,At=new Array(qt-1);gt<qt;gt++)At[gt-1]=arguments[gt];F.fn.apply(F.context,At)}else{var Rt,ht=F.length;for(gt=0;gt<ht;gt++)switch(F[gt].once&&this.removeListener(et,F[gt].fn,void 0,!0),qt){case 1:F[gt].fn.call(F[gt].context);break;case 2:F[gt].fn.call(F[gt].context,it);break;case 3:F[gt].fn.call(F[gt].context,it,rt);break;case 4:F[gt].fn.call(F[gt].context,it,rt,z);break;default:if(!At)for(Rt=1,At=new Array(qt-1);Rt<qt;Rt++)At[Rt-1]=arguments[Rt];F[gt].fn.apply(F[gt].context,At)}}return!0},X.prototype.on=function(et,it,rt){return h(this,et,it,rt,!1)},X.prototype.once=function(et,it,rt){return h(this,et,it,rt,!0)},X.prototype.removeListener=function(et,it,rt,z){var pt=B?B+et:et;if(!this._events[pt])return this;if(!it)return mt(this,pt),this;var P=this._events[pt];if(P.fn)P.fn===it&&(!z||P.once)&&(!rt||P.context===rt)&&mt(this,pt);else{for(var Et=0,F=[],qt=P.length;Et<qt;Et++)(P[Et].fn!==it||z&&!P[Et].once||rt&&P[Et].context!==rt)&&F.push(P[Et]);F.length?this._events[pt]=1===F.length?F[0]:F:mt(this,pt)}return this},X.prototype.removeAllListeners=function(et){var it;return et?this._events[it=B?B+et:et]&&mt(this,it):(this._events=new q,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=B,X.EventEmitter=X,Wt.exports=X},516:Wt=>{"use strict";function dt(B,q){return Object.prototype.hasOwnProperty.call(B,q)}Wt.exports=function(B,q,Lt,h){Lt=Lt||"=";var mt={};if("string"!=typeof B||0===B.length)return mt;var X=/\+/g;B=B.split(q=q||"&");var L=1e3;h&&"number"==typeof h.maxKeys&&(L=h.maxKeys);var et=B.length;L>0&&et>L&&(et=L);for(var it=0;it<et;++it){var pt,P,Et,F,rt=B[it].replace(X,"%20"),z=rt.indexOf(Lt);z>=0?(pt=rt.substr(0,z),P=rt.substr(z+1)):(pt=rt,P=""),Et=decodeURIComponent(pt),F=decodeURIComponent(P),dt(mt,Et)?Array.isArray(mt[Et])?mt[Et].push(F):mt[Et]=[mt[Et],F]:mt[Et]=F}return mt}},5776:Wt=>{"use strict";var dt=function(B){switch(typeof B){case"string":return B;case"boolean":return B?"true":"false";case"number":return isFinite(B)?B:"";default:return""}};Wt.exports=function(B,q,Lt,h){return q=q||"&",Lt=Lt||"=",null===B&&(B=void 0),"object"==typeof B?Object.keys(B).map(function(mt){var X=encodeURIComponent(dt(mt))+Lt;return Array.isArray(B[mt])?B[mt].map(function(L){return X+encodeURIComponent(dt(L))}).join(q):X+encodeURIComponent(dt(B[mt]))}).join(q):h?encodeURIComponent(dt(h))+Lt+encodeURIComponent(dt(B)):""}},7137:(Wt,dt,B)=>{"use strict";dt.decode=dt.parse=B(516),dt.encode=dt.stringify=B(5776)},1308:function(Wt,dt,B){var q;Wt=B.nmd(Wt),function(Lt){"object"==typeof global&&global;var L,et=2147483647,At=/^xn--/,gt=/[^\x20-\x7E]/,ht=/[\x2E\u3002\uFF0E\uFF61]/g,Rt={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},jt=Math.floor,Ot=String.fromCharCode;function A(y){throw RangeError(Rt[y])}function st(y,w){for(var D=y.length,Y=[];D--;)Y[D]=w(y[D]);return Y}function S(y,w){var D=y.split("@"),Y="";return D.length>1&&(Y=D[0]+"@",y=D[1]),Y+st((y=y.replace(ht,".")).split("."),w).join(".")}function Xt(y){for(var U,ot,w=[],D=0,Y=y.length;D<Y;)(U=y.charCodeAt(D++))>=55296&&U<=56319&&D<Y?56320==(64512&(ot=y.charCodeAt(D++)))?w.push(((1023&U)<<10)+(1023&ot)+65536):(w.push(U),D--):w.push(U);return w}function Ct(y){return st(y,function(w){var D="";return w>65535&&(D+=Ot((w-=65536)>>>10&1023|55296),w=56320|1023&w),D+Ot(w)}).join("")}function Kt(y){return y-48<10?y-22:y-65<26?y-65:y-97<26?y-97:36}function Vt(y,w){return y+22+75*(y<26)-((0!=w)<<5)}function m(y,w,D){var Y=0;for(y=D?jt(y/700):y>>1,y+=jt(y/w);y>455;Y+=36)y=jt(y/35);return jt(Y+36*y/(y+38))}function b(y){var Y,Z,ut,nt,vt,It,Dt,O,I,at,w=[],D=y.length,U=0,ot=128,G=72;for((Z=y.lastIndexOf("-"))<0&&(Z=0),ut=0;ut<Z;++ut)y.charCodeAt(ut)>=128&&A("not-basic"),w.push(y.charCodeAt(ut));for(nt=Z>0?Z+1:0;nt<D;){for(vt=U,It=1,Dt=36;nt>=D&&A("invalid-input"),((O=Kt(y.charCodeAt(nt++)))>=36||O>jt((et-U)/It))&&A("overflow"),U+=O*It,!(O<(I=Dt<=G?1:Dt>=G+26?26:Dt-G));Dt+=36)It>jt(et/(at=36-I))&&A("overflow"),It*=at;G=m(U-vt,Y=w.length+1,0==vt),jt(U/Y)>et-ot&&A("overflow"),ot+=jt(U/Y),U%=Y,w.splice(U++,0,ot)}return Ct(w)}function v(y){var w,D,Y,U,ot,G,Z,ut,nt,vt,It,O,I,at,Be,Dt=[];for(O=(y=Xt(y)).length,w=128,D=0,ot=72,G=0;G<O;++G)(It=y[G])<128&&Dt.push(Ot(It));for(Y=U=Dt.length,U&&Dt.push("-");Y<O;){for(Z=et,G=0;G<O;++G)(It=y[G])>=w&&It<Z&&(Z=It);for(Z-w>jt((et-D)/(I=Y+1))&&A("overflow"),D+=(Z-w)*I,w=Z,G=0;G<O;++G)if((It=y[G])<w&&++D>et&&A("overflow"),It==w){for(ut=D,nt=36;!(ut<(vt=nt<=ot?1:nt>=ot+26?26:nt-ot));nt+=36)Dt.push(Ot(Vt(vt+(Be=ut-vt)%(at=36-vt),0))),ut=jt(Be/at);Dt.push(Ot(Vt(ut,0))),ot=m(D,I,Y==U),D=0,++Y}++D,++w}return Dt.join("")}L={version:"1.3.2",ucs2:{decode:Xt,encode:Ct},decode:b,encode:v,toASCII:function R(y){return S(y,function(w){return gt.test(w)?"xn--"+v(w):w})},toUnicode:function C(y){return S(y,function(w){return At.test(w)?b(w.slice(4).toLowerCase()):w})}},void 0!==(q=function(){return L}.call(dt,B,dt,Wt))&&(Wt.exports=q)}()},8762:(Wt,dt,B)=>{"use strict";var Lt=B(1308),h=B(796);function mt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}dt.Qc=Nt,dt.DB=function Ot(A,st){return Nt(A,!1,!0).resolve(st)},dt.WU=function jt(A){return h.isString(A)&&(A=Nt(A)),A instanceof mt?A.format():mt.prototype.format.call(A)};var X=/^([a-z0-9.+-]+:)/i,L=/:[0-9]*$/,et=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,rt=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),z=["'"].concat(rt),pt=["%","/","?",";","#"].concat(z),P=["/","?","#"],F=/^[+a-z0-9A-Z_-]{0,63}$/,qt=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,At={javascript:!0,"javascript:":!0},gt={javascript:!0,"javascript:":!0},ht={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Rt=B(7137);function Nt(A,st,S){if(A&&h.isObject(A)&&A instanceof mt)return A;var Xt=new mt;return Xt.parse(A,st,S),Xt}mt.prototype.parse=function(A,st,S){if(!h.isString(A))throw new TypeError("Parameter 'url' must be a string, not "+typeof A);var Xt=A.indexOf("?"),Ct=-1!==Xt&&Xt<A.indexOf("#")?"?":"#",Kt=A.split(Ct);Kt[0]=Kt[0].replace(/\\/g,"/");var m=A=Kt.join(Ct);if(m=m.trim(),!S&&1===A.split("#").length){var b=et.exec(m);if(b)return this.path=m,this.href=m,this.pathname=b[1],b[2]?(this.search=b[2],this.query=st?Rt.parse(this.search.substr(1)):this.search.substr(1)):st&&(this.search="",this.query={}),this}var v=X.exec(m);if(v){var C=(v=v[0]).toLowerCase();this.protocol=C,m=m.substr(v.length)}if(S||v||m.match(/^\/\/[^@\/]+@[^@\/]+/)){var R="//"===m.substr(0,2);R&&(!v||!gt[v])&&(m=m.substr(2),this.slashes=!0)}if(!gt[v]&&(R||v&&!ht[v])){for(var y=-1,w=0;w<P.length;w++)-1!==(D=m.indexOf(P[w]))&&(-1===y||D<y)&&(y=D);var Y,U;for(-1!==(U=-1===y?m.lastIndexOf("@"):m.lastIndexOf("@",y))&&(Y=m.slice(0,U),m=m.slice(U+1),this.auth=decodeURIComponent(Y)),y=-1,w=0;w<pt.length;w++){var D;-1!==(D=m.indexOf(pt[w]))&&(-1===y||D<y)&&(y=D)}-1===y&&(y=m.length),this.host=m.slice(0,y),m=m.slice(y),this.parseHost(),this.hostname=this.hostname||"";var ot="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ot)for(var G=this.hostname.split(/\./),Z=(w=0,G.length);w<Z;w++){var ut=G[w];if(ut&&!ut.match(F)){for(var nt="",vt=0,It=ut.length;vt<It;vt++)ut.charCodeAt(vt)>127?nt+="x":nt+=ut[vt];if(!nt.match(F)){var Dt=G.slice(0,w),O=G.slice(w+1),I=ut.match(qt);I&&(Dt.push(I[1]),O.unshift(I[2])),O.length&&(m="/"+O.join(".")+m),this.hostname=Dt.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),ot||(this.hostname=Lt.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,ot&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==m[0]&&(m="/"+m))}if(!At[C])for(w=0,Z=z.length;w<Z;w++){var K=z[w];if(-1!==m.indexOf(K)){var Fe=encodeURIComponent(K);Fe===K&&(Fe=escape(K)),m=m.split(K).join(Fe)}}var Ti=m.indexOf("#");-1!==Ti&&(this.hash=m.substr(Ti),m=m.slice(0,Ti));var ai=m.indexOf("?");return-1!==ai?(this.search=m.substr(ai),this.query=m.substr(ai+1),st&&(this.query=Rt.parse(this.query)),m=m.slice(0,ai)):st&&(this.search="",this.query={}),m&&(this.pathname=m),ht[C]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},mt.prototype.format=function(){var A=this.auth||"";A&&(A=(A=encodeURIComponent(A)).replace(/%3A/i,":"),A+="@");var st=this.protocol||"",S=this.pathname||"",Xt=this.hash||"",Ct=!1,Kt="";this.host?Ct=A+this.host:this.hostname&&(Ct=A+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(Ct+=":"+this.port)),this.query&&h.isObject(this.query)&&Object.keys(this.query).length&&(Kt=Rt.stringify(this.query));var Vt=this.search||Kt&&"?"+Kt||"";return st&&":"!==st.substr(-1)&&(st+=":"),this.slashes||(!st||ht[st])&&!1!==Ct?(Ct="//"+(Ct||""),S&&"/"!==S.charAt(0)&&(S="/"+S)):Ct||(Ct=""),Xt&&"#"!==Xt.charAt(0)&&(Xt="#"+Xt),Vt&&"?"!==Vt.charAt(0)&&(Vt="?"+Vt),st+Ct+(S=S.replace(/[?#]/g,function(m){return encodeURIComponent(m)}))+(Vt=Vt.replace("#","%23"))+Xt},mt.prototype.resolve=function(A){return this.resolveObject(Nt(A,!1,!0)).format()},mt.prototype.resolveObject=function(A){if(h.isString(A)){var st=new mt;st.parse(A,!1,!0),A=st}for(var S=new mt,Xt=Object.keys(this),Ct=0;Ct<Xt.length;Ct++){var Kt=Xt[Ct];S[Kt]=this[Kt]}if(S.hash=A.hash,""===A.href)return S.href=S.format(),S;if(A.slashes&&!A.protocol){for(var Vt=Object.keys(A),m=0;m<Vt.length;m++){var b=Vt[m];"protocol"!==b&&(S[b]=A[b])}return ht[S.protocol]&&S.hostname&&!S.pathname&&(S.path=S.pathname="/"),S.href=S.format(),S}if(A.protocol&&A.protocol!==S.protocol){if(!ht[A.protocol]){for(var v=Object.keys(A),C=0;C<v.length;C++){var R=v[C];S[R]=A[R]}return S.href=S.format(),S}if(S.protocol=A.protocol,A.host||gt[A.protocol])S.pathname=A.pathname;else{for(var Z=(A.pathname||"").split("/");Z.length&&!(A.host=Z.shift()););A.host||(A.host=""),A.hostname||(A.hostname=""),""!==Z[0]&&Z.unshift(""),Z.length<2&&Z.unshift(""),S.pathname=Z.join("/")}return S.search=A.search,S.query=A.query,S.host=A.host||"",S.auth=A.auth,S.hostname=A.hostname||A.host,S.port=A.port,(S.pathname||S.search)&&(S.path=(S.pathname||"")+(S.search||"")),S.slashes=S.slashes||A.slashes,S.href=S.format(),S}var D=S.pathname&&"/"===S.pathname.charAt(0),Y=A.host||A.pathname&&"/"===A.pathname.charAt(0),U=Y||D||S.host&&A.pathname,ot=U,G=S.pathname&&S.pathname.split("/")||[],ut=(Z=A.pathname&&A.pathname.split("/")||[],S.protocol&&!ht[S.protocol]);if(ut&&(S.hostname="",S.port=null,S.host&&(""===G[0]?G[0]=S.host:G.unshift(S.host)),S.host="",A.protocol&&(A.hostname=null,A.port=null,A.host&&(""===Z[0]?Z[0]=A.host:Z.unshift(A.host)),A.host=null),U=U&&(""===Z[0]||""===G[0])),Y)S.host=A.host||""===A.host?A.host:S.host,S.hostname=A.hostname||""===A.hostname?A.hostname:S.hostname,S.search=A.search,S.query=A.query,G=Z;else if(Z.length)G||(G=[]),G.pop(),G=G.concat(Z),S.search=A.search,S.query=A.query;else if(!h.isNullOrUndefined(A.search))return ut&&(S.hostname=S.host=G.shift(),(nt=!!(S.host&&S.host.indexOf("@")>0)&&S.host.split("@"))&&(S.auth=nt.shift(),S.host=S.hostname=nt.shift())),S.search=A.search,S.query=A.query,(!h.isNull(S.pathname)||!h.isNull(S.search))&&(S.path=(S.pathname?S.pathname:"")+(S.search?S.search:"")),S.href=S.format(),S;if(!G.length)return S.pathname=null,S.path=S.search?"/"+S.search:null,S.href=S.format(),S;for(var vt=G.slice(-1)[0],It=(S.host||A.host||G.length>1)&&("."===vt||".."===vt)||""===vt,Dt=0,O=G.length;O>=0;O--)"."===(vt=G[O])?G.splice(O,1):".."===vt?(G.splice(O,1),Dt++):Dt&&(G.splice(O,1),Dt--);if(!U&&!ot)for(;Dt--;Dt)G.unshift("..");U&&""!==G[0]&&(!G[0]||"/"!==G[0].charAt(0))&&G.unshift(""),It&&"/"!==G.join("/").substr(-1)&&G.push("");var nt,I=""===G[0]||G[0]&&"/"===G[0].charAt(0);return ut&&(S.hostname=S.host=I?"":G.length?G.shift():"",(nt=!!(S.host&&S.host.indexOf("@")>0)&&S.host.split("@"))&&(S.auth=nt.shift(),S.host=S.hostname=nt.shift())),(U=U||S.host&&G.length)&&!I&&G.unshift(""),G.length?S.pathname=G.join("/"):(S.pathname=null,S.path=null),(!h.isNull(S.pathname)||!h.isNull(S.search))&&(S.path=(S.pathname?S.pathname:"")+(S.search?S.search:"")),S.auth=A.auth||S.auth,S.slashes=S.slashes||A.slashes,S.href=S.format(),S},mt.prototype.parseHost=function(){var A=this.host,st=L.exec(A);st&&(":"!==(st=st[0])&&(this.port=st.substr(1)),A=A.substr(0,A.length-st.length)),A&&(this.hostname=A)}},796:Wt=>{"use strict";Wt.exports={isString:function(dt){return"string"==typeof dt},isObject:function(dt){return"object"==typeof dt&&null!==dt},isNull:function(dt){return null===dt},isNullOrUndefined:function(dt){return null==dt}}}}]);