(self.webpackChunkclient=self.webpackChunkclient||[]).push([[867],{4867:(ci,me,ot)=>{"use strict";ot.r(me),ot.d(me,{TooltipOptions:()=>g0,WarehouseModule:()=>UP});var ee=ot(6895),ni=ot(1669),_=ot(4650),pt=ot(4006),ye=ot(4004),xe=ot(3151),Jt=ot(262),Xt=ot(9646),he=ot(4128),Pe=ot(9751),Et=ot(5861);const N=100,Hi=1001,mi=1003,gi=1006,Us=1008,ks=1009,Gs=1014,_s=1015,Ia=1016,Cr=1020,pn=1023,zs=1026,Rr=1027,Hs=3e3,Qe=3001,Un="srgb",Pa="srgb-linear";class Ws{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const s=this._listeners[t];if(void 0!==s){const r=s.indexOf(e);-1!==r&&s.splice(r,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const i=this._listeners[t.type];if(void 0!==i){t.target=this;const s=i.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,t);t.target=null}}}const ki=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Xs=Math.PI/180,Da=180/Math.PI;function nn(){const n=4294967295*Math.random()|0,t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ki[255&n]+ki[n>>8&255]+ki[n>>16&255]+ki[n>>24&255]+"-"+ki[255&t]+ki[t>>8&255]+"-"+ki[t>>16&15|64]+ki[t>>24&255]+"-"+ki[63&e|128]+ki[e>>8&255]+"-"+ki[e>>16&255]+ki[e>>24&255]+ki[255&i]+ki[i>>8&255]+ki[i>>16&255]+ki[i>>24&255]).toLowerCase()}function di(n,t,e){return Math.max(t,Math.min(e,n))}function La(n,t,e){return(1-e)*n+e*t}function Kh(n){return 0==(n&n-1)&&0!==n}function Uo(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Qn(n,t){switch(t.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Je(n,t){switch(t.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}class dt{constructor(t=0,e=0){dt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*s+t.x,this.y=r*s+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ji{constructor(){ji.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,s,r,a,o,l,h){const c=this.elements;return c[0]=t,c[1]=s,c[2]=o,c[3]=e,c[4]=r,c[5]=l,c[6]=i,c[7]=a,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,a=i[0],o=i[3],l=i[6],h=i[1],c=i[4],u=i[7],d=i[2],f=i[5],p=i[8],m=s[0],g=s[3],x=s[6],v=s[1],y=s[4],b=s[7],M=s[2],S=s[5],A=s[8];return r[0]=a*m+o*v+l*M,r[3]=a*g+o*y+l*S,r[6]=a*x+o*b+l*A,r[1]=h*m+c*v+u*M,r[4]=h*g+c*y+u*S,r[7]=h*x+c*b+u*A,r[2]=d*m+f*v+p*M,r[5]=d*g+f*y+p*S,r[8]=d*x+f*b+p*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8];return e*a*c-e*o*h-i*r*c+i*o*l+s*r*h-s*a*l}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=c*a-o*h,d=o*l-c*r,f=h*r-a*l,p=e*u+i*d+s*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=u*m,t[1]=(s*h-c*i)*m,t[2]=(o*i-s*a)*m,t[3]=d*m,t[4]=(c*e-s*l)*m,t[5]=(s*r-o*e)*m,t[6]=f*m,t[7]=(i*l-h*e)*m,t[8]=(a*e-i*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,a,o){const l=Math.cos(r),h=Math.sin(r);return this.set(i*l,i*h,-i*(l*a+h*o)+a+t,-s*h,s*l,-s*(-h*a+l*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Qh.makeScale(t,e)),this}rotate(t){return this.premultiply(Qh.makeRotation(-t)),this}translate(t,e){return this.premultiply(Qh.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Qh=new ji;function vf(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Oa(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Ys(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function ko(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const tc={[Un]:{[Pa]:Ys},[Pa]:{[Un]:ko}},Vi={legacyMode:!0,get workingColorSpace(){return Pa},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,t,e){if(this.legacyMode||t===e||!t||!e)return n;if(tc[t]&&void 0!==tc[t][e]){const i=tc[t][e];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,t){return this.convert(n,this.workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this.workingColorSpace)}},bf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mi={r:0,g:0,b:0},wn={h:0,s:0,l:0},Go={h:0,s:0,l:0};function ec(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+6*(t-n)*e:e<.5?t:e<2/3?n+6*(t-n)*(2/3-e):n}function zo(n,t){return t.r=n.r,t.g=n.g,t.b=n.b,t}let Lr,kt=(()=>{class n{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===i&&void 0===s?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Un){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Vi.toWorkingColorSpace(this,i),this}setRGB(e,i,s,r=Vi.workingColorSpace){return this.r=e,this.g=i,this.b=s,Vi.toWorkingColorSpace(this,r),this}setHSL(e,i,s,r=Vi.workingColorSpace){if(e=function Jh(n,t){return(n%t+t)%t}(e,1),i=di(i,0,1),s=di(s,0,1),0===i)this.r=this.g=this.b=s;else{const a=s<=.5?s*(1+i):s+i-s*i,o=2*s-a;this.r=ec(o,a,e+1/3),this.g=ec(o,a,e),this.b=ec(o,a,e-1/3)}return Vi.toWorkingColorSpace(this,r),this}setStyle(e,i=Un){function s(a){void 0!==a&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let a;const l=r[2];switch(r[1]){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,Vi.toWorkingColorSpace(this,i),s(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,Vi.toWorkingColorSpace(this,i),s(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const h=parseFloat(a[1])/360,c=parseFloat(a[2])/100,u=parseFloat(a[3])/100;return s(a[4]),this.setHSL(h,c,u,i)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=r[1],o=a.length;if(3===o)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,Vi.toWorkingColorSpace(this,i),this;if(6===o)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,Vi.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i=Un){const s=bf[e.toLowerCase()];return void 0!==s?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ys(e.r),this.g=Ys(e.g),this.b=Ys(e.b),this}copyLinearToSRGB(e){return this.r=ko(e.r),this.g=ko(e.g),this.b=ko(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Un){return Vi.fromWorkingColorSpace(zo(this,Mi),e),di(255*Mi.r,0,255)<<16^di(255*Mi.g,0,255)<<8^di(255*Mi.b,0,255)<<0}getHexString(e=Un){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Vi.workingColorSpace){Vi.fromWorkingColorSpace(zo(this,Mi),i);const s=Mi.r,r=Mi.g,a=Mi.b,o=Math.max(s,r,a),l=Math.min(s,r,a);let h,c;const u=(l+o)/2;if(l===o)h=0,c=0;else{const d=o-l;switch(c=u<=.5?d/(o+l):d/(2-o-l),o){case s:h=(r-a)/d+(r<a?6:0);break;case r:h=(a-s)/d+2;break;case a:h=(s-r)/d+4}h/=6}return e.h=h,e.s=c,e.l=u,e}getRGB(e,i=Vi.workingColorSpace){return Vi.fromWorkingColorSpace(zo(this,Mi),i),e.r=Mi.r,e.g=Mi.g,e.b=Mi.b,e}getStyle(e=Un){return Vi.fromWorkingColorSpace(zo(this,Mi),e),e!==Un?`color(${e} ${Mi.r} ${Mi.g} ${Mi.b})`:`rgb(${255*Mi.r|0},${255*Mi.g|0},${255*Mi.b|0})`}offsetHSL(e,i,s){return this.getHSL(wn),wn.h+=e,wn.s+=i,wn.l+=s,this.setHSL(wn.h,wn.s,wn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(wn),e.getHSL(Go);const s=La(wn.h,Go.h,i),r=La(wn.s,Go.s,i),a=La(wn.l,Go.l,i);return this.setHSL(s,r,a),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}return n.NAMES=bf,n})();class wf{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Lr&&(Lr=Oa("canvas")),Lr.width=t.width,Lr.height=t.height;const i=Lr.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Lr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Oa("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=255*Ys(r[a]/255);return i.putImageData(s,0,0),e}if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e[i]=e instanceof Uint8Array||e instanceof Uint8ClampedArray?Math.floor(255*Ys(e[i]/255)):Ys(e[i]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Or{constructor(t=null){this.isSource=!0,this.uuid=nn(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(null!==s){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)r.push(ic(s[a].isDataTexture?s[a].image:s[a]))}else r=ic(s);i.url=r}return e||(t.images[this.uuid]=i),i}}function ic(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?wf.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let hy=0,Mn=(()=>{class n extends Ws{constructor(e=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,s=Hi,r=Hi,a=gi,o=Us,l=pn,h=ks,c=n.DEFAULT_ANISOTROPY,u=Hs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hy++}),this.uuid=nn(),this.name="",this.source=new Or(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=r,this.magFilter=a,this.minFilter=o,this.anisotropy=c,this.format=l,this.internalFormat=null,this.type=h,this.offset=new dt(0,0),this.repeat=new dt(1,1),this.center=new dt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ji,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case Hi:e.x=e.x<0?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case Hi:e.y=e.y<0?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class Ze{constructor(t=0,e=0,i=0,s=1){Ze.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*s+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*s+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*s+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,r;const l=t.elements,h=l[0],c=l[4],u=l[8],d=l[1],f=l[5],p=l[9],m=l[2],g=l[6],x=l[10];if(Math.abs(c-d)<.01&&Math.abs(u-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(u+m)<.1&&Math.abs(p+g)<.1&&Math.abs(h+f+x-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const y=(h+1)/2,b=(f+1)/2,M=(x+1)/2,S=(c+d)/4,A=(u+m)/4,w=(p+g)/4;return y>b&&y>M?y<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(y),s=S/i,r=A/i):b>M?b<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(b),i=S/s,r=w/s):M<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(M),i=A/r,s=w/r),this.set(i,s,r,e),this}let v=Math.sqrt((g-p)*(g-p)+(u-m)*(u-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(g-p)/v,this.y=(u-m)/v,this.z=(d-c)/v,this.w=Math.acos((h+f+x-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Zs extends Ws{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Ze(0,0,t,e),this.scissorTest=!1,this.viewport=new Ze(0,0,t,e),this.texture=new Mn({width:t,height:e,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:gi,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Or(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class nc extends Mn{constructor(t=null,e=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=mi,this.minFilter=mi,this.wrapR=Hi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Mf extends Mn{constructor(t=null,e=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=mi,this.minFilter=mi,this.wrapR=Hi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Wi{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,a,o){let l=i[s+0],h=i[s+1],c=i[s+2],u=i[s+3];const d=r[a+0],f=r[a+1],p=r[a+2],m=r[a+3];if(0===o)return t[e+0]=l,t[e+1]=h,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=d,t[e+1]=f,t[e+2]=p,void(t[e+3]=m);if(u!==m||l!==d||h!==f||c!==p){let g=1-o;const x=l*d+h*f+c*p+u*m,v=x>=0?1:-1,y=1-x*x;if(y>Number.EPSILON){const M=Math.sqrt(y),S=Math.atan2(M,x*v);g=Math.sin(g*S)/M,o=Math.sin(o*S)/M}const b=o*v;if(l=l*g+d*b,h=h*g+f*b,c=c*g+p*b,u=u*g+m*b,g===1-o){const M=1/Math.sqrt(l*l+h*h+c*c+u*u);l*=M,h*=M,c*=M,u*=M}}t[e]=l,t[e+1]=h,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,s,r,a){const o=i[s],l=i[s+1],h=i[s+2],c=i[s+3],u=r[a],d=r[a+1],f=r[a+2],p=r[a+3];return t[e]=o*p+c*u+l*f-h*d,t[e+1]=l*p+c*d+h*u-o*f,t[e+2]=h*p+c*f+o*d-l*u,t[e+3]=c*p-o*u-l*d-h*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,s=t._y,r=t._z,a=t._order,o=Math.cos,l=Math.sin,h=o(i/2),c=o(s/2),u=o(r/2),d=l(i/2),f=l(s/2),p=l(r/2);switch(a){case"XYZ":this._x=d*c*u+h*f*p,this._y=h*f*u-d*c*p,this._z=h*c*p+d*f*u,this._w=h*c*u-d*f*p;break;case"YXZ":this._x=d*c*u+h*f*p,this._y=h*f*u-d*c*p,this._z=h*c*p-d*f*u,this._w=h*c*u+d*f*p;break;case"ZXY":this._x=d*c*u-h*f*p,this._y=h*f*u+d*c*p,this._z=h*c*p+d*f*u,this._w=h*c*u-d*f*p;break;case"ZYX":this._x=d*c*u-h*f*p,this._y=h*f*u+d*c*p,this._z=h*c*p-d*f*u,this._w=h*c*u+d*f*p;break;case"YZX":this._x=d*c*u+h*f*p,this._y=h*f*u+d*c*p,this._z=h*c*p-d*f*u,this._w=h*c*u-d*f*p;break;case"XZY":this._x=d*c*u-h*f*p,this._y=h*f*u-d*c*p,this._z=h*c*p+d*f*u,this._w=h*c*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],a=e[1],o=e[5],l=e[9],h=e[2],c=e[6],u=e[10],d=i+o+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(r-h)*f,this._z=(a-s)*f}else if(i>o&&i>u){const f=2*Math.sqrt(1+i-o-u);this._w=(c-l)/f,this._x=.25*f,this._y=(s+a)/f,this._z=(r+h)/f}else if(o>u){const f=2*Math.sqrt(1+o-i-u);this._w=(r-h)/f,this._x=(s+a)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+u-i-o);this._w=(a-s)/f,this._x=(r+h)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(di(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,a=t._w,o=e._x,l=e._y,h=e._z,c=e._w;return this._x=i*c+a*o+s*h-r*l,this._y=s*c+a*l+r*o-i*h,this._z=r*c+a*h+i*l-s*o,this._w=a*c-i*o-s*l-r*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,r=this._z,a=this._w;let o=a*t._w+i*t._x+s*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=s,this._z=r,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-e;return this._w=f*a+e*this._w,this._x=f*i+e*this._x,this._y=f*s+e*this._y,this._z=f*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),c=Math.atan2(h,o),u=Math.sin((1-e)*c)/h,d=Math.sin(e*c)/h;return this._w=a*u+this._w*d,this._x=i*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class I{constructor(t=0,e=0,i=0){I.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Sf.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Sf.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,a=t.y,o=t.z,l=t.w,h=l*e+a*s-o*i,c=l*i+o*e-r*s,u=l*s+r*i-a*e,d=-r*e-a*i-o*s;return this.x=h*l+d*-r+c*-o-u*-a,this.y=c*l+d*-a+u*-r-h*-o,this.z=u*l+d*-o+h*-a-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,a=e.x,o=e.y,l=e.z;return this.x=s*l-r*o,this.y=r*a-i*l,this.z=i*o-s*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return sc.copy(this).projectOnVector(t),this.sub(sc)}reflect(t){return this.sub(sc.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(di(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const sc=new I,Sf=new Wi;class Br{constructor(t=new I(1/0,1/0,1/0),e=new I(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,s=1/0,r=-1/0,a=-1/0,o=-1/0;for(let l=0,h=t.length;l<h;l+=3){const c=t[l],u=t[l+1],d=t[l+2];c<e&&(e=c),u<i&&(i=u),d<s&&(s=d),c>r&&(r=c),u>a&&(a=u),d>o&&(o=d)}return this.min.set(e,i,s),this.max.set(r,a,o),this}setFromBufferAttribute(t){let e=1/0,i=1/0,s=1/0,r=-1/0,a=-1/0,o=-1/0;for(let l=0,h=t.count;l<h;l++){const c=t.getX(l),u=t.getY(l),d=t.getZ(l);c<e&&(e=c),u<i&&(i=u),d<s&&(s=d),c>r&&(r=c),u>a&&(a=u),d>o&&(o=d)}return this.min.set(e,i,s),this.max.set(r,a,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=$s.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const r=i.attributes.position;for(let a=0,o=r.count;a<o;a++)$s.fromBufferAttribute(r,a).applyMatrix4(t.matrixWorld),this.expandByPoint($s)}else null===i.boundingBox&&i.computeBoundingBox(),rc.copy(i.boundingBox),rc.applyMatrix4(t.matrixWorld),this.union(rc);const s=t.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,$s),$s.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ba),Ho.subVectors(this.max,Ba),Fr.subVectors(t.a,Ba),Nr.subVectors(t.b,Ba),Ur.subVectors(t.c,Ba),ys.subVectors(Nr,Fr),xs.subVectors(Ur,Nr),qs.subVectors(Fr,Ur);let e=[0,-ys.z,ys.y,0,-xs.z,xs.y,0,-qs.z,qs.y,ys.z,0,-ys.x,xs.z,0,-xs.x,qs.z,0,-qs.x,-ys.y,ys.x,0,-xs.y,xs.x,0,-qs.y,qs.x,0];return!(!ac(e,Fr,Nr,Ur,Ho)||(e=[1,0,0,0,1,0,0,0,1],!ac(e,Fr,Nr,Ur,Ho)))&&(Vo.crossVectors(ys,xs),e=[Vo.x,Vo.y,Vo.z],ac(e,Fr,Nr,Ur,Ho))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return $s.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize($s).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(ts[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ts[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ts[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ts[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ts[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ts[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ts[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ts[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ts)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ts=[new I,new I,new I,new I,new I,new I,new I,new I],$s=new I,rc=new Br,Fr=new I,Nr=new I,Ur=new I,ys=new I,xs=new I,qs=new I,Ba=new I,Ho=new I,Vo=new I,js=new I;function ac(n,t,e,i,s){for(let r=0,a=n.length-3;r<=a;r+=3){js.fromArray(n,r);const o=s.x*Math.abs(js.x)+s.y*Math.abs(js.y)+s.z*Math.abs(js.z),l=t.dot(js),h=e.dot(js),c=i.dot(js);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>o)return!1}return!0}const cy=new Br,Fa=new I,oc=new I;class kr{constructor(t=new I,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):cy.setFromPoints(t).getCenter(i);let s=0;for(let r=0,a=t.length;r<a;r++)s=Math.max(s,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Fa.subVectors(t,this.center);const e=Fa.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=.5*(i-this.radius);this.center.addScaledVector(Fa,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(oc.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Fa.copy(t.center).add(oc)),this.expandByPoint(Fa.copy(t.center).sub(oc))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const es=new I,lc=new I,Wo=new I,vs=new I,hc=new I,Xo=new I,cc=new I;class Yo{constructor(t=new I,e=new I(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,es)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=es.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(es.copy(this.direction).multiplyScalar(e).add(this.origin),es.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){lc.copy(t).add(e).multiplyScalar(.5),Wo.copy(e).sub(t).normalize(),vs.copy(this.origin).sub(lc);const r=.5*t.distanceTo(e),a=-this.direction.dot(Wo),o=vs.dot(this.direction),l=-vs.dot(Wo),h=vs.lengthSq(),c=Math.abs(1-a*a);let u,d,f,p;if(c>0)if(u=a*l-o,d=a*o-l,p=r*c,u>=0)if(d>=-p)if(d<=p){const m=1/c;u*=m,d*=m,f=u*(u+a*d+2*o)+d*(a*u+d+2*l)+h}else d=r,u=Math.max(0,-(a*d+o)),f=-u*u+d*(d+2*l)+h;else d=-r,u=Math.max(0,-(a*d+o)),f=-u*u+d*(d+2*l)+h;else d<=-p?(u=Math.max(0,-(-a*r+o)),d=u>0?-r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+h):d<=p?(u=0,d=Math.min(Math.max(-r,-l),r),f=d*(d+2*l)+h):(u=Math.max(0,-(a*r+o)),d=u>0?r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+h);else d=a>0?-r:r,u=Math.max(0,-(a*d+o)),f=-u*u+d*(d+2*l)+h;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),s&&s.copy(Wo).multiplyScalar(d).add(lc),f}intersectSphere(t,e){es.subVectors(t.center,this.origin);const i=es.dot(this.direction),s=es.dot(es)-i*i,r=t.radius*t.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=i-a,l=i+a;return o<0&&l<0?null:this.at(o<0?l:o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,r,a,o,l;const h=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return h>=0?(i=(t.min.x-d.x)*h,s=(t.max.x-d.x)*h):(i=(t.max.x-d.x)*h,s=(t.min.x-d.x)*h),c>=0?(r=(t.min.y-d.y)*c,a=(t.max.y-d.y)*c):(r=(t.max.y-d.y)*c,a=(t.min.y-d.y)*c),i>a||r>s||((r>i||isNaN(i))&&(i=r),(a<s||isNaN(s))&&(s=a),u>=0?(o=(t.min.z-d.z)*u,l=(t.max.z-d.z)*u):(o=(t.max.z-d.z)*u,l=(t.min.z-d.z)*u),i>l||o>s)||((o>i||i!=i)&&(i=o),(l<s||s!=s)&&(s=l),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return null!==this.intersectBox(t,es)}intersectTriangle(t,e,i,s,r){hc.subVectors(e,t),Xo.subVectors(i,t),cc.crossVectors(hc,Xo);let o,a=this.direction.dot(cc);if(a>0){if(s)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}vs.subVectors(this.origin,t);const l=o*this.direction.dot(Xo.crossVectors(vs,Xo));if(l<0)return null;const h=o*this.direction.dot(hc.cross(vs));if(h<0||l+h>a)return null;const c=-o*vs.dot(cc);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class _e{constructor(){_e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,s,r,a,o,l,h,c,u,d,f,p,m,g){const x=this.elements;return x[0]=t,x[4]=e,x[8]=i,x[12]=s,x[1]=r,x[5]=a,x[9]=o,x[13]=l,x[2]=h,x[6]=c,x[10]=u,x[14]=d,x[3]=f,x[7]=p,x[11]=m,x[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new _e).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/Gr.setFromMatrixColumn(t,0).length(),r=1/Gr.setFromMatrixColumn(t,1).length(),a=1/Gr.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,r=t.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(s),h=Math.sin(s),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const d=a*c,f=a*u,p=o*c,m=o*u;e[0]=l*c,e[4]=-l*u,e[8]=h,e[1]=f+p*h,e[5]=d-m*h,e[9]=-o*l,e[2]=m-d*h,e[6]=p+f*h,e[10]=a*l}else if("YXZ"===t.order){const d=l*c,f=l*u,p=h*c,m=h*u;e[0]=d+m*o,e[4]=p*o-f,e[8]=a*h,e[1]=a*u,e[5]=a*c,e[9]=-o,e[2]=f*o-p,e[6]=m+d*o,e[10]=a*l}else if("ZXY"===t.order){const d=l*c,f=l*u,p=h*c,m=h*u;e[0]=d-m*o,e[4]=-a*u,e[8]=p+f*o,e[1]=f+p*o,e[5]=a*c,e[9]=m-d*o,e[2]=-a*h,e[6]=o,e[10]=a*l}else if("ZYX"===t.order){const d=a*c,f=a*u,p=o*c,m=o*u;e[0]=l*c,e[4]=p*h-f,e[8]=d*h+m,e[1]=l*u,e[5]=m*h+d,e[9]=f*h-p,e[2]=-h,e[6]=o*l,e[10]=a*l}else if("YZX"===t.order){const d=a*l,f=a*h,p=o*l,m=o*h;e[0]=l*c,e[4]=m-d*u,e[8]=p*u+f,e[1]=u,e[5]=a*c,e[9]=-o*c,e[2]=-h*c,e[6]=f*u+p,e[10]=d-m*u}else if("XZY"===t.order){const d=a*l,f=a*h,p=o*l,m=o*h;e[0]=l*c,e[4]=-u,e[8]=h*c,e[1]=d*u+m,e[5]=a*c,e[9]=f*u-p,e[2]=p*u-f,e[6]=o*c,e[10]=m*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(uy,t,dy)}lookAt(t,e,i){const s=this.elements;return sn.subVectors(t,e),0===sn.lengthSq()&&(sn.z=1),sn.normalize(),bs.crossVectors(i,sn),0===bs.lengthSq()&&(1===Math.abs(i.z)?sn.x+=1e-4:sn.z+=1e-4,sn.normalize(),bs.crossVectors(i,sn)),bs.normalize(),Zo.crossVectors(sn,bs),s[0]=bs.x,s[4]=Zo.x,s[8]=sn.x,s[1]=bs.y,s[5]=Zo.y,s[9]=sn.y,s[2]=bs.z,s[6]=Zo.z,s[10]=sn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,a=i[0],o=i[4],l=i[8],h=i[12],c=i[1],u=i[5],d=i[9],f=i[13],p=i[2],m=i[6],g=i[10],x=i[14],v=i[3],y=i[7],b=i[11],M=i[15],S=s[0],A=s[4],w=s[8],T=s[12],C=s[1],F=s[5],Y=s[9],O=s[13],D=s[2],W=s[6],X=s[10],j=s[14],$=s[3],et=s[7],ft=s[11],K=s[15];return r[0]=a*S+o*C+l*D+h*$,r[4]=a*A+o*F+l*W+h*et,r[8]=a*w+o*Y+l*X+h*ft,r[12]=a*T+o*O+l*j+h*K,r[1]=c*S+u*C+d*D+f*$,r[5]=c*A+u*F+d*W+f*et,r[9]=c*w+u*Y+d*X+f*ft,r[13]=c*T+u*O+d*j+f*K,r[2]=p*S+m*C+g*D+x*$,r[6]=p*A+m*F+g*W+x*et,r[10]=p*w+m*Y+g*X+x*ft,r[14]=p*T+m*O+g*j+x*K,r[3]=v*S+y*C+b*D+M*$,r[7]=v*A+y*F+b*W+M*et,r[11]=v*w+y*Y+b*X+M*ft,r[15]=v*T+y*O+b*j+M*K,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],a=t[1],o=t[5],l=t[9],h=t[13],c=t[2],u=t[6],d=t[10],f=t[14];return t[3]*(+r*l*u-s*h*u-r*o*d+i*h*d+s*o*f-i*l*f)+t[7]*(+e*l*f-e*h*d+r*a*d-s*a*f+s*h*c-r*l*c)+t[11]*(+e*h*u-e*o*f-r*a*u+i*a*f+r*o*c-i*h*c)+t[15]*(-s*o*c-e*l*u+e*o*d+s*a*u-i*a*d+i*l*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],x=t[15],v=u*g*h-m*d*h+m*l*f-o*g*f-u*l*x+o*d*x,y=p*d*h-c*g*h-p*l*f+a*g*f+c*l*x-a*d*x,b=c*m*h-p*u*h+p*o*f-a*m*f-c*o*x+a*u*x,M=p*u*l-c*m*l-p*o*d+a*m*d+c*o*g-a*u*g,S=e*v+i*y+s*b+r*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/S;return t[0]=v*A,t[1]=(m*d*r-u*g*r-m*s*f+i*g*f+u*s*x-i*d*x)*A,t[2]=(o*g*r-m*l*r+m*s*h-i*g*h-o*s*x+i*l*x)*A,t[3]=(u*l*r-o*d*r-u*s*h+i*d*h+o*s*f-i*l*f)*A,t[4]=y*A,t[5]=(c*g*r-p*d*r+p*s*f-e*g*f-c*s*x+e*d*x)*A,t[6]=(p*l*r-a*g*r-p*s*h+e*g*h+a*s*x-e*l*x)*A,t[7]=(a*d*r-c*l*r+c*s*h-e*d*h-a*s*f+e*l*f)*A,t[8]=b*A,t[9]=(p*u*r-c*m*r-p*i*f+e*m*f+c*i*x-e*u*x)*A,t[10]=(a*m*r-p*o*r+p*i*h-e*m*h-a*i*x+e*o*x)*A,t[11]=(c*o*r-a*u*r-c*i*h+e*u*h+a*i*f-e*o*f)*A,t[12]=M*A,t[13]=(c*m*s-p*u*s+p*i*d-e*m*d-c*i*g+e*u*g)*A,t[14]=(p*o*s-a*m*s-p*i*l+e*m*l+a*i*g-e*o*g)*A,t[15]=(a*u*s-c*o*s+c*i*l-e*u*l-a*i*d+e*o*d)*A,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,a=t.x,o=t.y,l=t.z,h=r*a,c=r*o;return this.set(h*a+i,h*o-s*l,h*l+s*o,0,h*o+s*l,c*o+i,c*l-s*a,0,h*l-s*o,c*l+s*a,r*l*l+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,a){return this.set(1,i,r,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,a=e._y,o=e._z,l=e._w,h=r+r,c=a+a,u=o+o,d=r*h,f=r*c,p=r*u,m=a*c,g=a*u,x=o*u,v=l*h,y=l*c,b=l*u,M=i.x,S=i.y,A=i.z;return s[0]=(1-(m+x))*M,s[1]=(f+b)*M,s[2]=(p-y)*M,s[3]=0,s[4]=(f-b)*S,s[5]=(1-(d+x))*S,s[6]=(g+v)*S,s[7]=0,s[8]=(p+y)*A,s[9]=(g-v)*A,s[10]=(1-(d+m))*A,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=Gr.set(s[0],s[1],s[2]).length();const a=Gr.set(s[4],s[5],s[6]).length(),o=Gr.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],Sn.copy(this);const h=1/r,c=1/a,u=1/o;return Sn.elements[0]*=h,Sn.elements[1]*=h,Sn.elements[2]*=h,Sn.elements[4]*=c,Sn.elements[5]*=c,Sn.elements[6]*=c,Sn.elements[8]*=u,Sn.elements[9]*=u,Sn.elements[10]*=u,e.setFromRotationMatrix(Sn),i.x=r,i.y=a,i.z=o,this}makePerspective(t,e,i,s,r,a){const o=this.elements,h=2*r/(i-s),c=(e+t)/(e-t),u=(i+s)/(i-s),d=-(a+r)/(a-r),f=-2*a*r/(a-r);return o[0]=2*r/(e-t),o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,s,r,a){const o=this.elements,l=1/(e-t),h=1/(i-s),c=1/(a-r),u=(e+t)*l,d=(i+s)*h,f=(a+r)*c;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const Gr=new I,Sn=new _e,uy=new I(0,0,0),dy=new I(1,1,1),bs=new I,Zo=new I,sn=new I,Tf=new _e,Ef=new Wi;let fy=(()=>{class n{constructor(e=0,i=0,s=0,r=n.DefaultOrder){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,a=r[0],o=r[4],l=r[8],h=r[1],c=r[5],u=r[9],d=r[2],f=r[6],p=r[10];switch(i){case"XYZ":this._y=Math.asin(di(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-di(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-d,a),this._z=0);break;case"ZXY":this._x=Math.asin(di(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(h,a));break;case"ZYX":this._y=Math.asin(-di(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(di(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,a)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-di(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(l,a)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===s&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return Tf.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Tf,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return Ef.setFromEuler(this),this.setFromQuaternion(Ef,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}return n.DefaultOrder="XYZ",n.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n})();class uc{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let py=0;const Af=new I,zr=new Wi,is=new _e,$o=new I,Na=new I,my=new I,gy=new Wi,Cf=new I(1,0,0),Rf=new I(0,1,0),If=new I(0,0,1),_y={type:"added"},Pf={type:"removed"};let mn=(()=>{class n extends Ws{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:py++}),this.uuid=nn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DefaultUp.clone();const e=new I,i=new fy,s=new Wi,r=new I(1,1,1);i._onChange(function a(){s.setFromEuler(i,!1)}),s._onChange(function o(){i.setFromQuaternion(s,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new _e},normalMatrix:{value:new ji}}),this.matrix=new _e,this.matrixWorld=new _e,this.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DefaultMatrixWorldAutoUpdate,this.layers=new uc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return zr.setFromAxisAngle(e,i),this.quaternion.multiply(zr),this}rotateOnWorldAxis(e,i){return zr.setFromAxisAngle(e,i),this.quaternion.premultiply(zr),this}rotateX(e){return this.rotateOnAxis(Cf,e)}rotateY(e){return this.rotateOnAxis(Rf,e)}rotateZ(e){return this.rotateOnAxis(If,e)}translateOnAxis(e,i){return Af.copy(e).applyQuaternion(this.quaternion),this.position.add(Af.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(Cf,e)}translateY(e){return this.translateOnAxis(Rf,e)}translateZ(e){return this.translateOnAxis(If,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(is.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?$o.copy(e):$o.set(e,i,s);const r=this.parent;this.updateWorldMatrix(!0,!1),Na.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?is.lookAt(Na,$o,this.up):is.lookAt($o,Na,this.up),this.quaternion.setFromRotationMatrix(is),r&&(is.extractRotation(r.matrixWorld),zr.setFromRotationMatrix(is),this.quaternion.premultiply(zr.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_y)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return-1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(Pf)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const i=this.children[e];i.parent=null,i.dispatchEvent(Pf)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),is.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),is.multiply(e.parent.matrixWorld)),e.applyMatrix4(is),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectByProperty(e,i);if(void 0!==o)return o}}getObjectsByProperty(e,i){let s=[];this[e]===i&&s.push(this);for(let r=0,a=this.children.length;r<a;r++){const o=this.children[r].getObjectsByProperty(e,i);o.length>0&&(s=s.concat(o))}return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Na,e,my),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Na,gy,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;null!==i&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,r=i.length;s<r;s++){const a=i[s];(!0===a.matrixWorldAutoUpdate||!0===e)&&a.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const s=this.parent;if(!0===e&&null!==s&&!0===s.matrixWorldAutoUpdate&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const r=this.children;for(let a=0,o=r.length;a<o;a++){const l=r[a];!0===l.matrixWorldAutoUpdate&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=void 0===e||"string"==typeof e,s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function a(l,h){return void 0===l[h.uuid]&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const h=l.shapes;if(Array.isArray(h))for(let c=0,u=h.length;c<u;c++)a(e.shapes,h[c]);else a(e.shapes,h)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let h=0,c=this.material.length;h<c;h++)l.push(a(e.materials,this.material[h]));r.material=l}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++)r.animations.push(a(e.animations,this.animations[l]))}if(i){const l=o(e.geometries),h=o(e.materials),c=o(e.textures),u=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),m=o(e.nodes);l.length>0&&(s.geometries=l),h.length>0&&(s.materials=h),c.length>0&&(s.textures=c),u.length>0&&(s.images=u),d.length>0&&(s.shapes=d),f.length>0&&(s.skeletons=f),p.length>0&&(s.animations=p),m.length>0&&(s.nodes=m)}return s.object=r,s;function o(l){const h=[];for(const c in l){const u=l[c];delete u.metadata,h.push(u)}return h}}clone(e){return(new this.constructor).copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===i)for(let s=0;s<e.children.length;s++)this.add(e.children[s].clone());return this}}return n.DefaultUp=new I(0,1,0),n.DefaultMatrixAutoUpdate=!0,n.DefaultMatrixWorldAutoUpdate=!0,n})();const Tn=new I,ns=new I,dc=new I,ss=new I,Hr=new I,Vr=new I,Df=new I,fc=new I,pc=new I,mc=new I;class En{constructor(t=new I,e=new I,i=new I){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),Tn.subVectors(t,e),s.cross(Tn);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,i,s,r){Tn.subVectors(s,e),ns.subVectors(i,e),dc.subVectors(t,e);const a=Tn.dot(Tn),o=Tn.dot(ns),l=Tn.dot(dc),h=ns.dot(ns),c=ns.dot(dc),u=a*h-o*o;if(0===u)return r.set(-2,-1,-1);const d=1/u,f=(h*l-o*c)*d,p=(a*c-o*l)*d;return r.set(1-f-p,p,f)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,ss),ss.x>=0&&ss.y>=0&&ss.x+ss.y<=1}static getUV(t,e,i,s,r,a,o,l){return this.getBarycoord(t,e,i,s,ss),l.set(0,0),l.addScaledVector(r,ss.x),l.addScaledVector(a,ss.y),l.addScaledVector(o,ss.z),l}static isFrontFacing(t,e,i,s){return Tn.subVectors(i,e),ns.subVectors(t,e),Tn.cross(ns).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Tn.subVectors(this.c,this.b),ns.subVectors(this.a,this.b),.5*Tn.cross(ns).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return En.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return En.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,s,r){return En.getUV(t,this.a,this.b,this.c,e,i,s,r)}containsPoint(t){return En.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return En.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,r=this.c;let a,o;Hr.subVectors(s,i),Vr.subVectors(r,i),fc.subVectors(t,i);const l=Hr.dot(fc),h=Vr.dot(fc);if(l<=0&&h<=0)return e.copy(i);pc.subVectors(t,s);const c=Hr.dot(pc),u=Vr.dot(pc);if(c>=0&&u<=c)return e.copy(s);const d=l*u-c*h;if(d<=0&&l>=0&&c<=0)return a=l/(l-c),e.copy(i).addScaledVector(Hr,a);mc.subVectors(t,r);const f=Hr.dot(mc),p=Vr.dot(mc);if(p>=0&&f<=p)return e.copy(r);const m=f*h-l*p;if(m<=0&&h>=0&&p<=0)return o=h/(h-p),e.copy(i).addScaledVector(Vr,o);const g=c*p-f*u;if(g<=0&&u-c>=0&&f-p>=0)return Df.subVectors(r,s),o=(u-c)/(u-c+(f-p)),e.copy(s).addScaledVector(Df,o);const x=1/(g+m+d);return a=m*x,o=d*x,e.copy(i).addScaledVector(Hr,a).addScaledVector(Vr,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let yy=0;class Ua extends Ws{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:yy++}),this.uuid=nn(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=N,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}const s=this[e];void 0!==s?s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const r=s(t.textures),a=s(t.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Ji extends Ua{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new kt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _i=new I,qo=new dt;class Ci{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)qo.fromBufferAttribute(this,e),qo.applyMatrix3(t),this.setXY(e,qo.x,qo.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)_i.fromBufferAttribute(this,e),_i.applyMatrix3(t),this.setXYZ(e,_i.x,_i.y,_i.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)_i.fromBufferAttribute(this,e),_i.applyMatrix4(t),this.setXYZ(e,_i.x,_i.y,_i.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)_i.fromBufferAttribute(this,e),_i.applyNormalMatrix(t),this.setXYZ(e,_i.x,_i.y,_i.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)_i.fromBufferAttribute(this,e),_i.transformDirection(t),this.setXYZ(e,_i.x,_i.y,_i.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Qn(e,this.array)),e}setX(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Qn(e,this.array)),e}setY(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Qn(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Qn(e,this.array)),e}setW(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),i=Je(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),i=Je(i,this.array),s=Je(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),i=Je(i,this.array),s=Je(s,this.array),r=Je(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Lf extends Ci{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Of extends Ci{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class zt extends Ci{constructor(t,e,i){super(new Float32Array(t),e,i)}}let xy=0;const gn=new _e,gc=new mn,Wr=new I,rn=new Br,ka=new Br,Ri=new I;class Se extends Ws{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:xy++}),this.uuid=nn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return this.index=Array.isArray(t)?new(vf(t)?Of:Lf)(t,1):t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const r=(new ji).getNormalMatrix(t);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(t),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return gn.makeRotationFromQuaternion(t),this.applyMatrix4(gn),this}rotateX(t){return gn.makeRotationX(t),this.applyMatrix4(gn),this}rotateY(t){return gn.makeRotationY(t),this.applyMatrix4(gn),this}rotateZ(t){return gn.makeRotationZ(t),this.applyMatrix4(gn),this}translate(t,e,i){return gn.makeTranslation(t,e,i),this.applyMatrix4(gn),this}scale(t,e,i){return gn.makeScale(t,e,i),this.applyMatrix4(gn),this}lookAt(t){return gc.lookAt(t),gc.updateMatrix(),this.applyMatrix4(gc.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wr).negate(),this.translate(Wr.x,Wr.y,Wr.z),this}setFromPoints(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new zt(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Br);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new I(-1/0,-1/0,-1/0),new I(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++)rn.setFromBufferAttribute(e[i]),this.morphTargetsRelative?(Ri.addVectors(this.boundingBox.min,rn.min),this.boundingBox.expandByPoint(Ri),Ri.addVectors(this.boundingBox.max,rn.max),this.boundingBox.expandByPoint(Ri)):(this.boundingBox.expandByPoint(rn.min),this.boundingBox.expandByPoint(rn.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new kr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new I,1/0);if(t){const i=this.boundingSphere.center;if(rn.setFromBufferAttribute(t),e)for(let r=0,a=e.length;r<a;r++)ka.setFromBufferAttribute(e[r]),this.morphTargetsRelative?(Ri.addVectors(rn.min,ka.min),rn.expandByPoint(Ri),Ri.addVectors(rn.max,ka.max),rn.expandByPoint(Ri)):(rn.expandByPoint(ka.min),rn.expandByPoint(ka.max));rn.getCenter(i);let s=0;for(let r=0,a=t.count;r<a;r++)Ri.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(Ri));if(e)for(let r=0,a=e.length;r<a;r++){const o=e[r],l=this.morphTargetsRelative;for(let h=0,c=o.count;h<c;h++)Ri.fromBufferAttribute(o,h),l&&(Wr.fromBufferAttribute(t,h),Ri.add(Wr)),s=Math.max(s,i.distanceToSquared(Ri))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,s=e.position.array,r=e.normal.array,a=e.uv.array,o=s.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Ci(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,h=[],c=[];for(let C=0;C<o;C++)h[C]=new I,c[C]=new I;const u=new I,d=new I,f=new I,p=new dt,m=new dt,g=new dt,x=new I,v=new I;function y(C,F,Y){u.fromArray(s,3*C),d.fromArray(s,3*F),f.fromArray(s,3*Y),p.fromArray(a,2*C),m.fromArray(a,2*F),g.fromArray(a,2*Y),d.sub(u),f.sub(u),m.sub(p),g.sub(p);const O=1/(m.x*g.y-g.x*m.y);!isFinite(O)||(x.copy(d).multiplyScalar(g.y).addScaledVector(f,-m.y).multiplyScalar(O),v.copy(f).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(O),h[C].add(x),h[F].add(x),h[Y].add(x),c[C].add(v),c[F].add(v),c[Y].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let C=0,F=b.length;C<F;++C){const Y=b[C],O=Y.start;for(let W=O,X=O+Y.count;W<X;W+=3)y(i[W+0],i[W+1],i[W+2])}const M=new I,S=new I,A=new I,w=new I;function T(C){A.fromArray(r,3*C),w.copy(A);const F=h[C];M.copy(F),M.sub(A.multiplyScalar(A.dot(F))).normalize(),S.crossVectors(w,F);const O=S.dot(c[C])<0?-1:1;l[4*C]=M.x,l[4*C+1]=M.y,l[4*C+2]=M.z,l[4*C+3]=O}for(let C=0,F=b.length;C<F;++C){const Y=b[C],O=Y.start;for(let W=O,X=O+Y.count;W<X;W+=3)T(i[W+0]),T(i[W+1]),T(i[W+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Ci(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const s=new I,r=new I,a=new I,o=new I,l=new I,h=new I,c=new I,u=new I;if(t)for(let d=0,f=t.count;d<f;d+=3){const p=t.getX(d+0),m=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),a.fromBufferAttribute(e,g),c.subVectors(a,r),u.subVectors(s,r),c.cross(u),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),h.fromBufferAttribute(i,g),o.add(c),l.add(c),h.add(c),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(g,h.x,h.y,h.z)}else for(let d=0,f=e.count;d<f;d+=3)s.fromBufferAttribute(e,d+0),r.fromBufferAttribute(e,d+1),a.fromBufferAttribute(e,d+2),c.subVectors(a,r),u.subVectors(s,r),c.cross(u),i.setXYZ(d+0,c.x,c.y,c.z),i.setXYZ(d+1,c.x,c.y,c.z),i.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ri.fromBufferAttribute(t,e),Ri.normalize(),t.setXYZ(e,Ri.x,Ri.y,Ri.z)}toNonIndexed(){function t(o,l){const h=o.array,c=o.itemSize,u=o.normalized,d=new h.constructor(l.length*c);let f=0,p=0;for(let m=0,g=l.length;m<g;m++){f=o.isInterleavedBufferAttribute?l[m]*o.data.stride+o.offset:l[m]*c;for(let x=0;x<c;x++)d[p++]=h[f++]}return new Ci(d,c,u)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Se,i=this.index.array,s=this.attributes;for(const o in s){const h=t(s[o],i);e.setAttribute(o,h)}const r=this.morphAttributes;for(const o in r){const l=[],h=r[o];for(let c=0,u=h.length;c<u;c++){const f=t(h[c],i);l.push(f)}e.morphAttributes[o]=l}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const h=a[o];e.addGroup(h.start,h.count,h.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const h in l)void 0!==l[h]&&(t[h]=l[h]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const l in i)t.data.attributes[l]=i[l].toJSON(t.data);const s={};let r=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],c=[];for(let u=0,d=h.length;u<d;u++)c.push(h[u].toJSON(t.data));c.length>0&&(s[l]=c,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const s=t.attributes;for(const h in s)this.setAttribute(h,s[h].clone(e));const r=t.morphAttributes;for(const h in r){const c=[],u=r[h];for(let d=0,f=u.length;d<f;d++)c.push(u[d].clone(e));this.morphAttributes[h]=c}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let h=0,c=a.length;h<c;h++){const u=a[h];this.addGroup(u.start,u.count,u.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const l=t.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Bf=new _e,Xr=new Yo,_c=new kr,Ga=new I,za=new I,Ha=new I,yc=new I,jo=new I,Jo=new dt,Ko=new dt,Qo=new dt,xc=new I,tl=new I;class Xi extends mn{constructor(t=new Se,e=new Ji){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(t,e){const i=this.geometry,r=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(i.attributes.position,t);const o=this.morphTargetInfluences;if(r&&o){jo.set(0,0,0);for(let l=0,h=r.length;l<h;l++){const c=o[l],u=r[l];0!==c&&(yc.fromBufferAttribute(u,t),jo.addScaledVector(a?yc:yc.sub(e),c))}e.add(jo)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){const i=this.geometry,s=this.material,r=this.matrixWorld;if(void 0===s||(null===i.boundingSphere&&i.computeBoundingSphere(),_c.copy(i.boundingSphere),_c.applyMatrix4(r),!1===t.ray.intersectsSphere(_c))||(Bf.copy(r).invert(),Xr.copy(t.ray).applyMatrix4(Bf),null!==i.boundingBox&&!1===Xr.intersectsBox(i.boundingBox)))return;let a;const o=i.index,l=i.attributes.position,h=i.attributes.uv,c=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let f=0,p=u.length;f<p;f++){const m=u[f],g=s[m.materialIndex];for(let y=Math.max(m.start,d.start),b=Math.min(o.count,Math.min(m.start+m.count,d.start+d.count));y<b;y+=3){const M=o.getX(y),S=o.getX(y+1),A=o.getX(y+2);a=el(this,g,t,Xr,h,c,M,S,A),a&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=m.materialIndex,e.push(a))}}else for(let m=Math.max(0,d.start),g=Math.min(o.count,d.start+d.count);m<g;m+=3){const x=o.getX(m),v=o.getX(m+1),y=o.getX(m+2);a=el(this,s,t,Xr,h,c,x,v,y),a&&(a.faceIndex=Math.floor(m/3),e.push(a))}else if(void 0!==l)if(Array.isArray(s))for(let f=0,p=u.length;f<p;f++){const m=u[f],g=s[m.materialIndex];for(let y=Math.max(m.start,d.start),b=Math.min(l.count,Math.min(m.start+m.count,d.start+d.count));y<b;y+=3)a=el(this,g,t,Xr,h,c,y,y+1,y+2),a&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=m.materialIndex,e.push(a))}else for(let m=Math.max(0,d.start),g=Math.min(l.count,d.start+d.count);m<g;m+=3)a=el(this,s,t,Xr,h,c,m,m+1,m+2),a&&(a.faceIndex=Math.floor(m/3),e.push(a))}}function el(n,t,e,i,s,r,a,o,l){n.getVertexPosition(a,Ga),n.getVertexPosition(o,za),n.getVertexPosition(l,Ha);const h=function vy(n,t,e,i,s,r,a,o){let l;if(l=1===t.side?i.intersectTriangle(a,r,s,!0,o):i.intersectTriangle(s,r,a,0===t.side,o),null===l)return null;tl.copy(o),tl.applyMatrix4(n.matrixWorld);const h=e.ray.origin.distanceTo(tl);return h<e.near||h>e.far?null:{distance:h,point:tl.clone(),object:n}}(n,t,e,i,Ga,za,Ha,xc);if(h){s&&(Jo.fromBufferAttribute(s,a),Ko.fromBufferAttribute(s,o),Qo.fromBufferAttribute(s,l),h.uv=En.getUV(xc,Ga,za,Ha,Jo,Ko,Qo,new dt)),r&&(Jo.fromBufferAttribute(r,a),Ko.fromBufferAttribute(r,o),Qo.fromBufferAttribute(r,l),h.uv2=En.getUV(xc,Ga,za,Ha,Jo,Ko,Qo,new dt));const c={a,b:o,c:l,normal:new I,materialIndex:0};En.getNormal(Ga,za,Ha,c.normal),h.face=c}return h}class ws extends Se{constructor(t=1,e=1,i=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:r,depthSegments:a};const o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const l=[],h=[],c=[],u=[];let d=0,f=0;function p(m,g,x,v,y,b,M,S,A,w,T){const C=b/A,F=M/w,Y=b/2,O=M/2,D=S/2,W=A+1,X=w+1;let j=0,$=0;const et=new I;for(let ft=0;ft<X;ft++){const K=ft*F-O;for(let tt=0;tt<W;tt++)et[m]=(tt*C-Y)*v,et[g]=K*y,et[x]=D,h.push(et.x,et.y,et.z),et[m]=0,et[g]=0,et[x]=S>0?1:-1,c.push(et.x,et.y,et.z),u.push(tt/A),u.push(1-ft/w),j+=1}for(let ft=0;ft<w;ft++)for(let K=0;K<A;K++){const vt=d+K+W*(ft+1),mt=d+(K+1)+W*(ft+1),At=d+(K+1)+W*ft;l.push(d+K+W*ft,vt,At),l.push(vt,mt,At),$+=6}o.addGroup(f,$,T),f+=$,d+=j}p("z","y","x",-1,-1,i,e,t,a,r,0),p("z","y","x",1,-1,i,e,-t,a,r,1),p("x","z","y",1,1,t,i,e,s,a,2),p("x","z","y",1,-1,t,i,-e,s,a,3),p("x","y","z",1,-1,t,e,i,s,r,4),p("x","y","z",-1,-1,t,e,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new zt(h,3)),this.setAttribute("normal",new zt(c,3)),this.setAttribute("uv",new zt(u,2))}static fromJSON(t){return new ws(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Yr(n){const t={};for(const e in n){t[e]={};for(const i in n[e]){const s=n[e][i];t[e][i]=s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.clone():Array.isArray(s)?s.slice():s}}return t}function Yi(n){const t={};for(let e=0;e<n.length;e++){const i=Yr(n[e]);for(const s in i)t[s]=i[s]}return t}function Ff(n){return null===n.getRenderTarget()&&n.outputEncoding===Qe?Un:Pa}const wy={clone:Yr,merge:Yi};class Ms extends Ua{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Yr(t.uniforms),this.uniformsGroups=function by(n){const t=[];for(let e=0;e<n.length;e++)t.push(n[e].clone());return t}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;e.uniforms[s]=a&&a.isTexture?{type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?{type:"c",value:a.getHex()}:a&&a.isVector2?{type:"v2",value:a.toArray()}:a&&a.isVector3?{type:"v3",value:a.toArray()}:a&&a.isVector4?{type:"v4",value:a.toArray()}:a&&a.isMatrix3?{type:"m3",value:a.toArray()}:a&&a.isMatrix4?{type:"m4",value:a.toArray()}:{value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const s in this.extensions)!0===this.extensions[s]&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class vc extends mn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new _e,this.projectionMatrix=new _e,this.projectionMatrixInverse=new _e}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Oi extends vc{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Da*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Xs*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Da*Math.atan(Math.tan(.5*Xs*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Xs*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const a=this.view;if(null!==this.view&&this.view.enabled){const l=a.fullWidth,h=a.fullHeight;r+=a.offsetX*s/l,e-=a.offsetY*i/h,s*=a.width/l,i*=a.height/h}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class Ty extends mn{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;const s=new Oi(-90,1,t,e);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(1,0,0),this.add(s);const r=new Oi(-90,1,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const a=new Oi(-90,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);const o=new Oi(-90,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const l=new Oi(-90,1,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const h=new Oi(-90,1,t,e);h.layers=this.layers,h.up.set(0,1,0),h.lookAt(0,0,-1),this.add(h)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[s,r,a,o,l,h]=this.children,c=t.getRenderTarget(),u=t.toneMapping,d=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,s),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,a),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,l),i.texture.generateMipmaps=f,t.setRenderTarget(i,5),t.render(e,h),t.setRenderTarget(c),t.toneMapping=u,t.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}class il extends Mn{constructor(t,e,i,s,r,a,o,l,h,c){super(t=void 0!==t?t:[],e=void 0!==e?e:301,i,s,r,a,o,l,h,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Ey extends Zs{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1};this.texture=new il([i,i,i,i,i,i],e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:gi}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new ws(5,5,5),r=new Ms({name:"CubemapFromEquirect",uniforms:Yr(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const a=new Xi(s,r),o=e.minFilter;return e.minFilter===Us&&(e.minFilter=gi),new Ty(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,s){const r=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,i,s);t.setRenderTarget(r)}}const bc=new I,Ay=new I,Cy=new ji;class Js{constructor(t=new I(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=bc.subVectors(i,e).cross(Ay.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(bc),s=this.normal.dot(i);if(0===s)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Cy.getNormalMatrix(t),s=this.coplanarPoint(bc).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const qr=new kr,nl=new I;class wc{constructor(t=new Js,e=new Js,i=new Js,s=new Js,r=new Js,a=new Js){this.planes=[t,e,i,s,r,a]}set(t,e,i,s,r,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,s=i[0],r=i[1],a=i[2],o=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],f=i[9],p=i[10],m=i[11],g=i[12],x=i[13],v=i[14],y=i[15];return e[0].setComponents(o-s,u-l,m-d,y-g).normalize(),e[1].setComponents(o+s,u+l,m+d,y+g).normalize(),e[2].setComponents(o+r,u+h,m+f,y+x).normalize(),e[3].setComponents(o-r,u-h,m-f,y-x).normalize(),e[4].setComponents(o-a,u-c,m-p,y-v).normalize(),e[5].setComponents(o+a,u+c,m+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),qr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(qr)}intersectsSprite(t){return qr.center.set(0,0,0),qr.radius=.7071067811865476,qr.applyMatrix4(t.matrixWorld),this.intersectsSphere(qr)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(nl.x=s.normal.x>0?t.max.x:t.min.x,nl.y=s.normal.y>0?t.max.y:t.min.y,nl.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(nl)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Nf(){let n=null,t=!1,e=null,i=null;function s(r,a){e(r,a),i=n.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==e&&(i=n.requestAnimationFrame(s),t=!0)},stop:function(){n.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(r){e=r},setContext:function(r){n=r}}}function Ry(n,t){const e=t.isWebGL2,i=new WeakMap;return{get:function a(h){return h.isInterleavedBufferAttribute&&(h=h.data),i.get(h)},remove:function o(h){h.isInterleavedBufferAttribute&&(h=h.data);const c=i.get(h);c&&(n.deleteBuffer(c.buffer),i.delete(h))},update:function l(h,c){if(h.isGLBufferAttribute){const d=i.get(h);return void((!d||d.version<h.version)&&i.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version}))}h.isInterleavedBufferAttribute&&(h=h.data);const u=i.get(h);void 0===u?i.set(h,function s(h,c){const u=h.array,d=h.usage,f=n.createBuffer();let p;if(n.bindBuffer(c,f),n.bufferData(c,u,d),h.onUploadCallback(),u instanceof Float32Array)p=5126;else if(u instanceof Uint16Array)if(h.isFloat16BufferAttribute){if(!e)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=5131}else p=5123;else if(u instanceof Int16Array)p=5122;else if(u instanceof Uint32Array)p=5125;else if(u instanceof Int32Array)p=5124;else if(u instanceof Int8Array)p=5120;else if(u instanceof Uint8Array)p=5121;else{if(!(u instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);p=5121}return{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:h.version}}(h,c)):u.version<h.version&&(function r(h,c,u){const d=c.array,f=c.updateRange;n.bindBuffer(u,h),-1===f.count?n.bufferSubData(u,0,d):(e?n.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):n.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),c.onUploadCallback()}(u.buffer,h,c),u.version=h.version)}}}class sl extends Se{constructor(t=1,e=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:s};const r=t/2,a=e/2,o=Math.floor(i),l=Math.floor(s),h=o+1,c=l+1,u=t/o,d=e/l,f=[],p=[],m=[],g=[];for(let x=0;x<c;x++){const v=x*d-a;for(let y=0;y<h;y++)p.push(y*u-r,-v,0),m.push(0,0,1),g.push(y/o),g.push(1-x/l)}for(let x=0;x<l;x++)for(let v=0;v<o;v++){const b=v+h*(x+1),M=v+1+h*(x+1),S=v+1+h*x;f.push(v+h*x,b,S),f.push(b,M,S)}this.setIndex(f),this.setAttribute("position",new zt(p,3)),this.setAttribute("normal",new zt(m,3)),this.setAttribute("uv",new zt(g,2))}static fromJSON(t){return new sl(t.width,t.height,t.widthSegments,t.heightSegments)}}const ve={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Rt={common:{diffuse:{value:new kt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ji},uv2Transform:{value:new ji},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new dt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new kt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new kt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ji}},sprite:{diffuse:{value:new kt(16777215)},opacity:{value:1},center:{value:new dt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ji}}},kn={basic:{uniforms:Yi([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.fog]),vertexShader:ve.meshbasic_vert,fragmentShader:ve.meshbasic_frag},lambert:{uniforms:Yi([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,Rt.lights,{emissive:{value:new kt(0)}}]),vertexShader:ve.meshlambert_vert,fragmentShader:ve.meshlambert_frag},phong:{uniforms:Yi([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,Rt.lights,{emissive:{value:new kt(0)},specular:{value:new kt(1118481)},shininess:{value:30}}]),vertexShader:ve.meshphong_vert,fragmentShader:ve.meshphong_frag},standard:{uniforms:Yi([Rt.common,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.roughnessmap,Rt.metalnessmap,Rt.fog,Rt.lights,{emissive:{value:new kt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ve.meshphysical_vert,fragmentShader:ve.meshphysical_frag},toon:{uniforms:Yi([Rt.common,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.gradientmap,Rt.fog,Rt.lights,{emissive:{value:new kt(0)}}]),vertexShader:ve.meshtoon_vert,fragmentShader:ve.meshtoon_frag},matcap:{uniforms:Yi([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,{matcap:{value:null}}]),vertexShader:ve.meshmatcap_vert,fragmentShader:ve.meshmatcap_frag},points:{uniforms:Yi([Rt.points,Rt.fog]),vertexShader:ve.points_vert,fragmentShader:ve.points_frag},dashed:{uniforms:Yi([Rt.common,Rt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ve.linedashed_vert,fragmentShader:ve.linedashed_frag},depth:{uniforms:Yi([Rt.common,Rt.displacementmap]),vertexShader:ve.depth_vert,fragmentShader:ve.depth_frag},normal:{uniforms:Yi([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,{opacity:{value:1}}]),vertexShader:ve.meshnormal_vert,fragmentShader:ve.meshnormal_frag},sprite:{uniforms:Yi([Rt.sprite,Rt.fog]),vertexShader:ve.sprite_vert,fragmentShader:ve.sprite_frag},background:{uniforms:{uvTransform:{value:new ji},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ve.background_vert,fragmentShader:ve.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ve.backgroundCube_vert,fragmentShader:ve.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ve.cube_vert,fragmentShader:ve.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ve.equirect_vert,fragmentShader:ve.equirect_frag},distanceRGBA:{uniforms:Yi([Rt.common,Rt.displacementmap,{referencePosition:{value:new I},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ve.distanceRGBA_vert,fragmentShader:ve.distanceRGBA_frag},shadow:{uniforms:Yi([Rt.lights,Rt.fog,{color:{value:new kt(0)},opacity:{value:1}}]),vertexShader:ve.shadow_vert,fragmentShader:ve.shadow_frag}};kn.physical={uniforms:Yi([kn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new dt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new kt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new dt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new kt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new kt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ve.meshphysical_vert,fragmentShader:ve.meshphysical_frag};const rl={r:0,b:0,g:0};function Cv(n,t,e,i,s,r,a){const o=new kt(0);let h,c,l=!0===r?0:1,u=null,d=0,f=null;function m(g,x){g.getRGB(rl,Ff(n)),i.buffers.color.setClear(rl.r,rl.g,rl.b,x,a)}return{getClearColor:function(){return o},setClearColor:function(g,x=1){o.set(g),l=x,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:function p(g,x){let v=!1,y=!0===x.isScene?x.background:null;y&&y.isTexture&&(y=(x.backgroundBlurriness>0?e:t).get(y));const b=n.xr,M=b.getSession&&b.getSession();M&&"additive"===M.environmentBlendMode&&(y=null),null===y?m(o,l):y&&y.isColor&&(m(y,1),v=!0),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),y&&(y.isCubeTexture||306===y.mapping)?(void 0===c&&(c=new Xi(new ws(1,1,1),new Ms({name:"BackgroundCubeMaterial",uniforms:Yr(kn.backgroundCube.uniforms),vertexShader:kn.backgroundCube.vertexShader,fragmentShader:kn.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(S,A,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=y.encoding!==Qe,(u!==y||d!==y.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,u=y,d=y.version,f=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(void 0===h&&(h=new Xi(new sl(2,2),new Ms({name:"BackgroundMaterial",uniforms:Yr(kn.background.uniforms),vertexShader:kn.background.vertexShader,fragmentShader:kn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=y,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.toneMapped=y.encoding!==Qe,!0===y.matrixAutoUpdate&&y.updateMatrix(),h.material.uniforms.uvTransform.value.copy(y.matrix),(u!==y||d!==y.version||f!==n.toneMapping)&&(h.material.needsUpdate=!0,u=y,d=y.version,f=n.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null))}}}function Rv(n,t,e,i){const s=n.getParameter(34921),r=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==r,o={},l=g(null);let h=l,c=!1;function f(D){return i.isWebGL2?n.bindVertexArray(D):r.bindVertexArrayOES(D)}function p(D){return i.isWebGL2?n.deleteVertexArray(D):r.deleteVertexArrayOES(D)}function g(D){const W=[],X=[],j=[];for(let $=0;$<s;$++)W[$]=0,X[$]=0,j[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:W,enabledAttributes:X,attributeDivisors:j,object:D,attributes:{},index:null}}function y(){const D=h.newAttributes;for(let W=0,X=D.length;W<X;W++)D[W]=0}function b(D){M(D,0)}function M(D,W){const j=h.enabledAttributes,$=h.attributeDivisors;h.newAttributes[D]=1,0===j[D]&&(n.enableVertexAttribArray(D),j[D]=1),$[D]!==W&&((i.isWebGL2?n:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,W),$[D]=W)}function S(){const D=h.newAttributes,W=h.enabledAttributes;for(let X=0,j=W.length;X<j;X++)W[X]!==D[X]&&(n.disableVertexAttribArray(X),W[X]=0)}function A(D,W,X,j,$,et){!0!==i.isWebGL2||5124!==X&&5125!==X?n.vertexAttribPointer(D,W,X,j,$,et):n.vertexAttribIPointer(D,W,X,$,et)}function Y(){O(),c=!0,h!==l&&(h=l,f(h.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function u(D,W,X,j,$){let et=!1;if(a){const ft=function m(D,W,X){const j=!0===X.wireframe;let $=o[D.id];void 0===$&&($={},o[D.id]=$);let et=$[W.id];void 0===et&&(et={},$[W.id]=et);let ft=et[j];return void 0===ft&&(ft=g(function d(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}()),et[j]=ft),ft}(j,X,W);h!==ft&&(h=ft,f(h.object)),et=function x(D,W,X,j){const $=h.attributes,et=W.attributes;let ft=0;const K=X.getAttributes();for(const tt in K)if(K[tt].location>=0){const mt=$[tt];let At=et[tt];if(void 0===At&&("instanceMatrix"===tt&&D.instanceMatrix&&(At=D.instanceMatrix),"instanceColor"===tt&&D.instanceColor&&(At=D.instanceColor)),void 0===mt||mt.attribute!==At||At&&mt.data!==At.data)return!0;ft++}return h.attributesNum!==ft||h.index!==j}(D,j,X,$),et&&function v(D,W,X,j){const $={},et=W.attributes;let ft=0;const K=X.getAttributes();for(const tt in K)if(K[tt].location>=0){let mt=et[tt];void 0===mt&&("instanceMatrix"===tt&&D.instanceMatrix&&(mt=D.instanceMatrix),"instanceColor"===tt&&D.instanceColor&&(mt=D.instanceColor));const At={};At.attribute=mt,mt&&mt.data&&(At.data=mt.data),$[tt]=At,ft++}h.attributes=$,h.attributesNum=ft,h.index=j}(D,j,X,$)}else{const ft=!0===W.wireframe;(h.geometry!==j.id||h.program!==X.id||h.wireframe!==ft)&&(h.geometry=j.id,h.program=X.id,h.wireframe=ft,et=!0)}null!==$&&e.update($,34963),(et||c)&&(c=!1,function w(D,W,X,j){if(!1===i.isWebGL2&&(D.isInstancedMesh||j.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;y();const $=j.attributes,et=X.getAttributes(),ft=W.defaultAttributeValues;for(const K in et){const tt=et[K];if(tt.location>=0){let vt=$[K];if(void 0===vt&&("instanceMatrix"===K&&D.instanceMatrix&&(vt=D.instanceMatrix),"instanceColor"===K&&D.instanceColor&&(vt=D.instanceColor)),void 0!==vt){const mt=vt.normalized,At=vt.itemSize,it=e.get(vt);if(void 0===it)continue;const Qt=it.buffer,Lt=it.type,jt=it.bytesPerElement;if(vt.isInterleavedBufferAttribute){const St=vt.data,ae=St.stride,lt=vt.offset;if(St.isInstancedInterleavedBuffer){for(let rt=0;rt<tt.locationSize;rt++)M(tt.location+rt,St.meshPerAttribute);!0!==D.isInstancedMesh&&void 0===j._maxInstanceCount&&(j._maxInstanceCount=St.meshPerAttribute*St.count)}else for(let rt=0;rt<tt.locationSize;rt++)b(tt.location+rt);n.bindBuffer(34962,Qt);for(let rt=0;rt<tt.locationSize;rt++)A(tt.location+rt,At/tt.locationSize,Lt,mt,ae*jt,(lt+At/tt.locationSize*rt)*jt)}else{if(vt.isInstancedBufferAttribute){for(let St=0;St<tt.locationSize;St++)M(tt.location+St,vt.meshPerAttribute);!0!==D.isInstancedMesh&&void 0===j._maxInstanceCount&&(j._maxInstanceCount=vt.meshPerAttribute*vt.count)}else for(let St=0;St<tt.locationSize;St++)b(tt.location+St);n.bindBuffer(34962,Qt);for(let St=0;St<tt.locationSize;St++)A(tt.location+St,At/tt.locationSize,Lt,mt,At*jt,At/tt.locationSize*St*jt)}}else if(void 0!==ft){const mt=ft[K];if(void 0!==mt)switch(mt.length){case 2:n.vertexAttrib2fv(tt.location,mt);break;case 3:n.vertexAttrib3fv(tt.location,mt);break;case 4:n.vertexAttrib4fv(tt.location,mt);break;default:n.vertexAttrib1fv(tt.location,mt)}}}}S()}(D,W,X,j),null!==$&&n.bindBuffer(34963,e.get($).buffer))},reset:Y,resetDefaultState:O,dispose:function T(){Y();for(const D in o){const W=o[D];for(const X in W){const j=W[X];for(const $ in j)p(j[$].object),delete j[$];delete W[X]}delete o[D]}},releaseStatesOfGeometry:function C(D){if(void 0===o[D.id])return;const W=o[D.id];for(const X in W){const j=W[X];for(const $ in j)p(j[$].object),delete j[$];delete W[X]}delete o[D.id]},releaseStatesOfProgram:function F(D){for(const W in o){const X=o[W];if(void 0===X[D.id])continue;const j=X[D.id];for(const $ in j)p(j[$].object),delete j[$];delete X[D.id]}},initAttributes:y,enableAttribute:b,disableUnusedAttributes:S}}function Iv(n,t,e,i){const s=i.isWebGL2;let r;this.setMode=function a(h){r=h},this.render=function o(h,c){n.drawArrays(r,h,c),e.update(c,r,1)},this.renderInstances=function l(h,c,u){if(0===u)return;let d,f;if(s)d=n,f="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===d)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[f](r,h,c,u),e.update(c,r,u)}}function Pv(n,t,e){let i;function r(A){if("highp"===A){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return"mediump"===A&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&n instanceof WebGL2ComputeRenderingContext;let o=void 0!==e.precision?e.precision:"highp";const l=r(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const h=a||t.has("WEBGL_draw_buffers"),c=!0===e.logarithmicDepthBuffer,u=n.getParameter(34930),d=n.getParameter(35660),f=n.getParameter(3379),p=n.getParameter(34076),m=n.getParameter(34921),g=n.getParameter(36347),x=n.getParameter(36348),v=n.getParameter(36349),y=d>0,b=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:function s(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const A=t.get("EXT_texture_filter_anisotropic");i=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:g,maxVaryings:x,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:a?n.getParameter(36183):0}}function Dv(n){const t=this;let e=null,i=0,s=!1,r=!1;const a=new Js,o=new ji,l={value:null,needsUpdate:!1};function h(){l.value!==e&&(l.value=e,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(u,d,f,p){const m=null!==u?u.length:0;let g=null;if(0!==m){if(g=l.value,!0!==p||null===g){const x=f+4*m,v=d.matrixWorldInverse;o.getNormalMatrix(v),(null===g||g.length<x)&&(g=new Float32Array(x));for(let y=0,b=f;y!==m;++y,b+=4)a.copy(u[y]).applyMatrix4(v,o),a.normal.toArray(g,b),g[b+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d,f){const p=0!==u.length||d||0!==i||s;return s=d,e=c(u,f,0),i=u.length,p},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,h()},this.setState=function(u,d,f){const p=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,x=n.get(u);if(!s||null===p||0===p.length||r&&!g)r?c(null):h();else{const v=r?0:i,y=4*v;let b=x.clippingState||null;l.value=b,b=c(p,d,y,f);for(let M=0;M!==y;++M)b[M]=e[M];x.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=v}}}function Lv(n){let t=new WeakMap;function e(a,o){return 303===o?a.mapping=301:304===o&&(a.mapping=302),a}function s(a){const o=a.target;o.removeEventListener("dispose",s);const l=t.get(o);void 0!==l&&(t.delete(o),l.dispose())}return{get:function i(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){const o=a.mapping;if(303===o||304===o){if(t.has(a))return e(t.get(a).texture,a.mapping);{const l=a.image;if(l&&l.height>0){const h=new Ey(l.height/2);return h.fromEquirectangularTexture(n,a),t.set(a,h),a.addEventListener("dispose",s),e(h.texture,a.mapping)}return null}}}return a},dispose:function r(){t=new WeakMap}}}class Mc extends vc{constructor(t=-1,e=1,i=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,a=i+t,o=s+e,l=s-e;if(null!==this.view&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=h*this.view.offsetX,a=r+h*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Uf=[.125,.215,.35,.446,.526,.582],Sc=new Mc,kf=new kt;let Tc=null;const Qs=(1+Math.sqrt(5))/2,Jr=1/Qs,Gf=[new I(1,1,1),new I(-1,1,1),new I(1,1,-1),new I(-1,1,-1),new I(0,Qs,Jr),new I(0,Qs,-Jr),new I(Jr,0,Qs),new I(-Jr,0,Qs),new I(Qs,Jr,0),new I(-Qs,Jr,0)];class zf{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,s=100){Tc=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Wf(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Vf(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Tc),t.scissorTest=!1,al(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSize(301===t.mapping||302===t.mapping?0===t.image.length?16:t.image[0].width||t.image[0].image.width:t.image.width/4),Tc=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:gi,minFilter:gi,generateMipmaps:!1,type:Ia,format:pn,encoding:Hs,depthBuffer:!1},s=Hf(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Hf(t,e,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function Ov(n){const t=[],e=[],i=[];let s=n;const r=n-4+1+Uf.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);e.push(o);let l=1/o;a>n-4?l=Uf[a-n+4-1]:0===a&&(l=0),i.push(l);const h=1/(o-2),c=-h,u=1+h,d=[c,c,u,c,u,u,c,c,u,u,c,u],f=6,p=6,m=3,g=2,x=1,v=new Float32Array(m*p*f),y=new Float32Array(g*p*f),b=new Float32Array(x*p*f);for(let S=0;S<f;S++){const A=S%3*2/3-1,w=S>2?0:-1;v.set([A,w,0,A+2/3,w,0,A+2/3,w+1,0,A,w,0,A+2/3,w+1,0,A,w+1,0],m*p*S),y.set(d,g*p*S),b.set([S,S,S,S,S,S],x*p*S)}const M=new Se;M.setAttribute("position",new Ci(v,m)),M.setAttribute("uv",new Ci(y,g)),M.setAttribute("faceIndex",new Ci(b,x)),t.push(M),s>4&&s--}return{lodPlanes:t,sizeLods:e,sigmas:i}}(r)),this._blurMaterial=function Bv(n,t,e){const i=new Float32Array(20),s=new I(0,1,0);return new Ms({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,t,e)}return s}_compileMaterial(t){const e=new Xi(this._lodPlanes[0],t);this._renderer.compile(e,Sc)}_sceneToCubeUV(t,e,i,s){const o=new Oi(90,1,e,i),l=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],c=this._renderer,u=c.autoClear,d=c.toneMapping;c.getClearColor(kf),c.toneMapping=0,c.autoClear=!1;const f=new Ji({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new Xi(new ws,f);let m=!1;const g=t.background;g?g.isColor&&(f.color.copy(g),t.background=null,m=!0):(f.color.copy(kf),m=!0);for(let x=0;x<6;x++){const v=x%3;0===v?(o.up.set(0,l[x],0),o.lookAt(h[x],0,0)):1===v?(o.up.set(0,0,l[x]),o.lookAt(0,h[x],0)):(o.up.set(0,l[x],0),o.lookAt(0,0,h[x]));const y=this._cubeSize;al(s,v*y,x>2?y:0,y,y),c.setRenderTarget(s),m&&c.render(p,o),c.render(t,o)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=d,c.autoClear=u,t.background=g}_textureToCubeUV(t,e){const i=this._renderer,s=301===t.mapping||302===t.mapping;s?(null===this._cubemapMaterial&&(this._cubemapMaterial=Wf()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Vf());const r=s?this._cubemapMaterial:this._equirectMaterial,a=new Xi(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const l=this._cubeSize;al(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(a,Sc)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]);this._blur(t,s-1,s,r,Gf[(s-1)%Gf.length])}e.autoClear=i}_blur(t,e,i,s,r){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,s,"latitudinal",r),this._halfBlur(a,t,i,i,s,"longitudinal",r)}_halfBlur(t,e,i,s,r,a,o){const l=this._renderer,h=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new Xi(this._lodPlanes[s],h),d=h.uniforms,f=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/39,m=r/p,g=isFinite(r)?1+Math.floor(3*m):20;g>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const x=[];let v=0;for(let A=0;A<20;++A){const w=A/m,T=Math.exp(-w*w/2);x.push(T),0===A?v+=T:A<g&&(v+=2*T)}for(let A=0;A<x.length;A++)x[A]=x[A]/v;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=x,d.latitudinal.value="latitudinal"===a,o&&(d.poleAxis.value=o);const{_lodMax:y}=this;d.dTheta.value=p,d.mipInt.value=y-i;const b=this._sizeLods[s];al(e,3*b*(s>y-4?s-y+4:0),4*(this._cubeSize-b),3*b,2*b),l.setRenderTarget(e),l.render(u,Sc)}}function Hf(n,t,e){const i=new Zs(n,t,e);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function al(n,t,e,i,s){n.viewport.set(t,e,i,s),n.scissor.set(t,e,i,s)}function Vf(){return new Ms({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Wf(){return new Ms({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Fv(n){let t=new WeakMap,e=null;function r(o){const l=o.target;l.removeEventListener("dispose",r);const h=t.get(l);void 0!==h&&(t.delete(l),h.dispose())}return{get:function i(o){if(o&&o.isTexture){const l=o.mapping,h=303===l||304===l,c=301===l||302===l;if(h||c){if(o.isRenderTargetTexture&&!0===o.needsPMREMUpdate){o.needsPMREMUpdate=!1;let u=t.get(o);return null===e&&(e=new zf(n)),u=h?e.fromEquirectangular(o,u):e.fromCubemap(o,u),t.set(o,u),u.texture}if(t.has(o))return t.get(o).texture;{const u=o.image;if(h&&u&&u.height>0||c&&u&&function s(o){let l=0;for(let c=0;c<6;c++)void 0!==o[c]&&l++;return 6===l}(u)){null===e&&(e=new zf(n));const d=h?e.fromEquirectangular(o):e.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",r),d.texture}return null}}}return o},dispose:function a(){t=new WeakMap,null!==e&&(e.dispose(),e=null)}}}function Nv(n){const t={};function e(i){if(void 0!==t[i])return t[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return t[i]=s,s}return{has:function(i){return null!==e(i)},init:function(i){i.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(i){const s=e(i);return null===s&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function Uv(n,t,e,i){const s={},r=new WeakMap;function a(u){const d=u.target;null!==d.index&&t.remove(d.index);for(const p in d.attributes)t.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete s[d.id];const f=r.get(d);f&&(t.remove(f),r.delete(d)),i.releaseStatesOfGeometry(d),!0===d.isInstancedBufferGeometry&&delete d._maxInstanceCount,e.memory.geometries--}function h(u){const d=[],f=u.index,p=u.attributes.position;let m=0;if(null!==f){const v=f.array;m=f.version;for(let y=0,b=v.length;y<b;y+=3){const M=v[y+0],S=v[y+1],A=v[y+2];d.push(M,S,S,A,A,M)}}else{m=p.version;for(let y=0,b=p.array.length/3-1;y<b;y+=3){const M=y+0,S=y+1,A=y+2;d.push(M,S,S,A,A,M)}}const g=new(vf(d)?Of:Lf)(d,1);g.version=m;const x=r.get(u);x&&t.remove(x),r.set(u,g)}return{get:function o(u,d){return!0===s[d.id]||(d.addEventListener("dispose",a),s[d.id]=!0,e.memory.geometries++),d},update:function l(u){const d=u.attributes;for(const p in d)t.update(d[p],34962);const f=u.morphAttributes;for(const p in f){const m=f[p];for(let g=0,x=m.length;g<x;g++)t.update(m[g],34962)}},getWireframeAttribute:function c(u){const d=r.get(u);if(d){const f=u.index;null!==f&&d.version<f.version&&h(u)}else h(u);return r.get(u)}}}function kv(n,t,e,i){const s=i.isWebGL2;let r,o,l;this.setMode=function a(d){r=d},this.setIndex=function h(d){o=d.type,l=d.bytesPerElement},this.render=function c(d,f){n.drawElements(r,f,o,d*l),e.update(f,r,1)},this.renderInstances=function u(d,f,p){if(0===p)return;let m,g;if(s)m=n,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===m)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m[g](r,f,o,d*l,p),e.update(f,r,p)}}function Gv(n){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function s(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function i(r,a,o){switch(e.calls++,a){case 4:e.triangles+=o*(r/3);break;case 1:e.lines+=o*(r/2);break;case 3:e.lines+=o*(r-1);break;case 2:e.lines+=o*r;break;case 0:e.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a)}}}}function zv(n,t){return n[0]-t[0]}function Hv(n,t){return Math.abs(t[1])-Math.abs(n[1])}function Vv(n,t,e){const i={},s=new Float32Array(8),r=new WeakMap,a=new Ze,o=[];for(let h=0;h<8;h++)o[h]=[h,0];return{update:function l(h,c,u,d){const f=h.morphTargetInfluences;if(!0===t.isWebGL2){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,m=void 0!==p?p.length:0;let g=r.get(c);if(void 0===g||g.count!==m){let W=function(){O.dispose(),r.delete(c),c.removeEventListener("dispose",W)};void 0!==g&&g.texture.dispose();const y=void 0!==c.morphAttributes.position,b=void 0!==c.morphAttributes.normal,M=void 0!==c.morphAttributes.color,S=c.morphAttributes.position||[],A=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let T=0;!0===y&&(T=1),!0===b&&(T=2),!0===M&&(T=3);let C=c.attributes.position.count*T,F=1;C>t.maxTextureSize&&(F=Math.ceil(C/t.maxTextureSize),C=t.maxTextureSize);const Y=new Float32Array(C*F*4*m),O=new nc(Y,C,F,m);O.type=_s,O.needsUpdate=!0;const D=4*T;for(let X=0;X<m;X++){const j=S[X],$=A[X],et=w[X],ft=C*F*4*X;for(let K=0;K<j.count;K++){const tt=K*D;!0===y&&(a.fromBufferAttribute(j,K),Y[ft+tt+0]=a.x,Y[ft+tt+1]=a.y,Y[ft+tt+2]=a.z,Y[ft+tt+3]=0),!0===b&&(a.fromBufferAttribute($,K),Y[ft+tt+4]=a.x,Y[ft+tt+5]=a.y,Y[ft+tt+6]=a.z,Y[ft+tt+7]=0),!0===M&&(a.fromBufferAttribute(et,K),Y[ft+tt+8]=a.x,Y[ft+tt+9]=a.y,Y[ft+tt+10]=a.z,Y[ft+tt+11]=4===et.itemSize?a.w:1)}}g={count:m,texture:O,size:new dt(C,F)},r.set(c,g),c.addEventListener("dispose",W)}let x=0;for(let y=0;y<f.length;y++)x+=f[y];const v=c.morphTargetsRelative?1:1-x;d.getUniforms().setValue(n,"morphTargetBaseInfluence",v),d.getUniforms().setValue(n,"morphTargetInfluences",f),d.getUniforms().setValue(n,"morphTargetsTexture",g.texture,e),d.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const p=void 0===f?0:f.length;let m=i[c.id];if(void 0===m||m.length!==p){m=[];for(let b=0;b<p;b++)m[b]=[b,0];i[c.id]=m}for(let b=0;b<p;b++){const M=m[b];M[0]=b,M[1]=f[b]}m.sort(Hv);for(let b=0;b<8;b++)b<p&&m[b][1]?(o[b][0]=m[b][0],o[b][1]=m[b][1]):(o[b][0]=Number.MAX_SAFE_INTEGER,o[b][1]=0);o.sort(zv);const g=c.morphAttributes.position,x=c.morphAttributes.normal;let v=0;for(let b=0;b<8;b++){const M=o[b],S=M[0],A=M[1];S!==Number.MAX_SAFE_INTEGER&&A?(g&&c.getAttribute("morphTarget"+b)!==g[S]&&c.setAttribute("morphTarget"+b,g[S]),x&&c.getAttribute("morphNormal"+b)!==x[S]&&c.setAttribute("morphNormal"+b,x[S]),s[b]=A,v+=A):(g&&!0===c.hasAttribute("morphTarget"+b)&&c.deleteAttribute("morphTarget"+b),x&&!0===c.hasAttribute("morphNormal"+b)&&c.deleteAttribute("morphNormal"+b),s[b]=0)}const y=c.morphTargetsRelative?1:1-v;d.getUniforms().setValue(n,"morphTargetBaseInfluence",y),d.getUniforms().setValue(n,"morphTargetInfluences",s)}}}}function Wv(n,t,e,i){let s=new WeakMap;function o(l){const h=l.target;h.removeEventListener("dispose",o),e.remove(h.instanceMatrix),null!==h.instanceColor&&e.remove(h.instanceColor)}return{update:function r(l){const h=i.render.frame,u=t.get(l,l.geometry);return s.get(u)!==h&&(t.update(u),s.set(u,h)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",o)&&l.addEventListener("dispose",o),e.update(l.instanceMatrix,34962),null!==l.instanceColor&&e.update(l.instanceColor,34962)),u},dispose:function a(){s=new WeakMap}}}const Xf=new Mn,Yf=new nc,Zf=new Mf,$f=new il,qf=[],jf=[],Jf=new Float32Array(16),Kf=new Float32Array(9),Qf=new Float32Array(4);function Kr(n,t,e){const i=n[0];if(i<=0||i>0)return n;const s=t*e;let r=qf[s];if(void 0===r&&(r=new Float32Array(s),qf[s]=r),0!==t){i.toArray(r,0);for(let a=1,o=0;a!==t;++a)o+=e,n[a].toArray(r,o)}return r}function Si(n,t){if(n.length!==t.length)return!1;for(let e=0,i=n.length;e<i;e++)if(n[e]!==t[e])return!1;return!0}function Ti(n,t){for(let e=0,i=t.length;e<i;e++)n[e]=t[e]}function ol(n,t){let e=jf[t];void 0===e&&(e=new Int32Array(t),jf[t]=e);for(let i=0;i!==t;++i)e[i]=n.allocateTextureUnit();return e}function Xv(n,t){const e=this.cache;e[0]!==t&&(n.uniform1f(this.addr,t),e[0]=t)}function Yv(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Si(e,t))return;n.uniform2fv(this.addr,t),Ti(e,t)}}function Zv(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(void 0!==t.r)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(Si(e,t))return;n.uniform3fv(this.addr,t),Ti(e,t)}}function $v(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Si(e,t))return;n.uniform4fv(this.addr,t),Ti(e,t)}}function qv(n,t){const e=this.cache,i=t.elements;if(void 0===i){if(Si(e,t))return;n.uniformMatrix2fv(this.addr,!1,t),Ti(e,t)}else{if(Si(e,i))return;Qf.set(i),n.uniformMatrix2fv(this.addr,!1,Qf),Ti(e,i)}}function jv(n,t){const e=this.cache,i=t.elements;if(void 0===i){if(Si(e,t))return;n.uniformMatrix3fv(this.addr,!1,t),Ti(e,t)}else{if(Si(e,i))return;Kf.set(i),n.uniformMatrix3fv(this.addr,!1,Kf),Ti(e,i)}}function Jv(n,t){const e=this.cache,i=t.elements;if(void 0===i){if(Si(e,t))return;n.uniformMatrix4fv(this.addr,!1,t),Ti(e,t)}else{if(Si(e,i))return;Jf.set(i),n.uniformMatrix4fv(this.addr,!1,Jf),Ti(e,i)}}function Kv(n,t){const e=this.cache;e[0]!==t&&(n.uniform1i(this.addr,t),e[0]=t)}function Qv(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Si(e,t))return;n.uniform2iv(this.addr,t),Ti(e,t)}}function tb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Si(e,t))return;n.uniform3iv(this.addr,t),Ti(e,t)}}function eb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Si(e,t))return;n.uniform4iv(this.addr,t),Ti(e,t)}}function ib(n,t){const e=this.cache;e[0]!==t&&(n.uniform1ui(this.addr,t),e[0]=t)}function nb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Si(e,t))return;n.uniform2uiv(this.addr,t),Ti(e,t)}}function sb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Si(e,t))return;n.uniform3uiv(this.addr,t),Ti(e,t)}}function rb(n,t){const e=this.cache;if(void 0!==t.x)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Si(e,t))return;n.uniform4uiv(this.addr,t),Ti(e,t)}}function ab(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture2D(t||Xf,s)}function ob(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture3D(t||Zf,s)}function lb(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTextureCube(t||$f,s)}function hb(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture2DArray(t||Yf,s)}function ub(n,t){n.uniform1fv(this.addr,t)}function db(n,t){const e=Kr(t,this.size,2);n.uniform2fv(this.addr,e)}function fb(n,t){const e=Kr(t,this.size,3);n.uniform3fv(this.addr,e)}function pb(n,t){const e=Kr(t,this.size,4);n.uniform4fv(this.addr,e)}function mb(n,t){const e=Kr(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,e)}function gb(n,t){const e=Kr(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,e)}function _b(n,t){const e=Kr(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,e)}function yb(n,t){n.uniform1iv(this.addr,t)}function xb(n,t){n.uniform2iv(this.addr,t)}function vb(n,t){n.uniform3iv(this.addr,t)}function bb(n,t){n.uniform4iv(this.addr,t)}function wb(n,t){n.uniform1uiv(this.addr,t)}function Mb(n,t){n.uniform2uiv(this.addr,t)}function Sb(n,t){n.uniform3uiv(this.addr,t)}function Tb(n,t){n.uniform4uiv(this.addr,t)}function Eb(n,t,e){const i=this.cache,s=t.length,r=ol(e,s);Si(i,r)||(n.uniform1iv(this.addr,r),Ti(i,r));for(let a=0;a!==s;++a)e.setTexture2D(t[a]||Xf,r[a])}function Ab(n,t,e){const i=this.cache,s=t.length,r=ol(e,s);Si(i,r)||(n.uniform1iv(this.addr,r),Ti(i,r));for(let a=0;a!==s;++a)e.setTexture3D(t[a]||Zf,r[a])}function Cb(n,t,e){const i=this.cache,s=t.length,r=ol(e,s);Si(i,r)||(n.uniform1iv(this.addr,r),Ti(i,r));for(let a=0;a!==s;++a)e.setTextureCube(t[a]||$f,r[a])}function Rb(n,t,e){const i=this.cache,s=t.length,r=ol(e,s);Si(i,r)||(n.uniform1iv(this.addr,r),Ti(i,r));for(let a=0;a!==s;++a)e.setTexture2DArray(t[a]||Yf,r[a])}class Pb{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function cb(n){switch(n){case 5126:return Xv;case 35664:return Yv;case 35665:return Zv;case 35666:return $v;case 35674:return qv;case 35675:return jv;case 35676:return Jv;case 5124:case 35670:return Kv;case 35667:case 35671:return Qv;case 35668:case 35672:return tb;case 35669:case 35673:return eb;case 5125:return ib;case 36294:return nb;case 36295:return sb;case 36296:return rb;case 35678:case 36198:case 36298:case 36306:case 35682:return ab;case 35679:case 36299:case 36307:return ob;case 35680:case 36300:case 36308:case 36293:return lb;case 36289:case 36303:case 36311:case 36292:return hb}}(e.type)}}class Db{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function Ib(n){switch(n){case 5126:return ub;case 35664:return db;case 35665:return fb;case 35666:return pb;case 35674:return mb;case 35675:return gb;case 35676:return _b;case 5124:case 35670:return yb;case 35667:case 35671:return xb;case 35668:case 35672:return vb;case 35669:case 35673:return bb;case 5125:return wb;case 36294:return Mb;case 36295:return Sb;case 36296:return Tb;case 35678:case 36198:case 36298:case 36306:case 35682:return Eb;case 35679:case 36299:case 36307:return Ab;case 35680:case 36300:case 36308:case 36293:return Cb;case 36289:case 36303:case 36311:case 36292:return Rb}}(e.type)}}class Lb{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const o=s[r];o.setValue(t,e[o.id],i)}}}const Ac=/(\w+)(\])?(\[|\.)?/g;function tp(n,t){n.seq.push(t),n.map[t.id]=t}function Ob(n,t,e){const i=n.name,s=i.length;for(Ac.lastIndex=0;;){const r=Ac.exec(i),a=Ac.lastIndex;let o=r[1];const h=r[3];if("]"===r[2]&&(o|=0),void 0===h||"["===h&&a+2===s){tp(e,void 0===h?new Pb(o,n,t):new Db(o,n,t));break}{let u=e.map[o];void 0===u&&(u=new Lb(o),tp(e,u)),e=u}}}class ll{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let s=0;s<i;++s){const r=t.getActiveUniform(e,s);Ob(r,t.getUniformLocation(e,r.name),this)}}setValue(t,e,i,s){const r=this.map[e];void 0!==r&&r.setValue(t,i,s)}setOptional(t,e,i){const s=e[i];void 0!==s&&this.setValue(t,i,s)}static upload(t,e,i,s){for(let r=0,a=e.length;r!==a;++r){const o=e[r],l=i[o.id];!1!==l.needsUpdate&&o.setValue(t,l.value,s)}}static seqWithValue(t,e){const i=[];for(let s=0,r=t.length;s!==r;++s){const a=t[s];a.id in e&&i.push(a)}return i}}function ep(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}let Bb=0;function ip(n,t,e){const i=n.getShaderParameter(t,35713),s=n.getShaderInfoLog(t).trim();if(i&&""===s)return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const a=parseInt(r[1]);return e.toUpperCase()+"\n\n"+s+"\n\n"+function Fb(n,t){const e=n.split("\n"),i=[],s=Math.max(t-6,0),r=Math.min(t+6,e.length);for(let a=s;a<r;a++){const o=a+1;i.push(`${o===t?">":" "} ${o}: ${e[a]}`)}return i.join("\n")}(n.getShaderSource(t),a)}return s}function Ub(n,t){const e=function Nb(n){switch(n){case Hs:return["Linear","( value )"];case Qe:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(t);return"vec4 "+n+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function kb(n,t){let e;switch(t){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="OptimizedCineon";break;case 4:e="ACESFilmic";break;case 5:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+n+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function Va(n){return""!==n}function np(n,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function sp(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Vb=/^[ \t]*#include +<([\w\d./]+)>/gm;function Cc(n){return n.replace(Vb,Wb)}function Wb(n,t){const e=ve[t];if(void 0===e)throw new Error("Can not resolve #include <"+t+">");return Cc(e)}const Xb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function rp(n){return n.replace(Xb,Yb)}function Yb(n,t,e,i){let s="";for(let r=parseInt(t);r<parseInt(e);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function ap(n){let t="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?t+="\n#define HIGH_PRECISION":"mediump"===n.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(t+="\n#define LOW_PRECISION"),t}function Kb(n,t,e,i){const s=n.getContext(),r=e.defines;let a=e.vertexShader,o=e.fragmentShader;const l=function Zb(n){let t="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(e),h=function $b(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:t="ENVMAP_TYPE_CUBE_UV"}return t}(e),c=function qb(n){let t="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(t="ENVMAP_MODE_REFRACTION"),t}(e),u=function jb(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(e),d=function Jb(n){const t=n.envMapCubeUVHeight;if(null===t)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:i,maxMip:e}}(e),f=e.isWebGL2?"":function Gb(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Va).join("\n")}(e),p=function zb(n){const t=[];for(const e in n){const i=n[e];!1!==i&&t.push("#define "+e+" "+i)}return t.join("\n")}(r),m=s.createProgram();let g,x,v=e.glslVersion?"#version "+e.glslVersion+"\n":"";e.isRawShaderMaterial?(g=[p].filter(Va).join("\n"),g.length>0&&(g+="\n"),x=[f,p].filter(Va).join("\n"),x.length>0&&(x+="\n")):(g=[ap(e),"#define SHADER_NAME "+e.shaderName,p,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Va).join("\n"),x=[f,ap(e),"#define SHADER_NAME "+e.shaderName,p,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.envMap?"#define "+c:"",e.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==e.toneMapping?"#define TONE_MAPPING":"",0!==e.toneMapping?ve.tonemapping_pars_fragment:"",0!==e.toneMapping?kb("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",ve.encodings_pars_fragment,Ub("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"","\n"].filter(Va).join("\n")),a=Cc(a),a=np(a,e),a=sp(a,e),o=Cc(o),o=np(o,e),o=sp(o,e),a=rp(a),o=rp(o),e.isWebGL2&&!0!==e.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,x=["#define varying in","300 es"===e.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===e.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const b=v+x+o,M=ep(s,35633,v+g+a),S=ep(s,35632,b);if(s.attachShader(m,M),s.attachShader(m,S),void 0!==e.index0AttributeName?s.bindAttribLocation(m,0,e.index0AttributeName):!0===e.morphTargets&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),n.debug.checkShaderErrors){const T=s.getProgramInfoLog(m).trim(),C=s.getShaderInfoLog(M).trim(),F=s.getShaderInfoLog(S).trim();let Y=!0,O=!0;if(!1===s.getProgramParameter(m,35714)){Y=!1;const D=ip(s,M,"vertex"),W=ip(s,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+T+"\n"+D+"\n"+W)}else""!==T?console.warn("THREE.WebGLProgram: Program Info Log:",T):(""===C||""===F)&&(O=!1);O&&(this.diagnostics={runnable:Y,programLog:T,vertexShader:{log:C,prefix:g},fragmentShader:{log:F,prefix:x}})}let A,w;return s.deleteShader(M),s.deleteShader(S),this.getUniforms=function(){return void 0===A&&(A=new ll(s,m)),A},this.getAttributes=function(){return void 0===w&&(w=function Hb(n,t){const e={},i=n.getProgramParameter(t,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(t,s),a=r.name;let o=1;35674===r.type&&(o=2),35675===r.type&&(o=3),35676===r.type&&(o=4),e[a]={type:r.type,location:n.getAttribLocation(t,a),locationSize:o}}return e}(s,m)),w},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=e.shaderName,this.id=Bb++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=M,this.fragmentShader=S,this}let Qb=0;class t1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.fragmentShader,s=this._getShaderStage(t.vertexShader),r=this._getShaderStage(i),a=this._getShaderCacheForMaterial(t);return!1===a.has(s)&&(a.add(s),s.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new e1(t),e.set(t,i)),i}}class e1{constructor(t){this.id=Qb++,this.code=t,this.usedTimes=0}}function i1(n,t,e,i,s,r,a){const o=new uc,l=new t1,h=[],c=s.isWebGL2,u=s.logarithmicDepthBuffer,d=s.vertexTextures;let f=s.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function m(w,T,C,F,Y){const O=F.fog,D=Y.geometry,X=(w.isMeshStandardMaterial?e:t).get(w.envMap||(w.isMeshStandardMaterial?F.environment:null)),j=X&&306===X.mapping?X.image.height:null,$=p[w.type];null!==w.precision&&(f=s.getMaxPrecision(w.precision),f!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",f,"instead."));const et=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,ft=void 0!==et?et.length:0;let tt,vt,mt,At,K=0;if(void 0!==D.morphAttributes.position&&(K=1),void 0!==D.morphAttributes.normal&&(K=2),void 0!==D.morphAttributes.color&&(K=3),$){const ae=kn[$];tt=ae.vertexShader,vt=ae.fragmentShader}else tt=w.vertexShader,vt=w.fragmentShader,l.update(w),mt=l.getVertexShaderID(w),At=l.getFragmentShaderID(w);const it=n.getRenderTarget(),Lt=w.clearcoat>0,jt=w.iridescence>0;return{isWebGL2:c,shaderID:$,shaderName:w.type,vertexShader:tt,fragmentShader:vt,defines:w.defines,customVertexShaderID:mt,customFragmentShaderID:At,isRawShaderMaterial:!0===w.isRawShaderMaterial,glslVersion:w.glslVersion,precision:f,instancing:!0===Y.isInstancedMesh,instancingColor:!0===Y.isInstancedMesh&&null!==Y.instanceColor,supportsVertexTextures:d,outputEncoding:null===it?n.outputEncoding:!0===it.isXRRenderTarget?it.texture.encoding:Hs,map:!!w.map,matcap:!!w.matcap,envMap:!!X,envMapMode:X&&X.mapping,envMapCubeUVHeight:j,lightMap:!!w.lightMap,aoMap:!!w.aoMap,emissiveMap:!!w.emissiveMap,bumpMap:!!w.bumpMap,normalMap:!!w.normalMap,objectSpaceNormalMap:1===w.normalMapType,tangentSpaceNormalMap:0===w.normalMapType,decodeVideoTexture:!!w.map&&!0===w.map.isVideoTexture&&w.map.encoding===Qe,clearcoat:Lt,clearcoatMap:Lt&&!!w.clearcoatMap,clearcoatRoughnessMap:Lt&&!!w.clearcoatRoughnessMap,clearcoatNormalMap:Lt&&!!w.clearcoatNormalMap,iridescence:jt,iridescenceMap:jt&&!!w.iridescenceMap,iridescenceThicknessMap:jt&&!!w.iridescenceThicknessMap,displacementMap:!!w.displacementMap,roughnessMap:!!w.roughnessMap,metalnessMap:!!w.metalnessMap,specularMap:!!w.specularMap,specularIntensityMap:!!w.specularIntensityMap,specularColorMap:!!w.specularColorMap,opaque:!1===w.transparent&&1===w.blending,alphaMap:!!w.alphaMap,alphaTest:w.alphaTest>0,gradientMap:!!w.gradientMap,sheen:w.sheen>0,sheenColorMap:!!w.sheenColorMap,sheenRoughnessMap:!!w.sheenRoughnessMap,transmission:w.transmission>0,transmissionMap:!!w.transmissionMap,thicknessMap:!!w.thicknessMap,combine:w.combine,vertexTangents:!!w.normalMap&&!!D.attributes.tangent,vertexColors:w.vertexColors,vertexAlphas:!0===w.vertexColors&&!!D.attributes.color&&4===D.attributes.color.itemSize,vertexUvs:!!(w.map||w.bumpMap||w.normalMap||w.specularMap||w.alphaMap||w.emissiveMap||w.roughnessMap||w.metalnessMap||w.clearcoatMap||w.clearcoatRoughnessMap||w.clearcoatNormalMap||w.iridescenceMap||w.iridescenceThicknessMap||w.displacementMap||w.transmissionMap||w.thicknessMap||w.specularIntensityMap||w.specularColorMap||w.sheenColorMap||w.sheenRoughnessMap),uvsVertexOnly:!(w.map||w.bumpMap||w.normalMap||w.specularMap||w.alphaMap||w.emissiveMap||w.roughnessMap||w.metalnessMap||w.clearcoatNormalMap||w.iridescenceMap||w.iridescenceThicknessMap||w.transmission>0||w.transmissionMap||w.thicknessMap||w.specularIntensityMap||w.specularColorMap||w.sheen>0||w.sheenColorMap||w.sheenRoughnessMap||!w.displacementMap),fog:!!O,useFog:!0===w.fog,fogExp2:O&&O.isFogExp2,flatShading:!!w.flatShading,sizeAttenuation:w.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===Y.isSkinnedMesh,morphTargets:void 0!==D.morphAttributes.position,morphNormals:void 0!==D.morphAttributes.normal,morphColors:void 0!==D.morphAttributes.color,morphTargetsCount:ft,morphTextureStride:K,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:w.dithering,shadowMapEnabled:n.shadowMap.enabled&&C.length>0,shadowMapType:n.shadowMap.type,toneMapping:w.toneMapped?n.toneMapping:0,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:w.premultipliedAlpha,doubleSided:2===w.side,flipSided:1===w.side,useDepthPacking:!!w.depthPacking,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionDerivatives:w.extensions&&w.extensions.derivatives,extensionFragDepth:w.extensions&&w.extensions.fragDepth,extensionDrawBuffers:w.extensions&&w.extensions.drawBuffers,extensionShaderTextureLOD:w.extensions&&w.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:w.customProgramCacheKey()}},getProgramCacheKey:function g(w){const T=[];if(w.shaderID?T.push(w.shaderID):(T.push(w.customVertexShaderID),T.push(w.customFragmentShaderID)),void 0!==w.defines)for(const C in w.defines)T.push(C),T.push(w.defines[C]);return!1===w.isRawShaderMaterial&&(function x(w,T){w.push(T.precision),w.push(T.outputEncoding),w.push(T.envMapMode),w.push(T.envMapCubeUVHeight),w.push(T.combine),w.push(T.vertexUvs),w.push(T.fogExp2),w.push(T.sizeAttenuation),w.push(T.morphTargetsCount),w.push(T.morphAttributeCount),w.push(T.numDirLights),w.push(T.numPointLights),w.push(T.numSpotLights),w.push(T.numSpotLightMaps),w.push(T.numHemiLights),w.push(T.numRectAreaLights),w.push(T.numDirLightShadows),w.push(T.numPointLightShadows),w.push(T.numSpotLightShadows),w.push(T.numSpotLightShadowsWithMaps),w.push(T.shadowMapType),w.push(T.toneMapping),w.push(T.numClippingPlanes),w.push(T.numClipIntersection),w.push(T.depthPacking)}(T,w),function v(w,T){o.disableAll(),T.isWebGL2&&o.enable(0),T.supportsVertexTextures&&o.enable(1),T.instancing&&o.enable(2),T.instancingColor&&o.enable(3),T.map&&o.enable(4),T.matcap&&o.enable(5),T.envMap&&o.enable(6),T.lightMap&&o.enable(7),T.aoMap&&o.enable(8),T.emissiveMap&&o.enable(9),T.bumpMap&&o.enable(10),T.normalMap&&o.enable(11),T.objectSpaceNormalMap&&o.enable(12),T.tangentSpaceNormalMap&&o.enable(13),T.clearcoat&&o.enable(14),T.clearcoatMap&&o.enable(15),T.clearcoatRoughnessMap&&o.enable(16),T.clearcoatNormalMap&&o.enable(17),T.iridescence&&o.enable(18),T.iridescenceMap&&o.enable(19),T.iridescenceThicknessMap&&o.enable(20),T.displacementMap&&o.enable(21),T.specularMap&&o.enable(22),T.roughnessMap&&o.enable(23),T.metalnessMap&&o.enable(24),T.gradientMap&&o.enable(25),T.alphaMap&&o.enable(26),T.alphaTest&&o.enable(27),T.vertexColors&&o.enable(28),T.vertexAlphas&&o.enable(29),T.vertexUvs&&o.enable(30),T.vertexTangents&&o.enable(31),T.uvsVertexOnly&&o.enable(32),w.push(o.mask),o.disableAll(),T.fog&&o.enable(0),T.useFog&&o.enable(1),T.flatShading&&o.enable(2),T.logarithmicDepthBuffer&&o.enable(3),T.skinning&&o.enable(4),T.morphTargets&&o.enable(5),T.morphNormals&&o.enable(6),T.morphColors&&o.enable(7),T.premultipliedAlpha&&o.enable(8),T.shadowMapEnabled&&o.enable(9),T.physicallyCorrectLights&&o.enable(10),T.doubleSided&&o.enable(11),T.flipSided&&o.enable(12),T.useDepthPacking&&o.enable(13),T.dithering&&o.enable(14),T.specularIntensityMap&&o.enable(15),T.specularColorMap&&o.enable(16),T.transmission&&o.enable(17),T.transmissionMap&&o.enable(18),T.thicknessMap&&o.enable(19),T.sheen&&o.enable(20),T.sheenColorMap&&o.enable(21),T.sheenRoughnessMap&&o.enable(22),T.decodeVideoTexture&&o.enable(23),T.opaque&&o.enable(24),w.push(o.mask)}(T,w),T.push(n.outputEncoding)),T.push(w.customProgramCacheKey),T.join()},getUniforms:function y(w){const T=p[w.type];let C;return C=T?wy.clone(kn[T].uniforms):w.uniforms,C},acquireProgram:function b(w,T){let C;for(let F=0,Y=h.length;F<Y;F++){const O=h[F];if(O.cacheKey===T){C=O,++C.usedTimes;break}}return void 0===C&&(C=new Kb(n,T,w,r),h.push(C)),C},releaseProgram:function M(w){if(0==--w.usedTimes){const T=h.indexOf(w);h[T]=h[h.length-1],h.pop(),w.destroy()}},releaseShaderCache:function S(w){l.remove(w)},programs:h,dispose:function A(){l.dispose()}}}function n1(){let n=new WeakMap;return{get:function t(r){let a=n.get(r);return void 0===a&&(a={},n.set(r,a)),a},remove:function e(r){n.delete(r)},update:function i(r,a,o){n.get(r)[a]=o},dispose:function s(){n=new WeakMap}}}function s1(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function op(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function lp(){const n=[];let t=0;const e=[],i=[],s=[];function a(u,d,f,p,m,g){let x=n[t];return void 0===x?(x={id:u.id,object:u,geometry:d,material:f,groupOrder:p,renderOrder:u.renderOrder,z:m,group:g},n[t]=x):(x.id=u.id,x.object=u,x.geometry=d,x.material=f,x.groupOrder=p,x.renderOrder=u.renderOrder,x.z=m,x.group=g),t++,x}return{opaque:e,transmissive:i,transparent:s,init:function r(){t=0,e.length=0,i.length=0,s.length=0},push:function o(u,d,f,p,m,g){const x=a(u,d,f,p,m,g);f.transmission>0?i.push(x):!0===f.transparent?s.push(x):e.push(x)},unshift:function l(u,d,f,p,m,g){const x=a(u,d,f,p,m,g);f.transmission>0?i.unshift(x):!0===f.transparent?s.unshift(x):e.unshift(x)},finish:function c(){for(let u=t,d=n.length;u<d;u++){const f=n[u];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function h(u,d){e.length>1&&e.sort(u||s1),i.length>1&&i.sort(d||op),s.length>1&&s.sort(d||op)}}}function r1(){let n=new WeakMap;return{get:function t(i,s){const r=n.get(i);let a;return void 0===r?(a=new lp,n.set(i,[a])):s>=r.length?(a=new lp,r.push(a)):a=r[s],a},dispose:function e(){n=new WeakMap}}}function a1(){const n={};return{get:function(t){if(void 0!==n[t.id])return n[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new I,color:new kt};break;case"SpotLight":e={position:new I,direction:new I,color:new kt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new I,color:new kt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new I,skyColor:new kt,groundColor:new kt};break;case"RectAreaLight":e={color:new kt,position:new I,halfWidth:new I,halfHeight:new I}}return n[t.id]=e,e}}}let l1=0;function h1(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function c1(n,t){const e=new a1,i=function o1(){const n={};return{get:function(t){if(void 0!==n[t.id])return n[t.id];let e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dt};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dt,shadowCameraNear:1,shadowCameraFar:1e3}}return n[t.id]=e,e}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)s.probe.push(new I);const r=new I,a=new _e,o=new _e;return{setup:function l(c,u){let d=0,f=0,p=0;for(let F=0;F<9;F++)s.probe[F].set(0,0,0);let m=0,g=0,x=0,v=0,y=0,b=0,M=0,S=0,A=0,w=0;c.sort(h1);const T=!0!==u?Math.PI:1;for(let F=0,Y=c.length;F<Y;F++){const O=c[F],D=O.color,W=O.intensity,X=O.distance,j=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)d+=D.r*W*T,f+=D.g*W*T,p+=D.b*W*T;else if(O.isLightProbe)for(let $=0;$<9;$++)s.probe[$].addScaledVector(O.sh.coefficients[$],W);else if(O.isDirectionalLight){const $=e.get(O);if($.color.copy(O.color).multiplyScalar(O.intensity*T),O.castShadow){const et=O.shadow,ft=i.get(O);ft.shadowBias=et.bias,ft.shadowNormalBias=et.normalBias,ft.shadowRadius=et.radius,ft.shadowMapSize=et.mapSize,s.directionalShadow[m]=ft,s.directionalShadowMap[m]=j,s.directionalShadowMatrix[m]=O.shadow.matrix,b++}s.directional[m]=$,m++}else if(O.isSpotLight){const $=e.get(O);$.position.setFromMatrixPosition(O.matrixWorld),$.color.copy(D).multiplyScalar(W*T),$.distance=X,$.coneCos=Math.cos(O.angle),$.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),$.decay=O.decay,s.spot[x]=$;const et=O.shadow;if(O.map&&(s.spotLightMap[A]=O.map,A++,et.updateMatrices(O),O.castShadow&&w++),s.spotLightMatrix[x]=et.matrix,O.castShadow){const ft=i.get(O);ft.shadowBias=et.bias,ft.shadowNormalBias=et.normalBias,ft.shadowRadius=et.radius,ft.shadowMapSize=et.mapSize,s.spotShadow[x]=ft,s.spotShadowMap[x]=j,S++}x++}else if(O.isRectAreaLight){const $=e.get(O);$.color.copy(D).multiplyScalar(W),$.halfWidth.set(.5*O.width,0,0),$.halfHeight.set(0,.5*O.height,0),s.rectArea[v]=$,v++}else if(O.isPointLight){const $=e.get(O);if($.color.copy(O.color).multiplyScalar(O.intensity*T),$.distance=O.distance,$.decay=O.decay,O.castShadow){const et=O.shadow,ft=i.get(O);ft.shadowBias=et.bias,ft.shadowNormalBias=et.normalBias,ft.shadowRadius=et.radius,ft.shadowMapSize=et.mapSize,ft.shadowCameraNear=et.camera.near,ft.shadowCameraFar=et.camera.far,s.pointShadow[g]=ft,s.pointShadowMap[g]=j,s.pointShadowMatrix[g]=O.shadow.matrix,M++}s.point[g]=$,g++}else if(O.isHemisphereLight){const $=e.get(O);$.skyColor.copy(O.color).multiplyScalar(W*T),$.groundColor.copy(O.groundColor).multiplyScalar(W*T),s.hemi[y]=$,y++}}v>0&&(t.isWebGL2||!0===n.has("OES_texture_float_linear")?(s.rectAreaLTC1=Rt.LTC_FLOAT_1,s.rectAreaLTC2=Rt.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=Rt.LTC_HALF_1,s.rectAreaLTC2=Rt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=d,s.ambient[1]=f,s.ambient[2]=p;const C=s.hash;(C.directionalLength!==m||C.pointLength!==g||C.spotLength!==x||C.rectAreaLength!==v||C.hemiLength!==y||C.numDirectionalShadows!==b||C.numPointShadows!==M||C.numSpotShadows!==S||C.numSpotMaps!==A)&&(s.directional.length=m,s.spot.length=x,s.rectArea.length=v,s.point.length=g,s.hemi.length=y,s.directionalShadow.length=b,s.directionalShadowMap.length=b,s.pointShadow.length=M,s.pointShadowMap.length=M,s.spotShadow.length=S,s.spotShadowMap.length=S,s.directionalShadowMatrix.length=b,s.pointShadowMatrix.length=M,s.spotLightMatrix.length=S+A-w,s.spotLightMap.length=A,s.numSpotLightShadowsWithMaps=w,C.directionalLength=m,C.pointLength=g,C.spotLength=x,C.rectAreaLength=v,C.hemiLength=y,C.numDirectionalShadows=b,C.numPointShadows=M,C.numSpotShadows=S,C.numSpotMaps=A,s.version=l1++)},setupView:function h(c,u){let d=0,f=0,p=0,m=0,g=0;const x=u.matrixWorldInverse;for(let v=0,y=c.length;v<y;v++){const b=c[v];if(b.isDirectionalLight){const M=s.directional[d];M.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(x),d++}else if(b.isSpotLight){const M=s.spot[p];M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(x),M.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(x),p++}else if(b.isRectAreaLight){const M=s.rectArea[m];M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(x),o.identity(),a.copy(b.matrixWorld),a.premultiply(x),o.extractRotation(a),M.halfWidth.set(.5*b.width,0,0),M.halfHeight.set(0,.5*b.height,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),m++}else if(b.isPointLight){const M=s.point[f];M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(x),f++}else if(b.isHemisphereLight){const M=s.hemi[g];M.direction.setFromMatrixPosition(b.matrixWorld),M.direction.transformDirection(x),g++}}},state:s}}function hp(n,t){const e=new c1(n,t),i=[],s=[];return{init:function r(){i.length=0,s.length=0},state:{lightsArray:i,shadowsArray:s,lights:e},setupLights:function l(u){e.setup(i,u)},setupLightsView:function h(u){e.setupView(i,u)},pushLight:function a(u){i.push(u)},pushShadow:function o(u){s.push(u)}}}function u1(n,t){let e=new WeakMap;return{get:function i(r,a=0){const o=e.get(r);let l;return void 0===o?(l=new hp(n,t),e.set(r,[l])):a>=o.length?(l=new hp(n,t),o.push(l)):l=o[a],l},dispose:function s(){e=new WeakMap}}}class cp extends Ua{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class up extends Ua{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new I,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function p1(n,t,e){let i=new wc;const s=new dt,r=new dt,a=new Ze,o=new cp({depthPacking:3201}),l=new up,h={},c=e.maxTextureSize,u={0:1,1:0,2:2},d=new Ms({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new dt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Se;p.setAttribute("position",new Ci(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Xi(p,d),g=this;function x(b,M){const S=t.update(m);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,f.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===b.mapPass&&(b.mapPass=new Zs(s.x,s.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,n.setRenderTarget(b.mapPass),n.clear(),n.renderBufferDirect(M,null,S,d,m,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,n.setRenderTarget(b.map),n.clear(),n.renderBufferDirect(M,null,S,f,m,null)}function v(b,M,S,A,w,T){let C=null;const F=!0===S.isPointLight?b.customDistanceMaterial:b.customDepthMaterial;if(void 0!==F)C=F;else if(C=!0===S.isPointLight?l:o,n.localClippingEnabled&&!0===M.clipShadows&&Array.isArray(M.clippingPlanes)&&0!==M.clippingPlanes.length||M.displacementMap&&0!==M.displacementScale||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const Y=C.uuid,O=M.uuid;let D=h[Y];void 0===D&&(D={},h[Y]=D);let W=D[O];void 0===W&&(W=C.clone(),D[O]=W),C=W}return C.visible=M.visible,C.wireframe=M.wireframe,C.side=3===T?null!==M.shadowSide?M.shadowSide:M.side:null!==M.shadowSide?M.shadowSide:u[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,!0===S.isPointLight&&!0===C.isMeshDistanceMaterial&&(C.referencePosition.setFromMatrixPosition(S.matrixWorld),C.nearDistance=A,C.farDistance=w),C}function y(b,M,S,A,w){if(!1===b.visible)return;if(b.layers.test(M.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&3===w)&&(!b.frustumCulled||i.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,b.matrixWorld);const F=t.update(b),Y=b.material;if(Array.isArray(Y)){const O=F.groups;for(let D=0,W=O.length;D<W;D++){const X=O[D],j=Y[X.materialIndex];if(j&&j.visible){const $=v(b,j,A,S.near,S.far,w);n.renderBufferDirect(S,null,F,$,b,X)}}}else if(Y.visible){const O=v(b,Y,A,S.near,S.far,w);n.renderBufferDirect(S,null,F,O,b,null)}}const C=b.children;for(let F=0,Y=C.length;F<Y;F++)y(C[F],M,S,A,w)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(b,M,S){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===b.length)return;const A=n.getRenderTarget(),w=n.getActiveCubeFace(),T=n.getActiveMipmapLevel(),C=n.state;C.setBlending(0),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let F=0,Y=b.length;F<Y;F++){const O=b[F],D=O.shadow;if(void 0===D){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(!1===D.autoUpdate&&!1===D.needsUpdate)continue;s.copy(D.mapSize);const W=D.getFrameExtents();s.multiply(W),r.copy(D.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(r.x=Math.floor(c/W.x),s.x=r.x*W.x,D.mapSize.x=r.x),s.y>c&&(r.y=Math.floor(c/W.y),s.y=r.y*W.y,D.mapSize.y=r.y)),null===D.map&&(D.map=new Zs(s.x,s.y,3!==this.type?{minFilter:mi,magFilter:mi}:{}),D.map.texture.name=O.name+".shadowMap",D.camera.updateProjectionMatrix()),n.setRenderTarget(D.map),n.clear();const X=D.getViewportCount();for(let j=0;j<X;j++){const $=D.getViewport(j);a.set(r.x*$.x,r.y*$.y,r.x*$.z,r.y*$.w),C.viewport(a),D.updateMatrices(O,j),i=D.getFrustum(),y(M,S,D.camera,O,this.type)}!0!==D.isPointLightShadow&&3===this.type&&x(D,S),D.needsUpdate=!1}g.needsUpdate=!1,n.setRenderTarget(A,w,T)}}function m1(n,t,e){const i=e.isWebGL2,o=new function s(){let U=!1;const st=new Ze;let _t=null;const Ut=new Ze(0,0,0,0);return{setMask:function(qt){_t!==qt&&!U&&(n.colorMask(qt,qt,qt,qt),_t=qt)},setLocked:function(qt){U=qt},setClear:function(qt,Ve,Ii,Gi,wr){!0===wr&&(qt*=Gi,Ve*=Gi,Ii*=Gi),st.set(qt,Ve,Ii,Gi),!1===Ut.equals(st)&&(n.clearColor(qt,Ve,Ii,Gi),Ut.copy(st))},reset:function(){U=!1,_t=null,Ut.set(-1,0,0,0)}}},l=new function r(){let U=!1,st=null,_t=null,Ut=null;return{setTest:function(qt){qt?Qt(2929):Lt(2929)},setMask:function(qt){st!==qt&&!U&&(n.depthMask(qt),st=qt)},setFunc:function(qt){if(_t!==qt){switch(qt){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}_t=qt}},setLocked:function(qt){U=qt},setClear:function(qt){Ut!==qt&&(n.clearDepth(qt),Ut=qt)},reset:function(){U=!1,st=null,_t=null,Ut=null}}},h=new function a(){let U=!1,st=null,_t=null,Ut=null,qt=null,Ve=null,Ii=null,Gi=null,wr=null;return{setTest:function(ii){U||(ii?Qt(2960):Lt(2960))},setMask:function(ii){st!==ii&&!U&&(n.stencilMask(ii),st=ii)},setFunc:function(ii,ms,bn){(_t!==ii||Ut!==ms||qt!==bn)&&(n.stencilFunc(ii,ms,bn),_t=ii,Ut=ms,qt=bn)},setOp:function(ii,ms,bn){(Ve!==ii||Ii!==ms||Gi!==bn)&&(n.stencilOp(ii,ms,bn),Ve=ii,Ii=ms,Gi=bn)},setLocked:function(ii){U=ii},setClear:function(ii){wr!==ii&&(n.clearStencil(ii),wr=ii)},reset:function(){U=!1,st=null,_t=null,Ut=null,qt=null,Ve=null,Ii=null,Gi=null,wr=null}}},c=new WeakMap,u=new WeakMap;let d={},f={},p=new WeakMap,m=[],g=null,x=!1,v=null,y=null,b=null,M=null,S=null,A=null,w=null,T=!1,C=null,F=null,Y=null,O=null,D=null;const W=n.getParameter(35661);let X=!1,j=0;const $=n.getParameter(7938);-1!==$.indexOf("WebGL")?(j=parseFloat(/^WebGL (\d)/.exec($)[1]),X=j>=1):-1!==$.indexOf("OpenGL ES")&&(j=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),X=j>=2);let et=null,ft={};const K=n.getParameter(3088),tt=n.getParameter(2978),vt=(new Ze).fromArray(K),mt=(new Ze).fromArray(tt);function At(U,st,_t){const Ut=new Uint8Array(4),qt=n.createTexture();n.bindTexture(U,qt),n.texParameteri(U,10241,9728),n.texParameteri(U,10240,9728);for(let Ve=0;Ve<_t;Ve++)n.texImage2D(st+Ve,0,6408,1,1,0,6408,5121,Ut);return qt}const it={};function Qt(U){!0!==d[U]&&(n.enable(U),d[U]=!0)}function Lt(U){!1!==d[U]&&(n.disable(U),d[U]=!1)}it[3553]=At(3553,3553,1),it[34067]=At(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),Qt(2929),l.setFunc(3),Tt(!1),ue(1),Qt(2884),wt(0);const lt={[N]:32774,101:32778,102:32779};if(i)lt[103]=32775,lt[104]=32776;else{const U=t.get("EXT_blend_minmax");null!==U&&(lt[103]=U.MIN_EXT,lt[104]=U.MAX_EXT)}const rt={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function wt(U,st,_t,Ut,qt,Ve,Ii,Gi){if(0!==U){if(!1===x&&(Qt(3042),x=!0),5===U)qt=qt||st,Ve=Ve||_t,Ii=Ii||Ut,(st!==y||qt!==S)&&(n.blendEquationSeparate(lt[st],lt[qt]),y=st,S=qt),(_t!==b||Ut!==M||Ve!==A||Ii!==w)&&(n.blendFuncSeparate(rt[_t],rt[Ut],rt[Ve],rt[Ii]),b=_t,M=Ut,A=Ve,w=Ii),v=U,T=!1;else if(U!==v||Gi!==T){if((y!==N||S!==N)&&(n.blendEquation(32774),y=N,S=N),Gi)switch(U){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",U)}else switch(U){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",U)}b=null,M=null,A=null,w=null,v=U,T=Gi}}else!0===x&&(Lt(3042),x=!1)}function Tt(U){C!==U&&(n.frontFace(U?2304:2305),C=U)}function ue(U){0!==U?(Qt(2884),U!==F&&n.cullFace(1===U?1029:2===U?1028:1032)):Lt(2884),F=U}function te(U,st,_t){U?(Qt(32823),(O!==st||D!==_t)&&(n.polygonOffset(st,_t),O=st,D=_t)):Lt(32823)}return{buffers:{color:o,depth:l,stencil:h},enable:Qt,disable:Lt,bindFramebuffer:function jt(U,st){return f[U]!==st&&(n.bindFramebuffer(U,st),f[U]=st,i&&(36009===U&&(f[36160]=st),36160===U&&(f[36009]=st)),!0)},drawBuffers:function St(U,st){let _t=m,Ut=!1;if(U)if(_t=p.get(st),void 0===_t&&(_t=[],p.set(st,_t)),U.isWebGLMultipleRenderTargets){const qt=U.texture;if(_t.length!==qt.length||36064!==_t[0]){for(let Ve=0,Ii=qt.length;Ve<Ii;Ve++)_t[Ve]=36064+Ve;_t.length=qt.length,Ut=!0}}else 36064!==_t[0]&&(_t[0]=36064,Ut=!0);else 1029!==_t[0]&&(_t[0]=1029,Ut=!0);Ut&&(e.isWebGL2?n.drawBuffers(_t):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(_t))},useProgram:function ae(U){return g!==U&&(n.useProgram(U),g=U,!0)},setBlending:wt,setMaterial:function Nt(U,st){2===U.side?Lt(2884):Qt(2884);let _t=1===U.side;st&&(_t=!_t),Tt(_t),1===U.blending&&!1===U.transparent?wt(0):wt(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.premultipliedAlpha),l.setFunc(U.depthFunc),l.setTest(U.depthTest),l.setMask(U.depthWrite),o.setMask(U.colorWrite);const Ut=U.stencilWrite;h.setTest(Ut),Ut&&(h.setMask(U.stencilWriteMask),h.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),h.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),te(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),!0===U.alphaToCoverage?Qt(32926):Lt(32926)},setFlipSided:Tt,setCullFace:ue,setLineWidth:function ne(U){U!==Y&&(X&&n.lineWidth(U),Y=U)},setPolygonOffset:te,setScissorTest:function $e(U){U?Qt(3089):Lt(3089)},activeTexture:function ke(U){void 0===U&&(U=33984+W-1),et!==U&&(n.activeTexture(U),et=U)},bindTexture:function L(U,st,_t){void 0===_t&&(_t=null===et?33984+W-1:et);let Ut=ft[_t];void 0===Ut&&(Ut={type:void 0,texture:void 0},ft[_t]=Ut),(Ut.type!==U||Ut.texture!==st)&&(et!==_t&&(n.activeTexture(_t),et=_t),n.bindTexture(U,st||it[U]),Ut.type=U,Ut.texture=st)},unbindTexture:function E(){const U=ft[et];void 0!==U&&void 0!==U.type&&(n.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)},compressedTexImage2D:function Q(){try{n.compressedTexImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},compressedTexImage3D:function gt(){try{n.compressedTexImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texImage2D:function Gt(){try{n.texImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texImage3D:function Ot(){try{n.texImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},updateUBOMapping:function Ie(U,st){let _t=u.get(st);void 0===_t&&(_t=new WeakMap,u.set(st,_t));let Ut=_t.get(U);void 0===Ut&&(Ut=n.getUniformBlockIndex(st,U.name),_t.set(U,Ut))},uniformBlockBinding:function Oe(U,st){const Ut=u.get(st).get(U);c.get(st)!==Ut&&(n.uniformBlockBinding(st,Ut,U.__bindingPointIndex),c.set(st,Ut))},texStorage2D:function z(){try{n.texStorage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texStorage3D:function Dt(){try{n.texStorage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texSubImage2D:function bt(){try{n.texSubImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},texSubImage3D:function It(){try{n.texSubImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},compressedTexSubImage2D:function oe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},compressedTexSubImage3D:function B(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}},scissor:function $t(U){!1===vt.equals(U)&&(n.scissor(U.x,U.y,U.z,U.w),vt.copy(U))},viewport:function Zt(U){!1===mt.equals(U)&&(n.viewport(U.x,U.y,U.z,U.w),mt.copy(U))},reset:function qe(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),d={},et=null,ft={},f={},p=new WeakMap,m=[],g=null,x=!1,v=null,y=null,b=null,M=null,S=null,A=null,w=null,T=!1,C=null,F=null,Y=null,O=null,D=null,vt.set(0,0,n.canvas.width,n.canvas.height),mt.set(0,0,n.canvas.width,n.canvas.height),o.reset(),l.reset(),h.reset()}}}function g1(n,t,e,i,s,r,a){const o=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,c=s.maxTextureSize,u=s.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function v(L,E){return x?new OffscreenCanvas(L,E):Oa("canvas")}function y(L,E,Q,gt){let bt=1;if((L.width>gt||L.height>gt)&&(bt=gt/Math.max(L.width,L.height)),bt<1||!0===E){if(typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&L instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&L instanceof ImageBitmap){const It=E?Uo:Math.floor,oe=It(bt*L.width),B=It(bt*L.height);void 0===m&&(m=v(oe,B));const z=Q?v(oe,B):m;return z.width=oe,z.height=B,z.getContext("2d").drawImage(L,0,0,oe,B),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+L.width+"x"+L.height+") to ("+oe+"x"+B+")."),z}return"data"in L&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+L.width+"x"+L.height+")."),L}return L}function b(L){return Kh(L.width)&&Kh(L.height)}function S(L,E){return L.generateMipmaps&&E&&L.minFilter!==mi&&L.minFilter!==gi}function A(L){n.generateMipmap(L)}function w(L,E,Q,gt,bt=!1){if(!1===o)return E;if(null!==L){if(void 0!==n[L])return n[L];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+L+"'")}let It=E;return 6403===E&&(5126===Q&&(It=33326),5131===Q&&(It=33325),5121===Q&&(It=33321)),33319===E&&(5126===Q&&(It=33328),5131===Q&&(It=33327),5121===Q&&(It=33323)),6408===E&&(5126===Q&&(It=34836),5131===Q&&(It=34842),5121===Q&&(It=gt===Qe&&!1===bt?35907:32856),32819===Q&&(It=32854),32820===Q&&(It=32855)),(33325===It||33326===It||33327===It||33328===It||34842===It||34836===It)&&t.get("EXT_color_buffer_float"),It}function T(L,E,Q){return!0===S(L,Q)||L.isFramebufferTexture&&L.minFilter!==mi&&L.minFilter!==gi?Math.log2(Math.max(E.width,E.height))+1:void 0!==L.mipmaps&&L.mipmaps.length>0?L.mipmaps.length:L.isCompressedTexture&&Array.isArray(L.image)?E.mipmaps.length:1}function C(L){return L===mi||1004===L||1005===L?9728:9729}function F(L){const E=L.target;E.removeEventListener("dispose",F),function O(L){const E=i.get(L);if(void 0===E.__webglInit)return;const Q=L.source,gt=g.get(Q);if(gt){const bt=gt[E.__cacheKey];bt.usedTimes--,0===bt.usedTimes&&D(L),0===Object.keys(gt).length&&g.delete(Q)}i.remove(L)}(E),E.isVideoTexture&&p.delete(E)}function Y(L){const E=L.target;E.removeEventListener("dispose",Y),function W(L){const E=L.texture,Q=i.get(L),gt=i.get(E);if(void 0!==gt.__webglTexture&&(n.deleteTexture(gt.__webglTexture),a.memory.textures--),L.depthTexture&&L.depthTexture.dispose(),L.isWebGLCubeRenderTarget)for(let bt=0;bt<6;bt++)n.deleteFramebuffer(Q.__webglFramebuffer[bt]),Q.__webglDepthbuffer&&n.deleteRenderbuffer(Q.__webglDepthbuffer[bt]);else{if(n.deleteFramebuffer(Q.__webglFramebuffer),Q.__webglDepthbuffer&&n.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&n.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer)for(let bt=0;bt<Q.__webglColorRenderbuffer.length;bt++)Q.__webglColorRenderbuffer[bt]&&n.deleteRenderbuffer(Q.__webglColorRenderbuffer[bt]);Q.__webglDepthRenderbuffer&&n.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}if(L.isWebGLMultipleRenderTargets)for(let bt=0,It=E.length;bt<It;bt++){const oe=i.get(E[bt]);oe.__webglTexture&&(n.deleteTexture(oe.__webglTexture),a.memory.textures--),i.remove(E[bt])}i.remove(E),i.remove(L)}(E)}function D(L){const E=i.get(L);n.deleteTexture(E.__webglTexture),delete g.get(L.source)[E.__cacheKey],a.memory.textures--}let X=0;function ft(L,E){const Q=i.get(L);if(L.isVideoTexture&&function $e(L){const E=a.render.frame;p.get(L)!==E&&(p.set(L,E),L.update())}(L),!1===L.isRenderTargetTexture&&L.version>0&&Q.__version!==L.version){const gt=L.image;if(null===gt)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==gt.complete)return void Lt(Q,L,E);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}e.bindTexture(3553,Q.__webglTexture,33984+E)}const mt={1e3:10497,[Hi]:33071,1002:33648},At={[mi]:9728,1004:9984,1005:9986,[gi]:9729,1007:9985,[Us]:9987};function it(L,E,Q){if(Q?(n.texParameteri(L,10242,mt[E.wrapS]),n.texParameteri(L,10243,mt[E.wrapT]),(32879===L||35866===L)&&n.texParameteri(L,32882,mt[E.wrapR]),n.texParameteri(L,10240,At[E.magFilter]),n.texParameteri(L,10241,At[E.minFilter])):(n.texParameteri(L,10242,33071),n.texParameteri(L,10243,33071),(32879===L||35866===L)&&n.texParameteri(L,32882,33071),(E.wrapS!==Hi||E.wrapT!==Hi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(L,10240,C(E.magFilter)),n.texParameteri(L,10241,C(E.minFilter)),E.minFilter!==mi&&E.minFilter!==gi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const gt=t.get("EXT_texture_filter_anisotropic");if(E.magFilter===mi||1005!==E.minFilter&&E.minFilter!==Us||E.type===_s&&!1===t.has("OES_texture_float_linear")||!1===o&&E.type===Ia&&!1===t.has("OES_texture_half_float_linear"))return;(E.anisotropy>1||i.get(E).__currentAnisotropy)&&(n.texParameterf(L,gt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,s.getMaxAnisotropy())),i.get(E).__currentAnisotropy=E.anisotropy)}}function Qt(L,E){let Q=!1;void 0===L.__webglInit&&(L.__webglInit=!0,E.addEventListener("dispose",F));const gt=E.source;let bt=g.get(gt);void 0===bt&&(bt={},g.set(gt,bt));const It=function et(L){const E=[];return E.push(L.wrapS),E.push(L.wrapT),E.push(L.wrapR||0),E.push(L.magFilter),E.push(L.minFilter),E.push(L.anisotropy),E.push(L.internalFormat),E.push(L.format),E.push(L.type),E.push(L.generateMipmaps),E.push(L.premultiplyAlpha),E.push(L.flipY),E.push(L.unpackAlignment),E.push(L.encoding),E.join()}(E);if(It!==L.__cacheKey){void 0===bt[It]&&(bt[It]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,Q=!0),bt[It].usedTimes++;const oe=bt[L.__cacheKey];void 0!==oe&&(bt[L.__cacheKey].usedTimes--,0===oe.usedTimes&&D(E)),L.__cacheKey=It,L.__webglTexture=bt[It].texture}return Q}function Lt(L,E,Q){let gt=3553;(E.isDataArrayTexture||E.isCompressedArrayTexture)&&(gt=35866),E.isData3DTexture&&(gt=32879);const bt=Qt(L,E),It=E.source;e.bindTexture(gt,L.__webglTexture,33984+Q);const oe=i.get(It);if(It.version!==oe.__version||!0===bt){e.activeTexture(33984+Q),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const B=function M(L){return!o&&(L.wrapS!==Hi||L.wrapT!==Hi||L.minFilter!==mi&&L.minFilter!==gi)}(E)&&!1===b(E.image);let z=y(E.image,B,!1,c);z=ke(E,z);const Dt=b(z)||o,Gt=r.convert(E.format,E.encoding);let Zt,Ot=r.convert(E.type),$t=w(E.internalFormat,Gt,Ot,E.encoding,E.isVideoTexture);it(gt,E,Dt);const Ie=E.mipmaps,Oe=o&&!0!==E.isVideoTexture,qe=void 0===oe.__version||!0===bt,U=T(E,z,Dt);if(E.isDepthTexture)$t=6402,o?$t=E.type===_s?36012:E.type===Gs?33190:E.type===Cr?35056:33189:E.type===_s&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),E.format===zs&&6402===$t&&1012!==E.type&&E.type!==Gs&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),E.type=Gs,Ot=r.convert(E.type)),E.format===Rr&&6402===$t&&($t=34041,E.type!==Cr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),E.type=Cr,Ot=r.convert(E.type))),qe&&(Oe?e.texStorage2D(3553,1,$t,z.width,z.height):e.texImage2D(3553,0,$t,z.width,z.height,0,Gt,Ot,null));else if(E.isDataTexture)if(Ie.length>0&&Dt){Oe&&qe&&e.texStorage2D(3553,U,$t,Ie[0].width,Ie[0].height);for(let st=0,_t=Ie.length;st<_t;st++)Zt=Ie[st],Oe?e.texSubImage2D(3553,st,0,0,Zt.width,Zt.height,Gt,Ot,Zt.data):e.texImage2D(3553,st,$t,Zt.width,Zt.height,0,Gt,Ot,Zt.data);E.generateMipmaps=!1}else Oe?(qe&&e.texStorage2D(3553,U,$t,z.width,z.height),e.texSubImage2D(3553,0,0,0,z.width,z.height,Gt,Ot,z.data)):e.texImage2D(3553,0,$t,z.width,z.height,0,Gt,Ot,z.data);else if(E.isCompressedTexture)if(E.isCompressedArrayTexture){Oe&&qe&&e.texStorage3D(35866,U,$t,Ie[0].width,Ie[0].height,z.depth);for(let st=0,_t=Ie.length;st<_t;st++)Zt=Ie[st],E.format!==pn?null!==Gt?Oe?e.compressedTexSubImage3D(35866,st,0,0,0,Zt.width,Zt.height,z.depth,Gt,Zt.data,0,0):e.compressedTexImage3D(35866,st,$t,Zt.width,Zt.height,z.depth,0,Zt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Oe?e.texSubImage3D(35866,st,0,0,0,Zt.width,Zt.height,z.depth,Gt,Ot,Zt.data):e.texImage3D(35866,st,$t,Zt.width,Zt.height,z.depth,0,Gt,Ot,Zt.data)}else{Oe&&qe&&e.texStorage2D(3553,U,$t,Ie[0].width,Ie[0].height);for(let st=0,_t=Ie.length;st<_t;st++)Zt=Ie[st],E.format!==pn?null!==Gt?Oe?e.compressedTexSubImage2D(3553,st,0,0,Zt.width,Zt.height,Gt,Zt.data):e.compressedTexImage2D(3553,st,$t,Zt.width,Zt.height,0,Zt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Oe?e.texSubImage2D(3553,st,0,0,Zt.width,Zt.height,Gt,Ot,Zt.data):e.texImage2D(3553,st,$t,Zt.width,Zt.height,0,Gt,Ot,Zt.data)}else if(E.isDataArrayTexture)Oe?(qe&&e.texStorage3D(35866,U,$t,z.width,z.height,z.depth),e.texSubImage3D(35866,0,0,0,0,z.width,z.height,z.depth,Gt,Ot,z.data)):e.texImage3D(35866,0,$t,z.width,z.height,z.depth,0,Gt,Ot,z.data);else if(E.isData3DTexture)Oe?(qe&&e.texStorage3D(32879,U,$t,z.width,z.height,z.depth),e.texSubImage3D(32879,0,0,0,0,z.width,z.height,z.depth,Gt,Ot,z.data)):e.texImage3D(32879,0,$t,z.width,z.height,z.depth,0,Gt,Ot,z.data);else if(E.isFramebufferTexture){if(qe)if(Oe)e.texStorage2D(3553,U,$t,z.width,z.height);else{let st=z.width,_t=z.height;for(let Ut=0;Ut<U;Ut++)e.texImage2D(3553,Ut,$t,st,_t,0,Gt,Ot,null),st>>=1,_t>>=1}}else if(Ie.length>0&&Dt){Oe&&qe&&e.texStorage2D(3553,U,$t,Ie[0].width,Ie[0].height);for(let st=0,_t=Ie.length;st<_t;st++)Zt=Ie[st],Oe?e.texSubImage2D(3553,st,0,0,Gt,Ot,Zt):e.texImage2D(3553,st,$t,Gt,Ot,Zt);E.generateMipmaps=!1}else Oe?(qe&&e.texStorage2D(3553,U,$t,z.width,z.height),e.texSubImage2D(3553,0,0,0,Gt,Ot,z)):e.texImage2D(3553,0,$t,Gt,Ot,z);S(E,Dt)&&A(gt),oe.__version=It.version,E.onUpdate&&E.onUpdate(E)}L.__version=E.version}function St(L,E,Q,gt,bt){const It=r.convert(Q.format,Q.encoding),oe=r.convert(Q.type),B=w(Q.internalFormat,It,oe,Q.encoding);i.get(E).__hasExternalTextures||(32879===bt||35866===bt?e.texImage3D(bt,0,B,E.width,E.height,E.depth,0,It,oe,null):e.texImage2D(bt,0,B,E.width,E.height,0,It,oe,null)),e.bindFramebuffer(36160,L),te(E)?d.framebufferTexture2DMultisampleEXT(36160,gt,bt,i.get(Q).__webglTexture,0,ne(E)):(3553===bt||bt>=34069&&bt<=34074)&&n.framebufferTexture2D(36160,gt,bt,i.get(Q).__webglTexture,0),e.bindFramebuffer(36160,null)}function ae(L,E,Q){if(n.bindRenderbuffer(36161,L),E.depthBuffer&&!E.stencilBuffer){let gt=33189;if(Q||te(E)){const bt=E.depthTexture;bt&&bt.isDepthTexture&&(bt.type===_s?gt=36012:bt.type===Gs&&(gt=33190));const It=ne(E);te(E)?d.renderbufferStorageMultisampleEXT(36161,It,gt,E.width,E.height):n.renderbufferStorageMultisample(36161,It,gt,E.width,E.height)}else n.renderbufferStorage(36161,gt,E.width,E.height);n.framebufferRenderbuffer(36160,36096,36161,L)}else if(E.depthBuffer&&E.stencilBuffer){const gt=ne(E);Q&&!1===te(E)?n.renderbufferStorageMultisample(36161,gt,35056,E.width,E.height):te(E)?d.renderbufferStorageMultisampleEXT(36161,gt,35056,E.width,E.height):n.renderbufferStorage(36161,34041,E.width,E.height),n.framebufferRenderbuffer(36160,33306,36161,L)}else{const gt=!0===E.isWebGLMultipleRenderTargets?E.texture:[E.texture];for(let bt=0;bt<gt.length;bt++){const It=gt[bt],oe=r.convert(It.format,It.encoding),B=r.convert(It.type),z=w(It.internalFormat,oe,B,It.encoding),Dt=ne(E);Q&&!1===te(E)?n.renderbufferStorageMultisample(36161,Dt,z,E.width,E.height):te(E)?d.renderbufferStorageMultisampleEXT(36161,Dt,z,E.width,E.height):n.renderbufferStorage(36161,z,E.width,E.height)}}n.bindRenderbuffer(36161,null)}function rt(L){const E=i.get(L),Q=!0===L.isWebGLCubeRenderTarget;if(L.depthTexture&&!E.__autoAllocateDepthBuffer){if(Q)throw new Error("target.depthTexture not supported in Cube render targets");!function lt(L,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,L),!E.depthTexture||!E.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),ft(E.depthTexture,0);const gt=i.get(E.depthTexture).__webglTexture,bt=ne(E);if(E.depthTexture.format===zs)te(E)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,gt,0,bt):n.framebufferTexture2D(36160,36096,3553,gt,0);else{if(E.depthTexture.format!==Rr)throw new Error("Unknown depthTexture format");te(E)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,gt,0,bt):n.framebufferTexture2D(36160,33306,3553,gt,0)}}(E.__webglFramebuffer,L)}else if(Q){E.__webglDepthbuffer=[];for(let gt=0;gt<6;gt++)e.bindFramebuffer(36160,E.__webglFramebuffer[gt]),E.__webglDepthbuffer[gt]=n.createRenderbuffer(),ae(E.__webglDepthbuffer[gt],L,!1)}else e.bindFramebuffer(36160,E.__webglFramebuffer),E.__webglDepthbuffer=n.createRenderbuffer(),ae(E.__webglDepthbuffer,L,!1);e.bindFramebuffer(36160,null)}function ne(L){return Math.min(u,L.samples)}function te(L){const E=i.get(L);return o&&L.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==E.__useRenderToTexture}function ke(L,E){const Q=L.encoding,gt=L.format,bt=L.type;return!0===L.isCompressedTexture||!0===L.isVideoTexture||1035===L.format||Q!==Hs&&(Q===Qe?!1===o?!0===t.has("EXT_sRGB")&&gt===pn?(L.format=1035,L.minFilter=gi,L.generateMipmaps=!1):E=wf.sRGBToLinear(E):(gt!==pn||bt!==ks)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Q)),E}this.allocateTextureUnit=function $(){const L=X;return L>=l&&console.warn("THREE.WebGLTextures: Trying to use "+L+" texture units while this GPU supports only "+l),X+=1,L},this.resetTextureUnits=function j(){X=0},this.setTexture2D=ft,this.setTexture2DArray=function K(L,E){const Q=i.get(L);L.version>0&&Q.__version!==L.version?Lt(Q,L,E):e.bindTexture(35866,Q.__webglTexture,33984+E)},this.setTexture3D=function tt(L,E){const Q=i.get(L);L.version>0&&Q.__version!==L.version?Lt(Q,L,E):e.bindTexture(32879,Q.__webglTexture,33984+E)},this.setTextureCube=function vt(L,E){const Q=i.get(L);L.version>0&&Q.__version!==L.version?function jt(L,E,Q){if(6!==E.image.length)return;const gt=Qt(L,E),bt=E.source;e.bindTexture(34067,L.__webglTexture,33984+Q);const It=i.get(bt);if(bt.version!==It.__version||!0===gt){e.activeTexture(33984+Q),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const oe=E.isCompressedTexture||E.image[0].isCompressedTexture,B=E.image[0]&&E.image[0].isDataTexture,z=[];for(let st=0;st<6;st++)z[st]=oe||B?B?E.image[st].image:E.image[st]:y(E.image[st],!1,!0,h),z[st]=ke(E,z[st]);const Dt=z[0],Gt=b(Dt)||o,Ot=r.convert(E.format,E.encoding),$t=r.convert(E.type),Zt=w(E.internalFormat,Ot,$t,E.encoding),Ie=o&&!0!==E.isVideoTexture,Oe=void 0===It.__version||!0===gt;let U,qe=T(E,Dt,Gt);if(it(34067,E,Gt),oe){Ie&&Oe&&e.texStorage2D(34067,qe,Zt,Dt.width,Dt.height);for(let st=0;st<6;st++){U=z[st].mipmaps;for(let _t=0;_t<U.length;_t++){const Ut=U[_t];E.format!==pn?null!==Ot?Ie?e.compressedTexSubImage2D(34069+st,_t,0,0,Ut.width,Ut.height,Ot,Ut.data):e.compressedTexImage2D(34069+st,_t,Zt,Ut.width,Ut.height,0,Ut.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ie?e.texSubImage2D(34069+st,_t,0,0,Ut.width,Ut.height,Ot,$t,Ut.data):e.texImage2D(34069+st,_t,Zt,Ut.width,Ut.height,0,Ot,$t,Ut.data)}}}else{U=E.mipmaps,Ie&&Oe&&(U.length>0&&qe++,e.texStorage2D(34067,qe,Zt,z[0].width,z[0].height));for(let st=0;st<6;st++)if(B){Ie?e.texSubImage2D(34069+st,0,0,0,z[st].width,z[st].height,Ot,$t,z[st].data):e.texImage2D(34069+st,0,Zt,z[st].width,z[st].height,0,Ot,$t,z[st].data);for(let _t=0;_t<U.length;_t++){const qt=U[_t].image[st].image;Ie?e.texSubImage2D(34069+st,_t+1,0,0,qt.width,qt.height,Ot,$t,qt.data):e.texImage2D(34069+st,_t+1,Zt,qt.width,qt.height,0,Ot,$t,qt.data)}}else{Ie?e.texSubImage2D(34069+st,0,0,0,Ot,$t,z[st]):e.texImage2D(34069+st,0,Zt,Ot,$t,z[st]);for(let _t=0;_t<U.length;_t++){const Ut=U[_t];Ie?e.texSubImage2D(34069+st,_t+1,0,0,Ot,$t,Ut.image[st]):e.texImage2D(34069+st,_t+1,Zt,Ot,$t,Ut.image[st])}}}S(E,Gt)&&A(34067),It.__version=bt.version,E.onUpdate&&E.onUpdate(E)}L.__version=E.version}(Q,L,E):e.bindTexture(34067,Q.__webglTexture,33984+E)},this.rebindTextures=function wt(L,E,Q){const gt=i.get(L);void 0!==E&&St(gt.__webglFramebuffer,L,L.texture,36064,3553),void 0!==Q&&rt(L)},this.setupRenderTarget=function Nt(L){const E=L.texture,Q=i.get(L),gt=i.get(E);L.addEventListener("dispose",Y),!0!==L.isWebGLMultipleRenderTargets&&(void 0===gt.__webglTexture&&(gt.__webglTexture=n.createTexture()),gt.__version=E.version,a.memory.textures++);const bt=!0===L.isWebGLCubeRenderTarget,It=!0===L.isWebGLMultipleRenderTargets,oe=b(L)||o;if(bt){Q.__webglFramebuffer=[];for(let B=0;B<6;B++)Q.__webglFramebuffer[B]=n.createFramebuffer()}else{if(Q.__webglFramebuffer=n.createFramebuffer(),It)if(s.drawBuffers){const B=L.texture;for(let z=0,Dt=B.length;z<Dt;z++){const Gt=i.get(B[z]);void 0===Gt.__webglTexture&&(Gt.__webglTexture=n.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&L.samples>0&&!1===te(L)){const B=It?E:[E];Q.__webglMultisampledFramebuffer=n.createFramebuffer(),Q.__webglColorRenderbuffer=[],e.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer);for(let z=0;z<B.length;z++){const Dt=B[z];Q.__webglColorRenderbuffer[z]=n.createRenderbuffer(),n.bindRenderbuffer(36161,Q.__webglColorRenderbuffer[z]);const Gt=r.convert(Dt.format,Dt.encoding),Ot=r.convert(Dt.type),$t=w(Dt.internalFormat,Gt,Ot,Dt.encoding,!0===L.isXRRenderTarget),Zt=ne(L);n.renderbufferStorageMultisample(36161,Zt,$t,L.width,L.height),n.framebufferRenderbuffer(36160,36064+z,36161,Q.__webglColorRenderbuffer[z])}n.bindRenderbuffer(36161,null),L.depthBuffer&&(Q.__webglDepthRenderbuffer=n.createRenderbuffer(),ae(Q.__webglDepthRenderbuffer,L,!0)),e.bindFramebuffer(36160,null)}}if(bt){e.bindTexture(34067,gt.__webglTexture),it(34067,E,oe);for(let B=0;B<6;B++)St(Q.__webglFramebuffer[B],L,E,36064,34069+B);S(E,oe)&&A(34067),e.unbindTexture()}else if(It){const B=L.texture;for(let z=0,Dt=B.length;z<Dt;z++){const Gt=B[z],Ot=i.get(Gt);e.bindTexture(3553,Ot.__webglTexture),it(3553,Gt,oe),St(Q.__webglFramebuffer,L,Gt,36064+z,3553),S(Gt,oe)&&A(3553)}e.unbindTexture()}else{let B=3553;(L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(o?B=L.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(B,gt.__webglTexture),it(B,E,oe),St(Q.__webglFramebuffer,L,E,36064,B),S(E,oe)&&A(B),e.unbindTexture()}L.depthBuffer&&rt(L)},this.updateRenderTargetMipmap=function Tt(L){const E=b(L)||o,Q=!0===L.isWebGLMultipleRenderTargets?L.texture:[L.texture];for(let gt=0,bt=Q.length;gt<bt;gt++){const It=Q[gt];if(S(It,E)){const oe=L.isWebGLCubeRenderTarget?34067:3553,B=i.get(It).__webglTexture;e.bindTexture(oe,B),A(oe),e.unbindTexture()}}},this.updateMultisampleRenderTarget=function ue(L){if(o&&L.samples>0&&!1===te(L)){const E=L.isWebGLMultipleRenderTargets?L.texture:[L.texture],Q=L.width,gt=L.height;let bt=16384;const It=[],oe=L.stencilBuffer?33306:36096,B=i.get(L),z=!0===L.isWebGLMultipleRenderTargets;if(z)for(let Dt=0;Dt<E.length;Dt++)e.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Dt,36161,null),e.bindFramebuffer(36160,B.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Dt,3553,null,0);e.bindFramebuffer(36008,B.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,B.__webglFramebuffer);for(let Dt=0;Dt<E.length;Dt++){It.push(36064+Dt),L.depthBuffer&&It.push(oe);const Gt=void 0!==B.__ignoreDepthValues&&B.__ignoreDepthValues;if(!1===Gt&&(L.depthBuffer&&(bt|=256),L.stencilBuffer&&(bt|=1024)),z&&n.framebufferRenderbuffer(36008,36064,36161,B.__webglColorRenderbuffer[Dt]),!0===Gt&&(n.invalidateFramebuffer(36008,[oe]),n.invalidateFramebuffer(36009,[oe])),z){const Ot=i.get(E[Dt]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Ot,0)}n.blitFramebuffer(0,0,Q,gt,0,0,Q,gt,bt,9728),f&&n.invalidateFramebuffer(36008,It)}if(e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null),z)for(let Dt=0;Dt<E.length;Dt++){e.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Dt,36161,B.__webglColorRenderbuffer[Dt]);const Gt=i.get(E[Dt]).__webglTexture;e.bindFramebuffer(36160,B.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Dt,3553,Gt,0)}e.bindFramebuffer(36009,B.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=rt,this.setupFrameBufferTexture=St,this.useMultisampledRTT=te}function _1(n,t,e){const i=e.isWebGL2;return{convert:function s(r,a=null){let o;if(r===ks)return 5121;if(1017===r)return 32819;if(1018===r)return 32820;if(1010===r)return 5120;if(1011===r)return 5122;if(1012===r)return 5123;if(1013===r)return 5124;if(r===Gs)return 5125;if(r===_s)return 5126;if(r===Ia)return i?5131:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(1021===r)return 6406;if(r===pn)return 6408;if(1024===r)return 6409;if(1025===r)return 6410;if(r===zs)return 6402;if(r===Rr)return 34041;if(1022===r)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===r)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(1028===r)return 6403;if(1029===r)return 36244;if(1030===r)return 33319;if(1031===r)return 33320;if(1033===r)return 36249;if(33776===r||33777===r||33778===r||33779===r)if(a===Qe){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(33776===r)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===r)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===r)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===r)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(33776===r)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(35840===r)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===r||37496===r){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(37492===r)return a===Qe?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(37496===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(37808===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===r)return a===Qe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===r){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(36492===r)return a===Qe?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}return r===Cr?i?34042:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[r]?n[r]:null}}}class y1 extends Oi{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Wa extends mn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const x1={type:"move"};class Rc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Wa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Wa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new I,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new I),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Wa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new I,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new I),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let s=null,r=null,a=null;const o=this._targetRay,l=this._grip,h=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(h&&t.hand){a=!0;for(const m of t.hand.values()){const g=e.getJointPose(m,i),x=this._getHandJoint(h,m);null!==g&&(x.matrix.fromArray(g.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.jointRadius=g.radius),x.visible=null!==g}const d=h.joints["index-finger-tip"].position.distanceTo(h.joints["thumb-tip"].position),f=.02,p=.005;h.inputState.pinching&&d>f+p?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&d<=f-p&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==l&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));null!==o&&(s=e.getPose(t.targetRaySpace,i),null===s&&null!==r&&(s=r),null!==s&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(x1)))}return null!==o&&(o.visible=null!==s),null!==l&&(l.visible=null!==r),null!==h&&(h.visible=null!==a),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new Wa;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class v1 extends Mn{constructor(t,e,i,s,r,a,o,l,h,c){if((c=void 0!==c?c:zs)!==zs&&c!==Rr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===zs&&(i=Gs),void 0===i&&c===Rr&&(i=Cr),super(null,s,r,a,o,l,c,i,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:mi,this.minFilter=void 0!==l?l:mi,this.flipY=!1,this.generateMipmaps=!1}}class b1 extends Ws{constructor(t,e){super();const i=this;let s=null,r=1,a=null,o="local-floor",l=null,h=null,c=null,u=null,d=null,f=null;const p=e.getContextAttributes();let m=null,g=null;const x=[],v=[],y=new Set,b=new Map,M=new Oi;M.layers.enable(1),M.viewport=new Ze;const S=new Oi;S.layers.enable(2),S.viewport=new Ze;const A=[M,S],w=new y1;w.layers.enable(1),w.layers.enable(2);let T=null,C=null;function F(K){const tt=v.indexOf(K.inputSource);if(-1===tt)return;const vt=x[tt];void 0!==vt&&vt.dispatchEvent({type:K.type,data:K.inputSource})}function Y(){s.removeEventListener("select",F),s.removeEventListener("selectstart",F),s.removeEventListener("selectend",F),s.removeEventListener("squeeze",F),s.removeEventListener("squeezestart",F),s.removeEventListener("squeezeend",F),s.removeEventListener("end",Y),s.removeEventListener("inputsourceschange",O);for(let K=0;K<x.length;K++){const tt=v[K];null!==tt&&(v[K]=null,x[K].disconnect(tt))}T=null,C=null,t.setRenderTarget(m),d=null,u=null,c=null,s=null,g=null,ft.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function O(K){for(let tt=0;tt<K.removed.length;tt++){const vt=K.removed[tt],mt=v.indexOf(vt);mt>=0&&(v[mt]=null,x[mt].disconnect(vt))}for(let tt=0;tt<K.added.length;tt++){const vt=K.added[tt];let mt=v.indexOf(vt);if(-1===mt){for(let it=0;it<x.length;it++){if(it>=v.length){v.push(vt),mt=it;break}if(null===v[it]){v[it]=vt,mt=it;break}}if(-1===mt)break}const At=x[mt];At&&At.connect(vt)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let tt=x[K];return void 0===tt&&(tt=new Rc,x[K]=tt),tt.getTargetRaySpace()},this.getControllerGrip=function(K){let tt=x[K];return void 0===tt&&(tt=new Rc,x[K]=tt),tt.getGripSpace()},this.getHand=function(K){let tt=x[K];return void 0===tt&&(tt=new Rc,x[K]=tt),tt.getHandSpace()},this.setFramebufferScaleFactor=function(K){r=K,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){o=K,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(K){l=K},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=function(){var K=(0,Et.Z)(function*(tt){if(s=tt,null!==s){if(m=t.getRenderTarget(),s.addEventListener("select",F),s.addEventListener("selectstart",F),s.addEventListener("selectend",F),s.addEventListener("squeeze",F),s.addEventListener("squeezestart",F),s.addEventListener("squeezeend",F),s.addEventListener("end",Y),s.addEventListener("inputsourceschange",O),!0!==p.xrCompatible&&(yield e.makeXRCompatible()),void 0===s.renderState.layers||!1===t.capabilities.isWebGL2)d=new XRWebGLLayer(s,e,{antialias:void 0!==s.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r}),s.updateRenderState({baseLayer:d}),g=new Zs(d.framebufferWidth,d.framebufferHeight,{format:pn,type:ks,encoding:t.outputEncoding,stencilBuffer:p.stencil});else{let vt=null,mt=null,At=null;p.depth&&(At=p.stencil?35056:33190,vt=p.stencil?Rr:zs,mt=p.stencil?Cr:Gs);const it={colorFormat:32856,depthFormat:At,scaleFactor:r};c=new XRWebGLBinding(s,e),u=c.createProjectionLayer(it),s.updateRenderState({layers:[u]}),g=new Zs(u.textureWidth,u.textureHeight,{format:pn,type:ks,depthTexture:new v1(u.textureWidth,u.textureHeight,mt,void 0,void 0,void 0,void 0,void 0,void 0,vt),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0}),t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),l=null,a=yield s.requestReferenceSpace(o),ft.setContext(s),ft.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(tt){return K.apply(this,arguments)}}();const D=new I,W=new I;function j(K,tt){null===tt?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(tt.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(null===s)return;w.near=S.near=M.near=K.near,w.far=S.far=M.far=K.far,(T!==w.near||C!==w.far)&&(s.updateRenderState({depthNear:w.near,depthFar:w.far}),T=w.near,C=w.far);const tt=K.parent,vt=w.cameras;j(w,tt);for(let At=0;At<vt.length;At++)j(vt[At],tt);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),K.matrix.copy(w.matrix),K.matrix.decompose(K.position,K.quaternion,K.scale);const mt=K.children;for(let At=0,it=mt.length;At<it;At++)mt[At].updateMatrixWorld(!0);2===vt.length?function X(K,tt,vt){D.setFromMatrixPosition(tt.matrixWorld),W.setFromMatrixPosition(vt.matrixWorld);const mt=D.distanceTo(W),At=tt.projectionMatrix.elements,it=vt.projectionMatrix.elements,Qt=At[14]/(At[10]-1),Lt=At[14]/(At[10]+1),jt=(At[9]+1)/At[5],St=(At[9]-1)/At[5],ae=(At[8]-1)/At[0],lt=(it[8]+1)/it[0],rt=Qt*ae,wt=Qt*lt,Nt=mt/(-ae+lt),Tt=Nt*-ae;tt.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(Tt),K.translateZ(Nt),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert();const ue=Qt+Nt,ne=Lt+Nt;K.projectionMatrix.makePerspective(rt-Tt,wt+(mt-Tt),jt*Lt/ne*ue,St*Lt/ne*ue,ue,ne)}(w,M,S):w.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(K){null!==u&&(u.fixedFoveation=K),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=K)},this.getPlanes=function(){return y};let $=null;const ft=new Nf;ft.setAnimationLoop(function et(K,tt){if(h=tt.getViewerPose(l||a),f=tt,null!==h){const vt=h.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let mt=!1;vt.length!==w.cameras.length&&(w.cameras.length=0,mt=!0);for(let At=0;At<vt.length;At++){const it=vt[At];let Qt=null;if(null!==d)Qt=d.getViewport(it);else{const jt=c.getViewSubImage(u,it);Qt=jt.viewport,0===At&&(t.setRenderTargetTextures(g,jt.colorTexture,u.ignoreDepthValues?void 0:jt.depthStencilTexture),t.setRenderTarget(g))}let Lt=A[At];void 0===Lt&&(Lt=new Oi,Lt.layers.enable(At),Lt.viewport=new Ze,A[At]=Lt),Lt.matrix.fromArray(it.transform.matrix),Lt.projectionMatrix.fromArray(it.projectionMatrix),Lt.viewport.set(Qt.x,Qt.y,Qt.width,Qt.height),0===At&&w.matrix.copy(Lt.matrix),!0===mt&&w.cameras.push(Lt)}}for(let vt=0;vt<x.length;vt++){const mt=v[vt],At=x[vt];null!==mt&&void 0!==At&&At.update(mt,tt,l||a)}if($&&$(K,tt),tt.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:tt.detectedPlanes});let vt=null;for(const mt of y)tt.detectedPlanes.has(mt)||(null===vt&&(vt=[]),vt.push(mt));if(null!==vt)for(const mt of vt)y.delete(mt),b.delete(mt),i.dispatchEvent({type:"planeremoved",data:mt});for(const mt of tt.detectedPlanes)if(y.has(mt)){const At=b.get(mt);mt.lastChangedTime>At&&(b.set(mt,mt.lastChangedTime),i.dispatchEvent({type:"planechanged",data:mt}))}else y.add(mt),b.set(mt,tt.lastChangedTime),i.dispatchEvent({type:"planeadded",data:mt})}f=null}),this.setAnimationLoop=function(K){$=K},this.dispose=function(){}}}function w1(n,t){function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,1===g.side&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),1===g.side&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const x=t.get(g).envMap;if(x&&(m.envMap.value=x,m.flipEnvMap.value=x.isCubeTexture&&!1===x.isRenderTargetTexture?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;const b=!0!==n.physicallyCorrectLights?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*b}let v,y;g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity),g.map?v=g.map:g.specularMap?v=g.specularMap:g.displacementMap?v=g.displacementMap:g.normalMap?v=g.normalMap:g.bumpMap?v=g.bumpMap:g.roughnessMap?v=g.roughnessMap:g.metalnessMap?v=g.metalnessMap:g.alphaMap?v=g.alphaMap:g.emissiveMap?v=g.emissiveMap:g.clearcoatMap?v=g.clearcoatMap:g.clearcoatNormalMap?v=g.clearcoatNormalMap:g.clearcoatRoughnessMap?v=g.clearcoatRoughnessMap:g.iridescenceMap?v=g.iridescenceMap:g.iridescenceThicknessMap?v=g.iridescenceThicknessMap:g.specularIntensityMap?v=g.specularIntensityMap:g.specularColorMap?v=g.specularColorMap:g.transmissionMap?v=g.transmissionMap:g.thicknessMap?v=g.thicknessMap:g.sheenColorMap?v=g.sheenColorMap:g.sheenRoughnessMap&&(v=g.sheenRoughnessMap),void 0!==v&&(v.isWebGLRenderTarget&&(v=v.texture),!0===v.matrixAutoUpdate&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix)),g.aoMap?y=g.aoMap:g.lightMap&&(y=g.lightMap),void 0!==y&&(y.isWebGLRenderTarget&&(y=y.texture),!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uv2Transform.value.copy(y.matrix))}return{refreshFogUniforms:function e(m,g){g.color.getRGB(m.fogColor.value,Ff(n)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)},refreshMaterialUniforms:function i(m,g,x,v,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),function c(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}(m,g)):g.isMeshPhongMaterial?(s(m,g),function h(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}(m,g)):g.isMeshStandardMaterial?(s(m,g),function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}(m,g),g.isMeshPhysicalMaterial&&function d(m,g,x){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,1===g.side&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=x.texture,m.transmissionSamplerSize.value.set(x.width,x.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}(m,g,y)):g.isMeshMatcapMaterial?(s(m,g),function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),function p(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(function r(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}(m,g),g.isLineDashedMaterial&&function a(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}(m,g)):g.isPointsMaterial?function o(m,g,x,v){let y;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*x,m.scale.value=.5*v,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?y=g.map:g.alphaMap&&(y=g.alphaMap),void 0!==y&&(!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}(m,g,x,v):g.isSpriteMaterial?function l(m,g){let x;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),void 0!==x&&(!0===x.matrixAutoUpdate&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function M1(n,t,e,i){let s={},r={},a=[];const o=e.isWebGL2?n.getParameter(35375):0;function f(v,y,b){const M=v.value;if(void 0===b[y]){if("number"==typeof M)b[y]=M;else{const S=Array.isArray(M)?M:[M],A=[];for(let w=0;w<S.length;w++)A.push(S[w].clone());b[y]=A}return!0}if("number"==typeof M){if(b[y]!==M)return b[y]=M,!0}else{const S=Array.isArray(b[y])?b[y]:[b[y]],A=Array.isArray(M)?M:[M];for(let w=0;w<S.length;w++){const T=S[w];if(!1===T.equals(A[w]))return T.copy(A[w]),!0}}return!1}function m(v){const y={boundary:0,storage:0};return"number"==typeof v?(y.boundary=4,y.storage=4):v.isVector2?(y.boundary=8,y.storage=8):v.isVector3||v.isColor?(y.boundary=16,y.storage=12):v.isVector4?(y.boundary=16,y.storage=16):v.isMatrix3?(y.boundary=48,y.storage=48):v.isMatrix4?(y.boundary=64,y.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),y}function g(v){const y=v.target;y.removeEventListener("dispose",g);const b=a.indexOf(y.__bindingPointIndex);a.splice(b,1),n.deleteBuffer(s[y.id]),delete s[y.id],delete r[y.id]}return{bind:function l(v,y){i.uniformBlockBinding(v,y.program)},update:function h(v,y){let b=s[v.id];void 0===b&&(function p(v){const y=v.uniforms;let b=0;let S=0;for(let A=0,w=y.length;A<w;A++){const T=y[A],C={boundary:0,storage:0},F=Array.isArray(T.value)?T.value:[T.value];for(let Y=0,O=F.length;Y<O;Y++){const W=m(F[Y]);C.boundary+=W.boundary,C.storage+=W.storage}if(T.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=b,A>0){S=b%16;const Y=16-S;0!==S&&Y-C.boundary<0&&(b+=16-S,T.__offset=b)}b+=C.storage}S=b%16,S>0&&(b+=16-S),v.__size=b,v.__cache={}}(v),b=function c(v){const y=function u(){for(let v=0;v<o;v++)if(-1===a.indexOf(v))return a.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();v.__bindingPointIndex=y;const b=n.createBuffer(),M=v.__size,S=v.usage;return n.bindBuffer(35345,b),n.bufferData(35345,M,S),n.bindBuffer(35345,null),n.bindBufferBase(35345,y,b),b}(v),s[v.id]=b,v.addEventListener("dispose",g)),i.updateUBOMapping(v,y.program);const S=t.render.frame;r[v.id]!==S&&(function d(v){const b=v.uniforms,M=v.__cache;n.bindBuffer(35345,s[v.id]);for(let S=0,A=b.length;S<A;S++){const w=b[S];if(!0===f(w,S,M)){const T=w.__offset,C=Array.isArray(w.value)?w.value:[w.value];let F=0;for(let Y=0;Y<C.length;Y++){const O=C[Y],D=m(O);"number"==typeof O?(w.__data[0]=O,n.bufferSubData(35345,T+F,w.__data)):O.isMatrix3?(w.__data[0]=O.elements[0],w.__data[1]=O.elements[1],w.__data[2]=O.elements[2],w.__data[3]=O.elements[0],w.__data[4]=O.elements[3],w.__data[5]=O.elements[4],w.__data[6]=O.elements[5],w.__data[7]=O.elements[0],w.__data[8]=O.elements[6],w.__data[9]=O.elements[7],w.__data[10]=O.elements[8],w.__data[11]=O.elements[0]):(O.toArray(w.__data,F),F+=D.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,T,w.__data)}}n.bindBuffer(35345,null)}(v),r[v.id]=S)},dispose:function x(){for(const v in s)n.deleteBuffer(s[v]);a=[],s={},r={}}}}function dp(n={}){this.isWebGLRenderer=!0;const t=void 0!==n.canvas?n.canvas:function S1(){const n=Oa("canvas");return n.style.display="block",n}(),e=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,s=void 0===n.stencil||n.stencil,r=void 0!==n.antialias&&n.antialias,a=void 0===n.premultipliedAlpha||n.premultipliedAlpha,o=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,l=void 0!==n.powerPreference?n.powerPreference:"default",h=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let c;c=null!==e?e.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let u=null,d=null;const f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Hs,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,x=0,v=0,y=null,b=-1,M=null;const S=new Ze,A=new Ze;let w=null,T=t.width,C=t.height,F=1,Y=null,O=null;const D=new Ze(0,0,T,C),W=new Ze(0,0,T,C);let X=!1;const j=new wc;let $=!1,et=!1,ft=null;const K=new _e,tt=new dt,vt=new I,mt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function At(){return null===y?F:1}let Lt,jt,St,ae,lt,rt,wt,Nt,Tt,ue,ne,te,$e,ke,L,E,Q,gt,bt,It,oe,B,z,Dt,it=e;function Qt(R,Z){for(let at=0;at<R.length;at++){const ct=t.getContext(R[at],Z);if(null!==ct)return ct}return null}try{const R={alpha:!0,depth:i,stencil:s,antialias:r,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r148"),t.addEventListener("webglcontextlost",$t,!1),t.addEventListener("webglcontextrestored",Zt,!1),t.addEventListener("webglcontextcreationerror",Ie,!1),null===it){const Z=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&Z.shift(),it=Qt(Z,R),null===it)throw Qt(Z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===it.getShaderPrecisionFormat&&(it.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}function Gt(){Lt=new Nv(it),jt=new Pv(it,Lt,n),Lt.init(jt),B=new _1(it,Lt,jt),St=new m1(it,Lt,jt),ae=new Gv,lt=new n1,rt=new g1(it,Lt,St,lt,jt,B,ae),wt=new Lv(m),Nt=new Fv(m),Tt=new Ry(it,jt),z=new Rv(it,Lt,Tt,jt),ue=new Uv(it,Tt,ae,z),ne=new Wv(it,ue,Tt,ae),bt=new Vv(it,jt,rt),E=new Dv(lt),te=new i1(m,wt,Nt,Lt,jt,z,E),$e=new w1(m,lt),ke=new r1,L=new u1(Lt,jt),gt=new Cv(m,wt,Nt,St,ne,c,a),Q=new p1(m,ne,jt),Dt=new M1(it,ae,jt,St),It=new Iv(it,Lt,ae,jt),oe=new kv(it,Lt,ae,jt),ae.programs=te.programs,m.capabilities=jt,m.extensions=Lt,m.properties=lt,m.renderLists=ke,m.shadowMap=Q,m.state=St,m.info=ae}Gt();const Ot=new b1(m,it);function $t(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function Zt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const R=ae.autoReset,Z=Q.enabled,at=Q.autoUpdate,V=Q.needsUpdate,ct=Q.type;Gt(),ae.autoReset=R,Q.enabled=Z,Q.autoUpdate=at,Q.needsUpdate=V,Q.type=ct}function Ie(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function Oe(R){const Z=R.target;Z.removeEventListener("dispose",Oe),function qe(R){(function U(R){const Z=lt.get(R).programs;void 0!==Z&&(Z.forEach(function(at){te.releaseProgram(at)}),R.isShaderMaterial&&te.releaseShaderCache(R))})(R),lt.remove(R)}(Z)}this.xr=Ot,this.getContext=function(){return it},this.getContextAttributes=function(){return it.getContextAttributes()},this.forceContextLoss=function(){const R=Lt.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=Lt.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(R){void 0!==R&&(F=R,this.setSize(T,C,!1))},this.getSize=function(R){return R.set(T,C)},this.setSize=function(R,Z,at){Ot.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=R,C=Z,t.width=Math.floor(R*F),t.height=Math.floor(Z*F),!1!==at&&(t.style.width=R+"px",t.style.height=Z+"px"),this.setViewport(0,0,R,Z))},this.getDrawingBufferSize=function(R){return R.set(T*F,C*F).floor()},this.setDrawingBufferSize=function(R,Z,at){T=R,C=Z,F=at,t.width=Math.floor(R*at),t.height=Math.floor(Z*at),this.setViewport(0,0,R,Z)},this.getCurrentViewport=function(R){return R.copy(S)},this.getViewport=function(R){return R.copy(D)},this.setViewport=function(R,Z,at,V){R.isVector4?D.set(R.x,R.y,R.z,R.w):D.set(R,Z,at,V),St.viewport(S.copy(D).multiplyScalar(F).floor())},this.getScissor=function(R){return R.copy(W)},this.setScissor=function(R,Z,at,V){R.isVector4?W.set(R.x,R.y,R.z,R.w):W.set(R,Z,at,V),St.scissor(A.copy(W).multiplyScalar(F).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(R){St.setScissorTest(X=R)},this.setOpaqueSort=function(R){Y=R},this.setTransparentSort=function(R){O=R},this.getClearColor=function(R){return R.copy(gt.getClearColor())},this.setClearColor=function(){gt.setClearColor.apply(gt,arguments)},this.getClearAlpha=function(){return gt.getClearAlpha()},this.setClearAlpha=function(){gt.setClearAlpha.apply(gt,arguments)},this.clear=function(R=!0,Z=!0,at=!0){let V=0;R&&(V|=16384),Z&&(V|=256),at&&(V|=1024),it.clear(V)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",$t,!1),t.removeEventListener("webglcontextrestored",Zt,!1),t.removeEventListener("webglcontextcreationerror",Ie,!1),ke.dispose(),L.dispose(),lt.dispose(),wt.dispose(),Nt.dispose(),ne.dispose(),z.dispose(),Dt.dispose(),te.dispose(),Ot.dispose(),Ot.removeEventListener("sessionstart",Ut),Ot.removeEventListener("sessionend",qt),ft&&(ft.dispose(),ft=null),Ve.stop()},this.renderBufferDirect=function(R,Z,at,V,ct,se){null===Z&&(Z=mt);const pe=ct.isMesh&&ct.matrixWorld.determinant()<0,we=function kP(R,Z,at,V,ct){!0!==Z.isScene&&(Z=mt),rt.resetTextureUnits();const se=Z.fog,we=null===y?m.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:Hs,Te=(V.isMeshStandardMaterial?Nt:wt).get(V.envMap||(V.isMeshStandardMaterial?Z.environment:null)),Ge=!0===V.vertexColors&&!!at.attributes.color&&4===at.attributes.color.itemSize,Be=!!V.normalMap&&!!at.attributes.tangent,Fe=!!at.morphAttributes.position,xi=!!at.morphAttributes.normal,un=!!at.morphAttributes.color,gs=V.toneMapped?m.toneMapping:0,Mr=at.morphAttributes.position||at.morphAttributes.normal||at.morphAttributes.color,vi=void 0!==Mr?Mr.length:0,Ne=lt.get(V),Hd=d.state.lights;!0!==$||!0!==et&&R===M||E.setState(V,R,R===M&&V.id===b);let Pi=!1;V.version===Ne.__version?(Ne.needsLights&&Ne.lightsStateVersion!==Hd.state.version||Ne.outputEncoding!==we||ct.isInstancedMesh&&!1===Ne.instancing||!ct.isInstancedMesh&&!0===Ne.instancing||ct.isSkinnedMesh&&!1===Ne.skinning||!ct.isSkinnedMesh&&!0===Ne.skinning||Ne.envMap!==Te||!0===V.fog&&Ne.fog!==se||void 0!==Ne.numClippingPlanes&&(Ne.numClippingPlanes!==E.numPlanes||Ne.numIntersection!==E.numIntersection)||Ne.vertexAlphas!==Ge||Ne.vertexTangents!==Be||Ne.morphTargets!==Fe||Ne.morphNormals!==xi||Ne.morphColors!==un||Ne.toneMapping!==gs||!0===jt.isWebGL2&&Ne.morphTargetsCount!==vi)&&(Pi=!0):(Pi=!0,Ne.__version=V.version);let Sr=Ne.currentProgram;!0===Pi&&(Sr=bn(V,Z,ct));let y0=!1,Co=!1,Vd=!1;const qi=Sr.getUniforms(),Tr=Ne.uniforms;if(St.useProgram(Sr.program)&&(y0=!0,Co=!0,Vd=!0),V.id!==b&&(b=V.id,Co=!0),y0||M!==R){if(qi.setValue(it,"projectionMatrix",R.projectionMatrix),jt.logarithmicDepthBuffer&&qi.setValue(it,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),M!==R&&(M=R,Co=!0,Vd=!0),V.isShaderMaterial||V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshStandardMaterial||V.envMap){const dn=qi.map.cameraPosition;void 0!==dn&&dn.setValue(it,vt.setFromMatrixPosition(R.matrixWorld))}(V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshLambertMaterial||V.isMeshBasicMaterial||V.isMeshStandardMaterial||V.isShaderMaterial)&&qi.setValue(it,"isOrthographic",!0===R.isOrthographicCamera),(V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshLambertMaterial||V.isMeshBasicMaterial||V.isMeshStandardMaterial||V.isShaderMaterial||V.isShadowMaterial||ct.isSkinnedMesh)&&qi.setValue(it,"viewMatrix",R.matrixWorldInverse)}if(ct.isSkinnedMesh){qi.setOptional(it,ct,"bindMatrix"),qi.setOptional(it,ct,"bindMatrixInverse");const dn=ct.skeleton;dn&&(jt.floatVertexTextures?(null===dn.boneTexture&&dn.computeBoneTexture(),qi.setValue(it,"boneTexture",dn.boneTexture,rt),qi.setValue(it,"boneTextureSize",dn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Wd=at.morphAttributes;if((void 0!==Wd.position||void 0!==Wd.normal||void 0!==Wd.color&&!0===jt.isWebGL2)&&bt.update(ct,at,V,Sr),(Co||Ne.receiveShadow!==ct.receiveShadow)&&(Ne.receiveShadow=ct.receiveShadow,qi.setValue(it,"receiveShadow",ct.receiveShadow)),V.isMeshGouraudMaterial&&null!==V.envMap&&(Tr.envMap.value=Te,Tr.flipEnvMap.value=Te.isCubeTexture&&!1===Te.isRenderTargetTexture?-1:1),Co&&(qi.setValue(it,"toneMappingExposure",m.toneMappingExposure),Ne.needsLights&&function GP(R,Z){R.ambientLightColor.needsUpdate=Z,R.lightProbe.needsUpdate=Z,R.directionalLights.needsUpdate=Z,R.directionalLightShadows.needsUpdate=Z,R.pointLights.needsUpdate=Z,R.pointLightShadows.needsUpdate=Z,R.spotLights.needsUpdate=Z,R.spotLightShadows.needsUpdate=Z,R.rectAreaLights.needsUpdate=Z,R.hemisphereLights.needsUpdate=Z}(Tr,Vd),se&&!0===V.fog&&$e.refreshFogUniforms(Tr,se),$e.refreshMaterialUniforms(Tr,V,F,C,ft),ll.upload(it,Ne.uniformsList,Tr,rt)),V.isShaderMaterial&&!0===V.uniformsNeedUpdate&&(ll.upload(it,Ne.uniformsList,Tr,rt),V.uniformsNeedUpdate=!1),V.isSpriteMaterial&&qi.setValue(it,"center",ct.center),qi.setValue(it,"modelViewMatrix",ct.modelViewMatrix),qi.setValue(it,"normalMatrix",ct.normalMatrix),qi.setValue(it,"modelMatrix",ct.matrixWorld),V.isShaderMaterial||V.isRawShaderMaterial){const dn=V.uniformsGroups;for(let Xd=0,HP=dn.length;Xd<HP;Xd++)if(jt.isWebGL2){const x0=dn[Xd];Dt.update(x0,Sr),Dt.bind(x0,Sr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Sr}(R,Z,at,V,ct);St.setMaterial(V,pe);let Te=at.index,Ge=1;!0===V.wireframe&&(Te=ue.getWireframeAttribute(at),Ge=2);const Be=at.drawRange,Fe=at.attributes.position;let xi=Be.start*Ge,un=(Be.start+Be.count)*Ge;null!==se&&(xi=Math.max(xi,se.start*Ge),un=Math.min(un,(se.start+se.count)*Ge)),null!==Te?(xi=Math.max(xi,0),un=Math.min(un,Te.count)):null!=Fe&&(xi=Math.max(xi,0),un=Math.min(un,Fe.count));const gs=un-xi;if(gs<0||gs===1/0)return;z.setup(ct,V,we,at,Te);let Mr,vi=It;if(null!==Te&&(Mr=Tt.get(Te),vi=oe,vi.setIndex(Mr)),ct.isMesh)!0===V.wireframe?(St.setLineWidth(V.wireframeLinewidth*At()),vi.setMode(1)):vi.setMode(4);else if(ct.isLine){let Ne=V.linewidth;void 0===Ne&&(Ne=1),St.setLineWidth(Ne*At()),vi.setMode(ct.isLineSegments?1:ct.isLineLoop?2:3)}else ct.isPoints?vi.setMode(0):ct.isSprite&&vi.setMode(4);if(ct.isInstancedMesh)vi.renderInstances(xi,gs,ct.count);else if(at.isInstancedBufferGeometry){const Hd=Math.min(at.instanceCount,void 0!==at._maxInstanceCount?at._maxInstanceCount:1/0);vi.renderInstances(xi,gs,Hd)}else vi.render(xi,gs)},this.compile=function(R,Z){function at(V,ct,se){!0===V.transparent&&3===V.side?(V.side=1,V.needsUpdate=!0,bn(V,ct,se),V.side=0,V.needsUpdate=!0,bn(V,ct,se),V.side=3):bn(V,ct,se)}d=L.get(R),d.init(),p.push(d),R.traverseVisible(function(V){V.isLight&&V.layers.test(Z.layers)&&(d.pushLight(V),V.castShadow&&d.pushShadow(V))}),d.setupLights(m.physicallyCorrectLights),R.traverse(function(V){const ct=V.material;if(ct)if(Array.isArray(ct))for(let se=0;se<ct.length;se++)at(ct[se],R,V);else at(ct,R,V)}),p.pop(),d=null};let st=null;function Ut(){Ve.stop()}function qt(){Ve.start()}const Ve=new Nf;function Ii(R,Z,at,V){if(!1===R.visible)return;if(R.layers.test(Z.layers))if(R.isGroup)at=R.renderOrder;else if(R.isLOD)!0===R.autoUpdate&&R.update(Z);else if(R.isLight)d.pushLight(R),R.castShadow&&d.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||j.intersectsSprite(R)){V&&vt.setFromMatrixPosition(R.matrixWorld).applyMatrix4(K);const pe=ne.update(R),we=R.material;we.visible&&u.push(R,pe,we,at,vt.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(R.isSkinnedMesh&&R.skeleton.frame!==ae.render.frame&&(R.skeleton.update(),R.skeleton.frame=ae.render.frame),!R.frustumCulled||j.intersectsObject(R))){V&&vt.setFromMatrixPosition(R.matrixWorld).applyMatrix4(K);const pe=ne.update(R),we=R.material;if(Array.isArray(we)){const Te=pe.groups;for(let Ge=0,Be=Te.length;Ge<Be;Ge++){const Fe=Te[Ge],xi=we[Fe.materialIndex];xi&&xi.visible&&u.push(R,pe,xi,at,vt.z,Fe)}}else we.visible&&u.push(R,pe,we,at,vt.z,null)}const se=R.children;for(let pe=0,we=se.length;pe<we;pe++)Ii(se[pe],Z,at,V)}function Gi(R,Z,at,V){const ct=R.opaque,se=R.transmissive,pe=R.transparent;d.setupLightsView(at),se.length>0&&function wr(R,Z,at){const V=jt.isWebGL2;null===ft&&(ft=new Zs(1,1,{generateMipmaps:!0,type:Lt.has("EXT_color_buffer_half_float")?Ia:ks,minFilter:Us,samples:V&&!0===r?4:0})),m.getDrawingBufferSize(tt),V?ft.setSize(tt.x,tt.y):ft.setSize(Uo(tt.x),Uo(tt.y));const ct=m.getRenderTarget();m.setRenderTarget(ft),m.clear();const se=m.toneMapping;m.toneMapping=0,ii(R,Z,at),m.toneMapping=se,rt.updateMultisampleRenderTarget(ft),rt.updateRenderTargetMipmap(ft),m.setRenderTarget(ct)}(ct,Z,at),V&&St.viewport(S.copy(V)),ct.length>0&&ii(ct,Z,at),se.length>0&&ii(se,Z,at),pe.length>0&&ii(pe,Z,at),St.buffers.depth.setTest(!0),St.buffers.depth.setMask(!0),St.buffers.color.setMask(!0),St.setPolygonOffset(!1)}function ii(R,Z,at){const V=!0===Z.isScene?Z.overrideMaterial:null;for(let ct=0,se=R.length;ct<se;ct++){const pe=R[ct],we=pe.object,Te=pe.geometry,Ge=null===V?pe.material:V,Be=pe.group;we.layers.test(at.layers)&&ms(we,Z,at,Te,Ge,Be)}}function ms(R,Z,at,V,ct,se){R.onBeforeRender(m,Z,at,V,ct,se),R.modelViewMatrix.multiplyMatrices(at.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),ct.onBeforeRender(m,Z,at,V,R,se),!0===ct.transparent&&3===ct.side?(ct.side=1,ct.needsUpdate=!0,m.renderBufferDirect(at,Z,V,ct,R,se),ct.side=0,ct.needsUpdate=!0,m.renderBufferDirect(at,Z,V,ct,R,se),ct.side=3):m.renderBufferDirect(at,Z,V,ct,R,se),R.onAfterRender(m,Z,at,V,ct,se)}function bn(R,Z,at){!0!==Z.isScene&&(Z=mt);const V=lt.get(R),ct=d.state.lights,pe=ct.state.version,we=te.getParameters(R,ct.state,d.state.shadowsArray,Z,at),Te=te.getProgramCacheKey(we);let Ge=V.programs;V.environment=R.isMeshStandardMaterial?Z.environment:null,V.fog=Z.fog,V.envMap=(R.isMeshStandardMaterial?Nt:wt).get(R.envMap||V.environment),void 0===Ge&&(R.addEventListener("dispose",Oe),Ge=new Map,V.programs=Ge);let Be=Ge.get(Te);if(void 0!==Be){if(V.currentProgram===Be&&V.lightsStateVersion===pe)return _0(R,we),Be}else we.uniforms=te.getUniforms(R),R.onBuild(at,we,m),R.onBeforeCompile(we,m),Be=te.acquireProgram(we,Te),Ge.set(Te,Be),V.uniforms=we.uniforms;const Fe=V.uniforms;(!R.isShaderMaterial&&!R.isRawShaderMaterial||!0===R.clipping)&&(Fe.clippingPlanes=E.uniform),_0(R,we),V.needsLights=function zP(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&!0===R.lights}(R),V.lightsStateVersion=pe,V.needsLights&&(Fe.ambientLightColor.value=ct.state.ambient,Fe.lightProbe.value=ct.state.probe,Fe.directionalLights.value=ct.state.directional,Fe.directionalLightShadows.value=ct.state.directionalShadow,Fe.spotLights.value=ct.state.spot,Fe.spotLightShadows.value=ct.state.spotShadow,Fe.rectAreaLights.value=ct.state.rectArea,Fe.ltc_1.value=ct.state.rectAreaLTC1,Fe.ltc_2.value=ct.state.rectAreaLTC2,Fe.pointLights.value=ct.state.point,Fe.pointLightShadows.value=ct.state.pointShadow,Fe.hemisphereLights.value=ct.state.hemi,Fe.directionalShadowMap.value=ct.state.directionalShadowMap,Fe.directionalShadowMatrix.value=ct.state.directionalShadowMatrix,Fe.spotShadowMap.value=ct.state.spotShadowMap,Fe.spotLightMatrix.value=ct.state.spotLightMatrix,Fe.spotLightMap.value=ct.state.spotLightMap,Fe.pointShadowMap.value=ct.state.pointShadowMap,Fe.pointShadowMatrix.value=ct.state.pointShadowMatrix);const xi=Be.getUniforms(),un=ll.seqWithValue(xi.seq,Fe);return V.currentProgram=Be,V.uniformsList=un,Be}function _0(R,Z){const at=lt.get(R);at.outputEncoding=Z.outputEncoding,at.instancing=Z.instancing,at.skinning=Z.skinning,at.morphTargets=Z.morphTargets,at.morphNormals=Z.morphNormals,at.morphColors=Z.morphColors,at.morphTargetsCount=Z.morphTargetsCount,at.numClippingPlanes=Z.numClippingPlanes,at.numIntersection=Z.numClipIntersection,at.vertexAlphas=Z.vertexAlphas,at.vertexTangents=Z.vertexTangents,at.toneMapping=Z.toneMapping}Ve.setAnimationLoop(function _t(R){st&&st(R)}),typeof self<"u"&&Ve.setContext(self),this.setAnimationLoop=function(R){st=R,Ot.setAnimationLoop(R),null===R?Ve.stop():Ve.start()},Ot.addEventListener("sessionstart",Ut),Ot.addEventListener("sessionend",qt),this.render=function(R,Z){if(void 0===Z||!0===Z.isCamera){if(!0!==g){if(!0===R.matrixWorldAutoUpdate&&R.updateMatrixWorld(),null===Z.parent&&!0===Z.matrixWorldAutoUpdate&&Z.updateMatrixWorld(),!0===Ot.enabled&&!0===Ot.isPresenting&&(!0===Ot.cameraAutoUpdate&&Ot.updateCamera(Z),Z=Ot.getCamera()),!0===R.isScene&&R.onBeforeRender(m,R,Z,y),d=L.get(R,p.length),d.init(),p.push(d),K.multiplyMatrices(Z.projectionMatrix,Z.matrixWorldInverse),j.setFromProjectionMatrix(K),et=this.localClippingEnabled,$=E.init(this.clippingPlanes,et,Z),u=ke.get(R,f.length),u.init(),f.push(u),Ii(R,Z,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(Y,O),!0===$&&E.beginShadows(),Q.render(d.state.shadowsArray,R,Z),!0===$&&E.endShadows(),!0===this.info.autoReset&&this.info.reset(),gt.render(u,R),d.setupLights(m.physicallyCorrectLights),Z.isArrayCamera){const V=Z.cameras;for(let ct=0,se=V.length;ct<se;ct++){const pe=V[ct];Gi(u,R,pe,pe.viewport)}}else Gi(u,R,Z);null!==y&&(rt.updateMultisampleRenderTarget(y),rt.updateRenderTargetMipmap(y)),!0===R.isScene&&R.onAfterRender(m,R,Z),z.resetDefaultState(),b=-1,M=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),u=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(R,Z,at){lt.get(R.texture).__webglTexture=Z,lt.get(R.depthTexture).__webglTexture=at;const V=lt.get(R);V.__hasExternalTextures=!0,V.__hasExternalTextures&&(V.__autoAllocateDepthBuffer=void 0===at,V.__autoAllocateDepthBuffer||!0===Lt.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),V.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(R,Z){const at=lt.get(R);at.__webglFramebuffer=Z,at.__useDefaultFramebuffer=void 0===Z},this.setRenderTarget=function(R,Z=0,at=0){y=R,x=Z,v=at;let V=!0,ct=null,se=!1,pe=!1;if(R){const Te=lt.get(R);void 0!==Te.__useDefaultFramebuffer?(St.bindFramebuffer(36160,null),V=!1):void 0===Te.__webglFramebuffer?rt.setupRenderTarget(R):Te.__hasExternalTextures&&rt.rebindTextures(R,lt.get(R.texture).__webglTexture,lt.get(R.depthTexture).__webglTexture);const Ge=R.texture;(Ge.isData3DTexture||Ge.isDataArrayTexture||Ge.isCompressedArrayTexture)&&(pe=!0);const Be=lt.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(ct=Be[Z],se=!0):ct=jt.isWebGL2&&R.samples>0&&!1===rt.useMultisampledRTT(R)?lt.get(R).__webglMultisampledFramebuffer:Be,S.copy(R.viewport),A.copy(R.scissor),w=R.scissorTest}else S.copy(D).multiplyScalar(F).floor(),A.copy(W).multiplyScalar(F).floor(),w=X;if(St.bindFramebuffer(36160,ct)&&jt.drawBuffers&&V&&St.drawBuffers(R,ct),St.viewport(S),St.scissor(A),St.setScissorTest(w),se){const Te=lt.get(R.texture);it.framebufferTexture2D(36160,36064,34069+Z,Te.__webglTexture,at)}else if(pe){const Te=lt.get(R.texture);it.framebufferTextureLayer(36160,36064,Te.__webglTexture,at||0,Z||0)}b=-1},this.readRenderTargetPixels=function(R,Z,at,V,ct,se,pe){if(!R||!R.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let we=lt.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&void 0!==pe&&(we=we[pe]),we){St.bindFramebuffer(36160,we);try{const Te=R.texture,Ge=Te.format,Be=Te.type;if(Ge!==pn&&B.convert(Ge)!==it.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Fe=Be===Ia&&(Lt.has("EXT_color_buffer_half_float")||jt.isWebGL2&&Lt.has("EXT_color_buffer_float"));if(!(Be===ks||B.convert(Be)===it.getParameter(35738)||Be===_s&&(jt.isWebGL2||Lt.has("OES_texture_float")||Lt.has("WEBGL_color_buffer_float"))||Fe))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Z>=0&&Z<=R.width-V&&at>=0&&at<=R.height-ct&&it.readPixels(Z,at,V,ct,B.convert(Ge),B.convert(Be),se)}finally{const Te=null!==y?lt.get(y).__webglFramebuffer:null;St.bindFramebuffer(36160,Te)}}},this.copyFramebufferToTexture=function(R,Z,at=0){const V=Math.pow(2,-at),ct=Math.floor(Z.image.width*V),se=Math.floor(Z.image.height*V);rt.setTexture2D(Z,0),it.copyTexSubImage2D(3553,at,0,0,R.x,R.y,ct,se),St.unbindTexture()},this.copyTextureToTexture=function(R,Z,at,V=0){const ct=Z.image.width,se=Z.image.height,pe=B.convert(at.format),we=B.convert(at.type);rt.setTexture2D(at,0),it.pixelStorei(37440,at.flipY),it.pixelStorei(37441,at.premultiplyAlpha),it.pixelStorei(3317,at.unpackAlignment),Z.isDataTexture?it.texSubImage2D(3553,V,R.x,R.y,ct,se,pe,we,Z.image.data):Z.isCompressedTexture?it.compressedTexSubImage2D(3553,V,R.x,R.y,Z.mipmaps[0].width,Z.mipmaps[0].height,pe,Z.mipmaps[0].data):it.texSubImage2D(3553,V,R.x,R.y,pe,we,Z.image),0===V&&at.generateMipmaps&&it.generateMipmap(3553),St.unbindTexture()},this.copyTextureToTexture3D=function(R,Z,at,V,ct=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const se=R.max.x-R.min.x+1,pe=R.max.y-R.min.y+1,we=R.max.z-R.min.z+1,Te=B.convert(V.format),Ge=B.convert(V.type);let Be;if(V.isData3DTexture)rt.setTexture3D(V,0),Be=32879;else{if(!V.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");rt.setTexture2DArray(V,0),Be=35866}it.pixelStorei(37440,V.flipY),it.pixelStorei(37441,V.premultiplyAlpha),it.pixelStorei(3317,V.unpackAlignment);const Fe=it.getParameter(3314),xi=it.getParameter(32878),un=it.getParameter(3316),gs=it.getParameter(3315),Mr=it.getParameter(32877),vi=at.isCompressedTexture?at.mipmaps[0]:at.image;it.pixelStorei(3314,vi.width),it.pixelStorei(32878,vi.height),it.pixelStorei(3316,R.min.x),it.pixelStorei(3315,R.min.y),it.pixelStorei(32877,R.min.z),at.isDataTexture||at.isData3DTexture?it.texSubImage3D(Be,ct,Z.x,Z.y,Z.z,se,pe,we,Te,Ge,vi.data):at.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),it.compressedTexSubImage3D(Be,ct,Z.x,Z.y,Z.z,se,pe,we,Te,vi.data)):it.texSubImage3D(Be,ct,Z.x,Z.y,Z.z,se,pe,we,Te,Ge,vi),it.pixelStorei(3314,Fe),it.pixelStorei(32878,xi),it.pixelStorei(3316,un),it.pixelStorei(3315,gs),it.pixelStorei(32877,Mr),0===ct&&V.generateMipmaps&&it.generateMipmap(Be),St.unbindTexture()},this.initTexture=function(R){R.isCubeTexture?rt.setTextureCube(R,0):R.isData3DTexture?rt.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?rt.setTexture2DArray(R,0):rt.setTexture2D(R,0),St.unbindTexture()},this.resetState=function(){x=0,v=0,y=null,St.reset(),z.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class T1 extends dp{}).prototype.isWebGL1Renderer=!0;class fp extends mn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}function _n(n,t,e){return su(n)?new n.constructor(n.subarray(t,void 0!==e?e:n.length)):n.slice(t,e)}function ir(n,t,e){return!n||!e&&n.constructor===t?n:"number"==typeof t.BYTES_PER_ELEMENT?new t(n):Array.prototype.slice.call(n)}function su(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}class Rl{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];t:{e:{let a;i:{n:if(!(t<s)){for(let o=i+2;;){if(void 0===s){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(r=s,s=e[++i],t<s)break e}a=e.length;break i}if(t>=r)break t;{const o=e[1];t<o&&(i=2,r=o);for(let l=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=e[--i-1],t>=r)break e}a=i,i=0}}for(;i<a;){const o=i+a>>>1;t<e[o]?a=o:i=o+1}if(s=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===s)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s;for(let a=0;a!==s;++a)e[a]=i[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Cw extends Rl{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,i){const s=this.parameterPositions;let r=t-2,a=t+1,o=s[r],l=s[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=t,o=2*e-i;break;case 2402:r=s.length-2,o=e+s[r]-s[r+1];break;default:r=t,o=i}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:a=t,l=2*i-e;break;case 2402:a=1,l=i+s[1]-s[0];break;default:a=t-1,l=e}const h=.5*(i-e),c=this.valueSize;this._weightPrev=h/(e-o),this._weightNext=h/(l-i),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(t,e,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,h=l-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(i-e)/(s-e),m=p*p,g=m*p,x=-d*g+2*d*m-d*p,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,y=(-1-f)*g+(1.5+f)*m+.5*p,b=f*g-f*m;for(let M=0;M!==o;++M)r[M]=x*a[c+M]+v*a[h+M]+y*a[l+M]+b*a[u+M];return r}}class Jp extends Rl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,h=l-o,c=(i-e)/(s-e),u=1-c;for(let d=0;d!==o;++d)r[d]=a[h+d]*u+a[l+d]*c;return r}}class Rw extends Rl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class zn{constructor(t,e,i,s){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ir(e,this.TimeBufferType),this.values=ir(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:ir(t.times,Array),values:ir(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Rw(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Jp(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Cw(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let r=0,a=s-1;for(;r!==s&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;if(++a,0!==r||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);const o=this.getValueSize();this.times=_n(i,r,a),this.values=_n(this.values,r*o,a*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==r;o++){const l=i[o];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(null!==a&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(void 0!==s&&su(s))for(let o=0,l=s.length;o!==l;++o){const h=s[o];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,h),t=!1;break}}return t}optimize(){const t=_n(this.times),e=_n(this.values),i=this.getValueSize(),s=2302===this.getInterpolation(),r=t.length-1;let a=1;for(let o=1;o<r;++o){let l=!1;const h=t[o];if(h!==t[o+1]&&(1!==o||h!==t[0]))if(s)l=!0;else{const u=o*i,d=u-i,f=u+i;for(let p=0;p!==i;++p){const m=e[u+p];if(m!==e[d+p]||m!==e[f+p]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const u=o*i,d=a*i;for(let f=0;f!==i;++f)e[d+f]=e[u+f]}++a}}if(r>0){t[a]=t[r];for(let o=r*i,l=a*i,h=0;h!==i;++h)e[l+h]=e[o+h];++a}return a!==t.length?(this.times=_n(t,0,a),this.values=_n(e,0,a*i)):(this.times=t,this.values=e),this}clone(){const t=_n(this.times,0),e=_n(this.values,0),s=new(0,this.constructor)(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}zn.prototype.TimeBufferType=Float32Array,zn.prototype.ValueBufferType=Float32Array,zn.prototype.DefaultInterpolation=2301;class aa extends zn{}aa.prototype.ValueTypeName="bool",aa.prototype.ValueBufferType=Array,aa.prototype.DefaultInterpolation=2300,aa.prototype.InterpolantFactoryMethodLinear=void 0,aa.prototype.InterpolantFactoryMethodSmooth=void 0;(class Kp extends zn{}).prototype.ValueTypeName="color";(class Il extends zn{}).prototype.ValueTypeName="number";class Iw extends Rl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(i-e)/(s-e);let h=t*o;for(let c=h+o;h!==c;h+=4)Wi.slerpFlat(r,0,a,h-o,a,h,l);return r}}class no extends zn{InterpolantFactoryMethodLinear(t){return new Iw(this.times,this.values,this.getValueSize(),t)}}no.prototype.ValueTypeName="quaternion",no.prototype.DefaultInterpolation=2301,no.prototype.InterpolantFactoryMethodSmooth=void 0;class oa extends zn{}oa.prototype.ValueTypeName="string",oa.prototype.ValueBufferType=Array,oa.prototype.DefaultInterpolation=2300,oa.prototype.InterpolantFactoryMethodLinear=void 0,oa.prototype.InterpolantFactoryMethodSmooth=void 0;(class Pl extends zn{}).prototype.ValueTypeName="vector";const la={enabled:!1,files:{},add:function(n,t){!1!==this.enabled&&(this.files[n]=t)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Qp{constructor(t,e,i){const s=this;let l,r=!1,a=0,o=0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(c){o++,!1===r&&void 0!==s.onStart&&s.onStart(c,a,o),r=!0},this.itemEnd=function(c){a++,void 0!==s.onProgress&&s.onProgress(c,a,o),a===o&&(r=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(c){void 0!==s.onError&&s.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,u){return h.push(c,u),this},this.removeHandler=function(c){const u=h.indexOf(c);return-1!==u&&h.splice(u,2),this},this.getHandler=function(c){for(let u=0,d=h.length;u<d;u+=2){const f=h[u],p=h[u+1];if(f.global&&(f.lastIndex=0),f.test(c))return p}return null}}}const Lw=new Qp;class tm{constructor(t){this.manager=void 0!==t?t:Lw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,r){i.load(t,s,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Error;class Ll extends tm{constructor(t){super(t)}load(t,e,i,s){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=la.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;const o=Oa("img");function l(){c(),la.add(t,this),e&&e(this),r.manager.itemEnd(t)}function h(u){c(),s&&s(u),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",h,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class Bw extends tm{constructor(t){super(t)}load(t,e,i,s){const r=new Mn,a=new Ll(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){r.image=o,r.needsUpdate=!0,void 0!==e&&e(r)},i,s),r}}const cu="\\[\\]\\.:\\/",tM=new RegExp("["+cu+"]","g"),uu="[^"+cu+"]",eM="[^"+cu.replace("\\.","")+"]",aM=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",uu)+/(WCOD+)?/.source.replace("WCOD",eM)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",uu)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",uu)+"$"),oM=["material","materials","bones","map"];class lM{constructor(t,e,i){const s=i||ti.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}getValue(t,e){this.bind();const s=this._bindings[this._targetGroup.nCachedObjects_];void 0!==s&&s.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}let ti=(()=>{class n{constructor(e,i,s){this.path=i,this.parsedPath=s||n.parseTrackName(i),this.node=n.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,s){return e&&e.isAnimationObjectGroup?new n.Composite(e,i,s):new n(e,i,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tM,"")}static parseTrackName(e){const i=aM.exec(e);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=s.nodeName&&s.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const a=s.nodeName.substring(r+1);-1!==oM.indexOf(a)&&(s.nodeName=s.nodeName.substring(0,r),s.objectName=a)}if(null===s.propertyName||0===s.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,i){if(void 0===i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(i);if(void 0!==s)return s}if(e.children){const s=function(a){for(let o=0;o<a.length;o++){const l=a[o];if(l.name===i||l.uuid===i)return l;const h=s(l.children);if(h)return h}return null},r=s(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const s=this.resolvedProperty;for(let r=0,a=s.length;r!==a;++r)e[i++]=s[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const s=this.resolvedProperty;for(let r=0,a=s.length;r!==a;++r)s[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,a=s.length;r!==a;++r)s[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,a=s.length;r!==a;++r)s[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,s=i.objectName,r=i.propertyName;let a=i.propertyIndex;if(e||(e=n.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(s){let c=i.objectIndex;switch(s){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[s])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[s]}if(void 0!==c){if(void 0===e[c])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[c]}}const o=e[r];if(void 0===o)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+r+" but it wasn't found.",e);let l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[a]&&(a=e.morphTargetDictionary[a])}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=a}else void 0!==o.fromArray&&void 0!==o.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=lM,n})();ti.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ti.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ti.prototype.GetterByBindingType=[ti.prototype._getValue_direct,ti.prototype._getValue_array,ti.prototype._getValue_arrayElement,ti.prototype._getValue_toArray],ti.prototype.SetterByBindingTypeAndVersioning=[[ti.prototype._setValue_direct,ti.prototype._setValue_direct_setNeedsUpdate,ti.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ti.prototype._setValue_array,ti.prototype._setValue_array_setNeedsUpdate,ti.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ti.prototype._setValue_arrayElement,ti.prototype._setValue_arrayElement_setNeedsUpdate,ti.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ti.prototype._setValue_fromArray,ti.prototype._setValue_fromArray_setNeedsUpdate,ti.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class mm{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(di(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"148"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="148");const mu=n=>new Pe.y(t=>{(new Bw).loadAsync(n).then(i=>{t.next(i),t.complete()}).catch(i=>{t.error(i)})});var zl=ot(4766);const Tm={type:"change"},gu={type:"start"},Em={type:"end"};class gM extends Ws{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new I,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(B){B.addEventListener("keydown",ke),this._domElementKeyEvents=B},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Tm),i.update(),r=s.NONE},this.update=function(){const B=new I,z=(new Wi).setFromUnitVectors(t.up,new I(0,1,0)),Dt=z.clone().invert(),Gt=new I,Ot=new Wi,$t=2*Math.PI;return function(){const Ie=i.object.position;B.copy(Ie).sub(i.target),B.applyQuaternion(z),o.setFromVector3(B),i.autoRotate&&r===s.NONE&&T(function A(){return 2*Math.PI/60/60*i.autoRotateSpeed}()),i.enableDamping?(o.theta+=l.theta*i.dampingFactor,o.phi+=l.phi*i.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let Oe=i.minAzimuthAngle,qe=i.maxAzimuthAngle;return isFinite(Oe)&&isFinite(qe)&&(Oe<-Math.PI?Oe+=$t:Oe>Math.PI&&(Oe-=$t),qe<-Math.PI?qe+=$t:qe>Math.PI&&(qe-=$t),o.theta=Oe<=qe?Math.max(Oe,Math.min(qe,o.theta)):o.theta>(Oe+qe)/2?Math.max(Oe,o.theta):Math.min(qe,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=h,o.radius=Math.max(i.minDistance,Math.min(i.maxDistance,o.radius)),!0===i.enableDamping?i.target.addScaledVector(c,i.dampingFactor):i.target.add(c),B.setFromSpherical(o),B.applyQuaternion(Dt),Ie.copy(i.target).add(B),i.object.lookAt(i.target),!0===i.enableDamping?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,c.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),c.set(0,0,0)),h=1,!!(u||Gt.distanceToSquared(i.object.position)>a||8*(1-Ot.dot(i.object.quaternion))>a)&&(i.dispatchEvent(Tm),Gt.copy(i.object.position),Ot.copy(i.object.quaternion),u=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Q),i.domElement.removeEventListener("pointerdown",wt),i.domElement.removeEventListener("pointercancel",ue),i.domElement.removeEventListener("wheel",$e),i.domElement.removeEventListener("pointermove",Nt),i.domElement.removeEventListener("pointerup",Tt),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",ke)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const a=1e-6,o=new mm,l=new mm;let h=1;const c=new I;let u=!1;const d=new dt,f=new dt,p=new dt,m=new dt,g=new dt,x=new dt,v=new dt,y=new dt,b=new dt,M=[],S={};function w(){return Math.pow(.95,i.zoomSpeed)}function T(B){l.theta-=B}function C(B){l.phi-=B}const F=function(){const B=new I;return function(Dt,Gt){B.setFromMatrixColumn(Gt,0),B.multiplyScalar(-Dt),c.add(B)}}(),Y=function(){const B=new I;return function(Dt,Gt){!0===i.screenSpacePanning?B.setFromMatrixColumn(Gt,1):(B.setFromMatrixColumn(Gt,0),B.crossVectors(i.object.up,B)),B.multiplyScalar(Dt),c.add(B)}}(),O=function(){const B=new I;return function(Dt,Gt){const Ot=i.domElement;if(i.object.isPerspectiveCamera){B.copy(i.object.position).sub(i.target);let Zt=B.length();Zt*=Math.tan(i.object.fov/2*Math.PI/180),F(2*Dt*Zt/Ot.clientHeight,i.object.matrix),Y(2*Gt*Zt/Ot.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(F(Dt*(i.object.right-i.object.left)/i.object.zoom/Ot.clientWidth,i.object.matrix),Y(Gt*(i.object.top-i.object.bottom)/i.object.zoom/Ot.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function D(B){i.object.isPerspectiveCamera?h/=B:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*B)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function W(B){i.object.isPerspectiveCamera?h*=B:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/B)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function X(B){d.set(B.clientX,B.clientY)}function $(B){m.set(B.clientX,B.clientY)}function mt(){1===M.length?d.set(M[0].pageX,M[0].pageY):d.set(.5*(M[0].pageX+M[1].pageX),.5*(M[0].pageY+M[1].pageY))}function At(){1===M.length?m.set(M[0].pageX,M[0].pageY):m.set(.5*(M[0].pageX+M[1].pageX),.5*(M[0].pageY+M[1].pageY))}function it(){const B=M[0].pageX-M[1].pageX,z=M[0].pageY-M[1].pageY,Dt=Math.sqrt(B*B+z*z);v.set(0,Dt)}function jt(B){if(1==M.length)f.set(B.pageX,B.pageY);else{const Dt=oe(B);f.set(.5*(B.pageX+Dt.x),.5*(B.pageY+Dt.y))}p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const z=i.domElement;T(2*Math.PI*p.x/z.clientHeight),C(2*Math.PI*p.y/z.clientHeight),d.copy(f)}function St(B){if(1===M.length)g.set(B.pageX,B.pageY);else{const z=oe(B);g.set(.5*(B.pageX+z.x),.5*(B.pageY+z.y))}x.subVectors(g,m).multiplyScalar(i.panSpeed),O(x.x,x.y),m.copy(g)}function ae(B){const z=oe(B),Dt=B.pageX-z.x,Gt=B.pageY-z.y,Ot=Math.sqrt(Dt*Dt+Gt*Gt);y.set(0,Ot),b.set(0,Math.pow(y.y/v.y,i.zoomSpeed)),D(b.y),v.copy(y)}function wt(B){!1!==i.enabled&&(0===M.length&&(i.domElement.setPointerCapture(B.pointerId),i.domElement.addEventListener("pointermove",Nt),i.domElement.addEventListener("pointerup",Tt)),function gt(B){M.push(B)}(B),"touch"===B.pointerType?function L(B){switch(It(B),M.length){case 1:switch(i.touches.ONE){case 0:if(!1===i.enableRotate)return;mt(),r=s.TOUCH_ROTATE;break;case 1:if(!1===i.enablePan)return;At(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case 2:if(!1===i.enableZoom&&!1===i.enablePan)return;(function Qt(){i.enableZoom&&it(),i.enablePan&&At()})(),r=s.TOUCH_DOLLY_PAN;break;case 3:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function Lt(){i.enableZoom&&it(),i.enableRotate&&mt()})(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(gu)}(B):function ne(B){let z;switch(B.button){case 0:z=i.mouseButtons.LEFT;break;case 1:z=i.mouseButtons.MIDDLE;break;case 2:z=i.mouseButtons.RIGHT;break;default:z=-1}switch(z){case 1:if(!1===i.enableZoom)return;(function j(B){v.set(B.clientX,B.clientY)})(B),r=s.DOLLY;break;case 0:if(B.ctrlKey||B.metaKey||B.shiftKey){if(!1===i.enablePan)return;$(B),r=s.PAN}else{if(!1===i.enableRotate)return;X(B),r=s.ROTATE}break;case 2:if(B.ctrlKey||B.metaKey||B.shiftKey){if(!1===i.enableRotate)return;X(B),r=s.ROTATE}else{if(!1===i.enablePan)return;$(B),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(gu)}(B))}function Nt(B){!1!==i.enabled&&("touch"===B.pointerType?function E(B){switch(It(B),r){case s.TOUCH_ROTATE:if(!1===i.enableRotate)return;jt(B),i.update();break;case s.TOUCH_PAN:if(!1===i.enablePan)return;St(B),i.update();break;case s.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;(function lt(B){i.enableZoom&&ae(B),i.enablePan&&St(B)})(B),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function rt(B){i.enableZoom&&ae(B),i.enableRotate&&jt(B)})(B),i.update();break;default:r=s.NONE}}(B):function te(B){switch(r){case s.ROTATE:if(!1===i.enableRotate)return;!function et(B){f.set(B.clientX,B.clientY),p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const z=i.domElement;T(2*Math.PI*p.x/z.clientHeight),C(2*Math.PI*p.y/z.clientHeight),d.copy(f),i.update()}(B);break;case s.DOLLY:if(!1===i.enableZoom)return;!function ft(B){y.set(B.clientX,B.clientY),b.subVectors(y,v),b.y>0?D(w()):b.y<0&&W(w()),v.copy(y),i.update()}(B);break;case s.PAN:if(!1===i.enablePan)return;!function K(B){g.set(B.clientX,B.clientY),x.subVectors(g,m).multiplyScalar(i.panSpeed),O(x.x,x.y),m.copy(g),i.update()}(B)}}(B))}function Tt(B){bt(B),0===M.length&&(i.domElement.releasePointerCapture(B.pointerId),i.domElement.removeEventListener("pointermove",Nt),i.domElement.removeEventListener("pointerup",Tt)),i.dispatchEvent(Em),r=s.NONE}function ue(B){bt(B)}function $e(B){!1===i.enabled||!1===i.enableZoom||r!==s.NONE||(B.preventDefault(),i.dispatchEvent(gu),function tt(B){B.deltaY<0?W(w()):B.deltaY>0&&D(w()),i.update()}(B),i.dispatchEvent(Em))}function ke(B){!1===i.enabled||!1===i.enablePan||function vt(B){let z=!1;switch(B.code){case i.keys.UP:B.ctrlKey||B.metaKey||B.shiftKey?C(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,i.keyPanSpeed),z=!0;break;case i.keys.BOTTOM:B.ctrlKey||B.metaKey||B.shiftKey?C(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,-i.keyPanSpeed),z=!0;break;case i.keys.LEFT:B.ctrlKey||B.metaKey||B.shiftKey?T(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(i.keyPanSpeed,0),z=!0;break;case i.keys.RIGHT:B.ctrlKey||B.metaKey||B.shiftKey?T(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(-i.keyPanSpeed,0),z=!0}z&&(B.preventDefault(),i.update())}(B)}function Q(B){!1!==i.enabled&&B.preventDefault()}function bt(B){delete S[B.pointerId];for(let z=0;z<M.length;z++)if(M[z].pointerId==B.pointerId)return void M.splice(z,1)}function It(B){let z=S[B.pointerId];void 0===z&&(z=new dt,S[B.pointerId]=z),z.set(B.pageX,B.pageY)}function oe(B){return S[(B.pointerId===M[0].pointerId?M[1]:M[0]).pointerId]}i.domElement.addEventListener("contextmenu",Q),i.domElement.addEventListener("pointerdown",wt),i.domElement.addEventListener("pointercancel",ue),i.domElement.addEventListener("wheel",$e,{passive:!1}),this.update()}}var lr=ot(388),Hl=ot(529),_M=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,yM=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,xM=/[^-+\dA-Z]/g;function Am(n,t,e,i){if(1===arguments.length&&"string"==typeof n&&!/\d/.test(n)&&(t=n,n=void 0),(n=n||0===n?n:new Date)instanceof Date||(n=new Date(n)),isNaN(n))throw TypeError("Invalid date");var s=(t=String(Cm[t]||t||Cm.default)).slice(0,4);("UTC:"===s||"GMT:"===s)&&(t=t.slice(4),e=!0,"GMT:"===s&&(i=!0));var r=function(){return e?"getUTC":"get"},a=function(){return n[r()+"Date"]()},o=function(){return n[r()+"Day"]()},l=function(){return n[r()+"Month"]()},h=function(){return n[r()+"FullYear"]()},c=function(){return n[r()+"Hours"]()},u=function(){return n[r()+"Minutes"]()},d=function(){return n[r()+"Seconds"]()},f=function(){return n[r()+"Milliseconds"]()},p=function(){return e?0:n.getTimezoneOffset()},m=function(){return vM(n)},g=function(){return bM(n)},x={d:function(){return a()},dd:function(){return on(a())},ddd:function(){return Ki.dayNames[o()]},DDD:function(){return Rm({y:h(),m:l(),d:a(),_:r(),dayName:Ki.dayNames[o()],short:!0})},dddd:function(){return Ki.dayNames[o()+7]},DDDD:function(){return Rm({y:h(),m:l(),d:a(),_:r(),dayName:Ki.dayNames[o()+7]})},m:function(){return l()+1},mm:function(){return on(l()+1)},mmm:function(){return Ki.monthNames[l()]},mmmm:function(){return Ki.monthNames[l()+12]},yy:function(){return String(h()).slice(2)},yyyy:function(){return on(h(),4)},h:function(){return c()%12||12},hh:function(){return on(c()%12||12)},H:function(){return c()},HH:function(){return on(c())},M:function(){return u()},MM:function(){return on(u())},s:function(){return d()},ss:function(){return on(d())},l:function(){return on(f(),3)},L:function(){return on(Math.floor(f()/10))},t:function(){return c()<12?Ki.timeNames[0]:Ki.timeNames[1]},tt:function(){return c()<12?Ki.timeNames[2]:Ki.timeNames[3]},T:function(){return c()<12?Ki.timeNames[4]:Ki.timeNames[5]},TT:function(){return c()<12?Ki.timeNames[6]:Ki.timeNames[7]},Z:function(){return i?"GMT":e?"UTC":wM(n)},o:function(){return(p()>0?"-":"+")+on(100*Math.floor(Math.abs(p())/60)+Math.abs(p())%60,4)},p:function(){return(p()>0?"-":"+")+on(Math.floor(Math.abs(p())/60),2)+":"+on(Math.floor(Math.abs(p())%60),2)},S:function(){return["th","st","nd","rd"][a()%10>3?0:(a()%100-a()%10!=10)*a()%10]},W:function(){return m()},WW:function(){return on(m())},N:function(){return g()}};return t.replace(_M,function(v){return v in x?x[v]():v.slice(1,v.length-1)})}var Cm={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Ki={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},on=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(t).padStart(e,"0")},Rm=function(t){var e=t.y,i=t.m,s=t.d,r=t._,a=t.dayName,o=t.short,l=void 0!==o&&o,h=new Date,c=new Date;c.setDate(c[r+"Date"]()-1);var u=new Date;return u.setDate(u[r+"Date"]()+1),h[r+"FullYear"]()===e&&h[r+"Month"]()===i&&h[r+"Date"]()===s?l?"Tdy":"Today":c[r+"FullYear"]()===e&&c[r+"Month"]()===i&&c[r+"Date"]()===s?l?"Ysd":"Yesterday":u[r+"FullYear"]()===e&&u[r+"Month"]()===i&&u[r+"Date"]()===s?l?"Tmw":"Tomorrow":a},vM=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var i=new Date(e.getFullYear(),0,4);i.setDate(i.getDate()-(i.getDay()+6)%7+3);var s=e.getTimezoneOffset()-i.getTimezoneOffset();return e.setHours(e.getHours()-s),1+Math.floor((e-i)/6048e5)},bM=function(t){var e=t.getDay();return 0===e&&(e=7),e},wM=function(t){return(String(t).match(yM)||[""]).pop().replace(xM,"").replace(/GMT\+0000/g,"UTC")},Im=ot(8060),Vl=ot(1831);let hr=(()=>{class n{constructor(e,i){this.http=e,this.store=i,this.baseUrl=zl.N.rpwebAPI}loadPositionTypeBins(){return this.http.get(`${this.baseUrl}/PositionTypeBinMaster`)}loadMiscellaneousType(){return this.http.get(`${this.baseUrl}/miscellaneous`)}loadAddresses(){this.http.get(`${this.baseUrl}/address`).subscribe(e=>{this.store.dispatch((n=>({type:Im.n.SetAddresses,payload:{addresses:n}}))(e))})}load3dAddresses(){return this.http.get(`${this.baseUrl}/address/address3d`)}loadHeatMapFlow2D(e,i){const s=(new Hl.LE).set("start",Am(e,"yyyy-mm-dd")).set("end",Am(i,"yyyy-mm-dd"));return this.http.get(`${this.baseUrl}/point`,{params:s})}loadAddressDetail(e){return this.http.get(`${this.baseUrl}/address/addressdetail/${e}`)}loadProducts(){return this.http.get(`${this.baseUrl}/product`)}saveAddresess(e){return this.http.post(`${this.baseUrl}/address`,e)}saveAddressDetail(e,i){return this.http.post(`${this.baseUrl}/address/addressDetail/${e}`,i)}loadStatic3dAddresses(){return this.http.get("/assets/address_3d_demo.json")}loadStaticMiscellaneousType(){return this.http.get("/assets/miscellaneousLayout.json")}loadStatic2dAddresses(){return this.http.get("/assets/addressLayout.json")}loadStaticIndicators(){return this.http.get("/assets/indicatorData.json")}}return n.\u0275fac=function(e){return new(e||n)(_.LFG(Hl.eN),_.LFG(Vl.yh))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var TM=ot(7185);const EM=["input"];function AM(n,t){if(1&n&&(_.TgZ(0,"div",5)(1,"div",6),_._uU(2,"*Required"),_.qZA(),_.TgZ(3,"p"),_._uU(4),_.qZA()()),2&n){const e=_.oxw();_.xp6(4),_.hij("",e.label," is missing!")}}let _u=(()=>{class n{constructor(e){this.controlDir=e,this.type="",this.label="",this.controlDir.valueAccessor=this}ngOnInit(){const e=this.controlDir.control;e.setValidators(e.validator?[e.validator]:[]),e.updateValueAndValidity()}onChange(e){}onTouched(){}writeValue(e){this.input.nativeElement.value=e||""}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}getValue(e){return e.target.value}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(pt.a5,2))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-text-input"]],viewQuery:function(e,i){if(1&e&&_.Gf(EM,7),2&e){let s;_.iGM(s=_.CRH())&&(i.input=s.first)}},inputs:{type:"type",label:"label"},features:[_._Bn([],[{provide:pt.gN,useExisting:pt.sg}])],decls:7,vars:6,consts:[[1,"space-between"],[3,"ngClass"],[3,"type","placeholder","id","input","blur"],["input",""],["class","ui error message",4,"ngIf"],[1,"ui","error","message"],[1,"header"]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"label"),_._uU(3),_.qZA(),_.TgZ(4,"input",2,3),_.NdJ("input",function(r){return i.onChange(i.getValue(r))})("blur",function(){return i.onTouched()}),_.qZA()(),_.YNc(6,AM,5,1,"div",4),_.qZA()),2&e&&(_.xp6(1),_.Q6J("ngClass",i.controlDir&&i.controlDir.control&&i.controlDir.control.touched?i.controlDir.control.valid?"field":"field error":null),_.xp6(2),_.Oqu(i.label),_.xp6(1),_.s9C("type",i.type),_.s9C("placeholder",i.label),_.s9C("id",i.label),_.xp6(2),_.Q6J("ngIf",i.controlDir&&i.controlDir.control&&!i.controlDir.control.valid&&i.controlDir.control.touched))},dependencies:[ee.mk,ee.O5],styles:[".space-between[_ngcontent-%COMP%]{margin:2.5%}"]}),n})();var yu=ot(1607),Pm=ot(5987),CM=ot(727),xu=ot(576);function vu(n){return!!n&&(n instanceof Pe.y||(0,xu.m)(n.lift)&&(0,xu.m)(n.subscribe))}var Dm=ot(515),RM=ot(457),be=ot(7340),Lm=ot(2381),bu=ot(8372),IM=ot(8505),PM=ot(3900),DM=ot(5577),ro=ot(9300),LM=ot(7359),Om=ot(4482);const BM=(n,t)=>(n.push(t),n);const NM=["ulElement"],UM=["liElements"];function kM(n,t){}function GM(n,t){if(1&n&&_._UZ(0,"span",4),2&n){const e=t.match,i=t.query,s=_.oxw();_.Q6J("innerHtml",s.highlight(e,i),_.oJD)}}function zM(n,t){if(1&n&&(_.TgZ(0,"li",10,11),_._uU(2),_.qZA()),2&n){const e=_.oxw().$implicit;_.xp6(2),_.Oqu(e)}}function HM(n,t){}const Bm=function(n,t,e,i){return{item:n,index:t,match:e,query:i}};function VM(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"li",12,11),_.NdJ("mouseenter",function(){_.CHM(e);const s=_.oxw().$implicit,r=_.oxw(2);return _.KtG(r.selectActive(s))}),_.TgZ(2,"a",13),_.NdJ("click",function(s){_.CHM(e);const r=_.oxw().$implicit,a=_.oxw(2);return _.KtG(a.selectMatch(r,s))}),_.YNc(3,HM,0,0,"ng-template",0),_.qZA()()}if(2&n){const e=_.oxw(),i=e.$implicit,s=e.index,r=_.oxw(2),a=_.MAs(2);_.ekj("active",r.isActive(i)),_.Q6J("id",r.popupId+"-"+s)("@typeaheadAnimation",r.animationState),_.xp6(3),_.Q6J("ngTemplateOutlet",r.itemTemplate||a)("ngTemplateOutletContext",_.l5B(6,Bm,i.item,s,i,r.query))}}function WM(n,t){if(1&n&&(_.YNc(0,zM,3,1,"li",8),_.YNc(1,VM,4,11,"li",9)),2&n){const e=t.$implicit;_.Q6J("ngIf",e.isHeader()),_.xp6(1),_.Q6J("ngIf",!e.isHeader())}}function XM(n,t){if(1&n&&(_.TgZ(0,"ul",5,6),_.YNc(2,WM,2,2,"ng-template",7),_.qZA()),2&n){const e=_.oxw();_.Udp("overflow-y",e.needScrollbar?"scroll":"auto")("height",e.needScrollbar?e.guiHeight:"auto"),_.xp6(2),_.Q6J("ngForOf",e.matches)}}function YM(n,t){if(1&n&&(_.TgZ(0,"h6",10),_._uU(1),_.qZA()),2&n){const e=_.oxw().$implicit;_.xp6(1),_.Oqu(e)}}function ZM(n,t){}function $M(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"button",15,11),_.NdJ("click",function(s){_.CHM(e);const r=_.oxw().$implicit,a=_.oxw(2);return _.KtG(a.selectMatch(r,s))})("mouseenter",function(){_.CHM(e);const s=_.oxw().$implicit,r=_.oxw(2);return _.KtG(r.selectActive(s))}),_.YNc(2,ZM,0,0,"ng-template",0),_.qZA()}if(2&n){const e=_.oxw(),i=e.$implicit,s=e.index,r=_.oxw(2),a=_.MAs(2);_.ekj("active",r.isActive(i)),_.Q6J("id",r.popupId+"-"+s)("@typeaheadAnimation",r.animationState),_.xp6(2),_.Q6J("ngTemplateOutlet",r.itemTemplate||a)("ngTemplateOutletContext",_.l5B(6,Bm,i.item,s,i,r.query))}}function qM(n,t){if(1&n&&(_.YNc(0,YM,2,1,"h6",8),_.YNc(1,$M,3,11,"ng-template",14)),2&n){const e=t.$implicit;_.Q6J("ngIf",e.isHeader()),_.xp6(1),_.Q6J("ngIf",!e.isHeader())}}function jM(n,t){if(1&n&&_.YNc(0,qM,2,2,"ng-template",7),2&n){const e=_.oxw();_.Q6J("ngForOf",e.matches)}}const JM=function(n,t,e,i){return{matches:n,itemTemplate:t,query:e,$implicit:i}},KM={\u00c1:"A",\u0102:"A",\u1eae:"A",\u1eb6:"A",\u1eb0:"A",\u1eb2:"A",\u1eb4:"A",\u01cd:"A",\u00c2:"A",\u1ea4:"A",\u1eac:"A",\u1ea6:"A",\u1ea8:"A",\u1eaa:"A",\u00c4:"A",\u01de:"A",\u0226:"A",\u01e0:"A",\u1ea0:"A",\u0200:"A",\u00c0:"A",\u1ea2:"A",\u0202:"A",\u0100:"A",\u0104:"A",\u00c5:"A",\u01fa:"A",\u1e00:"A",\u023a:"A",\u00c3:"A",\ua732:"AA",\u00c6:"AE",\u01fc:"AE",\u01e2:"AE",\ua734:"AO",\ua736:"AU",\ua738:"AV",\ua73a:"AV",\ua73c:"AY",\u1e02:"B",\u1e04:"B",\u0181:"B",\u1e06:"B",\u0243:"B",\u0182:"B",\u0106:"C",\u010c:"C",\u00c7:"C",\u1e08:"C",\u0108:"C",\u010a:"C",\u0187:"C",\u023b:"C",\u010e:"D",\u1e10:"D",\u1e12:"D",\u1e0a:"D",\u1e0c:"D",\u018a:"D",\u1e0e:"D",\u01f2:"D",\u01c5:"D",\u0110:"D",\u018b:"D",\u01f1:"DZ",\u01c4:"DZ",\u00c9:"E",\u0114:"E",\u011a:"E",\u0228:"E",\u1e1c:"E",\u00ca:"E",\u1ebe:"E",\u1ec6:"E",\u1ec0:"E",\u1ec2:"E",\u1ec4:"E",\u1e18:"E",\u00cb:"E",\u0116:"E",\u1eb8:"E",\u0204:"E",\u00c8:"E",\u1eba:"E",\u0206:"E",\u0112:"E",\u1e16:"E",\u1e14:"E",\u0118:"E",\u0246:"E",\u1ebc:"E",\u1e1a:"E",\ua76a:"ET",\u1e1e:"F",\u0191:"F",\u01f4:"G",\u011e:"G",\u01e6:"G",\u0122:"G",\u011c:"G",\u0120:"G",\u0193:"G",\u1e20:"G",\u01e4:"G",\u1e2a:"H",\u021e:"H",\u1e28:"H",\u0124:"H",\u2c67:"H",\u1e26:"H",\u1e22:"H",\u1e24:"H",\u0126:"H",\u00cd:"I",\u012c:"I",\u01cf:"I",\u00ce:"I",\u00cf:"I",\u1e2e:"I",\u0130:"I",\u1eca:"I",\u0208:"I",\u00cc:"I",\u1ec8:"I",\u020a:"I",\u012a:"I",\u012e:"I",\u0197:"I",\u0128:"I",\u1e2c:"I",\ua779:"D",\ua77b:"F",\ua77d:"G",\ua782:"R",\ua784:"S",\ua786:"T",\ua76c:"IS",\u0134:"J",\u0248:"J",\u1e30:"K",\u01e8:"K",\u0136:"K",\u2c69:"K",\ua742:"K",\u1e32:"K",\u0198:"K",\u1e34:"K",\ua740:"K",\ua744:"K",\u0139:"L",\u023d:"L",\u013d:"L",\u013b:"L",\u1e3c:"L",\u1e36:"L",\u1e38:"L",\u2c60:"L",\ua748:"L",\u1e3a:"L",\u013f:"L",\u2c62:"L",\u01c8:"L",\u0141:"L",\u01c7:"LJ",\u1e3e:"M",\u1e40:"M",\u1e42:"M",\u2c6e:"M",\u0143:"N",\u0147:"N",\u0145:"N",\u1e4a:"N",\u1e44:"N",\u1e46:"N",\u01f8:"N",\u019d:"N",\u1e48:"N",\u0220:"N",\u01cb:"N",\u00d1:"N",\u01ca:"NJ",\u00d3:"O",\u014e:"O",\u01d1:"O",\u00d4:"O",\u1ed0:"O",\u1ed8:"O",\u1ed2:"O",\u1ed4:"O",\u1ed6:"O",\u00d6:"O",\u022a:"O",\u022e:"O",\u0230:"O",\u1ecc:"O",\u0150:"O",\u020c:"O",\u00d2:"O",\u1ece:"O",\u01a0:"O",\u1eda:"O",\u1ee2:"O",\u1edc:"O",\u1ede:"O",\u1ee0:"O",\u020e:"O",\ua74a:"O",\ua74c:"O",\u014c:"O",\u1e52:"O",\u1e50:"O",\u019f:"O",\u01ea:"O",\u01ec:"O",\u00d8:"O",\u01fe:"O",\u00d5:"O",\u1e4c:"O",\u1e4e:"O",\u022c:"O",\u01a2:"OI",\ua74e:"OO",\u0190:"E",\u0186:"O",\u0222:"OU",\u1e54:"P",\u1e56:"P",\ua752:"P",\u01a4:"P",\ua754:"P",\u2c63:"P",\ua750:"P",\ua758:"Q",\ua756:"Q",\u0154:"R",\u0158:"R",\u0156:"R",\u1e58:"R",\u1e5a:"R",\u1e5c:"R",\u0210:"R",\u0212:"R",\u1e5e:"R",\u024c:"R",\u2c64:"R",\ua73e:"C",\u018e:"E",\u015a:"S",\u1e64:"S",\u0160:"S",\u1e66:"S",\u015e:"S",\u015c:"S",\u0218:"S",\u1e60:"S",\u1e62:"S",\u1e68:"S",\u0164:"T",\u0162:"T",\u1e70:"T",\u021a:"T",\u023e:"T",\u1e6a:"T",\u1e6c:"T",\u01ac:"T",\u1e6e:"T",\u01ae:"T",\u0166:"T",\u2c6f:"A",\ua780:"L",\u019c:"M",\u0245:"V",\ua728:"TZ",\u00da:"U",\u016c:"U",\u01d3:"U",\u00db:"U",\u1e76:"U",\u00dc:"U",\u01d7:"U",\u01d9:"U",\u01db:"U",\u01d5:"U",\u1e72:"U",\u1ee4:"U",\u0170:"U",\u0214:"U",\u00d9:"U",\u1ee6:"U",\u01af:"U",\u1ee8:"U",\u1ef0:"U",\u1eea:"U",\u1eec:"U",\u1eee:"U",\u0216:"U",\u016a:"U",\u1e7a:"U",\u0172:"U",\u016e:"U",\u0168:"U",\u1e78:"U",\u1e74:"U",\ua75e:"V",\u1e7e:"V",\u01b2:"V",\u1e7c:"V",\ua760:"VY",\u1e82:"W",\u0174:"W",\u1e84:"W",\u1e86:"W",\u1e88:"W",\u1e80:"W",\u2c72:"W",\u1e8c:"X",\u1e8a:"X",\u00dd:"Y",\u0176:"Y",\u0178:"Y",\u1e8e:"Y",\u1ef4:"Y",\u1ef2:"Y",\u01b3:"Y",\u1ef6:"Y",\u1efe:"Y",\u0232:"Y",\u024e:"Y",\u1ef8:"Y",\u0179:"Z",\u017d:"Z",\u1e90:"Z",\u2c6b:"Z",\u017b:"Z",\u1e92:"Z",\u0224:"Z",\u1e94:"Z",\u01b5:"Z",\u0132:"IJ",\u0152:"OE",\u1d00:"A",\u1d01:"AE",\u0299:"B",\u1d03:"B",\u1d04:"C",\u1d05:"D",\u1d07:"E",\ua730:"F",\u0262:"G",\u029b:"G",\u029c:"H",\u026a:"I",\u0281:"R",\u1d0a:"J",\u1d0b:"K",\u029f:"L",\u1d0c:"L",\u1d0d:"M",\u0274:"N",\u1d0f:"O",\u0276:"OE",\u1d10:"O",\u1d15:"OU",\u1d18:"P",\u0280:"R",\u1d0e:"N",\u1d19:"R",\ua731:"S",\u1d1b:"T",\u2c7b:"E",\u1d1a:"R",\u1d1c:"U",\u1d20:"V",\u1d21:"W",\u028f:"Y",\u1d22:"Z",\u00e1:"a",\u0103:"a",\u1eaf:"a",\u1eb7:"a",\u1eb1:"a",\u1eb3:"a",\u1eb5:"a",\u01ce:"a",\u00e2:"a",\u1ea5:"a",\u1ead:"a",\u1ea7:"a",\u1ea9:"a",\u1eab:"a",\u00e4:"a",\u01df:"a",\u0227:"a",\u01e1:"a",\u1ea1:"a",\u0201:"a",\u00e0:"a",\u1ea3:"a",\u0203:"a",\u0101:"a",\u0105:"a",\u1d8f:"a",\u1e9a:"a",\u00e5:"a",\u01fb:"a",\u1e01:"a",\u2c65:"a",\u00e3:"a",\ua733:"aa",\u00e6:"ae",\u01fd:"ae",\u01e3:"ae",\ua735:"ao",\ua737:"au",\ua739:"av",\ua73b:"av",\ua73d:"ay",\u1e03:"b",\u1e05:"b",\u0253:"b",\u1e07:"b",\u1d6c:"b",\u1d80:"b",\u0180:"b",\u0183:"b",\u0275:"o",\u0107:"c",\u010d:"c",\u00e7:"c",\u1e09:"c",\u0109:"c",\u0255:"c",\u010b:"c",\u0188:"c",\u023c:"c",\u010f:"d",\u1e11:"d",\u1e13:"d",\u0221:"d",\u1e0b:"d",\u1e0d:"d",\u0257:"d",\u1d91:"d",\u1e0f:"d",\u1d6d:"d",\u1d81:"d",\u0111:"d",\u0256:"d",\u018c:"d",\u0131:"i",\u0237:"j",\u025f:"j",\u0284:"j",\u01f3:"dz",\u01c6:"dz",\u00e9:"e",\u0115:"e",\u011b:"e",\u0229:"e",\u1e1d:"e",\u00ea:"e",\u1ebf:"e",\u1ec7:"e",\u1ec1:"e",\u1ec3:"e",\u1ec5:"e",\u1e19:"e",\u00eb:"e",\u0117:"e",\u1eb9:"e",\u0205:"e",\u00e8:"e",\u1ebb:"e",\u0207:"e",\u0113:"e",\u1e17:"e",\u1e15:"e",\u2c78:"e",\u0119:"e",\u1d92:"e",\u0247:"e",\u1ebd:"e",\u1e1b:"e",\ua76b:"et",\u1e1f:"f",\u0192:"f",\u1d6e:"f",\u1d82:"f",\u01f5:"g",\u011f:"g",\u01e7:"g",\u0123:"g",\u011d:"g",\u0121:"g",\u0260:"g",\u1e21:"g",\u1d83:"g",\u01e5:"g",\u1e2b:"h",\u021f:"h",\u1e29:"h",\u0125:"h",\u2c68:"h",\u1e27:"h",\u1e23:"h",\u1e25:"h",\u0266:"h",\u1e96:"h",\u0127:"h",\u0195:"hv",\u00ed:"i",\u012d:"i",\u01d0:"i",\u00ee:"i",\u00ef:"i",\u1e2f:"i",\u1ecb:"i",\u0209:"i",\u00ec:"i",\u1ec9:"i",\u020b:"i",\u012b:"i",\u012f:"i",\u1d96:"i",\u0268:"i",\u0129:"i",\u1e2d:"i",\ua77a:"d",\ua77c:"f",\u1d79:"g",\ua783:"r",\ua785:"s",\ua787:"t",\ua76d:"is",\u01f0:"j",\u0135:"j",\u029d:"j",\u0249:"j",\u1e31:"k",\u01e9:"k",\u0137:"k",\u2c6a:"k",\ua743:"k",\u1e33:"k",\u0199:"k",\u1e35:"k",\u1d84:"k",\ua741:"k",\ua745:"k",\u013a:"l",\u019a:"l",\u026c:"l",\u013e:"l",\u013c:"l",\u1e3d:"l",\u0234:"l",\u1e37:"l",\u1e39:"l",\u2c61:"l",\ua749:"l",\u1e3b:"l",\u0140:"l",\u026b:"l",\u1d85:"l",\u026d:"l",\u0142:"l",\u01c9:"lj",\u017f:"s",\u1e9c:"s",\u1e9b:"s",\u1e9d:"s",\u1e3f:"m",\u1e41:"m",\u1e43:"m",\u0271:"m",\u1d6f:"m",\u1d86:"m",\u0144:"n",\u0148:"n",\u0146:"n",\u1e4b:"n",\u0235:"n",\u1e45:"n",\u1e47:"n",\u01f9:"n",\u0272:"n",\u1e49:"n",\u019e:"n",\u1d70:"n",\u1d87:"n",\u0273:"n",\u00f1:"n",\u01cc:"nj",\u00f3:"o",\u014f:"o",\u01d2:"o",\u00f4:"o",\u1ed1:"o",\u1ed9:"o",\u1ed3:"o",\u1ed5:"o",\u1ed7:"o",\u00f6:"o",\u022b:"o",\u022f:"o",\u0231:"o",\u1ecd:"o",\u0151:"o",\u020d:"o",\u00f2:"o",\u1ecf:"o",\u01a1:"o",\u1edb:"o",\u1ee3:"o",\u1edd:"o",\u1edf:"o",\u1ee1:"o",\u020f:"o",\ua74b:"o",\ua74d:"o",\u2c7a:"o",\u014d:"o",\u1e53:"o",\u1e51:"o",\u01eb:"o",\u01ed:"o",\u00f8:"o",\u01ff:"o",\u00f5:"o",\u1e4d:"o",\u1e4f:"o",\u022d:"o",\u01a3:"oi",\ua74f:"oo",\u025b:"e",\u1d93:"e",\u0254:"o",\u1d97:"o",\u0223:"ou",\u1e55:"p",\u1e57:"p",\ua753:"p",\u01a5:"p",\u1d71:"p",\u1d88:"p",\ua755:"p",\u1d7d:"p",\ua751:"p",\ua759:"q",\u02a0:"q",\u024b:"q",\ua757:"q",\u0155:"r",\u0159:"r",\u0157:"r",\u1e59:"r",\u1e5b:"r",\u1e5d:"r",\u0211:"r",\u027e:"r",\u1d73:"r",\u0213:"r",\u1e5f:"r",\u027c:"r",\u1d72:"r",\u1d89:"r",\u024d:"r",\u027d:"r",\u2184:"c",\ua73f:"c",\u0258:"e",\u027f:"r",\u015b:"s",\u1e65:"s",\u0161:"s",\u1e67:"s",\u015f:"s",\u015d:"s",\u0219:"s",\u1e61:"s",\u1e63:"s",\u1e69:"s",\u0282:"s",\u1d74:"s",\u1d8a:"s",\u023f:"s",\u0261:"g",\u1d11:"o",\u1d13:"o",\u1d1d:"u",\u0165:"t",\u0163:"t",\u1e71:"t",\u021b:"t",\u0236:"t",\u1e97:"t",\u2c66:"t",\u1e6b:"t",\u1e6d:"t",\u01ad:"t",\u1e6f:"t",\u1d75:"t",\u01ab:"t",\u0288:"t",\u0167:"t",\u1d7a:"th",\u0250:"a",\u1d02:"ae",\u01dd:"e",\u1d77:"g",\u0265:"h",\u02ae:"h",\u02af:"h",\u1d09:"i",\u029e:"k",\ua781:"l",\u026f:"m",\u0270:"m",\u1d14:"oe",\u0279:"r",\u027b:"r",\u027a:"r",\u2c79:"r",\u0287:"t",\u028c:"v",\u028d:"w",\u028e:"y",\ua729:"tz",\u00fa:"u",\u016d:"u",\u01d4:"u",\u00fb:"u",\u1e77:"u",\u00fc:"u",\u01d8:"u",\u01da:"u",\u01dc:"u",\u01d6:"u",\u1e73:"u",\u1ee5:"u",\u0171:"u",\u0215:"u",\u00f9:"u",\u1ee7:"u",\u01b0:"u",\u1ee9:"u",\u1ef1:"u",\u1eeb:"u",\u1eed:"u",\u1eef:"u",\u0217:"u",\u016b:"u",\u1e7b:"u",\u0173:"u",\u1d99:"u",\u016f:"u",\u0169:"u",\u1e79:"u",\u1e75:"u",\u1d6b:"ue",\ua778:"um",\u2c74:"v",\ua75f:"v",\u1e7f:"v",\u028b:"v",\u1d8c:"v",\u2c71:"v",\u1e7d:"v",\ua761:"vy",\u1e83:"w",\u0175:"w",\u1e85:"w",\u1e87:"w",\u1e89:"w",\u1e81:"w",\u2c73:"w",\u1e98:"w",\u1e8d:"x",\u1e8b:"x",\u1d8d:"x",\u00fd:"y",\u0177:"y",\u00ff:"y",\u1e8f:"y",\u1ef5:"y",\u1ef3:"y",\u01b4:"y",\u1ef7:"y",\u1eff:"y",\u0233:"y",\u1e99:"y",\u024f:"y",\u1ef9:"y",\u017a:"z",\u017e:"z",\u1e91:"z",\u0291:"z",\u2c6c:"z",\u017c:"z",\u1e93:"z",\u0225:"z",\u1e95:"z",\u1d76:"z",\u1d8e:"z",\u0290:"z",\u01b6:"z",\u0240:"z",\ufb00:"ff",\ufb03:"ffi",\ufb04:"ffl",\ufb01:"fi",\ufb02:"fl",\u0133:"ij",\u0153:"oe",\ufb06:"st",\u2090:"a",\u2091:"e",\u1d62:"i",\u2c7c:"j",\u2092:"o",\u1d63:"r",\u1d64:"u",\u1d65:"v",\u2093:"x"};class Wl{constructor(t,e=t,i=!1){this.item=t,this.value=e,this.header=i}isHeader(){return this.header}toString(){return this.value}}function ao(n){return n?n.replace(/[^A-Za-z0-9[\] ]/g,function(t){return KM[t]||t}):""}function wu(n,t=" ",e="",i){let s=[];if(i){const a=n.split(new RegExp(`([${i}]+)`,"g")),o=a[a.length-1];o>""&&(t&&e?s=Fm(o,t,e):s.push(o))}else s=Fm(n,t,e);return s}function Fm(n,t,e){const i=[],r=n.split(new RegExp(`(?:[${e}])([^${e}]+)(?:[${e}])|([^${t}]+)`,"g")),a=r.length;let o;const l=new RegExp(`[${e}]+`,"g");for(let h=0;h<a;h+=1)o=r[h],o&&o.length&&o!==t&&i.push(o.replace(l,""));return i}function cr(n,t){if(!t||"object"!=typeof n)return n.toString();if(t.endsWith("()"))return n[t.slice(0,t.length-2)]().toString();const i=t.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split(".");for(const s of i)s in n&&(n=n[s]);return n?n.toString():""}const Nm="220ms cubic-bezier(0, 0, 0.2, 1)",QM=(0,be.X$)("typeaheadAnimation",[(0,be.SB)("animated-down",(0,be.oB)({height:"*",overflow:"hidden"})),(0,be.eR)("* => animated-down",[(0,be.oB)({height:0,overflow:"hidden"}),(0,be.jt)(Nm)]),(0,be.SB)("animated-up",(0,be.oB)({height:"*",overflow:"hidden"})),(0,be.eR)("* => animated-up",[(0,be.oB)({height:"*",overflow:"hidden"}),(0,be.jt)(Nm)]),(0,be.eR)("* => unanimated",(0,be.jt)("0s"))]);let tS=0,eS=(()=>{class n{constructor(e,i,s,r){this.positionService=e,this.renderer=i,this.element=s,this.changeDetectorRef=r,this.activeChangeEvent=new _.vpe,this.isFocused=!1,this.positionServiceSubscription=new CM.w0,this.height=0,this.popupId="ngb-typeahead-"+tS++,this._matches=[],this.renderer.setAttribute(this.element.nativeElement,"id",this.popupId),this.positionServiceSubscription.add(this.positionService.event$?.subscribe(()=>{if(this.isAnimated)return this.animationState=this.isTopPosition?"animated-up":"animated-down",void this.changeDetectorRef.detectChanges();this.animationState="unanimated",this.changeDetectorRef.detectChanges()}))}get isBs4(){return!(0,yu.XA)()}get typeaheadTemplateMethods(){return{selectMatch:this.selectMatch.bind(this),selectActive:this.selectActive.bind(this),isActive:this.isActive.bind(this)}}get active(){return this._active}set active(e){this._active=e,this.activeChanged()}get matches(){return this._matches}set matches(e){if(this.positionService.setOptions({modifiers:{flip:{enabled:this.adaptivePosition}},allowedPositions:["top","bottom"]}),this._matches=e,this.needScrollbar=this.typeaheadScrollable&&this.typeaheadOptionsInScrollableView<this.matches.length,this.typeaheadScrollable&&setTimeout(()=>{this.setScrollableMode()}),this.typeaheadIsFirstItemActive&&this._matches.length>0&&(this.setActive(this._matches[0]),this._active?.isHeader()&&this.nextActiveMatch()),this._active&&!this.typeaheadIsFirstItemActive){const i=this._matches.find(s=>s.value===this._active?.value);if(i)return void this.selectActive(i);this.active=void 0}}get isTopPosition(){return this.element.nativeElement.classList.contains("top")}get optionsListTemplate(){return this.parent?this.parent.optionsListTemplate:void 0}get isAnimated(){return!!this.parent&&this.parent.isAnimated}get adaptivePosition(){return!!this.parent&&this.parent.adaptivePosition}get typeaheadScrollable(){return!!this.parent&&this.parent.typeaheadScrollable}get typeaheadOptionsInScrollableView(){return this.parent?this.parent.typeaheadOptionsInScrollableView:5}get typeaheadIsFirstItemActive(){return!this.parent||this.parent.typeaheadIsFirstItemActive}get itemTemplate(){return this.parent?this.parent.typeaheadItemTemplate:void 0}get canSelectItemsOnBlur(){return!!this.parent?.selectItemOnBlur}selectActiveMatch(e){this._active&&this.parent?.typeaheadSelectFirstItem&&this.selectMatch(this._active),!this.parent?.typeaheadSelectFirstItem&&e&&this.selectMatch(this._active)}activeChanged(){if(!this._active)return;const e=this.matches.indexOf(this._active);this.activeChangeEvent.emit(`${this.popupId}-${e}`)}prevActiveMatch(){if(!this._active)return;const e=this.matches.indexOf(this._active);this.setActive(this.matches[e-1<0?this.matches.length-1:e-1]),this._active.isHeader()&&this.prevActiveMatch(),this.typeaheadScrollable&&this.scrollPrevious(e)}nextActiveMatch(){const e=this._active?this.matches.indexOf(this._active):-1;this.setActive(this.matches[e+1>this.matches.length-1?0:e+1]),this._active?.isHeader()&&this.nextActiveMatch(),this.typeaheadScrollable&&this.scrollNext(e)}selectActive(e){this.isFocused=!0,this.setActive(e)}highlight(e,i){let a,o,s=e.value,r=(this.parent&&this.parent.typeaheadLatinize?ao(s):s).toLowerCase();if("object"==typeof i){const l=i.length;for(let h=0;h<l;h+=1)a=r.indexOf(i[h]),o=i[h].length,a>=0&&o>0&&(s=`${s.substring(0,a)}<strong>${s.substring(a,a+o)}</strong>${s.substring(a+o)}`,r=`${r.substring(0,a)}        ${" ".repeat(o)}         ${r.substring(a+o)}`)}else i&&(a=r.indexOf(i),o=i.length,a>=0&&o>0&&(s=`${s.substring(0,a)}<strong>${s.substring(a,a+o)}</strong>${s.substring(a+o)}`));return s}focusLost(){this.isFocused=!1,this.canSelectItemsOnBlur||this.setActive(void 0)}isActive(e){return this.active===e}selectMatch(e,i){return i&&(i.stopPropagation(),i.preventDefault()),this.parent?.changeModel(e),setTimeout(()=>this.parent?.typeaheadOnSelect.emit(e),0),!1}setScrollableMode(){if(this.ulElement||(this.ulElement=this.element),this.liElements?.first){const e=yu.cQ.getStyles(this.ulElement.nativeElement),i=yu.cQ.getStyles(this.liElements.first.nativeElement),s=parseFloat((e["padding-bottom"]?e["padding-bottom"]:"").replace("px","")),r=parseFloat((e["padding-top"]?e["padding-top"]:"0").replace("px","")),a=parseFloat((i.height?i.height:"0").replace("px",""));this.guiHeight=`${this.typeaheadOptionsInScrollableView*a+r+s}px`}this.renderer.setStyle(this.element.nativeElement,"visibility","visible")}scrollPrevious(e){if(0!==e){if(this.liElements&&this.ulElement){const i=this.liElements.toArray()[e-1];i&&!this.isScrolledIntoView(i.nativeElement)&&(this.ulElement.nativeElement.scrollTop=i.nativeElement.offsetTop)}}else this.scrollToBottom()}scrollNext(e){if(e+1>this.matches.length-1)this.scrollToTop();else if(this.liElements&&this.ulElement){const i=this.liElements.toArray()[e+1];i&&!this.isScrolledIntoView(i.nativeElement)&&(this.ulElement.nativeElement.scrollTop=i.nativeElement.offsetTop-Number(this.ulElement.nativeElement.offsetHeight)+Number(i.nativeElement.offsetHeight))}}ngOnDestroy(){this.positionServiceSubscription.unsubscribe()}setActive(e){let i;this._active=e,null==this._active||this._active.isHeader()||(i=e),this.parent?.typeaheadOnPreview.emit(i)}isScrolledIntoView(e){if(!this.ulElement)return!1;const i=this.ulElement.nativeElement.scrollTop,s=i+Number(this.ulElement.nativeElement.offsetHeight),r=e.offsetTop;return r+e.offsetHeight<=s&&r>=i}scrollToBottom(){!this.ulElement?.nativeElement||(this.ulElement.nativeElement.scrollTop=this.ulElement.nativeElement.scrollHeight)}scrollToTop(){!this.ulElement?.nativeElement||(this.ulElement.nativeElement.scrollTop=0)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(Pm.sA),_.Y36(_.Qsj),_.Y36(_.SBq),_.Y36(_.sBO))},n.\u0275cmp=_.Xpm({type:n,selectors:[["typeahead-container"]],viewQuery:function(e,i){if(1&e&&(_.Gf(NM,5),_.Gf(UM,5)),2&e){let s;_.iGM(s=_.CRH())&&(i.ulElement=s.first),_.iGM(s=_.CRH())&&(i.liElements=s)}},hostAttrs:[1,"dropdown","open","bottom",2,"position","absolute","display","block"],hostVars:9,hostBindings:function(e,i){1&e&&_.NdJ("mouseleave",function(){return i.focusLost()})("blur",function(){return i.focusLost()}),2&e&&(_.uIk("role",i.isBs4?"listbox":null),_.Udp("height",i.isBs4&&i.needScrollbar?i.guiHeight:"auto")("visibility","inherit"),_.ekj("dropdown-menu",i.isBs4)("dropup",i.dropup))},outputs:{activeChangeEvent:"activeChange"},decls:7,vars:7,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext"],["bsItemTemplate",""],["bs3Template",""],["bs4Template",""],[3,"innerHtml"],["role","listbox",1,"dropdown-menu"],["ulElement",""],["ngFor","",3,"ngForOf"],["class","dropdown-header",4,"ngIf"],["role","option",3,"id","active","mouseenter",4,"ngIf"],[1,"dropdown-header"],["liElements",""],["role","option",3,"id","mouseenter"],["href","#","tabindex","-1",3,"click"],[3,"ngIf"],["role","option",1,"dropdown-item",3,"id","click","mouseenter"]],template:function(e,i){if(1&e&&(_.YNc(0,kM,0,0,"ng-template",0),_.YNc(1,GM,1,1,"ng-template",null,1,_.W1O),_.YNc(3,XM,3,5,"ng-template",null,2,_.W1O),_.YNc(5,jM,1,1,"ng-template",null,3,_.W1O)),2&e){const s=_.MAs(2),r=_.MAs(4),a=_.MAs(6);_.Q6J("ngTemplateOutlet",i.optionsListTemplate||(i.isBs4?a:r))("ngTemplateOutletContext",_.l5B(2,JM,i.matches,i.itemTemplate||s,i.query,i.typeaheadTemplateMethods))}},dependencies:[ee.sg,ee.O5,ee.tP],styles:[".dropdown[_nghost-%COMP%]{z-index:1000}.dropdown-menu[_nghost-%COMP%], .dropdown-menu[_ngcontent-%COMP%]{overflow-y:auto;height:100px}"],data:{animation:[QM]}}),n})(),Um=(()=>{class n{constructor(){this.adaptivePosition=!1,this.isAnimated=!1,this.hideResultsOnBlur=!0,this.cancelRequestOnFocusLost=!1,this.selectFirstItem=!0,this.isFirstItemActive=!0,this.minLength=1,this.selectItemOnBlur=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),iS=(()=>{class n{constructor(e,i,s,r,a,o,l){this.changeDetection=s,this.element=r,this.ngControl=a,this.renderer=o,this.typeaheadMinLength=1,this.adaptivePosition=!1,this.isAnimated=!1,this.typeaheadWaitMs=0,this.typeaheadLatinize=!0,this.typeaheadSingleWords=!0,this.typeaheadWordDelimiters=" ",this.typeaheadMultipleSearchDelimiters=",",this.typeaheadPhraseDelimiters="'\"",this.typeaheadScrollable=!1,this.typeaheadOptionsInScrollableView=5,this.typeaheadSelectFirstItem=!0,this.typeaheadIsFirstItemActive=!0,this.typeaheadLoading=new _.vpe,this.typeaheadNoResults=new _.vpe,this.typeaheadOnSelect=new _.vpe,this.typeaheadOnPreview=new _.vpe,this.typeaheadOnBlur=new _.vpe,this.dropup=!1,this.isOpen=!1,this.list="list",this.isActiveItemChanged=!1,this.isFocused=!1,this.cancelRequestOnFocusLost=!1,this.selectItemOnBlur=!1,this.keyUpEventEmitter=new _.vpe,this.placement="bottom left",this._matches=[],this._subscriptions=[],this._outsideClickListener=()=>{},this._typeahead=e.createLoader(r,l,o).provide({provide:Um,useValue:i}),Object.assign(this,{typeaheadHideResultsOnBlur:i.hideResultsOnBlur,cancelRequestOnFocusLost:i.cancelRequestOnFocusLost,typeaheadSelectFirstItem:i.selectFirstItem,typeaheadIsFirstItemActive:i.isFirstItemActive,typeaheadMinLength:i.minLength,adaptivePosition:i.adaptivePosition,isAnimated:i.isAnimated,selectItemOnBlur:i.selectItemOnBlur})}get matches(){return this._matches}ngOnInit(){this.typeaheadOptionsLimit=this.typeaheadOptionsLimit||20,this.typeaheadMinLength=void 0===this.typeaheadMinLength?1:this.typeaheadMinLength,void 0===this.typeaheadAsync&&!vu(this.typeahead)&&(this.typeaheadAsync=!1),vu(this.typeahead)&&(this.typeaheadAsync=!0),this.typeaheadAsync?this.asyncActions():this.syncActions(),this.checkDelimitersConflict()}onInput(e){const i=void 0!==e.target.value?e.target.value:void 0!==e.target.textContent?e.target.textContent:e.target.innerText;null!=i&&i.trim().length>=this.typeaheadMinLength?(this.typeaheadLoading.emit(!0),this.keyUpEventEmitter.emit(e.target.value)):(this.typeaheadLoading.emit(!1),this.typeaheadNoResults.emit(!1),this.hide())}onChange(e){if(this._container){if(27===e.keyCode||"Escape"===e.key)return void this.hide();if(38===e.keyCode||"ArrowUp"===e.key)return this.isActiveItemChanged=!0,void this._container.prevActiveMatch();if(40===e.keyCode||"ArrowDown"===e.key)return this.isActiveItemChanged=!0,void this._container.nextActiveMatch();if(13===e.keyCode||"Enter"===e.key)return void this._container.selectActiveMatch()}}onFocus(){this.isFocused=!0,setTimeout(()=>{0===this.typeaheadMinLength&&(this.typeaheadLoading.emit(!0),this.keyUpEventEmitter.emit(this.element.nativeElement.value||""))},0)}onBlur(){this.isFocused=!1,this._container&&!this._container.isFocused&&this.typeaheadOnBlur.emit(this._container.active),!this.container&&0===this._matches?.length&&this.typeaheadOnBlur.emit(new Wl(this.element.nativeElement.value,this.element.nativeElement.value,!1))}onKeydown(e){if(this._container&&((9===e.keyCode||"Tab"===e.key)&&this.onBlur(),9===e.keyCode||"Tab"===e.key||13===e.keyCode||"Enter"===e.key)){if(e.preventDefault(),this.typeaheadSelectFirstItem)return void this._container.selectActiveMatch();this.typeaheadSelectFirstItem||(this._container.selectActiveMatch(this.isActiveItemChanged),this.isActiveItemChanged=!1,this.hide())}}changeModel(e){if(!e)return;let i;if(this.typeaheadMultipleSearch&&this._allEnteredValue){const s=this._allEnteredValue.split(new RegExp(`([${this.typeaheadMultipleSearchDelimiters}]+)`));this._allEnteredValue=s.slice(0,s.length-1).concat(e.value).join(""),i=this._allEnteredValue}else i=e.value;this.ngControl.viewToModelUpdate(i),this.ngControl.control?.setValue(i),this.changeDetection.markForCheck(),this.hide()}show(){if(this._typeahead.attach(eS).to(this.container).position({attachment:(this.dropup?"top":"bottom")+" left"}).show({typeaheadRef:this,placement:this.placement,animation:!1,dropup:this.dropup}),this._outsideClickListener=this.renderer.listen("document","click",i=>{0===this.typeaheadMinLength&&this.element.nativeElement.contains(i.target)||!this.typeaheadHideResultsOnBlur||this.element.nativeElement.contains(i.target)||this.onOutsideClick()}),!this._typeahead.instance||!this.ngControl.control)return;this._container=this._typeahead.instance,this._container.parent=this;const e=(this.typeaheadLatinize?ao(this.ngControl.control.value):this.ngControl.control.value).toString().toLowerCase();this._container.query=this.tokenizeQuery(e),this._container.matches=this._matches,this.element.nativeElement.focus(),this._container.activeChangeEvent.subscribe(i=>{this.activeDescendant=i,this.changeDetection.markForCheck()}),this.isOpen=!0}hide(){this._typeahead.isShown&&(this._typeahead.hide(),this._outsideClickListener(),this._container=void 0,this.isOpen=!1,this.changeDetection.markForCheck()),this.typeaheadOnPreview.emit()}onOutsideClick(){this._container&&!this._container.isFocused&&this.hide()}ngOnDestroy(){for(const e of this._subscriptions)e.unsubscribe();this._typeahead.dispose()}asyncActions(){this._subscriptions.push(this.keyUpEventEmitter.pipe((0,bu.b)(this.typeaheadWaitMs),(0,IM.b)(e=>this._allEnteredValue=e),(0,PM.w)(()=>this.typeahead?this.typeahead:Dm.E)).subscribe(e=>{this.finalizeAsyncCall(e)}))}syncActions(){this._subscriptions.push(this.keyUpEventEmitter.pipe((0,bu.b)(this.typeaheadWaitMs),(0,DM.z)(e=>{this._allEnteredValue=e;const i=this.normalizeQuery(e);return this.typeahead?(vu(this.typeahead)?this.typeahead:(0,RM.D)(this.typeahead)).pipe((0,ro.h)(r=>!!r&&this.testMatch(this.normalizeOption(r),i)),function FM(){return(0,Om.e)((n,t)=>{(function OM(n,t){return(0,Om.e)((0,LM.U)(n,t,arguments.length>=2,!1,!0))})(BM,[])(n).subscribe(t)})}()):Dm.E})).subscribe(e=>{this.finalizeAsyncCall(e)}))}normalizeOption(e){const i=cr(e,this.typeaheadOptionField);return(this.typeaheadLatinize?ao(i):i).toLowerCase()}tokenizeQuery(e){let i=e;return this.typeaheadMultipleSearch&&this.typeaheadSingleWords?this.haveCommonCharacters(`${this.typeaheadPhraseDelimiters}${this.typeaheadWordDelimiters}`,this.typeaheadMultipleSearchDelimiters)||(i=wu(i,this.typeaheadWordDelimiters,this.typeaheadPhraseDelimiters,this.typeaheadMultipleSearchDelimiters)):i=this.typeaheadSingleWords?wu(i,this.typeaheadWordDelimiters,this.typeaheadPhraseDelimiters):wu(i,void 0,void 0,this.typeaheadMultipleSearchDelimiters),i}normalizeQuery(e){let i=(this.typeaheadLatinize?ao(e):e).toString().toLowerCase();return i=this.tokenizeQuery(i),i}testMatch(e,i){let s;if("object"==typeof i){s=i.length;for(let r=0;r<s;r+=1)if(i[r].length>0&&e.indexOf(i[r])<0)return!1;return!0}return e.indexOf(i)>=0}finalizeAsyncCall(e){if(this.prepareMatches(e||[]),this.typeaheadLoading.emit(!1),this.typeaheadNoResults.emit(!this.hasMatches()),this.hasMatches()){if(this.isFocused||!this.cancelRequestOnFocusLost)if(this._container&&this.ngControl.control){const s=((this.typeaheadLatinize?ao(this.ngControl.control.value):this.ngControl.control.value)||"").toString().toLowerCase();this._container.query=this.tokenizeQuery(s),this._container.matches=this._matches}else this.show()}else this.hide()}prepareMatches(e){const i=e.slice(0,this.typeaheadOptionsLimit),s=this.typeaheadOrderBy?this.orderMatches(i):i;if(this.typeaheadGroupField){let r=[];s.map(o=>cr(o,this.typeaheadGroupField)).filter((o,l,h)=>h.indexOf(o)===l).forEach(o=>{r.push(new Wl(o,o,!0)),r=r.concat(s.filter(l=>cr(l,this.typeaheadGroupField)===o).map(l=>new Wl(l,cr(l,this.typeaheadOptionField))))}),this._matches=r}else this._matches=s.map(r=>new Wl(r,cr(r,this.typeaheadOptionField)))}orderMatches(e){if(!e.length)return e;if(null!=this.typeaheadOrderBy&&"object"==typeof this.typeaheadOrderBy&&0===Object.keys(this.typeaheadOrderBy).length)return console.error("Field and direction properties for typeaheadOrderBy have to be set according to documentation!"),e;const{field:i,direction:s}=this.typeaheadOrderBy||{};return!s||"asc"!==s&&"desc"!==s?(console.error('typeaheadOrderBy direction has to equal "asc" or "desc". Please follow the documentation.'),e):"string"==typeof e[0]?"asc"===s?e.sort():e.sort().reverse():i&&"string"==typeof i?e.sort((r,a)=>{const o=cr(r,i),l=cr(a,i);return o<l?"asc"===s?-1:1:o>l?"asc"===s?1:-1:0}):(console.error("typeaheadOrderBy field has to set according to the documentation."),e)}hasMatches(){return this._matches.length>0}checkDelimitersConflict(){if(this.typeaheadMultipleSearch&&this.typeaheadSingleWords&&this.haveCommonCharacters(`${this.typeaheadPhraseDelimiters}${this.typeaheadWordDelimiters}`,this.typeaheadMultipleSearchDelimiters))throw new Error(`Delimiters used in typeaheadMultipleSearchDelimiters must be different\n          from delimiters used in typeaheadWordDelimiters (current value: ${this.typeaheadWordDelimiters}) and\n          typeaheadPhraseDelimiters (current value: ${this.typeaheadPhraseDelimiters}).\n          Please refer to the documentation`)}haveCommonCharacters(e,i){for(let s=0;s<e.length;s++)if(e.charAt(s).indexOf(i)>-1)return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(Lm.oj),_.Y36(Um),_.Y36(_.sBO),_.Y36(_.SBq),_.Y36(pt.a5),_.Y36(_.Qsj),_.Y36(_.s_b))},n.\u0275dir=_.lG2({type:n,selectors:[["","typeahead",""]],hostVars:4,hostBindings:function(e,i){1&e&&_.NdJ("input",function(r){return i.onInput(r)})("keyup",function(r){return i.onChange(r)})("click",function(){return i.onFocus()})("focus",function(){return i.onFocus()})("blur",function(){return i.onBlur()})("keydown",function(r){return i.onKeydown(r)}),2&e&&_.uIk("aria-activedescendant",i.activeDescendant)("aria-owns",i.isOpen?i._container.popupId:null)("aria-expanded",i.isOpen)("aria-autocomplete",i.list)},inputs:{typeahead:"typeahead",typeaheadMinLength:"typeaheadMinLength",adaptivePosition:"adaptivePosition",isAnimated:"isAnimated",typeaheadWaitMs:"typeaheadWaitMs",typeaheadOptionsLimit:"typeaheadOptionsLimit",typeaheadOptionField:"typeaheadOptionField",typeaheadGroupField:"typeaheadGroupField",typeaheadOrderBy:"typeaheadOrderBy",typeaheadAsync:"typeaheadAsync",typeaheadLatinize:"typeaheadLatinize",typeaheadSingleWords:"typeaheadSingleWords",typeaheadWordDelimiters:"typeaheadWordDelimiters",typeaheadMultipleSearch:"typeaheadMultipleSearch",typeaheadMultipleSearchDelimiters:"typeaheadMultipleSearchDelimiters",typeaheadPhraseDelimiters:"typeaheadPhraseDelimiters",typeaheadItemTemplate:"typeaheadItemTemplate",optionsListTemplate:"optionsListTemplate",typeaheadScrollable:"typeaheadScrollable",typeaheadOptionsInScrollableView:"typeaheadOptionsInScrollableView",typeaheadHideResultsOnBlur:"typeaheadHideResultsOnBlur",typeaheadSelectFirstItem:"typeaheadSelectFirstItem",typeaheadIsFirstItemActive:"typeaheadIsFirstItemActive",container:"container",dropup:"dropup"},outputs:{typeaheadLoading:"typeaheadLoading",typeaheadNoResults:"typeaheadNoResults",typeaheadOnSelect:"typeaheadOnSelect",typeaheadOnPreview:"typeaheadOnPreview",typeaheadOnBlur:"typeaheadOnBlur"},exportAs:["bs-typeahead"]}),n})(),nS=(()=>{class n{static forRoot(){return{ngModule:n,providers:[Lm.oj,Pm.sA]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[ee.ez]}),n})();const sS=["canvas"];function rS(n,t){if(1&n&&(_.TgZ(0,"div",7)(1,"label",8),_._uU(2),_.qZA()()),2&n){const e=_.oxw();_.xp6(2),_.hij("Total Height (M): ",e.address?e.address.totalHeight:"0.0","")}}function aS(n,t){if(1&n){const e=_.EpF();_.TgZ(0,"div",28),_.NdJ("dblclick",function(){const r=_.CHM(e).$implicit,a=_.oxw();return _.KtG(a.openModal2(r.id))}),_.TgZ(1,"p",29),_._uU(2),_.qZA()()}if(2&n){const e=t.$implicit;_.xp6(2),_.hij(" ",e.binDescription," ")}}const km=function(n){return{display:n}},oS=function(n,t){return{"grid-template-columns":n,"grid-template-row":t}};let Mu=(()=>{class n{constructor(e,i,s,r){this.bsModalRef=e,this.fb=i,this.warehouseService=s,this.toastr=r,this.title="",this.id=0,this.divCountColumn="2",this.divGridSizeColumn="50%",this.divCountRow="1",this.divGridSizeRow="100%",this.bins=[],this.products=[],this.productsStrs=[],this.scale=1e3,this.isModalOpen=!1}ngAfterViewInit(){}ngOnInit(){this.form=this.fb.group({addressId:["",pt.kI.nullValidator]}),this.animation=this.animation.bind(this),this.warehouseService.loadAddressDetail(this.id).pipe((0,ye.U)(e=>{this.address=e,this.form.get("addressId")?.setValue(this.address.addressId);const i=this.address.layers.length,s=this.address.layers[0].bins.length,a=100/i;this.divGridSizeColumn=`${(100/s).toFixed(2)}%`,this.divGridSizeRow=`${a.toFixed(2)}%`,this.divCountRow=i.toString(),this.divCountColumn=s.toString();const o=[];return this.address.layers.forEach(l=>{o.push(...l.bins)}),o}),(0,xe.d)()).subscribe({next:e=>this.bins=e,error:console.error}),this.warehouseService.loadProducts().pipe((0,ye.U)(e=>(this.productsStrs=e.map(i=>`${i.productId}-${i.productDescription}`),e))).subscribe({next:e=>this.products=e,error:console.error})}closeModal(){this.bsModalRef.hide()}closeModal2(){this.isModalOpen=!1}openModal2(e){this.init3d(),this.animation(),this.binSelected=this.bins.find(i=>i.id===e),this.binSelected?(this.binSelected.products[0]?(this.selected=this.binSelected.products[0].productId+"-"+this.binSelected.products[0].productDescription,this.product=this.binSelected.products[0],this.product3d(this.product)):this.selected="",this.isModalOpen=!0):this.toastr.warning("Not Founded!")}productSelected(e){const i=e.value.split("-")[0],s=this.products.find(r=>r.productId===i);s?(s.images="bin"!==this.address?.type?s.images.slice(0,6):s.images.slice(6,13),this.product=s,this.product3d(s)):this.toastr.warning("Product not founeded!")}get canvas(){return this.canvasRef?.nativeElement}init3d(){this.renderer=new dp({antialias:!0,canvas:this.canvas}),this.renderer.setSize(this.canvas.width,this.canvas.height),this.camera=new Oi(70,this.canvas.width/this.canvas.height,1,1e3),this.controls=new gM(this.camera,this.renderer.domElement),this.camera.position.z=10,this.controls.update(),this.scene=new fp;const e=new ws(.1,.1,.1),i=new Ji({color:267386880});this.mesh=new Xi(e,i),this.scene.add(this.mesh),this.scene.background=new kt(13882323)}animation(){requestAnimationFrame(this.animation),this.mesh.rotation.y+=.005,this.controls?.update(),this.renderer?.render(this.scene,this.camera)}product3d(e){this.scene?.clear();let i={front:e.totalFront,depth:e.totalHeight,height:e.totalDepth};"bin"!==this.address?.type&&(i={front:e.palletFront,depth:e.palletHeight,height:e.palletDepth});const s=new ws(i.front,i.height,i.depth),r=mu(`${zl.N.images}/MyImages/${e.productId}F.jpg`).pipe((0,Jt.K)(l=>(console.error(l),(0,Xt.of)(new Mn)))),a=mu(`${zl.N.images}/MyImages/${e.productId}T.jpg`).pipe((0,Jt.K)(l=>(console.error(l),(0,Xt.of)(new Mn)))),o=mu(`${zl.N.images}/MyImages/${e.productId}L.jpg`).pipe((0,Jt.K)(l=>(console.error(l),(0,Xt.of)(new Mn))));(0,he.D)([r,a,o]).pipe((0,ye.U)(l=>[new Ji({map:l[2],color:16777215}),new Ji({map:l[2],color:16777215}),new Ji({map:l[1],color:16777215}),new Ji({map:l[1],color:16777215}),new Ji({map:l[0],color:16777215}),new Ji({map:l[0],color:16777215})])).subscribe({next:l=>{this.mesh=new Xi(s,l),this.scene?.add(this.mesh),this.mesh.rotation.x-=9},error:console.error})}save(){const e=this.form.get("addressId")?.value;this.address&&e&&(this.address.addressId=e,this.warehouseService.saveAddressDetail(this.address?.id,this.address).subscribe(()=>{this.warehouseService.loadAddresses(),this.closeModal()}))}saveProduct(){this.product?this.binSelected.products=[this.product]:this.toastr.error("Unable to set product to this position!!"),this.closeModal2()}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(lr.UZ),_.Y36(pt.qu),_.Y36(hr),_.Y36(TM._W))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-modal-address-detail"]],viewQuery:function(e,i){if(1&e&&_.Gf(sS,5),2&e){let s;_.iGM(s=_.CRH())&&(i.canvasRef=s.first)}},inputs:{title:"title",id:"id"},decls:50,vars:19,consts:[["tabindex","-1",1,"modal-lg",3,"ngStyle"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[2,"margin-top","10px","margin-left","2%"],[1,"ui","label","big"],["style","margin-top: 10px; margin-left: 2%",4,"ngIf"],[1,"ui","form",3,"formGroup"],["type","text","label","Address Id","formControlName","addressId"],[1,"grid-layout-address-spot",3,"ngStyle"],["class","div-address-spot",3,"dblclick",4,"ngFor","ngForOf"],[2,"margin-top","8px"],[1,"ui","button","primary",3,"click"],[1,"ui","button","red",3,"click"],[1,"modal-lg",3,"ngStyle"],["tabindex","1",1,"modal-header"],[1,"modal-title","pull-left"],[2,"height","600px"],[2,"margin-bottom","0.25%"],[1,"form-control",3,"ngModel","typeahead","ngModelChange","typeaheadOnSelect"],[2,"height","90%","margin-top","1%"],["width","770","height","530",2,"border-radius","5%"],["canvas",""],["type","button",1,"ui","button","primary",3,"click"],["type","button",1,"ui","button","red",3,"click"],[1,"div-address-spot",3,"dblclick"],[2,"text-align","center","font-weight","600","font-size","18px"]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),_._uU(4),_.qZA(),_.TgZ(5,"button",4),_.NdJ("click",function(){return i.closeModal()}),_.TgZ(6,"span",5),_._uU(7,"\xd7"),_.qZA()()(),_.TgZ(8,"div",6)(9,"div")(10,"div",7)(11,"label",8),_._uU(12),_.qZA()(),_.TgZ(13,"div",7)(14,"label",8),_._uU(15),_.qZA()(),_.TgZ(16,"div",7)(17,"label",8),_._uU(18),_.qZA()(),_.YNc(19,rS,3,1,"div",9),_.TgZ(20,"form",10),_._UZ(21,"app-text-input",11),_.qZA(),_.TgZ(22,"div"),_._uU(23,"Address Infos"),_.qZA(),_.TgZ(24,"div",12),_.YNc(25,aS,3,1,"div",13),_.qZA(),_.TgZ(26,"div",14)(27,"button",15),_.NdJ("click",function(){return i.save()}),_._uU(28,"Save"),_.qZA(),_.TgZ(29,"button",16),_.NdJ("click",function(){return i.closeModal()}),_._uU(30,"Close"),_.qZA()()()()()(),_.TgZ(31,"div",17)(32,"div",18)(33,"h4",19),_._uU(34,"Product"),_.qZA(),_.TgZ(35,"button",4),_.NdJ("click",function(){return i.closeModal2()}),_.TgZ(36,"span",5),_._uU(37,"\xd7"),_.qZA()()(),_.TgZ(38,"div",6)(39,"div",20)(40,"label",21),_._uU(41,"Product"),_.qZA(),_.TgZ(42,"input",22),_.NdJ("ngModelChange",function(r){return i.selected=r})("typeaheadOnSelect",function(r){return i.productSelected(r)}),_.qZA(),_.TgZ(43,"div",23),_._UZ(44,"canvas",24,25),_.qZA()(),_.TgZ(46,"button",26),_.NdJ("click",function(){return i.saveProduct()}),_._uU(47," Save "),_.qZA(),_.TgZ(48,"button",27),_.NdJ("click",function(){return i.closeModal2()}),_._uU(49," Close "),_.qZA()()()),2&e&&(_.Q6J("ngStyle",_.VKq(12,km,i.isModalOpen?"none":"block")),_.xp6(4),_.hij(" ",i.title," "),_.xp6(8),_.hij("Type: ",i.address?i.address.type.charAt(0).toUpperCase()+i.address.type.substr(1):"Undefined",""),_.xp6(3),_.hij("Total Front (M): ",i.address?i.address.totalFront:"0.0",""),_.xp6(3),_.hij("Total Depth (M): ",i.address?i.address.totalDepth:"0.0",""),_.xp6(1),_.Q6J("ngIf","floor"!==(null==i.address?null:i.address.type)),_.xp6(1),_.Q6J("formGroup",i.form),_.xp6(4),_.Q6J("ngStyle",_.WLB(14,oS,"repeat("+i.divCountColumn+","+i.divGridSizeColumn+")","repeat("+i.divCountRow+","+i.divGridSizeRow+")")),_.xp6(1),_.Q6J("ngForOf",i.bins),_.xp6(6),_.Q6J("ngStyle",_.VKq(17,km,i.isModalOpen?"block":"none")),_.xp6(11),_.Q6J("ngModel",i.selected)("typeahead",i.productsStrs))},dependencies:[ee.sg,ee.O5,ee.PC,pt._Y,pt.Fj,pt.JJ,pt.JL,pt.sg,pt.u,pt.On,_u,iS],styles:[".grid-layout-address-spot[_ngcontent-%COMP%]{display:grid;height:400px;width:100%;border:1px solid lightgrey;padding:.5%}.div-address-spot[_ngcontent-%COMP%]{background-color:green;border:1px solid black;align-items:center}"]}),n})();var ur=(n=>(n[n.WEBGL_LEGACY=0]="WEBGL_LEGACY",n[n.WEBGL=1]="WEBGL",n[n.WEBGL2=2]="WEBGL2",n))(ur||{}),Su=(n=>(n[n.COLOR=16384]="COLOR",n[n.DEPTH=256]="DEPTH",n[n.STENCIL=1024]="STENCIL",n))(Su||{}),re=(n=>(n[n.NORMAL=0]="NORMAL",n[n.ADD=1]="ADD",n[n.MULTIPLY=2]="MULTIPLY",n[n.SCREEN=3]="SCREEN",n[n.OVERLAY=4]="OVERLAY",n[n.DARKEN=5]="DARKEN",n[n.LIGHTEN=6]="LIGHTEN",n[n.COLOR_DODGE=7]="COLOR_DODGE",n[n.COLOR_BURN=8]="COLOR_BURN",n[n.HARD_LIGHT=9]="HARD_LIGHT",n[n.SOFT_LIGHT=10]="SOFT_LIGHT",n[n.DIFFERENCE=11]="DIFFERENCE",n[n.EXCLUSION=12]="EXCLUSION",n[n.HUE=13]="HUE",n[n.SATURATION=14]="SATURATION",n[n.COLOR=15]="COLOR",n[n.LUMINOSITY=16]="LUMINOSITY",n[n.NORMAL_NPM=17]="NORMAL_NPM",n[n.ADD_NPM=18]="ADD_NPM",n[n.SCREEN_NPM=19]="SCREEN_NPM",n[n.NONE=20]="NONE",n[n.SRC_OVER=0]="SRC_OVER",n[n.SRC_IN=21]="SRC_IN",n[n.SRC_OUT=22]="SRC_OUT",n[n.SRC_ATOP=23]="SRC_ATOP",n[n.DST_OVER=24]="DST_OVER",n[n.DST_IN=25]="DST_IN",n[n.DST_OUT=26]="DST_OUT",n[n.DST_ATOP=27]="DST_ATOP",n[n.ERASE=26]="ERASE",n[n.SUBTRACT=28]="SUBTRACT",n[n.XOR=29]="XOR",n))(re||{}),Hn=(n=>(n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n))(Hn||{}),Mt=(n=>(n[n.RGBA=6408]="RGBA",n[n.RGB=6407]="RGB",n[n.RG=33319]="RG",n[n.RED=6403]="RED",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.ALPHA=6406]="ALPHA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n))(Mt||{}),ha=(n=>(n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n))(ha||{}),Kt=(n=>(n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.BYTE=5120]="BYTE",n[n.SHORT=5122]="SHORT",n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.HALF_FLOAT=36193]="HALF_FLOAT",n))(Kt||{}),Tu=(n=>(n[n.FLOAT=0]="FLOAT",n[n.INT=1]="INT",n[n.UINT=2]="UINT",n))(Tu||{}),ls=(n=>(n[n.NEAREST=0]="NEAREST",n[n.LINEAR=1]="LINEAR",n))(ls||{}),Es=(n=>(n[n.CLAMP=33071]="CLAMP",n[n.REPEAT=10497]="REPEAT",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n))(Es||{}),Vn=(n=>(n[n.OFF=0]="OFF",n[n.POW2=1]="POW2",n[n.ON=2]="ON",n[n.ON_MANUAL=3]="ON_MANUAL",n))(Vn||{}),An=(n=>(n[n.NPM=0]="NPM",n[n.UNPACK=1]="UNPACK",n[n.PMA=2]="PMA",n[n.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",n[n.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",n[n.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",n))(An||{}),Wn=(n=>(n[n.NO=0]="NO",n[n.YES=1]="YES",n[n.AUTO=2]="AUTO",n[n.BLEND=0]="BLEND",n[n.CLEAR=1]="CLEAR",n[n.BLIT=2]="BLIT",n))(Wn||{}),Eu=(n=>(n[n.AUTO=0]="AUTO",n[n.MANUAL=1]="MANUAL",n))(Eu||{}),yn=(n=>(n.LOW="lowp",n.MEDIUM="mediump",n.HIGH="highp",n))(yn||{}),Ei=(n=>(n[n.NONE=0]="NONE",n[n.SCISSOR=1]="SCISSOR",n[n.STENCIL=2]="STENCIL",n[n.SPRITE=3]="SPRITE",n[n.COLOR=4]="COLOR",n))(Ei||{}),yi=(n=>(n[n.NONE=0]="NONE",n[n.LOW=2]="LOW",n[n.MEDIUM=4]="MEDIUM",n[n.HIGH=8]="HIGH",n))(yi||{}),Xn=(n=>(n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n))(Xn||{});const Ft={ADAPTER:{createCanvas:(n,t)=>{const e=document.createElement("canvas");return e.width=n,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(n,t)=>fetch(n,t),parseXML:n=>(new DOMParser).parseFromString(n,"text/xml")},RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Au=/iPhone/i,Gm=/iPod/i,zm=/iPad/i,Hm=/\biOS-universal(?:.+)Mac\b/i,Cu=/\bAndroid(?:.+)Mobile\b/i,Vm=/Android/i,ca=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Xl=/Silk/i,hs=/Windows Phone/i,Wm=/\bWindows(?:.+)ARM\b/i,Xm=/BlackBerry/i,Ym=/BB10/i,Zm=/Opera Mini/i,$m=/\b(CriOS|Chrome)(?:.+)Mobile/i,qm=/Mobile(?:.+)Firefox\b/i,jm=function(n){return typeof n<"u"&&"MacIntel"===n.platform&&"number"==typeof n.maxTouchPoints&&n.maxTouchPoints>1&&typeof MSStream>"u"};const cs=function uS(n){var t={userAgent:"",platform:"",maxTouchPoints:0};!n&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:"string"==typeof n?t.userAgent=n:n&&n.userAgent&&(t={userAgent:n.userAgent,platform:n.platform,maxTouchPoints:n.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),typeof(i=e.split("Twitter"))[1]<"u"&&(e=i[0]);var s=function cS(n){return function(t){return t.test(n)}}(e),r={apple:{phone:s(Au)&&!s(hs),ipod:s(Gm),tablet:!s(Au)&&(s(zm)||jm(t))&&!s(hs),universal:s(Hm),device:(s(Au)||s(Gm)||s(zm)||s(Hm)||jm(t))&&!s(hs)},amazon:{phone:s(ca),tablet:!s(ca)&&s(Xl),device:s(ca)||s(Xl)},android:{phone:!s(hs)&&s(ca)||!s(hs)&&s(Cu),tablet:!s(hs)&&!s(ca)&&!s(Cu)&&(s(Xl)||s(Vm)),device:!s(hs)&&(s(ca)||s(Xl)||s(Cu)||s(Vm))||s(/\bokhttp\b/i)},windows:{phone:s(hs),tablet:s(Wm),device:s(hs)||s(Wm)},other:{blackberry:s(Xm),blackberry10:s(Ym),opera:s(Zm),firefox:s(qm),chrome:s($m),device:s(Xm)||s(Ym)||s(Zm)||s(qm)||s($m)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}(globalThis.navigator);Ft.RETINA_PREFIX=/@([0-9\.]+)x/,Ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var oo=ot(2005),dS=ot(5469),Ru=ot(8762);const fS={parse:Ru.Qc,format:Ru.WU,resolve:Ru.DB};function Cn(n){if("string"!=typeof n)throw new TypeError(`Path must be a string. Received ${JSON.stringify(n)}`)}function lo(n){return n.split("?")[0].split("#")[0]}const Bi={toPosix:n=>function mS(n,t,e){return n.replace(new RegExp(function pS(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(t),"g"),e)}(n,"\\","/"),isUrl(n){return/^https?:/.test(this.toPosix(n))},isDataUrl:n=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(n),hasProtocol(n){return/^[^/:]+:\//.test(this.toPosix(n))},getProtocol(n){Cn(n),n=this.toPosix(n);let t="";const e=/^file:\/\/\//.exec(n),i=/^[^/:]+:\/\//.exec(n),s=/^[^/:]+:\//.exec(n);if(e||i||s){const r=e?.[0]||i?.[0]||s?.[0];t=r,n=n.slice(r.length)}return t},toAbsolute(n,t,e){if(this.isDataUrl(n))return n;const i=lo(this.toPosix(t??Ft.ADAPTER.getBaseUrl())),s=lo(this.toPosix(e??this.rootname(i)));return Cn(n),(n=this.toPosix(n)).startsWith("/")?Bi.join(s,n.slice(1)):this.isAbsolute(n)?n:this.join(i,n)},normalize(n){if(Cn(n=this.toPosix(n)),0===n.length)return".";let t="";const e=n.startsWith("/");this.hasProtocol(n)&&(t=this.rootname(n),n=n.slice(t.length));const i=n.endsWith("/");return n=function gS(n,t){let e="",i=0,s=-1,r=0,a=-1;for(let o=0;o<=n.length;++o){if(o<n.length)a=n.charCodeAt(o);else{if(47===a)break;a=47}if(47===a){if(s!==o-1&&1!==r)if(s!==o-1&&2===r){if(e.length<2||2!==i||46!==e.charCodeAt(e.length-1)||46!==e.charCodeAt(e.length-2))if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){-1===l?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),s=o,r=0;continue}}else if(2===e.length||1===e.length){e="",i=0,s=o,r=0;continue}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${n.slice(s+1,o)}`:e=n.slice(s+1,o),i=o-s-1;s=o,r=0}else 46===a&&-1!==r?++r:r=-1}return e}(n,!1),n.length>0&&i&&(n+="/"),e?`/${n}`:t+n},isAbsolute(n){return Cn(n),n=this.toPosix(n),!!this.hasProtocol(n)||n.startsWith("/")},join(...n){if(0===n.length)return".";let t;for(let e=0;e<n.length;++e){const i=n[e];Cn(i),i.length>0&&(void 0===t?t=i:this.extname(n[e-1]??"")?t+=`/../${i}`:t+=`/${i}`)}return void 0===t?".":this.normalize(t)},dirname(n){if(Cn(n),0===n.length)return".";let t=(n=this.toPosix(n)).charCodeAt(0);const e=47===t;let i=-1,s=!0;const r=this.getProtocol(n),a=n;for(let o=(n=n.slice(r.length)).length-1;o>=1;--o)if(t=n.charCodeAt(o),47===t){if(!s){i=o;break}}else s=!1;return-1===i?e?"/":this.isUrl(a)?r+n:r:e&&1===i?"//":r+n.slice(0,i)},rootname(n){Cn(n);let t="";if(t=(n=this.toPosix(n)).startsWith("/")?"/":this.getProtocol(n),this.isUrl(n)){const e=n.indexOf("/",t.length);t=-1!==e?n.slice(0,e):n,t.endsWith("/")||(t+="/")}return t},basename(n,t){Cn(n),t&&Cn(t),n=lo(this.toPosix(n));let r,e=0,i=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=n.length){if(t.length===n.length&&t===n)return"";let a=t.length-1,o=-1;for(r=n.length-1;r>=0;--r){const l=n.charCodeAt(r);if(47===l){if(!s){e=r+1;break}}else-1===o&&(s=!1,o=r+1),a>=0&&(l===t.charCodeAt(a)?-1==--a&&(i=r):(a=-1,i=o))}return e===i?i=o:-1===i&&(i=n.length),n.slice(e,i)}for(r=n.length-1;r>=0;--r)if(47===n.charCodeAt(r)){if(!s){e=r+1;break}}else-1===i&&(s=!1,i=r+1);return-1===i?"":n.slice(e,i)},extname(n){Cn(n);let t=-1,e=0,i=-1,s=!0,r=0;for(let a=(n=lo(this.toPosix(n))).length-1;a>=0;--a){const o=n.charCodeAt(a);if(47!==o)-1===i&&(s=!1,i=a+1),46===o?-1===t?t=a:1!==r&&(r=1):-1!==t&&(r=-1);else if(!s){e=a+1;break}}return-1===t||-1===i||0===r||1===r&&t===i-1&&t===e+1?"":n.slice(t,i)},parse(n){Cn(n);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===n.length)return t;let e=(n=lo(this.toPosix(n))).charCodeAt(0);const i=this.isAbsolute(n);let s;t.root=this.rootname(n),s=i||this.hasProtocol(n)?1:0;let a=-1,o=0,l=-1,h=!0,c=n.length-1,u=0;for(;c>=s;--c)if(e=n.charCodeAt(c),47!==e)-1===l&&(h=!1,l=c+1),46===e?-1===a?a=c:1!==u&&(u=1):-1!==a&&(u=-1);else if(!h){o=c+1;break}return-1===a||-1===l||0===u||1===u&&a===l-1&&a===o+1?-1!==l&&(t.base=t.name=n.slice(0===o&&i?1:o,l)):(0===o&&i?(t.name=n.slice(1,a),t.base=n.slice(1,l)):(t.name=n.slice(o,a),t.base=n.slice(o,l)),t.ext=n.slice(a,l)),t.dir=this.dirname(n),t},sep:"/",delimiter:":"},Jm={};function De(n,t,e=3){if(Jm[t])return;let i=(new Error).stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${n}`):(i=i.split("\n").splice(e).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${n}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${n}`),console.warn(i))),Jm[t]=!0}let Iu;var sA={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ho(n,t=[]){return t[0]=(n>>16&255)/255,t[1]=(n>>8&255)/255,t[2]=(255&n)/255,t}function Km(n){let t=n.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function Pu(n){if("string"==typeof n&&("#"===(n=sA[n.toLowerCase()]||n)[0]&&(n=n.slice(1)),3===n.length)){const[t,e,i]=n;n=t+t+e+e+i+i}return parseInt(n,16)}const Qm=function rA(){const n=[],t=[];for(let i=0;i<32;i++)n[i]=i,t[i]=i;n[re.NORMAL_NPM]=re.NORMAL,n[re.ADD_NPM]=re.ADD,n[re.SCREEN_NPM]=re.SCREEN,t[re.NORMAL]=re.NORMAL_NPM,t[re.ADD]=re.ADD_NPM,t[re.SCREEN]=re.SCREEN_NPM;const e=[];return e.push(t),e.push(n),e}();function tg(n,t){return Qm[t?1:0][n]}function Du(n,t){if(1===t)return(255*t<<24)+n;if(0===t)return 0;let e=n>>16&255,i=n>>8&255,s=255&n;return e=e*t+.5|0,i=i*t+.5|0,s=s*t+.5|0,(255*t<<24)+(e<<16)+(i<<8)+s}function eg(n,t,e,i){return(e=e||new Float32Array(4))[0]=(n>>16&255)/255,e[1]=(n>>8&255)/255,e[2]=(255&n)/255,(i||void 0===i)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function Lu(n){if(4===n.BYTES_PER_ELEMENT)return n instanceof Float32Array?"Float32Array":n instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===n.BYTES_PER_ELEMENT){if(n instanceof Uint16Array)return"Uint16Array"}else if(1===n.BYTES_PER_ELEMENT&&n instanceof Uint8Array)return"Uint8Array";return null}function Yl(n){return n+=0===n?1:0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,1+(n|=n>>>16)}function ig(n){return!(n&n-1||!n)}function ng(n){let t=(n>65535?1:0)<<4,e=((n>>>=t)>255?1:0)<<3;return t|=e,e=((n>>>=e)>15?1:0)<<2,t|=e,e=((n>>>=e)>3?1:0)<<1,t|=e,t|(n>>>=e)>>1}function ua(n,t,e){const i=n.length;let s;if(t>=i||0===e)return;const r=i-(e=t+e>i?i-t:e);for(s=t;s<r;++s)n[s]=n[s+e];n.length=r}function da(n){return 0===n?0:n<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let cA=0;function dr(){return++cA}const sg=class{constructor(n,t,e,i){this.left=n,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Ou=sg;Ou.EMPTY=new sg(0,0,0,0);const rg={},Qi=Object.create(null),xn=Object.create(null);class ag{constructor(t,e,i){this._canvas=Ft.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||Ft.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function og(n,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(0!==n[s+3])return!1;return!0}function lg(n,t,e,i,s){const r=4*t;for(let a=i,o=i*r+4*e;a<=s;++a,o+=r)if(0!==n[o+3])return!1;return!0}let Zl;function As(n,t=1){const e=Ft.RETINA_PREFIX?.exec(n);return e?parseFloat(e[1]):t}var Pt=(n=>(n.Renderer="renderer",n.Application="application",n.RendererSystem="renderer-webgl-system",n.RendererPlugin="renderer-webgl-plugin",n.CanvasRendererSystem="renderer-canvas-system",n.CanvasRendererPlugin="renderer-canvas-plugin",n.Asset="asset",n.LoadParser="load-parser",n.ResolveParser="resolve-parser",n.CacheParser="cache-parser",n.DetectionParser="detection-parser",n))(Pt||{});const Bu=n=>{if("function"==typeof n||"object"==typeof n&&n.extension){if(!n.extension)throw new Error("Extension class must have an extension object");n={..."object"!=typeof n.extension?{type:n.extension}:n.extension,ref:n}}if("object"!=typeof n)throw new Error("Invalid extension type");return"string"==typeof(n={...n}).type&&(n.type=[n.type]),n},hg=(n,t)=>Bu(n).priority??t,Yt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...n){return n.map(Bu).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...n){return n.map(Bu).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))})}),this},handle(n,t,e){const i=this._addHandlers,s=this._removeHandlers;if(i[n]||s[n])throw new Error(`Extension type ${n} already has a handler`);i[n]=t,s[n]=e;const r=this._queue;return r[n]&&(r[n].forEach(a=>t(a)),delete r[n]),this},handleByMap(n,t){return this.handle(n,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(n,t,e=-1){return this.handle(n,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,r)=>hg(r,e)-hg(s,e)))},i=>{const s=t.indexOf(i.ref);-1!==s&&t.splice(s,1)})}};class Fu{constructor(t){this.rawBinaryData="number"==typeof t?new ArrayBuffer(t):t instanceof Uint8Array?t.buffer:t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const pA=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function mA(n){let t="";for(let e=0;e<n;++e)e>0&&(t+="\nelse "),e<n-1&&(t+=`if(test == ${e}.0){}`);return t}class us{constructor(){this.data=0,this.blendMode=re.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==re.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new us;return t.depthTest=!1,t.blend=!0,t}}const Vu=[];function cg(n,t){if(!n)return null;let e="";if("string"==typeof n){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(n);i&&(e=i[1].toLowerCase())}for(let i=Vu.length-1;i>=0;--i){const s=Vu[i];if(s.test&&s.test(n,e))return new s(n,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Rn{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,r,a,o,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](t,e,i,s,r,a,o,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(Rn.prototype,{dispatch:{value:Rn.prototype.emit},run:{value:Rn.prototype.emit}});class co{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Rn("setRealSize"),this.onUpdate=new Rn("update"),this.onError=new Rn("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class uo extends co{constructor(t,e){const{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t}upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===An.UNPACK);const r=e.realWidth,a=e.realHeight;return i.width===r&&i.height===a?s.texSubImage2D(e.target,0,0,0,r,a,e.format,i.type,this.data):(i.width=r,i.height=a,s.texImage2D(e.target,0,i.internalFormat,r,a,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const _A={scaleMode:ls.NEAREST,format:Mt.RGBA,alphaMode:An.NPM},fa=class extends oo{constructor(n=null,t=null){super(),t=Object.assign({},fa.defaultOptions,t);const{alphaMode:e,mipmap:i,anisotropicLevel:s,scaleMode:r,width:a,height:o,wrapMode:l,format:h,type:c,target:u,resolution:d,resourceOptions:f}=t;n&&!(n instanceof co)&&((n=cg(n,f)).internal=!0),this.resolution=d||Ft.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=r,this.format=h,this.type=c,this.target=u,this.alphaMode=e,this.uid=dr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(n)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(n){this._mipmap!==n&&(this._mipmap=n,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(n){this._scaleMode!==n&&(this._scaleMode=n,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(n){this._wrapMode!==n&&(this._wrapMode=n,this.dirtyStyleId++)}setStyle(n,t){let e;return void 0!==n&&n!==this.scaleMode&&(this.scaleMode=n,e=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(n,t,e){return this.setRealSize(n*(e=e||this.resolution),t*e,e)}setRealSize(n,t,e){return this.resolution=e||this.resolution,this.width=Math.round(n)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ig(this.realWidth)&&ig(this.realHeight)}setResolution(n){const t=this.resolution;return t===n||(this.resolution=n,this.valid&&(this.width=Math.round(this.width*t)/n,this.height=Math.round(this.height*t)/n,this.emit("update",this)),this._refreshPOT()),this}setResource(n){if(this.resource===n)return this;if(this.resource)throw new Error("Resource can be set only once");return n.bind(this),this.resource=n,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(n){this.emit("error",this,n)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete xn[this.cacheId],delete Qi[this.cacheId],this.cacheId=null),this.dispose(),fa.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(n,t,e=Ft.STRICT_TEXTURE_CACHE){const i="string"==typeof n;let s=null;i?s=n:(n._pixiId||(n._pixiId=`${t?.pixiIdPrefix||"pixiid"}_${dr()}`),s=n._pixiId);let r=xn[s];if(i&&e&&!r)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return r||(r=new fa(n,t),r.cacheId=s,fa.addToCache(r,s)),r}static fromBuffer(n,t,e,i){n=n||new Float32Array(t*e*4);const s=new uo(n,{width:t,height:e}),r=n instanceof Float32Array?Kt.FLOAT:Kt.UNSIGNED_BYTE;return new fa(s,Object.assign({},_A,i||{width:t,height:e,type:r}))}static addToCache(n,t){t&&(n.textureCacheIds.includes(t)||n.textureCacheIds.push(t),xn[t]&&xn[t]!==n&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),xn[t]=n)}static removeFromCache(n){if("string"==typeof n){const t=xn[n];if(t){const e=t.textureCacheIds.indexOf(n);return e>-1&&t.textureCacheIds.splice(e,1),delete xn[n],t}}else if(n?.textureCacheIds){for(let t=0;t<n.textureCacheIds.length;++t)delete xn[n.textureCacheIds[t]];return n.textureCacheIds.length=0,n}return null}};let fe=fa;fe.defaultOptions={mipmap:Vn.POW2,anisotropicLevel:0,scaleMode:ls.LINEAR,wrapMode:Es.CLAMP,alphaMode:An.UNPACK,target:ha.TEXTURE_2D,format:Mt.RGBA,type:Kt.UNSIGNED_BYTE},fe._globalBatch=0;class Wu{constructor(){this.texArray=null,this.blend=0,this.type=Hn.TRIANGLES,this.start=0,this.size=0,this.data=null}}let yA=0;class pi{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=yA++,this.disposeRunner=new Rn("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Xn.ELEMENT_ARRAY_BUFFER:Xn.ARRAY_BUFFER}get index(){return this.type===Xn.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new pi(t)}}class $l{constructor(t,e=0,i=!1,s=Kt.FLOAT,r,a,o,l=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=r,this.start=a,this.instance=o,this.divisor=l}destroy(){this.buffer=null}static from(t,e,i,s,r){return new $l(t,e,i,s,r)}}const xA={Float32Array,Uint32Array,Int32Array,Uint8Array},ug={5126:4,5123:2,5121:1};let bA=0;const wA={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Cs{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=bA++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Rn("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,r,a,o,l=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof pi||(e instanceof Array&&(e=new Float32Array(e)),e=new pi(e));const h=t.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],e,i,s,r);return this}let c=this.buffers.indexOf(e);return-1===c&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new $l(c,i,s,r,a,o,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof pi||(t instanceof Array&&(t=new Uint16Array(t)),t=new pi(t)),t.type=Xn.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new pi;let s;for(s in this.attributes){const r=this.attributes[s];t.push(this.buffers[r.buffer].data),e.push(r.size*ug[r.type]/4),r.buffer=0}for(i.data=function vA(n,t){let e=0,i=0;const s={};for(let l=0;l<n.length;l++)i+=t[l],e+=n[l].length;const r=new ArrayBuffer(4*e);let a=null,o=0;for(let l=0;l<n.length;l++){const h=t[l],c=n[l],u=Lu(c);s[u]||(s[u]=new xA[u](r)),a=s[u];for(let d=0;d<c.length;d++)a[(d/h|0)*i+o+d%h]=c[d];o+=h}return new Float32Array(r)}(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Cs;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new pi(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new $l(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Xn.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Cs,i=[],s=[],r=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let l=0;l<a.buffers.length;l++)s[l]=s[l]||0,s[l]+=a.buffers[l].data.length,r[l]=0}for(let o=0;o<a.buffers.length;o++)i[o]=new(wA[Lu(a.buffers[o].data)])(s[o]),e.buffers[o]=new pi(i[o]);for(let o=0;o<t.length;o++){a=t[o];for(let l=0;l<a.buffers.length;l++)i[l].set(a.buffers[l].data,r[l]),r[l]+=a.buffers[l].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=Xn.ELEMENT_ARRAY_BUFFER;let o=0,l=0,h=0,c=0;for(let u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){c=u;break}for(const u in a.attributes){const d=a.attributes[u];(0|d.buffer)===c&&(l+=d.size*ug[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+h]+=o;o+=t[u].buffers[c].data.length/l,h+=d.length}}return e}}class dg extends Cs{constructor(t=!1){super(),this._buffer=new pi(null,t,!1),this._indexBuffer=new pi(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Kt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Kt.FLOAT).addAttribute("aColor",this._buffer,4,!0,Kt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Kt.FLOAT).addIndex(this._indexBuffer)}}const ql=2*Math.PI,MA=180/Math.PI,SA=Math.PI/180;var Fi=(n=>(n[n.POLY=0]="POLY",n[n.RECT=1]="RECT",n[n.CIRC=2]="CIRC",n[n.ELIP=3]="ELIP",n[n.RREC=4]="RREC",n))(Fi||{});class Le{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Le(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const jl=[new Le,new Le,new Le,new Le];class Ae{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=Fi.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ae(0,0,0,0)}clone(){return new Ae(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e)return!((this.right>t.right?t.right:this.right)<=(this.x<t.x?t.x:this.x))&&(this.bottom>t.bottom?t.bottom:this.bottom)>(this.y<t.y?t.y:this.y);const i=this.left,s=this.right,r=this.top,a=this.bottom;if(s<=i||a<=r)return!1;const o=jl[0].set(t.left,t.top),l=jl[1].set(t.left,t.bottom),h=jl[2].set(t.right,t.top),c=jl[3].set(t.right,t.bottom);if(h.x<=o.x||l.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u||(e.apply(o,o),e.apply(l,l),e.apply(h,h),e.apply(c,c),Math.max(o.x,l.x,h.x,c.x)<=i||Math.min(o.x,l.x,h.x,c.x)>=s||Math.max(o.y,l.y,h.y,c.y)<=r||Math.min(o.y,l.y,h.y,c.y)>=a))return!1;const d=u*(l.y-o.y),f=u*(o.x-l.x),p=d*i+f*r,m=d*s+f*r,g=d*i+f*a,x=d*s+f*a;if(Math.max(p,m,g,x)<=d*o.x+f*o.y||Math.min(p,m,g,x)>=d*c.x+f*c.y)return!1;const v=u*(o.y-h.y),y=u*(h.x-o.x),b=v*i+y*r,M=v*s+y*r,S=v*i+y*a,A=v*s+y*a;return!(Math.max(b,M,S,A)<=v*o.x+y*o.y||Math.min(b,M,S,A)>=v*c.x+y*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(r-s,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=r-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Xu{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Fi.CIRC}clone(){return new Xu(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let s=this.x-t,r=this.y-e;return s*=s,r*=r,s+r<=this.radius*this.radius}getBounds(){return new Ae(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Yu{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=Fi.ELIP}clone(){return new Yu(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Ae(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class pa{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const i=[];for(let s=0,r=e.length;s<r;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=Fi.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new pa(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const s=this.points.length/2;for(let r=0,a=s-1;r<s;a=r++){const o=this.points[2*r],l=this.points[2*r+1],h=this.points[2*a],c=this.points[2*a+1];l>e!=c>e&&t<(e-l)/(c-l)*(h-o)+o&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}}class Zu{constructor(t=0,e=0,i=0,s=0,r=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=r,this.type=Fi.RREC}clone(){return new Zu(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),r=e-(this.y+i);const a=i*i;if(s*s+r*r<=a||(s=t-(this.x+this.width-i),s*s+r*r<=a)||(r=e-(this.y+this.height-i),s*s+r*r<=a)||(s=t-(this.x+i),s*s+r*r<=a))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class ei{constructor(t=1,e=0,i=0,s=1,r=0,a=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,r,a){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new Le;const i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Le;const i=1/(this.a*this.d+this.c*-this.b),s=t.x,r=t.y;return e.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.c,a=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}append(t){const e=this.a,i=this.b,s=this.c,r=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}setTransform(t,e,i,s,r,a,o,l,h){return this.a=Math.cos(o+h)*r,this.b=Math.sin(o+h)*r,this.c=-Math.sin(o-l)*a,this.d=Math.cos(o-l)*a,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,s=this.c,r=this.d,a=t.pivot,o=-Math.atan2(-s,r),l=Math.atan2(i,e),h=Math.abs(o+l);return h<1e-5||Math.abs(ql-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+r*r),t.position.x=this.tx+(a.x*e+a.y*s),t.position.y=this.ty+(a.x*i+a.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,a=t*s-e*i;return this.a=s/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-s*r)/a,this.ty=-(t*this.ty-e*r)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new ei;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new ei}static get TEMP_MATRIX(){return new ei}}const fr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],pr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],mr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],gr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],$u=[],fg=[],Jl=Math.sign;!function TA(){for(let n=0;n<16;n++){const t=[];$u.push(t);for(let e=0;e<16;e++){const i=Jl(fr[n]*fr[e]+mr[n]*pr[e]),s=Jl(pr[n]*fr[e]+gr[n]*pr[e]),r=Jl(fr[n]*mr[e]+mr[n]*gr[e]),a=Jl(pr[n]*mr[e]+gr[n]*gr[e]);for(let o=0;o<16;o++)if(fr[o]===i&&pr[o]===s&&mr[o]===r&&gr[o]===a){t.push(o);break}}}for(let n=0;n<16;n++){const t=new ei;t.set(fr[n],pr[n],mr[n],gr[n],0,0),fg.push(t)}}();const ri={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:n=>fr[n],uY:n=>pr[n],vX:n=>mr[n],vY:n=>gr[n],inv:n=>8&n?15&n:7&-n,add:(n,t)=>$u[n][t],sub:(n,t)=>$u[n][ri.inv(t)],rotate180:n=>4^n,isVertical:n=>2==(3&n),byDirection:(n,t)=>2*Math.abs(n)<=Math.abs(t)?t>=0?ri.S:ri.N:2*Math.abs(t)<=Math.abs(n)?n>0?ri.E:ri.W:t>0?n>0?ri.SE:ri.SW:n>0?ri.NE:ri.NW,matrixAppendRotationInv:(n,t,e=0,i=0)=>{const s=fg[ri.inv(t)];s.tx=e,s.ty=i,n.append(s)}};class Rs{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Rs(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const pg=class{constructor(){this.worldTransform=new ei,this.localTransform=new ei,this.position=new Rs(this.onChange,this,0,0),this.scale=new Rs(this.onChange,this,1,1),this.pivot=new Rs(this.onChange,this,0,0),this.skew=new Rs(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const n=this.localTransform;this._localID!==this._currentLocalID&&(n.a=this._cx*this.scale.x,n.b=this._sx*this.scale.x,n.c=this._cy*this.scale.y,n.d=this._sy*this.scale.y,n.tx=this.position.x-(this.pivot.x*n.a+this.pivot.y*n.c),n.ty=this.position.y-(this.pivot.x*n.b+this.pivot.y*n.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(n){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==n._worldID){const e=n.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=n._worldID,this._worldID++}}setFromMatrix(n){n.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(n){this._rotation!==n&&(this._rotation=n,this.updateSkew())}};let qu=pg;qu.IDENTITY=new pg;const ma=[{test:n=>"float"===n.type&&1===n.size&&!n.isArray,code:n=>`\n            if(uv["${n}"] !== ud["${n}"].value)\n            {\n                ud["${n}"].value = uv["${n}"]\n                gl.uniform1f(ud["${n}"].location, uv["${n}"])\n            }\n            `},{test:(n,t)=>!("sampler2D"!==n.type&&"samplerCube"!==n.type&&"sampler2DArray"!==n.type||1!==n.size||n.isArray||null!=t&&void 0===t.castToBaseTexture),code:n=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${n}"], t);\n\n            if(ud["${n}"].value !== t)\n            {\n                ud["${n}"].value = t;\n                gl.uniform1i(ud["${n}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(n,t)=>"mat3"===n.type&&1===n.size&&!n.isArray&&void 0!==t.a,code:n=>`\n            gl.uniformMatrix3fv(ud["${n}"].location, false, uv["${n}"].toArray(true));\n            `,codeUbo:n=>`\n                var ${n}_matrix = uv.${n}.toArray(true);\n\n                data[offset] = ${n}_matrix[0];\n                data[offset+1] = ${n}_matrix[1];\n                data[offset+2] = ${n}_matrix[2];\n        \n                data[offset + 4] = ${n}_matrix[3];\n                data[offset + 5] = ${n}_matrix[4];\n                data[offset + 6] = ${n}_matrix[5];\n        \n                data[offset + 8] = ${n}_matrix[6];\n                data[offset + 9] = ${n}_matrix[7];\n                data[offset + 10] = ${n}_matrix[8];\n            `},{test:(n,t)=>"vec2"===n.type&&1===n.size&&!n.isArray&&void 0!==t.x,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${n}"].location, v.x, v.y);\n                }`,codeUbo:n=>`\n                v = uv.${n};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:n=>"vec2"===n.type&&1===n.size&&!n.isArray,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${n}"].location, v[0], v[1]);\n                }\n            `},{test:(n,t)=>"vec4"===n.type&&1===n.size&&!n.isArray&&void 0!==t.width,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${n}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:n=>`\n                    v = uv.${n};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:n=>"vec4"===n.type&&1===n.size&&!n.isArray,code:n=>`\n                cv = ud["${n}"].value;\n                v = uv["${n}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${n}"].location, v[0], v[1], v[2], v[3])\n                }`}],CA={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},RA={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},mg={};let Ql,Kl=mg;const LA={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function gg(n){return LA[n]}let th=null;const _g={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function yg(n,t){if(!th){const e=Object.keys(_g);th={};for(let i=0;i<e.length;++i){const s=e[i];th[n[s]]=_g[s]}}return th[t]}function xg(n,t,e){if("precision"!==n.substring(0,9)){let i=t;return t===yn.HIGH&&e!==yn.HIGH&&(i=yn.MEDIUM),`precision ${i} float;\n${n}`}return e!==yn.HIGH&&"precision highp"===n.substring(0,15)?n.replace("precision highp","precision mediump"):n}let OA=0;const eh={},ga=class{constructor(n,t,e="pixi-shader",i={}){this.extra={},this.id=OA++,this.vertexSrc=n||ga.defaultVertexSrc,this.fragmentSrc=t||ga.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,"#version"!==this.vertexSrc.substring(0,8)&&(e=e.replace(/\s+/g,"-"),eh[e]?(eh[e]++,e+=`-${eh[e]}`):eh[e]=1,this.vertexSrc=`#define SHADER_NAME ${e}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${e}\n${this.fragmentSrc}`,this.vertexSrc=xg(this.vertexSrc,ga.defaultVertexPrecision,yn.HIGH),this.fragmentSrc=xg(this.fragmentSrc,ga.defaultFragmentPrecision,function DA(){if(!Ql){Ql=yn.MEDIUM;const n=function PA(){if(Kl===mg||Kl?.isContextLost()){const n=Ft.ADAPTER.createCanvas();let t;Ft.PREFER_ENV>=ur.WEBGL2&&(t=n.getContext("webgl2",{})),t||(t=n.getContext("webgl",{})||n.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Kl=t}return Kl}();n&&n.getShaderPrecisionFormat&&(Ql=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision?yn.HIGH:yn.MEDIUM)}return Ql}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(n,t,e){const i=n+t;let s=rg[i];return s||(rg[i]=s=new ga(n,t,e)),s}};let In=ga;In.defaultVertexPrecision=yn.HIGH,In.defaultFragmentPrecision=cs.apple.device?yn.HIGH:yn.MEDIUM;let BA=0;class Pn{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=BA++,this.static=!!e,this.ubo=!!i,t instanceof pi?(this.buffer=t,this.buffer.type=Xn.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new pi(new Float32Array(1)),this.buffer.type=Xn.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new Pn(e,i)}static from(t,e,i){return new Pn(t,e,i)}static uboFrom(t,e){return new Pn(t,e??!0,!0)}}class Yn{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof Pn?e:new Pn(e):new Pn({}),this.disposeRunner=new Rn("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const s=e.uniforms[i];if(s.group&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const s=In.from(t,e);return new Yn(s,i)}}class FA{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let r=0;r<t;r++)i[r]=r;this.defaultGroupCache[t]=Pn.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new In(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new ei,default:this.defaultGroupCache[t]};return new Yn(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class ju{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class ih{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Dn=class extends ih{constructor(n){super(n),this.setShaderGenerator(),this.geometryClass=dg,this.vertexSize=6,this.state=us.for2d(),this.size=4*Dn.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),n.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function UA(n){let t=!0;const e=Ft.ADAPTER.getNavigator();if(cs.tablet||cs.phone){if(cs.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(cs.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?n:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(n){this._defaultMaxTextures=n}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??function NA(){return!cs.apple.device}(),this._canUploadSameBuffer}static set canUploadSameBuffer(n){this._canUploadSameBuffer=n}get MAX_TEXTURES(){return De("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:n=Dn.defaultVertexSrc,fragment:t=Dn.defaultFragmentTemplate}={}){this.shaderGenerator=new FA(n,t)}contextChange(){const n=this.renderer.gl;Ft.PREFER_ENV===ur.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),Dn.defaultMaxTextures),this.maxTextures=function gA(n,t){if(0===n)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=pA.replace(/%forloop%/gi,mA(n));if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))break;n=n/2|0}return n}(this.maxTextures,n)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:n,_textureArrayPool:t}=Dn,e=this.size/4,i=Math.floor(e/this.maxTextures)+1;for(;n.length<e;)n.push(new Wu);for(;t.length<i;)t.push(new ju);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(n){!n._texture.valid||(this._vertexCount+n.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=n.vertexData.length/2,this._indexCount+=n.indices.length,this._bufferedTextures[this._bufferSize]=n._texture.baseTexture,this._bufferedElements[this._bufferSize++]=n)}buildTexturesAndDrawCalls(){const{_bufferedTextures:n,maxTextures:t}=this,e=Dn._textureArrayPool,i=this.renderer.batch,s=this._tempBoundTextures,r=this.renderer.textureGC.count;let a=++fe._globalBatch,o=0,l=e[0],h=0;i.copyBoundTextures(s,t);for(let c=0;c<this._bufferSize;++c){const u=n[c];n[c]=null,u._batchEnabled!==a&&(l.count>=t&&(i.boundArray(l,s,a,t),this.buildDrawCalls(l,h,c),h=c,l=e[++o],++a),u._batchEnabled=a,u.touched=r,l.elements[l.count++]=u)}l.count>0&&(i.boundArray(l,s,a,t),this.buildDrawCalls(l,h,this._bufferSize),++o,++a);for(let c=0;c<s.length;c++)s[c]=null;fe._globalBatch=a}buildDrawCalls(n,t,e){const{_bufferedElements:i,_attributeBuffer:s,_indexBuffer:r,vertexSize:a}=this,o=Dn._drawCallPool;let l=this._dcIndex,h=this._aIndex,c=this._iIndex,u=o[l];u.start=this._iIndex,u.texArray=n;for(let d=t;d<e;++d){const f=i[d],m=Qm[f._texture.baseTexture.alphaMode?1:0][f.blendMode];i[d]=null,t<d&&u.blend!==m&&(u.size=c-u.start,t=d,u=o[++l],u.texArray=n,u.start=c),this.packInterleavedGeometry(f,s,r,h,c),h+=f.vertexData.length/2*a,c+=f.indices.length,u.blend=m}t<e&&(u.size=c-u.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=c}bindAndClearTexArray(n){const t=this.renderer.texture;for(let e=0;e<n.count;e++)t.bind(n.elements[e],n.ids[e]),n.elements[e]=null;n.count=0}updateGeometry(){const{_packedGeometries:n,_attributeBuffer:t,_indexBuffer:e}=this;Dn.canUploadSameBuffer?(n[this._flushId]._buffer.update(t.rawBinaryData),n[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,n[this._flushId]=new this.geometryClass),n[this._flushId]._buffer.update(t.rawBinaryData),n[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(n[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const n=this._dcIndex,{gl:t,state:e}=this.renderer,i=Dn._drawCallPool;let s=null;for(let r=0;r<n;r++){const{texArray:a,type:o,size:l,start:h,blend:c}=i[r];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,e.set(this.state),t.drawElements(o,l,t.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Dn.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let n=0;n<this._packedGeometryPoolSize;n++)this._packedGeometries[n]&&this._packedGeometries[n].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(n){const t=Yl(Math.ceil(n/8)),e=ng(t),i=8*t;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let s=this._aBuffers[i];return s||(this._aBuffers[i]=s=new Fu(i*this.vertexSize*4)),s}getIndexBuffer(n){const t=Yl(Math.ceil(n/12)),e=ng(t),i=12*t;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let s=this._iBuffers[e];return s||(this._iBuffers[e]=s=new Uint16Array(i)),s}packInterleavedGeometry(n,t,e,i,s){const{uint32View:r,float32View:a}=t,o=i/this.vertexSize,l=n.uvs,h=n.indices,c=n.vertexData,u=n._texture.baseTexture._batchLocation,d=Math.min(n.worldAlpha,1),f=d<1&&n._texture.baseTexture.alphaMode?Du(n._tintRGB,d):n._tintRGB+(255*d<<24);for(let p=0;p<c.length;p+=2)a[i++]=c[p],a[i++]=c[p+1],a[i++]=l[p],a[i++]=l[p+1],r[i++]=f,a[i++]=u;for(let p=0;p<h.length;p++)e[s++]=o+h[p]}};let Ln=Dn;Ln.defaultBatchSize=4096,Ln.extension={name:"batch",type:Pt.RendererPlugin},Ln._drawCallPool=[],Ln._textureArrayPool=[],Yt.add(Ln);const fo=class extends Yn{constructor(n,t,e){super(In.from(n||fo.defaultVertexSrc,t||fo.defaultFragmentSrc),e),this.padding=0,this.resolution=fo.defaultResolution,this.multisample=fo.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new us}apply(n,t,e,i,s){n.applyFilter(this,t,e,i)}get blendMode(){return this.state.blendMode}set blendMode(n){this.state.blendMode=n}get resolution(){return this._resolution}set resolution(n){this._resolution=n}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let Ni=fo;Ni.defaultResolution=1,Ni.defaultMultisample=yi.NONE;class vg{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color="string"==typeof t.color?Pu(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=Km(t),ho(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}vg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"background"},Yt.add(vg);class bg{constructor(t){this.renderer=t,this.emptyRenderer=new ih(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){const{elements:r,ids:a,count:o}=t;let l=0;for(let h=0;h<o;h++){const c=r[h],u=c._batchLocation;if(u>=0&&u<s&&e[u]===c)a[h]=u;else for(;l<s;){const d=e[l];if(!d||d._batchEnabled!==i||d._batchLocation!==l){a[h]=l,c._batchLocation=l,e[l]=c;break}l++}}}destroy(){this.renderer=null}}bg.extension={type:Pt.RendererSystem,name:"batch"},Yt.add(bg);let wg=0;class Mg{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=wg++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=wg++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(Ft.PREFER_ENV>=ur.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Mg.extension={type:Pt.RendererSystem,name:"context"},Yt.add(Mg);class VA extends uo{upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===An.UNPACK);const r=e.realWidth,a=e.realHeight;return i.width===r&&i.height===a?s.texSubImage2D(e.target,0,0,0,r,a,e.format,i.type,this.data):(i.width=r,i.height=a,s.texImage2D(e.target,0,i.internalFormat,r,a,0,e.format,i.type,this.data)),!0}}class Ju{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Rn("disposeFramebuffer"),this.multisample=yi.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new fe(null,{scaleMode:ls.NEAREST,resolution:1,mipmap:Vn.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new fe(new VA(null,{width:this.width,height:this.height}),{scaleMode:ls.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Vn.OFF,format:Mt.DEPTH_COMPONENT,type:Kt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],r=s.resolution;s.setSize(t/r,e/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Sg extends fe{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=yi.NONE),super(null,t),this.mipmap=Vn.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Ju(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Is extends co{constructor(t){super(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=function fA(n,t=globalThis.location){if(n.startsWith("data:"))return"";t=t||globalThis.location,Zl||(Zl=document.createElement("a")),Zl.href=n;const e=fS.parse(Zl.href);return e.hostname!==t.hostname||(e.port||""!==t.port)&&e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}(e)}upload(t,e,i,s){const r=t.gl,a=e.realWidth,o=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||0===s.naturalWidth)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&0===s.buffered.length)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===An.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==a||i.height!==o?(i.width=a,i.height=o,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,s),!0}update(){if(this.destroyed)return;const t=this.source;this.resize(t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height),super.update()}dispose(){this.source=null}}class Tg extends Is{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;Is.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Ft.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const s=this.source;this.url=s.src;const r=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,e(this.createBitmap?this.process():this))};s.complete&&s.src?r():(s.onload=r,s.onerror=a=>{i(a),this.onError.emit(a)})})),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap;return this._process=fetch(t.src,{mode:t.crossOrigin&&"anonymous"!==t.crossOrigin?"no-cors":"cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===An.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0;const r=e._glTextures;for(const a in r){const o=r[a];if(o!==i&&o.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&("string"==typeof t||t instanceof HTMLImageElement)}}class Eg{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const s=e.width,r=e.height;if(i){const a=t.width/2/s,o=t.height/2/r,l=t.x/s+a,h=t.y/r+o;i=ri.add(i,ri.NW),this.x0=l+a*ri.uX(i),this.y0=h+o*ri.uY(i),i=ri.add(i,2),this.x1=l+a*ri.uX(i),this.y1=h+o*ri.uY(i),i=ri.add(i,2),this.x2=l+a*ri.uX(i),this.y2=h+o*ri.uY(i),i=ri.add(i,2),this.x3=l+a*ri.uX(i),this.y3=h+o*ri.uY(i)}else this.x0=t.x/s,this.y0=t.y/r,this.x1=(t.x+t.width)/s,this.y1=t.y/r,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/r,this.x3=t.x/s,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Ag=new Eg;function nh(n){n.destroy=function(){},n.on=function(){},n.once=function(){},n.emit=function(){}}class Wt extends oo{constructor(t,e,i,s,r,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Ae(0,0,1,1)),t instanceof Wt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this._uvs=Ag,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Le(a.x,a.y):new Le(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Qi[e.url]&&Wt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Wt.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Wt(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Ag&&(this._uvs=new Eg),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=Ft.STRICT_TEXTURE_CACHE){const s="string"==typeof t;let r=null;s?r=t:t instanceof fe?(t.cacheId||(t.cacheId=`${e?.pixiIdPrefix||"pixiid"}-${dr()}`,fe.addToCache(t,t.cacheId)),r=t.cacheId):(t._pixiId||(t._pixiId=`${e?.pixiIdPrefix||"pixiid"}_${dr()}`),r=t._pixiId);let a=Qi[r];if(s&&i&&!a)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return a||t instanceof fe?!a&&t instanceof fe&&(a=new Wt(t),Wt.addToCache(a,r)):(e.resolution||(e.resolution=As(t)),a=new Wt(new fe(t,e)),a.baseTexture.cacheId=r,fe.addToCache(a.baseTexture,r),Wt.addToCache(a,r)),a}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),s=Wt.from(t,Object.assign({resourceOptions:i},e),!1),r=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):r.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new Wt(fe.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){const r=new fe(t,Object.assign({scaleMode:fe.defaultOptions.scaleMode,resolution:As(e)},s)),{resource:a}=r;a instanceof Tg&&(a.url=e);const o=new Wt(r);return i||(i=e),fe.addToCache(o.baseTexture,i),Wt.addToCache(o,i),i!==e&&(fe.addToCache(o.baseTexture,e),Wt.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(l=>{o.baseTexture.once("loaded",()=>l(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Qi[e]&&Qi[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Qi[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Qi[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Qi[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Qi[t.textureCacheIds[e]]===t&&delete Qi[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:s,height:r}=t,a=e+s>this.baseTexture.width,o=i+r>this.baseTexture.height;if(a||o)throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width} ${a&&o?"and":"or"} Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`);this.valid=s&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Wt._EMPTY||(Wt._EMPTY=new Wt(new fe),nh(Wt._EMPTY),nh(Wt._EMPTY.baseTexture)),Wt._EMPTY}static get WHITE(){if(!Wt._WHITE){const t=Ft.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Wt._WHITE=new Wt(fe.from(t)),nh(Wt._WHITE),nh(Wt._WHITE.baseTexture)}return Wt._WHITE}}class Ps extends Wt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const s=this.baseTexture.resolution,r=Math.round(t*s)/s,a=Math.round(e*s)/s;this.valid=r>0&&a>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(r,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ps(new Sg(t))}}let WA=(()=>{class n{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,s=yi.NONE){const r=new Sg(Object.assign({width:e,height:i,resolution:1,multisample:s},this.textureOptions));return new Ps(r)}getOptimalTexture(e,i,s=1,r=yi.NONE){let a;e=Math.ceil(e*s-1e-6),i=Math.ceil(i*s-1e-6),this.enableFullScreen&&e===this._pixelsWidth&&i===this._pixelsHeight?a=r>1?-r:-1:(a=((65535&(e=Yl(e)))<<16|65535&(i=Yl(i)))>>>0,r>1&&(a+=4294967296*r)),this.texturePool[a]||(this.texturePool[a]=[]);let o=this.texturePool[a].pop();return o||(o=this.createTexture(e,i,r)),o.filterPoolKey=a,o.setResolution(s),o}getFilterTexture(e,i,s){const r=this.getOptimalTexture(e.width,e.height,i||e.resolution,s||yi.NONE);return r.filterFrame=e.filterFrame,r}returnTexture(e){const i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const i in this.texturePool){const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const i in this.texturePool){if(!(Number(i)<0))continue;const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}return n.SCREEN_KEY=-1,n})();class XA extends Cs{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Cg extends Cs{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new pi(this.vertices),this.uvBuffer=new pi(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class YA{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=yi.NONE,this.sourceFrame=new Ae,this.destinationFrame=new Ae,this.bindingSourceFrame=new Ae,this.bindingDestinationFrame=new Ae,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const sh=[new Le,new Le,new Le,new Le],Ku=new ei;class Rg{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new WA,this.statePool=[],this.quad=new XA,this.quadUv=new Cg,this.tempRect=new Ae,this.activeState={},this.globalUniforms=new Pn({outputFrame:new Ae,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,s=this.defaultFilterStack,r=this.statePool.pop()||new YA,a=this.renderer.renderTexture;let o=e[0].resolution,l=e[0].multisample,h=e[0].padding,c=e[0].autoFit,u=e[0].legacy??!0;for(let p=1;p<e.length;p++){const m=e[p];o=Math.min(o,m.resolution),l=Math.min(l,m.multisample),h=this.useMaxPadding?Math.max(h,m.padding):h+m.padding,c=c&&m.autoFit,u=u||(m.legacy??!0)}1===s.length&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(r),r.resolution=o,r.multisample=l,r.legacy=u,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(h);const d=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(Ku.copyFrom(i.projection.transform).invert(),d),c?(r.sourceFrame.fit(d),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(d)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,o,l),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=r.sourceFrame.width,f.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(a.sourceFrame),r.bindingDestinationFrame.copyFrom(a.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,a.bind(r.renderTexture,r.sourceFrame,f),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const r=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],a[0]=Math.round(r[0]*e.resolution),a[1]=Math.round(r[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*r[2]-.5*a[2],o[3]=e.sourceFrame.height*r[3]-.5*a[3],e.legacy){const h=s.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,l.renderTexture,Wn.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let h=e.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,e.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<i.length-1;++u){1===u&&e.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,e.resolution),c.filterFrame=h.filterFrame),i[u].apply(this,h,c,Wn.CLEAR,e);const d=h;h=c,c=d}i[u].apply(this,h,l.renderTexture,Wn.BLEND,e),u>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Wn.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(this.renderer.projection.transform=t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.activeState.transform:null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,i.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);(e===Wn.CLEAR||e===Wn.BLIT&&(1&s.stateId||this.forceClear))&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){const r=this.renderer;r.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(Hn.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(Hn.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:r}=e._texture,a=t.set(s.width,0,0,s.height,i.x,i.y),o=e.worldTransform.copyTo(ei.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/r.width,1/r.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=yi.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if("number"==typeof t){const r=t;t=e,e=r}const s=this.texturePool.getOptimalTexture((t=t||this.activeState.renderTexture).width,t.height,e||t.resolution,i||yi.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=sh[0],s=sh[1],r=sh[2],a=sh[3];i.set(e.left,e.top),s.set(e.left,e.bottom),r.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(r,r),t.apply(a,a);const o=Math.min(i.x,s.x,r.x,a.x),l=Math.min(i.y,s.y,r.y,a.y),h=Math.max(i.x,s.x,r.x,a.x),c=Math.max(i.y,s.y,r.y,a.y);e.x=o,e.y=l,e.width=h-o,e.height=c-l}roundFrame(t,e,i,s,r){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(r){const{a,b:o,c:l,d:h}=r;if((Math.abs(o)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(h)>1e-4))return}(r=r?Ku.copyFrom(r):Ku.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}Rg.extension={type:Pt.RendererSystem,name:"filter"},Yt.add(Rg);class ZA{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=yi.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const $A=new Ae;class Ig{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ju(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ae,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Ft.PREFER_ENV===ur.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:s}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>i,l=a/e.width;this.setViewport(e.x*l,e.y*l,a,e.height>>i)}else this.setViewport(0,0,t.width>>i,t.height>>i)}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){const r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(r.width!==i||r.height!==s||r.x!==t||r.y!==e)&&(r.x=t,r.y=e,r.width=i,r.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,r=Su.COLOR|Su.DEPTH){const{gl:a}=this;a.clearColor(t,e,i,s),a.clear(r)}initFramebuffer(t){const{gl:e}=this,i=new ZA(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const s=t.colorTextures;let r=s.length;e.drawBuffers||(r=Math.min(r,1));for(let a=0;a<r;a++){const o=s[a],l=o.parentTextureArray||o;this.renderer.texture.bind(l,0),0===a&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let a=r.length;i.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let l=0;l<a;l++){const h=r[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),0===l&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+l))}if(o.length>1&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null):(s.stencil=s.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=yi.NONE;if(t<=1||null===e)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return 1===i&&(i=yi.NONE),i}blit(t,e,i){const{current:s,renderer:r,gl:a,CONTEXT_UID:o}=this;if(2!==r.context.webGLVersion||!s)return;const l=s.glFramebuffers[o];if(!l)return;if(!t){if(!l.msaaBuffer)return;const c=s.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new Ju(s.width,s.height),l.blitFramebuffer.addColorTexture(0,c)),(t=l.blitFramebuffer).colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||((e=$A).width=s.width,e.height=s.height),i||(i=e);const h=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,h?a.NEAREST:a.LINEAR)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,s=t.height,r=this.gl,a=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,a),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,s):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,s),e.stencil=a,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ae}destroy(){this.renderer=null}}Ig.extension={type:Pt.RendererSystem,name:"framebuffer"},Yt.add(Ig);const Qu={5126:4,5123:2,5121:1};class Pg{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let i=this.renderer.context.extensions.vertexArrayObject;Ft.PREFER_ENV===ur.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(s,r)=>i.vertexAttribDivisorANGLE(s,r),t.drawElementsInstanced=(s,r,a,o,l)=>i.drawElementsInstancedANGLE(s,r,a,o,l),t.drawArraysInstanced=(s,r,a,o)=>i.drawArraysInstancedANGLE(s,r,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},r=!0);const a=s[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++)e.update(t.buffers[i])}checkCompatibility(t,e){const i=t.attributes,s=e.attributeData;for(const r in s)if(!i[r])throw new Error(`shader and geometry incompatible, geometry missing the "${r}" attribute`)}getSignature(t,e){const i=t.attributes,s=e.attributeData,r=["g",t.id];for(const a in i)s[a]&&r.push(a,s[a].location);return r.join("-")}initGeometryVao(t,e,i=!0){const s=this.gl,r=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const l=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let c=h[l];if(c)return h[o.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&o.attributeData[m]?d[m].size=o.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*Qu[d[m].type];for(const m in d){const g=d[m],x=g.size;void 0===g.stride&&(g.stride=f[g.buffer]===x*Qu[g.type]?0:f[g.buffer]),void 0===g.start&&(g.start=p[g.buffer],p[g.buffer]+=x*Qu[g.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let m=0;m<u.length;m++){const g=u[m];a.bind(g),i&&g._glBuffers[r].refCount++}return this.activateVao(t,o),h[o.id]=c,h[l]=c,s.bindVertexArray(null),a.unbind(Xn.ARRAY_BUFFER),c}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,r=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(a)for(let o=0;o<r.length;o++){const l=r[o]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!e&&a.dispose(r[o],e))}if(!e)for(const o in i)if("g"===o[0]){const l=i[o];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let l=null;for(const h in o){const c=o[h],u=a[c.buffer],d=u._glBuffers[s];if(e.attributeData[h]){l!==d&&(r.bind(u),l=d);const f=e.attributeData[h].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(f,c.divisor)}}}}draw(t,e,i,s){const{gl:r}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,l=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?a.instanced?r.drawElementsInstanced(t,e||a.indexBuffer.data.length,l,(i||0)*o,s||1):r.drawElements(t,e||a.indexBuffer.data.length,l,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?r.drawArraysInstanced(t,i,e||a.getSize(),s||1):r.drawArrays(t,i,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Pg.extension={type:Pt.RendererSystem,name:"geometry"},Yt.add(Pg);const Dg=new ei;class Lg{constructor(t,e){this._texture=t,this.mapCoord=new ei,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let s=0;s<t.length;s+=2){const r=t[s],a=t[s+1];e[s]=r*i.a+a*i.c+i.tx,e[s+1]=r*i.b+a*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=e.orig,r=e.trim;r&&(Dg.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Dg));const a=e.baseTexture,o=this.uClampFrame,l=this.clampMargin/a.resolution,h=this.clampOffset;return o[0]=(e._frame.x+l+h)/a.width,o[1]=(e._frame.y+l+h)/a.height,o[2]=(e._frame.x+e._frame.width-l+h)/a.width,o[3]=(e._frame.y+e._frame.height-l+h)/a.height,this.uClampOffset[0]=h/a.realWidth,this.uClampOffset[1]=h/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&0===e.rotate,!0}}class JA extends Ni{constructor(t,e,i){let s=null;"string"!=typeof t&&void 0===e&&void 0===i&&(s=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=s,this.maskMatrix=new ei}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){const r=this._maskSprite,a=r._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new Lg(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}}class KA{constructor(t=null){this.type=Ei.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ni.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ei.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Og{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const r=this.maskDataPool.pop()||new KA;r.pooled=!0,r.maskObject=e,i=r}const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Ei.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Ei.SCISSOR:this.renderer.scissor.push(i);break;case Ei.STENCIL:this.renderer.stencil.push(i);break;case Ei.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Ei.COLOR:this.pushColorMask(i)}i.type===Ei.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case Ei.SCISSOR:this.renderer.scissor.pop(e);break;case Ei.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Ei.SPRITE:this.popSpriteMask(e);break;case Ei.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const i=this.maskStack[this.maskStack.length-1];i.type===Ei.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;t.type=e?e.isSprite?Ei.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?Ei.SCISSOR:Ei.STENCIL:Ei.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new JA]));const r=this.renderer,a=r.renderTexture;let o,l;if(a.current){const c=a.current;o=t.resolution||c.resolution,l=t.multisample??c.multisample}else o=t.resolution||r.resolution,l=t.multisample??r.multisample;s[0].resolution=o,s[0].multisample=l,s[0].maskSprite=e;const h=i.filterArea;i.filterArea=e.getBounds(!0),r.filter.push(i,s),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t._colorMask&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}Og.extension={type:Pt.RendererSystem,name:"mask"},Yt.add(Og);class Bg{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==i&&(0===s?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Fg=new ei,Ng=[],rh=class extends Bg{constructor(n){super(n),this.glConst=Ft.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const n=this.maskStack[this.maskStack.length-1];return n?n._scissorCounter:0}calcScissorRect(n){if(n._scissorRectLocal)return;const t=n._scissorRect,{maskObject:e}=n,{renderer:i}=this,s=i.renderTexture,r=e.getBounds(!0,Ng.pop()??new Ae);this.roundFrameToPixels(r,s.current?s.current.resolution:i.resolution,s.sourceFrame,s.destinationFrame,i.projection.transform),t&&r.fit(t),n._scissorRectLocal=r}static isMatrixRotated(n){if(!n)return!1;const{a:t,b:e,c:i,d:s}=n;return(Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4)}testScissor(n){const{maskObject:t}=n;if(!t.isFastRect||!t.isFastRect()||rh.isMatrixRotated(t.worldTransform)||rh.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(n);const e=n._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(n,t,e,i,s){rh.isMatrixRotated(s)||((s=s?Fg.copyFrom(s):Fg.identity()).translate(-e.x,-e.y).scale(i.width/e.width,i.height/e.height).translate(i.x,i.y),this.renderer.filter.transformAABB(s,n),n.fit(i),n.x=Math.round(n.x*t),n.y=Math.round(n.y*t),n.width=Math.round(n.width*t),n.height=Math.round(n.height*t))}push(n){n._scissorRectLocal||this.calcScissorRect(n);const{gl:t}=this.renderer;n._scissorRect||t.enable(t.SCISSOR_TEST),n._scissorCounter++,n._scissorRect=n._scissorRectLocal,this._useCurrent()}pop(n){const{gl:t}=this.renderer;n&&Ng.push(n._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const n=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?n.y:this.renderer.height-n.height-n.y,this.renderer.gl.scissor(n.x,t,n.width,n.height)}};let Ug=rh;Ug.extension={type:Pt.RendererSystem,name:"scissor"},Yt.add(Ug);class kg extends Bg{constructor(t){super(t),this.glConst=Ft.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;0===s&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;0!==r&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(t._colorMask=r,i.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;0!==s&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==s&&(i._colorMask=s,e.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}kg.extension={type:Pt.RendererSystem,name:"stencil"},Yt.add(kg);class Gg{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(De("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(De("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(De("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Gg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"_plugin"},Yt.add(Gg);class zg{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ei,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){const r=this.projectionMatrix,a=s?-1:1;r.identity(),r.a=1/e.width*2,r.d=a*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-a-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}zg.extension={type:Pt.RendererSystem,name:"projection"},Yt.add(zg);const QA=new qu;class Hg{constructor(t){this.renderer=t,this._tempMatrix=new ei}generateTexture(t,e){const{region:i,...s}=e||{},r=i||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const a=Ps.create({width:r.width,height:r.height,...s});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const o=t.transform;return t.transform=QA,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}Hg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"textureGenerator"},Yt.add(Hg);const _r=new Ae,po=new Ae;class Vg{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ae,this.destinationFrame=new Ae,this.viewportFrame=new Ae}bind(t=null,e,i){const s=this.renderer;let r,a,o;this.current=t,t?(r=t.baseTexture,o=r.resolution,e||(_r.width=t.frame.width,_r.height=t.frame.height,e=_r),i||(po.x=t.frame.x,po.y=t.frame.y,po.width=e.width,po.height=e.height,i=po),a=r.framebuffer):(o=s.resolution,e||(_r.width=s._view.screen.width,_r.height=s._view.screen.height,e=_r),i||((i=_r).width=e.width,i.height=e.height));const l=this.viewportFrame;l.x=i.x*o,l.y=i.y*o,l.width=i.width*o,l.height=i.height*o,t||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(a,l),this.renderer.projection.update(i,e,o,!a),this.renderer.mask.setMaskStack(t?r.maskStack:this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.renderer.background.colorRgba;const i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,r=i.width!==s.width||i.height!==s.height;if(r){let{x:a,y:o,width:l,height:h}=this.viewportFrame;a=Math.round(a),o=Math.round(o),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Vg.extension={type:Pt.RendererSystem,name:"renderTexture"},Yt.add(Vg);class tC{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Wg(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}function td(n){const t=new Array(n);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Xg(n,t){switch(n){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return td(2*t);case"bvec3":return td(3*t);case"bvec4":return td(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Yg(n,t){const e=n.getShaderSource(t).split("\n").map((h,c)=>`${c}: ${h}`),i=n.getShaderInfoLog(t),s=i.split("\n"),r={},a=s.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>!(!h||r[h]||(r[h]=!0,0))),o=[""];a.forEach(h=>{e[h-1]=`%c${e[h-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=e.join("\n");o[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function rC(n,t,e,i,s){e.buffer.update(s)}const aC={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},Zg={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let mo,uC=0;const ah={textureCount:0,uboCount:0};class $g{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=uC++}systemCheck(){if(!function cC(){if("boolean"==typeof mo)return mo;try{mo=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{mo=!1}return mo}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(ah.textureCount=0,ah.uboCount=0,this.syncUniformGroup(t.uniformGroup,ah)),s}setUniforms(t){const e=this.shader.program;e.syncUniforms(e.glPrograms[this.renderer.CONTEXT_UID].uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function IA(n,t){const e=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const i in n.uniforms){const s=t[i];if(!s){n.uniforms[i]?.group&&e.push(n.uniforms[i].ubo?`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `:`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `);continue}const r=n.uniforms[i];let a=!1;for(let o=0;o<ma.length;o++)if(ma[o].test(s,r)){e.push(ma[o].code(i,r)),a=!0;break}if(!a){const l=(1!==s.size||s.isArray?RA:CA)[s.type].replace("location",`ud["${i}"].location`);e.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${l};`)}}return new Function("ud","uv","renderer","syncData",e.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,ah,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=function hC(n,t){if(!n.autoManage)return{size:0,syncFunc:rC};const e=function lC(n,t){const e=[];for(const i in n)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}(n.uniforms,t),{uboElements:i,size:s}=function oC(n){const t=n.map(r=>({data:r,offset:0,dataLen:0,dirty:0}));let e=0,i=0,s=0;for(let r=0;r<t.length;r++){const a=t[r];if(e=Zg[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,i%e!=0&&i<16){const o=i%e%16;i+=o,s+=o}i+e>16?(s=16*Math.ceil(s/16),a.offset=s,s+=e,i=e):(a.offset=s,i+=e,s+=e)}return s=16*Math.ceil(s/16),{uboElements:t,size:s}}(e),r=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let a=0;a<i.length;a++){const o=i[a],l=n.uniforms[o.data.name],h=o.data.name;let c=!1;for(let u=0;u<ma.length;u++){const d=ma[u];if(d.codeUbo&&d.test(o.data,l)){r.push(`offset = ${o.offset/4};`,ma[u].codeUbo(o.data.name,l)),c=!0;break}}if(!c)if(o.data.size>1){const u=gg(o.data.type),d=Math.max(Zg[o.data.type]/16,1),f=u/d;r.push(`\n                cv = ud.${h}.value;\n                v = uv.${h};\n                offset = ${o.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${o.data.size*d}; i++)\n                {\n                    for(var j = 0; j < ${f}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${(4-f%4)%4};\n                }\n\n                `)}else r.push(`\n                cv = ud.${h}.value;\n                v = uv.${h};\n                offset = ${o.offset/4};\n                ${aC[o.data.type]};\n                `)}return r.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(o.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const s=t.uniforms,r=[`${i}-`];for(const a in s)r.push(a),e[a]&&r.push(e[a].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const i=t.program,s=function sC(n,t){const e=Wg(n,n.VERTEX_SHADER,t.vertexSrc),i=Wg(n,n.FRAGMENT_SHADER,t.fragmentSrc),s=n.createProgram();n.attachShader(s,e),n.attachShader(s,i);const r=t.extra?.transformFeedbackVaryings;if(r&&("function"!=typeof n.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):n.transformFeedbackVaryings(s,r.names,"separate"===r.bufferMode?n.SEPARATE_ATTRIBS:n.INTERLEAVED_ATTRIBS)),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS)||function nC(n,t,e,i){n.getProgramParameter(t,n.LINK_STATUS)||(n.getShaderParameter(e,n.COMPILE_STATUS)||Yg(n,e),n.getShaderParameter(i,n.COMPILE_STATUS)||Yg(n,i),console.error("PixiJS Error: Could not initialize shader."),""!==n.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",n.getProgramInfoLog(t)))}(n,s,e,i),t.attributeData=function eC(n,t){const e={},i=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=t.getActiveAttrib(n,s);if(r.name.startsWith("gl_"))continue;const a=yg(t,r.type),o={type:a,name:r.name,size:gg(a),location:t.getAttribLocation(n,r.name)};e[r.name]=o}return e}(s,n),t.uniformData=function iC(n,t){const e={},i=t.getProgramParameter(n,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const r=t.getActiveUniform(n,s),a=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),l=yg(t,r.type);e[a]={name:a,index:s,type:l,size:r.size,isArray:o,value:Xg(l,r.size)}}return e}(s,n),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((h,c)=>h>c?1:-1);for(let h=0;h<l.length;h++)t.attributeData[l[h]].location=h,n.bindAttribLocation(s,h,l[h]);n.linkProgram(s)}n.deleteShader(e),n.deleteShader(i);const a={};for(const l in t.uniformData){const h=t.uniformData[l];a[l]={location:n.getUniformLocation(s,l),value:Xg(h.type,h.size)}}return new tC(s,a)}(this.gl,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}$g.extension={type:Pt.RendererSystem,name:"shader"},Yt.add($g);class qg{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.1.1 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}qg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"startup"},Yt.add(qg);const ed=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=re.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new us,this.defaultState.blend=!0}contextChange(n){this.gl=n,this.blendModes=function dC(n,t=[]){return t[re.NORMAL]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.ADD]=[n.ONE,n.ONE],t[re.MULTIPLY]=[n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.SCREEN]=[n.ONE,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.OVERLAY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.DARKEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.LIGHTEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.COLOR_DODGE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.COLOR_BURN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.HARD_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.SOFT_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.DIFFERENCE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.EXCLUSION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.HUE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.SATURATION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.COLOR]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.LUMINOSITY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.NONE]=[0,0],t[re.NORMAL_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.ADD_NPM]=[n.SRC_ALPHA,n.ONE,n.ONE,n.ONE],t[re.SCREEN_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],t[re.SRC_IN]=[n.DST_ALPHA,n.ZERO],t[re.SRC_OUT]=[n.ONE_MINUS_DST_ALPHA,n.ZERO],t[re.SRC_ATOP]=[n.DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],t[re.DST_OVER]=[n.ONE_MINUS_DST_ALPHA,n.ONE],t[re.DST_IN]=[n.ZERO,n.SRC_ALPHA],t[re.DST_OUT]=[n.ZERO,n.ONE_MINUS_SRC_ALPHA],t[re.DST_ATOP]=[n.ONE_MINUS_DST_ALPHA,n.SRC_ALPHA],t[re.XOR]=[n.ONE_MINUS_DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],t[re.SUBTRACT]=[n.ONE,n.ONE,n.ONE,n.ONE,n.FUNC_REVERSE_SUBTRACT,n.FUNC_ADD],t}(n),this.set(this.defaultState),this.reset()}set(n){if(this.stateId!==(n=n||this.defaultState).data){let t=this.stateId^n.data,e=0;for(;t;)1&t&&this.map[e].call(this,!!(n.data&1<<e)),t>>=1,e++;this.stateId=n.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,n)}forceState(n){n=n||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(n.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,n);this.stateId=n.data}setBlend(n){this.updateCheck(ed.checkBlendMode,n),this.gl[n?"enable":"disable"](this.gl.BLEND)}setOffset(n){this.updateCheck(ed.checkPolygonOffset,n),this.gl[n?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(n){this.gl[n?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(n){this.gl.depthMask(n)}setCullFace(n){this.gl[n?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(n){this.gl.frontFace(this.gl[n?"CW":"CCW"])}setBlendMode(n){if(n===this.blendMode)return;this.blendMode=n;const t=this.blendModes[n],e=this.gl;2===t.length?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(n,t){this.gl.polygonOffset(n,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(n,t){const e=this.checks.indexOf(n);t&&-1===e?this.checks.push(n):!t&&-1!==e&&this.checks.splice(e,1)}static checkBlendMode(n,t){n.setBlendMode(t.blendMode)}static checkPolygonOffset(n,t){n.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let jg=ed;jg.extension={type:Pt.RendererSystem,name:"state"},Yt.add(jg);class xC extends oo{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Rn(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(s=>{const r=i.find(a=>this._systemsHash[a]===s);s[t.name](e[r])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const oh=class{constructor(n){this.renderer=n,this.count=0,this.checkCount=0,this.maxIdle=oh.defaultMaxIdle,this.checkCountMax=oh.defaultCheckCountMax,this.mode=oh.defaultMode}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==Eu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const n=this.renderer.texture,t=n.managedTextures;let e=!1;for(let i=0;i<t.length;i++){const s=t[i];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(n.destroyTexture(s,!0),t[i]=null,e=!0)}if(e){let i=0;for(let s=0;s<t.length;s++)null!==t[s]&&(t[i++]=t[s]);t.length=i}}unload(n){const e=n._texture;e&&!e.framebuffer&&this.renderer.texture.destroyTexture(e);for(let i=n.children.length-1;i>=0;i--)this.unload(n.children[i])}destroy(){this.renderer=null}};let On=oh;On.defaultMode=Eu.AUTO,On.defaultMaxIdle=3600,On.defaultCheckCountMax=600,On.extension={type:Pt.RendererSystem,name:"textureGC"},Yt.add(On);class id{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Kt.UNSIGNED_BYTE,this.internalFormat=Mt.RGBA,this.samplerType=0}}class Jg{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new fe,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function vC(n){let t;return t="WebGL2RenderingContext"in globalThis&&n instanceof globalThis.WebGL2RenderingContext?{[Kt.UNSIGNED_BYTE]:{[Mt.RGBA]:n.RGBA8,[Mt.RGB]:n.RGB8,[Mt.RG]:n.RG8,[Mt.RED]:n.R8,[Mt.RGBA_INTEGER]:n.RGBA8UI,[Mt.RGB_INTEGER]:n.RGB8UI,[Mt.RG_INTEGER]:n.RG8UI,[Mt.RED_INTEGER]:n.R8UI,[Mt.ALPHA]:n.ALPHA,[Mt.LUMINANCE]:n.LUMINANCE,[Mt.LUMINANCE_ALPHA]:n.LUMINANCE_ALPHA},[Kt.BYTE]:{[Mt.RGBA]:n.RGBA8_SNORM,[Mt.RGB]:n.RGB8_SNORM,[Mt.RG]:n.RG8_SNORM,[Mt.RED]:n.R8_SNORM,[Mt.RGBA_INTEGER]:n.RGBA8I,[Mt.RGB_INTEGER]:n.RGB8I,[Mt.RG_INTEGER]:n.RG8I,[Mt.RED_INTEGER]:n.R8I},[Kt.UNSIGNED_SHORT]:{[Mt.RGBA_INTEGER]:n.RGBA16UI,[Mt.RGB_INTEGER]:n.RGB16UI,[Mt.RG_INTEGER]:n.RG16UI,[Mt.RED_INTEGER]:n.R16UI,[Mt.DEPTH_COMPONENT]:n.DEPTH_COMPONENT16},[Kt.SHORT]:{[Mt.RGBA_INTEGER]:n.RGBA16I,[Mt.RGB_INTEGER]:n.RGB16I,[Mt.RG_INTEGER]:n.RG16I,[Mt.RED_INTEGER]:n.R16I},[Kt.UNSIGNED_INT]:{[Mt.RGBA_INTEGER]:n.RGBA32UI,[Mt.RGB_INTEGER]:n.RGB32UI,[Mt.RG_INTEGER]:n.RG32UI,[Mt.RED_INTEGER]:n.R32UI,[Mt.DEPTH_COMPONENT]:n.DEPTH_COMPONENT24},[Kt.INT]:{[Mt.RGBA_INTEGER]:n.RGBA32I,[Mt.RGB_INTEGER]:n.RGB32I,[Mt.RG_INTEGER]:n.RG32I,[Mt.RED_INTEGER]:n.R32I},[Kt.FLOAT]:{[Mt.RGBA]:n.RGBA32F,[Mt.RGB]:n.RGB32F,[Mt.RG]:n.RG32F,[Mt.RED]:n.R32F,[Mt.DEPTH_COMPONENT]:n.DEPTH_COMPONENT32F},[Kt.HALF_FLOAT]:{[Mt.RGBA]:n.RGBA16F,[Mt.RGB]:n.RGB16F,[Mt.RG]:n.RG16F,[Mt.RED]:n.R16F},[Kt.UNSIGNED_SHORT_5_6_5]:{[Mt.RGB]:n.RGB565},[Kt.UNSIGNED_SHORT_4_4_4_4]:{[Mt.RGBA]:n.RGBA4},[Kt.UNSIGNED_SHORT_5_5_5_1]:{[Mt.RGBA]:n.RGB5_A1},[Kt.UNSIGNED_INT_2_10_10_10_REV]:{[Mt.RGBA]:n.RGB10_A2,[Mt.RGBA_INTEGER]:n.RGB10_A2UI},[Kt.UNSIGNED_INT_10F_11F_11F_REV]:{[Mt.RGB]:n.R11F_G11F_B10F},[Kt.UNSIGNED_INT_5_9_9_9_REV]:{[Mt.RGB]:n.RGB9_E5},[Kt.UNSIGNED_INT_24_8]:{[Mt.DEPTH_STENCIL]:n.DEPTH24_STENCIL8},[Kt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Mt.DEPTH_STENCIL]:n.DEPTH32F_STENCIL8}}:{[Kt.UNSIGNED_BYTE]:{[Mt.RGBA]:n.RGBA,[Mt.RGB]:n.RGB,[Mt.ALPHA]:n.ALPHA,[Mt.LUMINANCE]:n.LUMINANCE,[Mt.LUMINANCE_ALPHA]:n.LUMINANCE_ALPHA},[Kt.UNSIGNED_SHORT_5_6_5]:{[Mt.RGB]:n.RGB},[Kt.UNSIGNED_SHORT_4_4_4_4]:{[Mt.RGBA]:n.RGBA},[Kt.UNSIGNED_SHORT_5_5_5_1]:{[Mt.RGBA]:n.RGBA}},t}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const i=new id(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new id(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let r=t-1;r>=0;--r){const a=e[r];a&&a._glTextures[s].samplerType!==Tu.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new id(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.type=2===this.webGLVersion&&t.type===Kt.HALF_FLOAT?this.gl.HALF_FLOAT:t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==Tu.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,r=t.realHeight,a=i.gl;(e.width!==s||e.height!==r||e.dirtyId<0)&&(e.width=s,e.height=r,a.texImage2D(t.target,0,e.internalFormat,s,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);-1!==s&&ua(this.managedTextures,s,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];!e||(e.mipmap=!!(t.mipmap!==Vn.POW2&&2===this.webGLVersion||t.isPowerOfTwo)&&t.mipmap>=1,e.wrapMode=2===this.webGLVersion||t.isPowerOfTwo?t.wrapMode:Es.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==Vn.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ls.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===ls.LINEAR){const r=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===ls.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===ls.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Jg.extension={type:Pt.RendererSystem,name:"texture"},Yt.add(Jg);class Kg{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:s}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[s]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];!o||(i.buffer.update(o),o._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const l=o._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0===l.refCount&&!e&&r.dispose(o,e))}!i||(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Kg.extension={type:Pt.RendererSystem,name:"transformFeedback"},Yt.add(Kg);class Qg{constructor(t){this.renderer=t}init(t){this.screen=new Ae(0,0,t.width,t.height),this.element=t.view||Ft.ADAPTER.createCanvas(),this.resolution=t.resolution||Ft.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Qg.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"_view"},Yt.add(Qg),Ft.PREFER_ENV=ur.WEBGL2,Ft.STRICT_TEXTURE_CACHE=!1,Object.defineProperties(Ft,{WRAP_MODE:{get:()=>fe.defaultOptions.wrapMode,set(n){De("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),fe.defaultOptions.wrapMode=n}},SCALE_MODE:{get:()=>fe.defaultOptions.scaleMode,set(n){De("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),fe.defaultOptions.scaleMode=n}},MIPMAP_TEXTURES:{get:()=>fe.defaultOptions.mipmap,set(n){De("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),fe.defaultOptions.mipmap=n}},ANISOTROPIC_LEVEL:{get:()=>fe.defaultOptions.anisotropicLevel,set(n){De("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),fe.defaultOptions.anisotropicLevel=n}},FILTER_RESOLUTION:{get:()=>(De("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ni.defaultResolution),set(n){Ni.defaultResolution=n}},FILTER_MULTISAMPLE:{get:()=>(De("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ni.defaultMultisample),set(n){Ni.defaultMultisample=n}},SPRITE_MAX_TEXTURES:{get:()=>Ln.defaultMaxTextures,set(n){De("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ln.defaultMaxTextures=n}},SPRITE_BATCH_SIZE:{get:()=>Ln.defaultBatchSize,set(n){De("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ln.defaultBatchSize=n}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Ln.canUploadSameBuffer,set(n){De("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ln.canUploadSameBuffer=n}},GC_MODE:{get:()=>On.defaultMode,set(n){De("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),On.defaultMode=n}},GC_MAX_IDLE:{get:()=>On.defaultMaxIdle,set(n){De("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),On.defaultMaxIdle=n}},GC_MAX_CHECK_COUNT:{get:()=>On.defaultCheckCountMax,set(n){De("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),On.defaultCheckCountMax=n}},PRECISION_VERTEX:{get:()=>In.defaultVertexPrecision,set(n){De("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),In.defaultVertexPrecision=n}},PRECISION_FRAGMENT:{get:()=>In.defaultFragmentPrecision,set(n){De("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),In.defaultFragmentPrecision=n}}});var _a=(n=>(n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY",n))(_a||{});class nd{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const ln=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new nd(null,null,1/0),this.deltaMS=1/ln.targetFPMS,this.elapsedMS=1/ln.targetFPMS,this._tick=n=>{this._requestId=null,this.started&&(this.update(n),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(n,t,e=_a.NORMAL){return this._addListener(new nd(n,t,e))}addOnce(n,t,e=_a.NORMAL){return this._addListener(new nd(n,t,e,!0))}_addListener(n){let t=this._head.next,e=this._head;if(t){for(;t;){if(n.priority>t.priority){n.connect(e);break}e=t,t=t.next}n.previous||n.connect(e)}else n.connect(e);return this._startIfPossible(),this}remove(n,t){let e=this._head.next;for(;e;)e=e.match(n,t)?e.destroy():e.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let n=0,t=this._head;for(;t=t.next;)n++;return n}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let n=this._head.next;for(;n;)n=n.destroy(!0);this._head.destroy(),this._head=null}}update(n=performance.now()){let t;if(n>this.lastTime){if(t=this.elapsedMS=n-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const s=n-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=n-s%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ln.targetFPMS;const e=this._head;let i=e.next;for(;i;)i=i.emit(this.deltaTime);e.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=n}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(n){const t=Math.min(this.maxFPS,n),e=Math.min(Math.max(0,t)/1e3,ln.targetFPMS);this._maxElapsedMS=1/e}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(n){if(0===n)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,n);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ln._shared){const n=ln._shared=new ln;n.autoStart=!0,n._protected=!0}return ln._shared}static get system(){if(!ln._system){const n=ln._system=new ln;n.autoStart=!0,n._protected=!0}return ln._system}};let tn=ln;tn.targetFPMS=.06,Object.defineProperties(Ft,{TARGET_FPMS:{get:()=>tn.targetFPMS,set(n){De("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),tn.targetFPMS=n}}});class t_{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,_a.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?tn.shared:new tn,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}t_.extension=Pt.Application,Yt.add(t_);const e_=[];Yt.handleByList(Pt.Renderer,e_);const i_="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class n_{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}this.multisample=e>=yi.HIGH?yi.HIGH:e>=yi.MEDIUM?yi.MEDIUM:e>=yi.LOW?yi.LOW:yi.NONE}destroy(){}}n_.extension={type:Pt.RendererSystem,name:"_multisample"},Yt.add(n_);class TC{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class s_{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,i){const{gl:s,CONTEXT_UID:r}=this;i=i||0;const a=t._glBuffers[r]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,a.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new TC(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}s_.extension={type:Pt.RendererSystem,name:"buffer"},Yt.add(s_);class r_{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let s,r,a,o;if(e&&(s=e.renderTexture,r=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(s||(this.lastObjectRendered=t),!o){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}r_.extension={type:Pt.RendererSystem,name:"objectRenderer"},Yt.add(r_);const sd=class extends xC{constructor(n){super(),n=Object.assign({},Ft.RENDER_OPTIONS,n),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Pn({projectionMatrix:new ei},!0),this.setup({runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:sd.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]}),"useContextAlpha"in n&&(De("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),n.premultipliedAlpha=n.useContextAlpha&&"notMultiplied"!==n.useContextAlpha,n.backgroundAlpha=!1===n.useContextAlpha?1:n.backgroundAlpha),this.startup.run({hello:n.hello,_plugin:sd.__plugins,background:{alpha:n.backgroundAlpha,color:n.background??n.backgroundColor,clearBeforeRender:n.clearBeforeRender},_view:{height:n.height,width:n.width,autoDensity:n.autoDensity,resolution:n.resolution,view:n.view},context:{antialias:n.antialias,context:n.context,powerPreference:n.powerPreference,premultipliedAlpha:n.premultipliedAlpha,preserveDrawingBuffer:n.preserveDrawingBuffer}}),this.options=n}static test(n){return!n?.forceCanvas&&function _S(){return typeof Iu>"u"&&(Iu=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:Ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Ft.ADAPTER.getWebGLRenderingContext())return!1;const e=Ft.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const s=!!i?.getContextAttributes()?.stencil;if(i){const r=i.getExtension("WEBGL_lose_context");r&&r.loseContext()}return i=null,s}catch{return!1}}()),Iu}()}render(n,t){this.objectRenderer.render(n,t)}resize(n,t){this._view.resizeView(n,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(n=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:n}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(n){this._view.resolution=n,this.runners.resolutionChange.emit(n)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return De("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return De("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return De("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return De("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(n){De("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=n}get backgroundAlpha(){return De("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(n){De("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=n}get powerPreference(){return De("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(n,t){return this.textureGenerator.generateTexture(n,t)}};let ya=sd;ya.extension={type:Pt.Renderer,priority:1},ya.__plugins={},ya.__systems={},Yt.handleByMap(Pt.RendererPlugin,ya.__plugins),Yt.handleByMap(Pt.RendererSystem,ya.__systems),Yt.add(ya);class a_ extends co{constructor(t,e){const{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let r=0;r<t;r++){const a=new fe;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)!t[i]||(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):this.addResourceAt(t[i]instanceof co?t[i]:cg(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(e).then(()=>{const{realWidth:i,realHeight:s}=this.items[0];return this.resize(i,s),Promise.resolve(this)}),this._load}}const go=class extends a_{constructor(n,t){const{width:e,height:i,autoLoad:s,linkBaseTexture:r}=t||{};if(n&&n.length!==go.SIDES)throw new Error(`Invalid length. Got ${n.length}, expected 6`);super(6,{width:e,height:i});for(let a=0;a<go.SIDES;a++)this.items[a].target=ha.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=!1!==r,n&&this.initFromArray(n,t),!1!==s&&this.load()}bind(n){super.bind(n),n.target=ha.TEXTURE_CUBE_MAP}addBaseTextureAt(n,t,e){if(void 0===e&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||n.parentTextureArray||Object.keys(n._glTextures).length>0){if(!n.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(n.resource,t)}else n.target=ha.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.parentTextureArray=this.baseTexture,this.items[t]=n;return n.valid&&!this.valid&&this.resize(n.realWidth,n.realHeight),this.items[t]=n,this}upload(n,t,e){const i=this.itemDirtyIds;for(let s=0;s<go.SIDES;s++){const r=this.items[s];(i[s]<r.dirtyId||e.dirtyId<t.dirtyId)&&(r.valid&&r.resource?(r.resource.upload(n,r,e),i[s]=r.dirtyId):i[s]<-1&&(n.gl.texImage2D(r.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),i[s]=-1))}return!0}static test(n){return Array.isArray(n)&&n.length===go.SIDES}};let o_=go;o_.SIDES=6;class xa extends Is{constructor(t,e){let i,s;e=e||{},"string"==typeof t?(i=xa.EMPTY,s=t):(i=t,s=null),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){var t=this;return this._load||(this._load=new Promise(function(){var e=(0,Et.Z)(function*(i,s){if(null!==t.url)try{const r=yield Ft.ADAPTER.fetch(t.url,{mode:t.crossOrigin?"cors":"no-cors"});if(t.destroyed)return;const a=yield r.blob();if(t.destroyed)return;const o=yield createImageBitmap(a,{premultiplyAlpha:null===t.alphaMode||t.alphaMode===An.UNPACK?"premultiply":"none"});if(t.destroyed)return;t.source=o,t.update(),i(t)}catch(r){if(t.destroyed)return;s(r),t.onError.emit(r)}else i(t)});return function(i,s){return e.apply(this,arguments)}}())),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return xa._EMPTY=xa._EMPTY??Ft.ADAPTER.createCanvas(0,0),xa._EMPTY}}const lh=class extends Is{constructor(n,t){t=t||{},super(Ft.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=n,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(n=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),n(this)},lh.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const n=new Image;Is.crossOrigin(n,this.svg,this._crossorigin),n.src=this.svg,n.onerror=t=>{!this._resolve||(n.onerror=null,this.onError.emit(t))},n.onload=()=>{if(!this._resolve)return;const t=n.width,e=n.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,s=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/e*t,s=this._overrideHeight||this._overrideWidth/t*e),i=Math.round(i),s=Math.round(s);const r=this.source;r.width=i,r.height=s,r._pixiId=`canvas_${dr()}`,r.getContext("2d").drawImage(n,0,0,t,e,0,0,i,s),this._resolve(),this._resolve=null}}static getSize(n){const t=lh.SVG_SIZE.exec(n),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(n,t){return"svg"===t||"string"==typeof n&&n.startsWith("data:image/svg+xml")||"string"==typeof n&&lh.SVG_XML.test(n)}};let _o=lh;_o.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,_o.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const rd=class extends Is{constructor(n,t){if(t=t||{},!(n instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),"string"==typeof n&&(n=[n]),Is.crossOrigin(e,n[0].src||n[0],t.crossorigin);for(let s=0;s<n.length;++s){const r=document.createElement("source");let{src:a,mime:o}=n[s];a=a||n[s];const l=a.split("?").shift().toLowerCase(),h=l.slice(l.lastIndexOf(".")+1);o=o||rd.MIME_TYPES[h]||`video/${h}`,r.src=a,r.type=o,e.appendChild(r)}n=e}super(n),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==t.autoLoad&&this.load()}update(n=0){this.destroyed||(this._msToNextUpdate=Math.floor(this._msToNextUpdate-tn.shared.elapsedMS*this.source.playbackRate),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))}load(){if(this._load)return this._load;const n=this.source;return(n.readyState===n.HAVE_ENOUGH_DATA||n.readyState===n.HAVE_FUTURE_DATA)&&n.width&&n.height&&(n.complete=!0),n.addEventListener("play",this._onPlayStart.bind(this)),n.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(n.addEventListener("canplay",this._onCanPlay),n.addEventListener("canplaythrough",this._onCanPlay),n.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,n.load())}),this._load}_onError(n){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(n)}_isSourcePlaying(){const n=this.source;return!n.paused&&!n.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(tn.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(tn.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const n=this.source;n.removeEventListener("canplay",this._onCanPlay),n.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(n.videoWidth,n.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&n.play()}dispose(){this._isConnectedToTicker&&(tn.shared.remove(this.update,this),this._isConnectedToTicker=!1);const n=this.source;n&&(n.removeEventListener("error",this._onError,!0),n.pause(),n.src="",n.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(n){n!==this._autoUpdate&&(this._autoUpdate=n,!this._autoUpdate&&this._isConnectedToTicker?(tn.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(tn.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(n){n!==this._updateFPS&&(this._updateFPS=n)}static test(n,t){return globalThis.HTMLVideoElement&&n instanceof HTMLVideoElement||rd.TYPES.includes(t)}};let ad=rd;ad.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],ad.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},Vu.push(xa,Tg,class AC extends Is{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},ad,_o,uo,o_,class EC extends a_{constructor(t,e){const{width:i,height:s}=e||{};let r,a;Array.isArray(t)?(r=t,a=t.length):a=t,super(a,{width:i,height:s}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=ha.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:s,itemDirtyIds:r,items:a}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let l=0;l<s;l++){const h=a[l];r[l]<h.dirtyId&&(r[l]=h.dirtyId,h.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,i.type,h.resource.source))}return!0}});class hh{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Ae.EMPTY:((t=t||new Ae(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:s,c:r,d:a,tx:o,ty:l}=t,h=i*e.x+r*e.y+o,c=s*e.x+a*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,r=this.maxY,a=t[0],o=t[1];e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,a=t[2],o=t[3],e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,a=t[4],o=t[5],e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,a=t[6],o=t[7],e=a<e?a:e,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,this.minX=e,this.minY=i,this.maxX=s,this.maxY=r}addFrame(t,e,i,s,r){this.addFrameMatrix(t.worldTransform,e,i,s,r)}addFrameMatrix(t,e,i,s,r){const a=t.a,o=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=a*e+l*i+c,x=o*e+h*i+u;d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=a*s+l*i+c,x=o*s+h*i+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=a*e+l*r+c,x=o*e+h*r+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,g=a*s+l*r+c,x=o*s+h*r+u,d=g<d?g:d,f=x<f?x:f,p=g>p?g:p,m=x>m?x:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,e,i){let s=this.minX,r=this.minY,a=this.maxX,o=this.maxY;for(let l=e;l<i;l+=2){const h=t[l],c=t[l+1];s=h<s?h:s,r=c<r?c:r,a=h>a?h:a,o=c>o?c:o}this.minX=s,this.minY=r,this.maxX=a,this.maxY=o}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,r=0,a=r){const o=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let x=i;x<s;x+=2){const v=e[x],y=e[x+1],b=o*v+h*y+u,M=c*y+l*v+d;f=Math.min(f,b-r),m=Math.max(m,b+r),p=Math.min(p,M-a),g=Math.max(g,M+a)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,s=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=r&&s<=a){const o=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<o?i:o,this.minY=s<l?s:l,this.maxX=r>h?r:h,this.maxY=a>c?a:c}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=r&&s<=a){const o=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<o?i:o,this.minY=s<l?s:l,this.maxX=r>h?r:h,this.maxY=a>c?a:c}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,r,a){e-=a,i+=r,s+=a,this.minX=this.minX<(t-=r)?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class ai extends oo{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new qu,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new hh,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const s=e[i];Object.defineProperty(ai.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ae),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ae),t=this._localBoundsRect),this._localBounds||(this._localBounds=new hh);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-r,a}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,r=0,a=0,o=0,l=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=r,this.skew.x=a,this.skew.y=o,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new CC),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*MA}set angle(t){this.transform.rotation=t*SA}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class CC extends ai{constructor(){super(...arguments),this.sortDirty=null}}ai.prototype.displayObjectUpdateTransform=ai.prototype.updateTransform;const RC=new ei;function IC(n,t){return n.zIndex===t.zIndex?n._lastSortedIndex-t._lastSortedIndex:n.zIndex-t.zIndex}const od=class extends ai{constructor(){super(),this.children=[],this.sortableChildren=od.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(n){}addChild(...n){if(n.length>1)for(let t=0;t<n.length;t++)this.addChild(n[t]);else{const t=n[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return n[0]}addChildAt(n,t){if(t<0||t>this.children.length)throw new Error(`${n}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.splice(t,0,n),this._boundsID++,this.onChildrenChange(t),n.emit("added",this),this.emit("childAdded",n,this,t),n}swapChildren(n,t){if(n===t)return;const e=this.getChildIndex(n),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=n,this.onChildrenChange(e<i?e:i)}getChildIndex(n){const t=this.children.indexOf(n);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(n,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const e=this.getChildIndex(n);ua(this.children,e,1),this.children.splice(t,0,n),this.onChildrenChange(t)}getChildAt(n){if(n<0||n>=this.children.length)throw new Error(`getChildAt: Index (${n}) does not exist.`);return this.children[n]}removeChild(...n){if(n.length>1)for(let t=0;t<n.length;t++)this.removeChild(n[t]);else{const t=n[0],e=this.children.indexOf(t);if(-1===e)return null;t.parent=null,t.transform._parentID=-1,ua(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e)}return n[0]}removeChildAt(n){const t=this.getChildAt(n);return t.parent=null,t.transform._parentID=-1,ua(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this),this.emit("childRemoved",t,this,n),t}removeChildren(n=0,t=this.children.length){const s=t-n;let r;if(s>0&&s<=t){r=this.children.splice(n,s);for(let a=0;a<r.length;++a)r[a].parent=null,r[a].transform&&(r[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(n);for(let a=0;a<r.length;++a)r[a].emit("removed",this),this.emit("childRemoved",r[a],this,a);return r}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let n=!1;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i._lastSortedIndex=t,!n&&0!==i.zIndex&&(n=!0)}n&&this.children.length>1&&this.children.sort(IC),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let n=0,t=this.children.length;n<t;++n){const e=this.children[n];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let n=0;n<this.children.length;n++){const t=this.children[n];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(n,t=!1){const e=super.getLocalBounds(n);if(!t)for(let i=0,s=this.children.length;i<s;++i){const r=this.children[i];r.visible&&r.updateTransform()}return e}_calculateBounds(){}_renderWithCulling(n){const t=n.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let e,i;this.cullArea?(e=this.cullArea,i=this.worldTransform):this._render!==od.prototype._render&&(e=this.getBounds(!0));const s=n.projection.transform;if(s&&(i?(i=RC.copyFrom(i),i.prepend(s)):i=s),e&&t.intersects(e,i))this._render(n);else if(this.cullArea)return;for(let r=0,a=this.children.length;r<a;++r){const o=this.children[r],l=o.cullable;o.cullable=l||!this.cullArea,o.render(n),o.cullable=l}}render(n){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(n);else if(this.cullable)this._renderWithCulling(n);else{this._render(n);for(let t=0,e=this.children.length;t<e;++t)this.children[t].render(n)}}renderAdvanced(n){const t=this.filters,e=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let s=0;s<t.length;s++)t[s].enabled&&this._enabledFilters.push(t[s])}const i=t&&this._enabledFilters?.length||e&&(!e.isMaskData||e.enabled&&(e.autoDetect||e.type!==Ei.NONE));if(i&&n.batch.flush(),t&&this._enabledFilters?.length&&n.filter.push(this,this._enabledFilters),e&&n.mask.push(this,this._mask),this.cullable)this._renderWithCulling(n);else{this._render(n);for(let s=0,r=this.children.length;s<r;++s)this.children[s].render(n)}i&&n.batch.flush(),e&&n.mask.pop(this),t&&this._enabledFilters?.length&&n.filter.pop()}_render(n){}destroy(n){super.destroy(),this.sortDirty=!1;const t="boolean"==typeof n?n:n?.children,e=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<e.length;++i)e[i].destroy(n)}get width(){return this.scale.x*this.getLocalBounds().width}set width(n){const t=this.getLocalBounds().width;this.scale.x=0!==t?n/t:1,this._width=n}get height(){return this.scale.y*this.getLocalBounds().height}set height(n){const t=this.getLocalBounds().height;this.scale.y=0!==t?n/t:1,this._height=n}};let vn=od;vn.defaultSortableChildren=!1,vn.prototype.containerUpdateTransform=vn.prototype.updateTransform,Object.defineProperties(Ft,{SORTABLE_CHILDREN:{get:()=>vn.defaultSortableChildren,set(n){De("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),vn.defaultSortableChildren=n}}});const yo=new Le,PC=new Uint16Array([0,1,2,0,2,3]);class xo extends vn{constructor(t){super(),this._anchor=new Rs(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=re.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Wt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=PC,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Ft.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=da(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=da(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,s=e.b,r=e.c,a=e.d,o=e.tx,l=e.ty,h=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,g=c.y-d._y*u.height,m=g+c.height):(p=-d._x*u.width,f=p+u.width,g=-d._y*u.height,m=g+u.height),h[0]=i*p+r*g+o,h[1]=a*g+s*p+l,h[2]=i*f+r*g+o,h[3]=a*g+s*f+l,h[4]=i*f+r*m+o,h[5]=a*m+s*f+l,h[6]=i*p+r*m+o,h[7]=a*m+s*p+l,this._roundPixels){const x=Ft.RESOLUTION;for(let v=0;v<h.length;++v)h[v]=Math.round(h[v]*x)/x}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this.vertexTrimmedData,i=this._texture.orig,s=this._anchor,r=this.transform.worldTransform,a=r.a,o=r.b,l=r.c,h=r.d,c=r.tx,u=r.ty,d=-s._x*i.width,f=d+i.width,p=-s._y*i.height,m=p+i.height;e[0]=a*d+l*p+c,e[1]=h*p+o*d+u,e[2]=a*f+l*p+c,e[3]=h*p+o*f+u,e[4]=a*f+l*m+c,e[5]=h*m+o*f+u,e[6]=a*d+l*m+c,e[7]=h*m+o*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new hh),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Ae),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,yo);const e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;let r=0;return yo.x>=s&&yo.x<s+e&&(r=-i*this.anchor.y,yo.y>=r&&yo.y<r+i)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof t?t:t?.texture)&&this._texture.destroy(!!("boolean"==typeof t?t:t?.baseTexture)),this._texture=null}static from(t,e){const i=t instanceof Wt?t:Wt.from(t,e);return new xo(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=da(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=da(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Wt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const l_=new ei;ai.prototype._cacheAsBitmap=!1,ai.prototype._cacheData=null,ai.prototype._cacheAsBitmapResolution=null,ai.prototype._cacheAsBitmapMultisample=null;class DC{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ai.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(n){n!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(n){n!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(n){if(this._cacheAsBitmap===n)return;let t;this._cacheAsBitmap=n,n?(this._cacheData||(this._cacheData=new DC),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),ai.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ai.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();this.filters?.length&&i.pad(this.filters[0].padding),i.ceil(Ft.RESOLUTION);const s=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,l=Ps.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${dr()}`;this._cacheData.textureCacheId=h,fe.addToCache(l.baseTexture,h),Wt.addToCache(l,h);const c=this.transform.localTransform.copyTo(l_).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(s,r,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new xo(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-i.x/i.width,u.anchor.y=-i.y/i.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},ai.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ai.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const s=t.canvasContext.activeContext,r=t._projTransform;e.ceil(Ft.RESOLUTION);const a=Ps.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${dr()}`;this._cacheData.textureCacheId=o,fe.addToCache(a.baseTexture,o),Wt.addToCache(a,o);const l=l_;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=s,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new xo(a);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},ai.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ai.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ai.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,fe.removeFromCache(this._cacheData.textureCacheId),Wt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ai.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ai.prototype.name=null,vn.prototype.getChildByName=function(t,e){for(let i=0,s=this.children.length;i<s;i++)if(this.children[i].name===t)return this.children[i];if(e)for(let i=0,s=this.children.length;i<s;i++){const r=this.children[i];if(!r.getChildByName)continue;const a=r.getChildByName(t,!0);if(a)return a}return null},ai.prototype.getGlobalPosition=function(t=new Le,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const BC={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},FC=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class ld extends Ni{constructor(t,e=8,i=4,s=Ni.defaultResolution,r=5){const a=function kC(n,t){const e=Math.ceil(n/2);let r,i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";r=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<n;a++){let o=r.replace("%index%",a.toString());o=o.replace("%sampleIndex%",a-(e-1)+".0"),s+=o,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",n.toString()),i}(r,t),o=function NC(n){const t=BC[n],e=t.length;let a,i=FC,s="";for(let o=0;o<n;o++){let l="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",o.toString());a=o,o>=e&&(a=n-o-1),l=l.replace("%value%",t[a].toString()),s+=l,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",n.toString()),i}(r);super(a,o),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(this.uniforms.strength=i?this.horizontal?1/i.width*(i.width/e.width):1/i.height*(i.height/e.height):this.horizontal?1/t.renderer.width*(t.renderer.width/e.width):1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,s);else{const r=t.getFilterTexture(),a=t.renderer;let o=e,l=r;this.state.blend=!1,t.applyFilter(this,o,l,Wn.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(o,Wn.BLIT),this.uniforms.uSampler=l;const c=l;l=o,o=c,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,i,s),t.returnFilterTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class hd extends Ni{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(i_,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)}tint(t,e){this._loadMatrix([(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0],e)}greyscale(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),s=Math.sin(t),a=1/3,o=(0,Math.sqrt)(a);this._loadMatrix([i+(1-i)*a,a*(1-i)-o*s,a*(1-i)+o*s,0,0,a*(1-i)+o*s,i+a*(1-i),a*(1-i)-o*s,0,0,a*(1-i)-o*s,a*(1-i)+o*s,i+a*(1-i),0,0,0,0,0,1,0],e)}contrast(t,e){const i=(t||0)+1,s=-.5*(i-1);this._loadMatrix([i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0],e)}saturate(t=0,e){const i=2*t/3+1,s=-.5*(i-1);this._loadMatrix([i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0],e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,s,r){const a=((i=i||16770432)>>16&255)/255,o=(i>>8&255)/255,l=(255&i)/255,h=((s=s||3375104)>>16&255)/255,c=(s>>8&255)/255,u=(255&s)/255;this._loadMatrix([.3,.59,.11,0,0,a,o,l,t=t||.2,0,h,c,u,e=e||.15,0,a-h,o-c,l-u,0,0],r)}night(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)}predator(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}hd.prototype.grayscale=hd.prototype.greyscale;const h_={AlphaFilter:class OC extends Ni{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class GC extends Ni{constructor(t=8,e=4,i=Ni.defaultResolution,s=5){super(),this.blurXFilter=new ld(!0,t,e,i,s),this.blurYFilter=new ld(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){const r=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(r&&a){const o=t.getFilterTexture();this.blurXFilter.apply(t,e,o,Wn.CLEAR),this.blurYFilter.apply(t,o,i,s),t.returnFilterTexture(o)}else a?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this.padding=this._repeatEdgePixels?0:2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:ld,ColorMatrixFilter:hd,DisplacementFilter:class WC extends Ni{constructor(t,e){const i=new ei;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,null==e&&(e=20),this.scale=new Le(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,a=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);0!==a&&0!==o&&(this.uniforms.rotation[0]=r.a/a,this.uniforms.rotation[1]=r.b/a,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class ZC extends Ni{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class qC extends Ni{constructor(t=.5,e=Math.random()){super(i_,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(h_).forEach(([n,t])=>{Object.defineProperty(h_,n,{get:()=>(De("7.1.0",`filters.${n} has moved to ${n}`),t)})});class vo{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=vo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Le,this.page=new Le,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class ch extends vo{constructor(){super(...arguments),this.client=new Le,this.movement=new Le,this.offset=new Le,this.global=new Le,this.screen=new Le}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,r,a,o,l,h,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class Bn extends ch{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class cd extends ch{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const JC=new Le,ud=new Le;class KC{constructor(t){this.dispatch=new oo,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,JC.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,r=i.length-1;s<r;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const s=i.children;if(s)for(let r=0;r<s.length;r++)this.all(t,e,s[r]);t.currentTarget=i,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,i,s,r){if(!t||!t.visible||r(t,i))return null;if(t.interactiveChildren&&t.children){const a=t.children;for(let o=a.length-1;o>=0;o--){const l=a[o],h=this.hitTestRecursive(l,e||l.interactive,i,s,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;return(h.length>0||t.interactive)&&h.push(t),h}}}return e&&s(t,i)?t.interactive?[t]:[]:null}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,ud),!t.hitArea.contains(ud.x,ud.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!!t.containsPoint&&t.containsPoint(e)}notifyTarget(t,e){t.currentTarget[`on${e=e??t.type}`]?.(t),this.notifyListeners(t,t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Bn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType?this.dispatchEvent(e,"touchstart"):"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.dispatchEvent(e,2===e.button?"rightdown":"mousedown"),this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Bn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t),i="mouse"===e.pointerType||"pen"===e.pointerType,s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&r!==e.target){const l=this.createPointerEvent(t,"mousemove"===t.type?"mouseout":"pointerout",r);if(this.dispatchEvent(l,"pointerout"),i&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(r)){const h=this.createPointerEvent(t,"pointerleave",r);for(h.eventPhase=h.AT_TARGET;h.target&&!e.composedPath().includes(h.target);)h.currentTarget=h.target,this.notifyTarget(h),i&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;this.freeEvent(h)}this.freeEvent(l)}if(r!==e.target){const l=this.clonePointerEvent(e,"mousemove"===t.type?"mouseover":"pointerover");this.dispatchEvent(l,"pointerover"),i&&this.dispatchEvent(l,"mouseover");let h=r?.parent;for(;h&&h!==this.rootTarget.parent&&h!==e.target;)h=h.parent;if(!h||h===this.rootTarget.parent){const u=this.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==r&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}const a=this.moveOnAll?"all":"dispatchEvent";this[a](e,"pointermove"),this.all(e,"globalpointermove"),"touch"===e.pointerType&&(this[a](e,"touchmove"),this.all(e,"globaltouchmove")),i&&(this[a](e,"mousemove"),this.all(e,"globalmousemove"),this.cursor=e.target?.cursor),s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Bn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof Bn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,s=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const a=this.createPointerEvent(t,"pointerleave",s);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Bn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType?this.dispatchEvent(i,"touchend"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.dispatchEvent(i,2===i.button?"rightup":"mouseup");const s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[t.button]);let a=r;if(r&&!i.composedPath().includes(r)){let o=r;for(;o&&!i.composedPath().includes(o);)i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),o=o.parent;delete s.pressTargetsByButton[t.button],a=o}if(a){const o=this.clonePointerEvent(i,"click");o.target=a,o.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:e});const l=s.clicksByButton[t.button];l.target===o.target&&e-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=o.target,l.timeStamp=e,o.detail=l.clickCount,"mouse"===o.pointerType?this.dispatchEvent(o,"click"):"touch"===o.pointerType&&this.dispatchEvent(o,"tap"),this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Bn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let r=i;for(;r;)s.currentTarget=r,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?this.notifyTarget(s,"touchendoutside"):("mouse"===s.pointerType||"pen"===s.pointerType)&&this.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof cd))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const s=this.allocateEvent(Bn);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y),"string"==typeof e&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(cd);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Bn);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Bn&&e instanceof Bn&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof ch&&e instanceof ch&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.fn.call(i.context,t);else for(let s=0,r=i.length;s<r&&!t.propagationImmediatelyStopped;s++)i[s].fn.call(i[s].context,t)}}const tR={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class c_{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new KC(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Bn(null),this.rootWheelEvent=new cd(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){const a=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let r=0,a=s.length;r<a;r++){const o=this.bootstrapEvent(this.rootPointerEvent,s[r]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s;s=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=this.domElement.width/s.width*(e-s.left)*r,t.y=this.domElement.height/s.height*(i-s.top)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){const r=t.changedTouches[i];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=1),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=tR[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}c_.extension={name:"events",type:[Pt.RendererSystem,Pt.CanvasRendererSystem]},Yt.add(c_);const eR={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(n,t,e){const s="function"==typeof t?void 0:t;this.on(n="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${n}capture`:n,t="function"==typeof t?t:t.handleEvent,s)},removeEventListener(n,t,e){const s="function"==typeof t?void 0:t;this.off(n="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${n}capture`:n,t="function"==typeof t?t:t.handleEvent,s)},dispatchEvent(n){if(!(n instanceof vo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=null,n.target=this,n.manager.dispatchEvent(n),!n.defaultPrevented}};ai.mixin(eR),ai.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class f_{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(cs.tablet||cs.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(cs.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:s,height:r}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:l}=this.renderer,h=s/a*l,c=r/o*l;let u=this.div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${a}px`,u.style.height=`${o}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,ua(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(u.style.left=(m.tx+p.x*m.a)*h+"px",u.style.top=(m.ty+p.y*m.d)*c+"px",u.style.width=p.width*m.a*h+"px",u.style.height=p.height*m.d*c+"px"):(p=f.getBounds(),this.capHitArea(p),u.style.left=p.x*h+"px",u.style.top=p.y*c+"px",u.style.width=p.width*h+"px",u.style.height=p.height*c+"px",u.title!==f.accessibleTitle&&null!==f.accessibleTitle&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&null!==f.accessibleHint&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,r=Object.assign(new vo(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>s.dispatchEvent(r,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}f_.extension={name:"accessibility",type:[Pt.RendererPlugin,Pt.CanvasRendererPlugin]},Yt.add(f_);const dd=class{constructor(n){this.stage=new vn,n=Object.assign({forceCanvas:!1},n),this.renderer=function bC(n){for(const t of e_)if(t.test(n))return new t(n);throw new Error("Unable to auto-detect a suitable renderer.")}(n),dd._plugins.forEach(t=>{t.init.call(this,n)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(n,t){const e=dd._plugins.slice(0);e.reverse(),e.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(n),this.renderer=null}};let dh=dd;dh._plugins=[],Yt.handleByList(Pt.Application,dh._plugins);class p_{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,i;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:r}=this._resizeTo;e=s,i=r}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}p_.extension=Pt.Application,Yt.add(p_);const m_={loader:Pt.LoadParser,resolver:Pt.ResolveParser,cache:Pt.CacheParser,detection:Pt.DetectionParser};Yt.handle(Pt.Asset,n=>{const t=n.ref;Object.entries(m_).filter(([e])=>!!t[e]).forEach(([e,i])=>Yt.add(Object.assign(t[e],{extension:t[e].extension??i})))},n=>{const t=n.ref;Object.keys(m_).filter(e=>!!t[e]).forEach(e=>Yt.remove(t[e]))});class hR{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){var t=this;return(0,Et.Z)(function*(){if(t._assetList.length&&t._isActive){t._isLoading=!0;const e=[],i=Math.min(t._assetList.length,t._maxConcurrent);for(let s=0;s<i;s++)e.push(t._assetList.pop());yield t._loader.load(e),t._isLoading=!1,t._next()}})()}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function fh(n,t){const e=n.split("?")[0],i=Bi.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const ds=(n,t)=>(Array.isArray(n)||(n=[n]),t?n.map(e=>"string"==typeof e?t(e):e):n),bo=new class cR{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=ds(t);let s;for(let o=0;o<this.parsers.length;o++){const l=this.parsers[o];if(l.test(e)){s=l.getCacheableAssets(i,e);break}}s||(s={},i.forEach(o=>{s[o]=e}));const r=Object.keys(s),a={cacheKeys:r,keys:i};if(i.forEach(o=>{this._cacheMap.set(o,a)}),r.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==e&&console.warn("[Cache] already has key:",o),this._cache.set(o,s[o])}),e instanceof Wt){const o=e;i.forEach(l=>{o.baseTexture!==Wt.EMPTY.baseTexture&&fe.addToCache(o.baseTexture,l),Wt.addToCache(o,l)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach(s=>{this._cache.delete(s)}),e.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}},ph=n=>!Array.isArray(n);class uR{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){var i=this;const s={promise:null,parser:null};return s.promise=(0,Et.Z)(function*(){let r=null;for(let a=0;a<i.parsers.length;a++){const o=i.parsers[a];if(o.load&&o.test?.(t,e,i)){r=yield o.load(t,e,i),s.parser=o;break}}if(!s.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let a=0;a<i.parsers.length;a++){const o=i.parsers[a];o.parse&&o.parse&&(yield o.testParse?.(r,e,i))&&(r=(yield o.parse(r,e,i))||r,s.parser=o)}return r})(),s}load(t,e){var i=this;return(0,Et.Z)(function*(){let s=0;const r={},a=ph(t),o=ds(t,c=>({src:c})),l=o.length,h=o.map(function(){var c=(0,Et.Z)(function*(u){const d=Bi.toAbsolute(u.src);if(!r[u.src])try{i.promiseCache[d]||(i.promiseCache[d]=i._getLoadPromiseAndParser(d,u)),r[u.src]=yield i.promiseCache[d].promise,e&&e(++s/l)}catch(f){throw delete i.promiseCache[d],delete r[u.src],new Error(`[Loader.load] Failed to load ${d}.\n${f}`)}});return function(u){return c.apply(this,arguments)}}());return yield Promise.all(h),a?r[o[0].src]:r})()}unload(t){var e=this;return(0,Et.Z)(function*(){const s=ds(t,r=>({src:r})).map(function(){var r=(0,Et.Z)(function*(a){const o=Bi.toAbsolute(a.src),l=e.promiseCache[o];if(l){const h=yield l.promise;l.parser?.unload?.(h,a,e),delete e.promiseCache[o]}});return function(a){return r.apply(this,arguments)}}());yield Promise.all(s)})()}get parsers(){return this._parsers}}var Zn=(n=>(n[n.Low=0]="Low",n[n.Normal=1]="Normal",n[n.High=2]="High",n))(Zn||{});const dR={extension:{type:Pt.LoadParser,priority:Zn.Low},test:n=>".json"===Bi.extname(n).toLowerCase(),load:n=>(0,Et.Z)(function*(){return yield(yield Ft.ADAPTER.fetch(n)).json()})()};Yt.add(dR);const fR={extension:{type:Pt.LoadParser,priority:Zn.Low},test:n=>".txt"===Bi.extname(n).toLowerCase(),load:n=>(0,Et.Z)(function*(){return yield(yield Ft.ADAPTER.fetch(n)).text()})()};function g_(n,t){if(Array.isArray(t)){for(const e of t)if(n.startsWith(`data:${e}`))return!0;return!1}return n.startsWith(`data:${t}`)}Yt.add(fR);const pR=["normal","bold","100","200","300","400","500","600","700","800","900"],mR=[".ttf",".otf",".woff",".woff2"],gR=["font/ttf","font/otf","font/woff","font/woff2"],yR={extension:{type:Pt.LoadParser,priority:Zn.Low},test:n=>g_(n,gR)||fh(n,mR),load:(n,t)=>(0,Et.Z)(function*(){if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=Ft.ADAPTER.getFontFaceSet();if(e){const i=[],s=t.data?.family??function _R(n){const t=Bi.extname(n);return Bi.basename(n,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}(n),r=t.data?.weights?.filter(o=>pR.includes(o))??["normal"],a=t.data??{};for(let o=0;o<r.length;o++){const l=r[o],h=new FontFace(s,`url(${encodeURI(n)})`,{...a,weight:l});yield h.load(),e.add(h),i.push(h)}return 1===i.length?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})(),unload(n){(Array.isArray(n)?n:[n]).forEach(t=>Ft.ADAPTER.getFontFaceSet().delete(t))}};Yt.add(yR);let fd,__=0;const xR_code="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",vR_code="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let pd;const y_=new class bR{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([xR_code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)})})),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}_initWorkers(){var t=this;return(0,Et.Z)(function*(){t._initialized||(t._initialized=!0)})()}getWorker(){void 0===fd&&(fd=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<fd&&(pd||(pd=URL.createObjectURL(new Blob([vR_code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(pd),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}_run(t,e){var i=this;return(0,Et.Z)(function*(){yield i._initWorkers();const s=new Promise((r,a)=>{i.queue.push({id:t,arguments:e,resolve:r,reject:a})});return i.next(),s})()}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[__]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:__++,id:i})}};function mh(n,t,e){const i=new Wt(n);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),i}const wR=[".jpeg",".jpg",".png",".webp",".avif"],MR=["image/jpeg","image/png","image/webp","image/avif"];function md(){return(md=(0,Et.Z)(function*(n){const t=yield Ft.ADAPTER.fetch(n);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${n}: ${t.status} ${t.statusText}`);const e=yield t.blob();return yield createImageBitmap(e)})).apply(this,arguments)}const wo={extension:{type:Pt.LoadParser,priority:Zn.High},config:{preferWorkers:!0},test:n=>g_(n,MR)||fh(n,wR),load(n,t,e){var i=this;return(0,Et.Z)(function*(){let s=null;s=globalThis.createImageBitmap?i.config.preferWorkers&&(yield y_.isImageBitmapSupported())?yield y_.loadImageBitmap(n):yield function SR(n){return md.apply(this,arguments)}(n):yield new Promise(a=>{s=new Image,s.crossOrigin="anonymous",s.src=n,s.complete?a(s):s.onload=()=>{a(s)}});const r=new fe(s,{resolution:As(n),...t.data});return r.resource.src=n,mh(r,e,n)})()},unload(n){n.destroy(!0)}};Yt.add(wo);const TR={extension:{type:Pt.LoadParser,priority:Zn.High},test:n=>".svg"===Bi.extname(n).toLowerCase(),testParse:n=>(0,Et.Z)(function*(){return _o.test(n)})(),parse:(n,t,e)=>(0,Et.Z)(function*(){const i=new _o(n,t?.data?.resourceOptions),s=new fe(i,{resolution:As(n),...t?.data});s.resource.src=n;const r=mh(s,e,n);return t?.data?.resourceOptions?.autoLoad||(yield i.load()),r})(),load:(n,t)=>(0,Et.Z)(function*(){return(yield Ft.ADAPTER.fetch(n)).text()})(),unload:wo.unload};function x_(n,t,e,i,s){const r=t[e];for(let a=0;a<r.length;a++){const o=r[a];e<t.length-1?x_(n.replace(i[e],o),t,e+1,i,s):s.push(n.replace(i[e],o))}}function ER(n){const e=n.match(/\{(.*?)\}/g),i=[];if(e){const s=[];e.forEach(r=>{const a=r.substring(1,r.length-1).split(",");s.push(a)}),x_(n,s,0,e,i)}else i.push(n);return i}Yt.add(TR);class AR{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,e)=>`${t}${this._bundleIdConnector}${e}`,this._extractAssetIdFromBundle=(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(s=>{if("string"==typeof s.name){const r=this._createBundleAssetId(t,s.name);i.push(r),this.add([s.name,r],s.srcs,s.data)}else{const r=s.name.map(a=>this._createBundleAssetId(t,a));r.forEach(a=>{i.push(a)}),this.add([...s.name,...r],s.srcs)}}):Object.keys(e).forEach(s=>{i.push(this._createBundleAssetId(t,s)),this.add([s,this._createBundleAssetId(t,s)],e[s])}),this._bundles[t]=i}add(t,e,i){const s=ds(t);s.forEach(a=>{this._assetMap[a]&&console.warn(`[Resolver] already has key: ${a} overwriting`)}),Array.isArray(e)||(e="string"==typeof e?ER(e):[e]);const r=e.map(a=>{let o=a;if("string"==typeof a){let l=!1;for(let h=0;h<this._parsers.length;h++){const c=this._parsers[h];if(c.test(a)){o=c.parse(a),l=!0;break}}l||(o={src:a})}return o.format||(o.format=o.src.split(".").pop()),o.alias||(o.alias=s),(this._basePath||this._rootPath)&&(o.src=Bi.toAbsolute(o.src,this._basePath,this._rootPath)),o.src=this._appendDefaultSearchParams(o.src),o.data=o.data??i,o});s.forEach(a=>{this._assetMap[a]=r})}resolveBundle(t){const e=ph(t);t=ds(t);const i={};return t.forEach(s=>{const r=this._bundles[s];if(r){const a=this.resolve(r),o={};for(const l in a){const h=a[l];o[this._extractAssetIdFromBundle(s,l)]=h}i[s]=o}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const i={};for(const s in e)i[s]=e[s].src;return i}return e.src}resolve(t){const e=ph(t);t=ds(t);const i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let r=this._assetMap[s];const a=this._getPreferredOrder(r),o=r[0];a?.priority.forEach(l=>{a.params[l].forEach(h=>{const c=r.filter(u=>!!u[l]&&u[l]===h);c.length&&(r=c)})}),this._resolverHash[s]=r[0]??o}else{let r=s;(this._basePath||this._rootPath)&&(r=Bi.toAbsolute(r,this._basePath,this._rootPath)),r=this._appendDefaultSearchParams(r),this._resolverHash[s]={src:r}}i[s]=this._resolverHash[s]}),e?i[t[0]]:i}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],s=this._preferredOrder.find(r=>r.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){return this._defaultSearchParams?`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`:t}}const gh=new class CR{constructor(){this._detections=[],this._initialized=!1,this.resolver=new AR,this.loader=new uR,this.cache=bo,this._backgroundLoader=new hR(this.loader),this._backgroundLoader.active=!0,this.reset()}init(t={}){var e=this;return(0,Et.Z)(function*(){if(e._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(e._initialized=!0,t.defaultSearchParams&&e.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(e.resolver.basePath=t.basePath),t.bundleIdentifier&&e.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;"string"==typeof a&&(a=yield e.load(a)),e.resolver.addManifest(a)}const i=t.texturePreference?.resolution??1,s="number"==typeof i?[i]:i;let r=[];if(t.texturePreference?.format){const a=t.texturePreference?.format;r="string"==typeof a?[a]:a;for(const o of e._detections)(yield o.test())||(r=yield o.remove(r))}else for(const a of e._detections)(yield a.test())&&(r=yield a.add(r));e.resolver.prefer({params:{format:r,resolution:s}})})()}add(t,e,i){this.resolver.add(t,e,i)}load(t,e){var i=this;return(0,Et.Z)(function*(){i._initialized||(yield i.init());const s=ph(t),r=ds(t).map(l=>"string"!=typeof l?(i.resolver.add(l.src,l),l.src):l),a=i.resolver.resolve(r),o=yield i._mapLoadToResolve(a,e);return s?o[r[0]]:o})()}addBundle(t,e){this.resolver.addBundle(t,e)}loadBundle(t,e){var i=this;return(0,Et.Z)(function*(){i._initialized||(yield i.init());let s=!1;"string"==typeof t&&(s=!0,t=[t]);const r=i.resolver.resolveBundle(t),a={},o=Object.keys(r);let l=0,h=0;const c=()=>{e?.(++l/h)},u=o.map(d=>{const f=r[d];return h+=Object.keys(f).length,i._mapLoadToResolve(f,c).then(p=>{a[d]=p})});return yield Promise.all(u),s?a[t[0]]:a})()}backgroundLoad(t){var e=this;return(0,Et.Z)(function*(){e._initialized||(yield e.init()),"string"==typeof t&&(t=[t]);const i=e.resolver.resolve(t);e._backgroundLoader.add(Object.values(i))})()}backgroundLoadBundle(t){var e=this;return(0,Et.Z)(function*(){e._initialized||(yield e.init()),"string"==typeof t&&(t=[t]);const i=e.resolver.resolveBundle(t);Object.values(i).forEach(s=>{e._backgroundLoader.add(Object.values(s))})})()}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return bo.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=bo.get(t[i]);return e}_mapLoadToResolve(t,e){var i=this;return(0,Et.Z)(function*(){const s=Object.values(t),r=Object.keys(t);i._backgroundLoader.active=!1;const a=yield i.loader.load(s,e);i._backgroundLoader.active=!0;const o={};return s.forEach((l,h)=>{const c=a[l.src],u=[l.src];l.alias&&u.push(...l.alias),o[r[h]]=c,bo.set(u,c)}),o})()}unload(t){var e=this;return(0,Et.Z)(function*(){e._initialized||(yield e.init());const i=ds(t).map(r=>"string"!=typeof r?r.src:r),s=e.resolver.resolve(i);yield e._unloadFromResolved(s)})()}unloadBundle(t){var e=this;return(0,Et.Z)(function*(){e._initialized||(yield e.init()),t=ds(t);const i=e.resolver.resolveBundle(t),s=Object.keys(i).map(r=>e._unloadFromResolved(i[r]));yield Promise.all(s)})()}_unloadFromResolved(t){var e=this;return(0,Et.Z)(function*(){const i=Object.values(t);i.forEach(s=>{bo.remove(s.src)}),yield e.loader.unload(i)})()}get detections(){return this._detections}get preferWorkers(){return wo.config.preferWorkers}set preferWorkers(t){wo.config.preferWorkers=t}};Yt.handleByList(Pt.LoadParser,gh.loader.parsers).handleByList(Pt.ResolveParser,gh.resolver.parsers).handleByList(Pt.CacheParser,gh.cache.parsers).handleByList(Pt.DetectionParser,gh.detections);const RR={extension:Pt.CacheParser,test:n=>Array.isArray(n)&&n.every(t=>t instanceof Wt),getCacheableAssets:(n,t)=>{const e={};return n.forEach(i=>{t.forEach((s,r)=>{e[i+(0===r?"":r+1)]=s})}),e}};Yt.add(RR);const IR={extension:{type:Pt.DetectionParser,priority:1},test:(n=(0,Et.Z)(function*(){if(!globalThis.createImageBitmap)return!1;const e=yield Ft.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)}),function(){return n.apply(this,arguments)}),add:function(){var n=(0,Et.Z)(function*(t){return[...t,"avif"]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Et.Z)(function*(t){return t.filter(e=>"avif"!==e)});return function(e){return n.apply(this,arguments)}}()};var n;Yt.add(IR);const PR={extension:{type:Pt.DetectionParser,priority:0},test:function(){var n=(0,Et.Z)(function*(){if(!globalThis.createImageBitmap)return!1;const e=yield Ft.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)});return function(){return n.apply(this,arguments)}}(),add:function(){var n=(0,Et.Z)(function*(t){return[...t,"webp"]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Et.Z)(function*(t){return t.filter(e=>"webp"!==e)});return function(e){return n.apply(this,arguments)}}()};Yt.add(PR);const v_=["png","jpg","jpeg"],DR={extension:{type:Pt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:function(){var n=(0,Et.Z)(function*(t){return[...t,...v_]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Et.Z)(function*(t){return t.filter(e=>!v_.includes(e))});return function(e){return n.apply(this,arguments)}}()};Yt.add(DR);const LR={extension:Pt.ResolveParser,test:wo.test,parse:n=>({resolution:parseFloat(Ft.RETINA_PREFIX.exec(n)?.[1]??"1"),format:n.split(".").pop(),src:n})};Yt.add(LR);const gd=(n,t)=>{const e=t.split("?")[1];return e&&(n+=`?${e}`),n};var hn=(n=>(n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n))(hn||{});const _h={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let fs,va;function b_(){va={s3tc:fs.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:fs.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:fs.getExtension("WEBGL_compressed_texture_etc"),etc1:fs.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:fs.getExtension("WEBGL_compressed_texture_pvrtc")||fs.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:fs.getExtension("WEBGL_compressed_texture_atc"),astc:fs.getExtension("WEBGL_compressed_texture_astc")}}const OR={extension:{type:Pt.DetectionParser,priority:2},test:function(){var n=(0,Et.Z)(function*(){const e=Ft.ADAPTER.createCanvas().getContext("webgl");return e?(fs=e,!0):(console.warn("WebGL not available for compressed textures."),!1)});return function(){return n.apply(this,arguments)}}(),add:function(){var n=(0,Et.Z)(function*(t){va||b_();const e=[];for(const i in va)!va[i]||e.push(i);return[...e,...t]});return function(e){return n.apply(this,arguments)}}(),remove:function(){var n=(0,Et.Z)(function*(t){return va||b_(),t.filter(e=>!(e in va))});return function(e){return n.apply(this,arguments)}}()};Yt.add(OR);class BR extends uo{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;"string"==typeof t?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new Fu(s):null,this.origin&&!1!==e.autoLoad&&this.load(),s?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){var t=this;return(0,Et.Z)(function*(){const s=yield(yield(yield fetch(t.origin)).blob()).arrayBuffer();return t.data=new Uint32Array(s),t.buffer=new Fu(s),t.loaded=!0,t.onBlobLoaded(s),t.update(),t})()}}class yr extends BR{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=yr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||yr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,o=this.levels;a<o;a++){const{levelID:l,levelWidth:h,levelHeight:c,levelBuffer:u}=this._levelBuffers[a];s.compressedTexImage2D(s.TEXTURE_2D,l,this.format,h,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=yr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,s,r,a,o){const l=new Array(i);let h=t.byteOffset,c=a,u=o,d=c+s-1&~(s-1),f=u+r-1&~(r-1),p=d*f*_h[e];for(let m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?c:d,levelHeight:i>1?u:f,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),f=u+r-1&~(r-1),p=d*f*_h[e];return l}}const KR={827611204:hn.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:hn.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:hn.COMPRESSED_RGBA_S3TC_DXT5_EXT},QR={70:hn.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:hn.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:hn.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:hn.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:hn.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:hn.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:hn.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:hn.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:hn.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},M_=[171,75,84,88,32,49,49,187,13,10,26,10],S_={[Kt.UNSIGNED_BYTE]:1,[Kt.UNSIGNED_SHORT]:2,[Kt.INT]:4,[Kt.UNSIGNED_INT]:4,[Kt.FLOAT]:4,[Kt.HALF_FLOAT]:8},iI={[Mt.RGBA]:4,[Mt.RGB]:3,[Mt.RG]:2,[Mt.RED]:1,[Mt.LUMINANCE]:1,[Mt.LUMINANCE_ALPHA]:2,[Mt.ALPHA]:1},nI={[Kt.UNSIGNED_SHORT_4_4_4_4]:2,[Kt.UNSIGNED_SHORT_5_5_5_1]:2,[Kt.UNSIGNED_SHORT_5_6_5]:2};function aI(n){switch(n){case Mt.RGBA:return Mt.RGBA_INTEGER;case Mt.RGB:return Mt.RGB_INTEGER;case Mt.RG:return Mt.RG_INTEGER;case Mt.RED:return Mt.RED_INTEGER;default:return n}}const lI={extension:{type:Pt.LoadParser,priority:Zn.High},test:n=>fh(n,".dds"),load:(n,t,e)=>(0,Et.Z)(function*(){const a=function tI(n){const t=new Uint32Array(n);if(542327876!==t[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(n,0,124/Uint32Array.BYTES_PER_ELEMENT),s=i[3],r=i[4],a=i[7],o=new Uint32Array(n,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),l=o[1];if(4&l){const h=o[2];if(808540228!==h){const y=KR[h],M=new Uint8Array(n,128);return[new yr(M,{format:y,width:r,height:s,levels:a})]}const u=new Uint32Array(t.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=u[0],f=u[1],p=u[2],m=u[3],g=QR[d];if(void 0===g)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(4===p)throw new Error("DDSParser does not support cubemap textures");if(6===f)throw new Error("DDSParser does not supported 3D texture data");const x=new Array,v=148;if(1===m)x.push(new Uint8Array(n,v));else{const y=_h[g];let b=0,M=r,S=s;for(let w=0;w<a;w++)b+=Math.max(1,M+3&-4)*Math.max(1,S+3&-4)*y,M>>>=1,S>>>=1;let A=v;for(let w=0;w<m;w++)x.push(new Uint8Array(n,A,b)),A+=b}return x.map(y=>new yr(y,{format:g,width:r,height:s,levels:a}))}throw 64&l?new Error("DDSParser does not support uncompressed texture data."):512&l?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&l?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&l?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(yield(yield Ft.ADAPTER.fetch(n)).arrayBuffer()).map(o=>mh(new fe(o,{mipmap:Vn.OFF,alphaMode:An.NO_PREMULTIPLIED_ALPHA,resolution:As(n),...t.data}),e,n));return 1===a.length?a[0]:a})(),unload(n){Array.isArray(n)?n.forEach(t=>t.destroy(!0)):n.destroy(!0)}};Yt.add(lI);const hI={extension:{type:Pt.LoadParser,priority:Zn.High},test:n=>fh(n,".ktx"),load:(n,t,e)=>(0,Et.Z)(function*(){const s=yield(yield Ft.ADAPTER.fetch(n)).arrayBuffer(),{compressed:r,uncompressed:a,kvData:o}=function sI(n,t,e=!1){const i=new DataView(t);if(!function rI(n,t){for(let e=0;e<M_.length;e++)if(t.getUint8(e)!==M_[e])return console.error(`${n} is not a valid *.ktx file!`),!1;return!0}(n,i))return null;const s=67305985===i.getUint32(12,!0),r=i.getUint32(16,s),a=i.getUint32(24,s),o=i.getUint32(28,s),l=i.getUint32(36,s),h=i.getUint32(40,s)||1,c=i.getUint32(44,s)||1,u=i.getUint32(48,s)||1,d=i.getUint32(52,s),f=i.getUint32(56,s),p=i.getUint32(60,s);if(0===h||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const x=l+3&-4,v=h+3&-4,y=new Array(u);let M,b=l*h;if(0===r&&(b=x*v),M=0!==r?S_[r]?S_[r]*iI[a]:nI[r]:_h[o],void 0===M)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const S=e?function oI(n,t,e){const i=new Map;let s=0;for(;s<t;){const r=n.getUint32(64+s,e),a=64+s+4,o=3-(r+3)%4;if(0===r||r>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<r&&0!==n.getUint8(a+l);l++);if(-1===l){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=(new TextDecoder).decode(new Uint8Array(n.buffer,a,l)),c=new DataView(n.buffer,a+l+1,r-l-1);i.set(h,c),s+=4+r+o}return i}(i,p,s):null;let w=b*M,T=l,C=h,F=x,Y=v,O=64+p;for(let D=0;D<f;D++){const W=i.getUint32(O,s);let X=O+4;for(let j=0;j<u;j++){let $=y[j];$||($=y[j]=new Array(f)),$[D]={levelID:D,levelWidth:f>1||0!==r?T:F,levelHeight:f>1||0!==r?C:Y,levelBuffer:new Uint8Array(t,X,w)},X+=w}O+=W+4,O=O%4!=0?O+4-O%4:O,T=T>>1||1,C=C>>1||1,F=T+4-1&-4,Y=C+4-1&-4,w=F*Y*M}return 0!==r?{uncompressed:y.map(D=>{let W=D[0].levelBuffer,X=!1;return r===Kt.FLOAT?W=new Float32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4):r===Kt.UNSIGNED_INT?(X=!0,W=new Uint32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4)):r===Kt.INT&&(X=!0,W=new Int32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4)),{resource:new uo(W,{width:D[0].levelWidth,height:D[0].levelHeight}),type:r,format:X?aI(a):a}}),kvData:S}:{compressed:y.map(D=>new yr(null,{format:o,width:l,height:h,levels:f,levelBuffers:D})),kvData:S}}(n,s),l=r??a,h={mipmap:Vn.OFF,alphaMode:An.NO_PREMULTIPLIED_ALPHA,resolution:As(n),...t.data},c=l.map(u=>{l===a&&Object.assign(h,{type:u.type,format:u.format});const d=new fe(u,h);return d.ktxKeyValueData=o,mh(d,e,n)});return 1===c.length?c[0]:c})(),unload(n){Array.isArray(n)?n.forEach(t=>t.destroy(!0)):n.destroy(!0)}};Yt.add(hI);const cI={extension:Pt.ResolveParser,test:n=>{const e=n.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:n=>{if("ktx"===n.split("?")[0].split(".").pop()){const i=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(i.some(s=>n.endsWith(s)))return{resolution:parseFloat(Ft.RETINA_PREFIX.exec(n)?.[1]??"1"),format:i.find(s=>n.endsWith(s)),src:n}}return{resolution:parseFloat(Ft.RETINA_PREFIX.exec(n)?.[1]??"1"),format:n.split(".").pop(),src:n}}};Yt.add(cI);const T_=new Ae,xd=class{constructor(n){this.renderer=n}image(n,t,e){var i=this;return(0,Et.Z)(function*(){const s=new Image;return s.src=yield i.base64(n,t,e),s})()}base64(n,t,e){var i=this;return(0,Et.Z)(function*(){const s=i.canvas(n);if(void 0!==s.toDataURL)return s.toDataURL(t,e);if(void 0!==s.convertToBlob){const r=yield s.convertToBlob({type:t,quality:e});return yield new Promise(a=>{const o=new FileReader;o.onload=()=>a(o.result),o.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")})()}canvas(n,t){const e=this.renderer;let i,r,s=!1,a=!1;n&&(n instanceof Ps?r=n:(r=this.renderer.generateTexture(n),a=!0)),r?(i=r.baseTexture.resolution,t=t??r.frame,s=!1,e.renderTexture.bind(r)):(i=e.resolution,t||((t=T_).width=e.width,t.height=e.height),s=!0,e.renderTexture.bind(null));const o=Math.round(t.width*i),l=Math.round(t.height*i);let h=new ag(o,l,1);const c=new Uint8Array(4*o*l),u=e.gl;u.readPixels(Math.round(t.x*i),Math.round(t.y*i),o,l,u.RGBA,u.UNSIGNED_BYTE,c);const d=h.context.getImageData(0,0,o,l);if(xd.arrayPostDivide(c,d.data),h.context.putImageData(d,0,0),s){const f=new ag(h.width,h.height,1);f.context.scale(1,-1),f.context.drawImage(h.canvas,0,-l),h.destroy(),h=f}return a&&r.destroy(!0),h.canvas}pixels(n,t){const e=this.renderer;let i,s,r=!1;n&&(n instanceof Ps?s=n:(s=this.renderer.generateTexture(n),r=!0)),s?(i=s.baseTexture.resolution,t=t??s.frame,e.renderTexture.bind(s)):(i=e.resolution,t||((t=T_).width=e.width,t.height=e.height),e.renderTexture.bind(null));const a=Math.round(t.width*i),o=Math.round(t.height*i),l=new Uint8Array(4*a*o),h=e.gl;return h.readPixels(Math.round(t.x*i),Math.round(t.y*i),a,o,h.RGBA,h.UNSIGNED_BYTE,l),r&&s.destroy(!0),xd.arrayPostDivide(l,l),l}destroy(){this.renderer=null}static arrayPostDivide(n,t){for(let e=0;e<n.length;e+=4){const i=t[e+3]=n[e+3];0!==i?(t[e]=Math.round(Math.min(255*n[e]/i,255)),t[e+1]=Math.round(Math.min(255*n[e+1]/i,255)),t[e+2]=Math.round(Math.min(255*n[e+2]/i,255))):(t[e]=n[e],t[e+1]=n[e+1],t[e+2]=n[e+2])}}};let A_=xd;A_.extension={name:"extract",type:Pt.RendererSystem},Yt.add(A_);const Mo={build(n){const t=n.points;let e,i,s,r,a,o;if(n.type===Fi.CIRC){const p=n.shape;e=p.x,i=p.y,a=o=p.radius,s=r=0}else if(n.type===Fi.ELIP){const p=n.shape;e=p.x,i=p.y,a=p.width,o=p.height,s=r=0}else{const p=n.shape,m=p.width/2,g=p.height/2;e=p.x+m,i=p.y+g,a=o=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-a,r=g-o}if(!(a>=0&&o>=0&&s>=0&&r>=0))return void(t.length=0);const l=Math.ceil(2.3*Math.sqrt(a+o)),h=8*l+(s?4:0)+(r?4:0);if(t.length=h,0===h)return;if(0===l)return t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+r,t[2]=t[4]=e-s,void(t[5]=t[7]=i-r);let c=0,u=4*l+(s?2:0)+2,d=u,f=h;{const p=s+a,m=r,g=e+p,x=e-p,v=i+m;if(t[c++]=g,t[c++]=v,t[--u]=v,t[--u]=x,r){const y=i-m;t[d++]=x,t[d++]=y,t[--f]=y,t[--f]=g}}for(let p=1;p<l;p++){const m=Math.PI/2*(p/l),g=s+Math.cos(m)*a,x=r+Math.sin(m)*o,v=e+g,y=e-g,b=i+x,M=i-x;t[c++]=v,t[c++]=b,t[--u]=b,t[--u]=y,t[d++]=y,t[d++]=M,t[--f]=M,t[--f]=v}{const m=r+o,g=e+s,x=e-s,v=i+m,y=i-m;t[c++]=g,t[c++]=v,t[--f]=y,t[--f]=g,s&&(t[c++]=x,t[c++]=v,t[--f]=y,t[--f]=x)}},triangulate(n,t){const e=n.points,i=t.points,s=t.indices;if(0===e.length)return;let r=i.length/2;const a=r;let o,l;if(n.type!==Fi.RREC){const c=n.shape;o=c.x,l=c.y}else{const c=n.shape;o=c.x+c.width/2,l=c.y+c.height/2}const h=n.matrix;i.push(n.matrix?h.a*o+h.c*l+h.tx:o,n.matrix?h.b*o+h.d*l+h.ty:l),r++,i.push(e[0],e[1]);for(let c=2;c<e.length;c+=2)i.push(e[c],e[c+1]),s.push(r++,a,r);s.push(a+1,a,r)}};function C_(n,t=!1){const e=n.length;if(e<6)return;let i=0;for(let s=0,r=n[e-2],a=n[e-1];s<e;s+=2){const o=n[s],l=n[s+1];i+=(o-r)*(l+a),r=o,a=l}if(!t&&i>0||t&&i<=0){const s=e/2;for(let r=s+s%2;r<e;r+=2){const a=e-r-2,o=e-r-1,l=r,h=r+1;[n[a],n[l]]=[n[l],n[a]],[n[o],n[h]]=[n[h],n[o]]}}}const vd={build(n){n.points=n.shape.points.slice()},triangulate(n,t){let e=n.points;const i=n.holes,s=t.points,r=t.indices;if(e.length>=6){C_(e,!1);const a=[];for(let h=0;h<i.length;h++){const c=i[h];C_(c.points,!0),a.push(e.length/2),e=e.concat(c.points)}const o=dS(e,a,2);if(!o)return;const l=s.length/2;for(let h=0;h<o.length;h+=3)r.push(o[h]+l),r.push(o[h+1]+l),r.push(o[h+2]+l);for(let h=0;h<e.length;h++)s.push(e[h])}}},R_={build(n){const t=n.shape,e=t.x,i=t.y,s=t.width,r=t.height,a=n.points;a.length=0,s>=0&&r>=0&&a.push(e,i,e+s,i,e+s,i+r,e,i+r)},triangulate(n,t){const e=n.points,i=t.points;if(0===e.length)return;const s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},I_={build(n){Mo.build(n)},triangulate(n,t){Mo.triangulate(n,t)}};var Ds=(n=>(n.MITER="miter",n.BEVEL="bevel",n.ROUND="round",n))(Ds||{}),xr=(n=>(n.BUTT="butt",n.ROUND="round",n.SQUARE="square",n))(xr||{});const ba={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(n,t=20){if(!this.adaptive||!n||isNaN(n))return t;let e=Math.ceil(n/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class bd{static curveTo(t,e,i,s,r,a){const h=a[a.length-1]-e,c=a[a.length-2]-t,u=s-e,d=i-t,f=Math.abs(h*d-c*u);if(f<1e-8||0===r)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const p=h*h+c*c,m=u*u+d*d,g=h*u+c*d,x=r*Math.sqrt(p)/f,v=r*Math.sqrt(m)/f,y=x*g/p,b=v*g/m,M=x*d+v*c,S=x*u+v*h,T=d*(x+b),C=u*(x+b);return{cx:M+t,cy:S+e,radius:r,startAngle:Math.atan2(h*(v+y)-S,c*(v+y)-M),endAngle:Math.atan2(C-S,T-M),anticlockwise:c*u>d*h}}static arc(t,e,i,s,r,a,o,l,h){const c=o-a,u=ba._segmentsCount(Math.abs(c)*r,40*Math.ceil(Math.abs(c)/ql)),d=c/(2*u),f=2*d,p=Math.cos(d),m=Math.sin(d),g=u-1,x=g%1/g;for(let v=0;v<=g;++v){const b=d+a+f*(v+x*v),M=Math.cos(b),S=-Math.sin(b);h.push((p*M+m*S)*r+i,(p*-S+m*M)*r+s)}}}class bh{static curveLength(t,e,i,s,r,a,o,l){let c=0,u=0,d=0,f=0,p=0,m=0,g=0,x=0,v=0,y=0,b=0,M=t,S=e;for(let A=1;A<=10;++A)u=A/10,d=u*u,f=d*u,p=1-u,m=p*p,g=m*p,x=g*t+3*m*u*i+3*p*d*r+f*o,v=g*e+3*m*u*s+3*p*d*a+f*l,y=M-x,b=S-v,M=x,S=v,c+=Math.sqrt(y*y+b*b);return c}static curveTo(t,e,i,s,r,a,o){const l=o[o.length-2],h=o[o.length-1];o.length-=2;const c=ba._segmentsCount(bh.curveLength(l,h,t,e,i,s,r,a));let u=0,d=0,f=0,p=0,m=0;o.push(l,h);for(let g=1,x=0;g<=c;++g)x=g/c,u=1-x,d=u*u,f=d*u,p=x*x,m=p*x,o.push(f*l+3*d*x*t+3*u*p*i+m*r,f*h+3*d*x*e+3*u*p*s+m*a)}}function P_(n,t,e,i,s,r,a,o){let d,f;a?(d=i,f=-e):(d=-i,f=e);const g=n+e*r+d,x=t+i*r+f;return o.push(n-e*s+d,t-i*s+f),o.push(g,x),2}function vr(n,t,e,i,s,r,a,o){const l=e-n,h=i-t;let c=Math.atan2(l,h),u=Math.atan2(s-n,r-t);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(l*l+h*h),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),x=f/g;if(d+=x,o){a.push(n,t),a.push(e,i);for(let v=1,y=d;v<g;v++,y+=x)a.push(n,t),a.push(n+Math.sin(y)*m,t+Math.cos(y)*m);a.push(n,t),a.push(s,r)}else{a.push(e,i),a.push(n,t);for(let v=1,y=d;v<g;v++,y+=x)a.push(n+Math.sin(y)*m,t+Math.cos(y)*m),a.push(n,t);a.push(s,r),a.push(n,t)}return 2*g}function wd(n,t){n.lineStyle.native?function dI(n,t){let e=0;const i=n.shape,s=n.points||i.points,r=i.type!==Fi.POLY||i.closeStroke;if(0===s.length)return;const a=t.points,o=t.indices,l=s.length/2,h=a.length/2;let c=h;for(a.push(s[0],s[1]),e=1;e<l;e++)a.push(s[2*e],s[2*e+1]),o.push(c,c+1),c++;r&&o.push(c,h)}(n,t):function uI(n,t){const e=n.shape;let i=n.points||e.points.slice();const s=t.closePointEps;if(0===i.length)return;const r=n.lineStyle,a=new Le(i[0],i[1]),o=new Le(i[i.length-2],i[i.length-1]),l=e.type!==Fi.POLY||e.closeStroke,h=Math.abs(a.x-o.x)<s&&Math.abs(a.y-o.y)<s;if(l){i=i.slice(),h&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));const j=.5*(a.x+o.x),$=.5*(o.y+a.y);i.unshift(j,$),i.push(j,$)}const c=t.points,u=i.length/2;let d=i.length;const f=c.length/2,p=r.width/2,m=p*p,g=r.miterLimit*r.miterLimit;let x=i[0],v=i[1],y=i[2],b=i[3],M=0,S=0,A=-(v-b),w=x-y,T=0,C=0,F=Math.sqrt(A*A+w*w);A/=F,w/=F,A*=p,w*=p;const Y=r.alignment,O=2*(1-Y),D=2*Y;l||(r.cap===xr.ROUND?d+=vr(x-A*(O-D)*.5,v-w*(O-D)*.5,x-A*O,v-w*O,x+A*D,v+w*D,c,!0)+2:r.cap===xr.SQUARE&&(d+=P_(x,v,A,w,O,D,!0,c))),c.push(x-A*O,v-w*O),c.push(x+A*D,v+w*D);for(let j=1;j<u-1;++j){x=i[2*(j-1)],v=i[2*(j-1)+1],y=i[2*j],b=i[2*j+1],M=i[2*(j+1)],S=i[2*(j+1)+1],A=-(v-b),w=x-y,F=Math.sqrt(A*A+w*w),A/=F,w/=F,A*=p,w*=p,T=-(b-S),C=y-M,F=Math.sqrt(T*T+C*C),T/=F,C/=F,T*=p,C*=p;const $=y-x,et=v-b,ft=y-M,K=S-b,tt=$*ft+et*K,vt=et*ft-K*$,mt=vt<0;if(Math.abs(vt)<.001*Math.abs(tt)){c.push(y-A*O,b-w*O),c.push(y+A*D,b+w*D),tt>=0&&(d+=r.join===Ds.ROUND?vr(y,b,y-A*O,b-w*O,y-T*O,b-C*O,c,!1)+4:2,c.push(y-T*D,b-C*D),c.push(y+T*O,b+C*O));continue}const At=(-A+x)*(-w+b)-(-A+y)*(-w+v),it=(-T+M)*(-C+b)-(-T+y)*(-C+S),Qt=($*it-ft*At)/vt,Lt=(K*At-et*it)/vt,jt=(Qt-y)*(Qt-y)+(Lt-b)*(Lt-b),St=y+(Qt-y)*O,ae=b+(Lt-b)*O,lt=y-(Qt-y)*D,rt=b-(Lt-b)*D,Nt=mt?O:D;jt<=Math.min($*$+et*et,ft*ft+K*K)+Nt*Nt*m?r.join===Ds.BEVEL||jt/m>g?(mt?(c.push(St,ae),c.push(y+A*D,b+w*D),c.push(St,ae),c.push(y+T*D,b+C*D)):(c.push(y-A*O,b-w*O),c.push(lt,rt),c.push(y-T*O,b-C*O),c.push(lt,rt)),d+=2):r.join===Ds.ROUND?mt?(c.push(St,ae),c.push(y+A*D,b+w*D),d+=vr(y,b,y+A*D,b+w*D,y+T*D,b+C*D,c,!0)+4,c.push(St,ae),c.push(y+T*D,b+C*D)):(c.push(y-A*O,b-w*O),c.push(lt,rt),d+=vr(y,b,y-A*O,b-w*O,y-T*O,b-C*O,c,!1)+4,c.push(y-T*O,b-C*O),c.push(lt,rt)):(c.push(St,ae),c.push(lt,rt)):(c.push(y-A*O,b-w*O),c.push(y+A*D,b+w*D),r.join===Ds.ROUND?d+=mt?vr(y,b,y+A*D,b+w*D,y+T*D,b+C*D,c,!0)+2:vr(y,b,y-A*O,b-w*O,y-T*O,b-C*O,c,!1)+2:r.join===Ds.MITER&&jt/m<=g&&(mt?(c.push(lt,rt),c.push(lt,rt)):(c.push(St,ae),c.push(St,ae)),d+=2),c.push(y-T*O,b-C*O),c.push(y+T*D,b+C*D),d+=2)}x=i[2*(u-2)],v=i[2*(u-2)+1],y=i[2*(u-1)],b=i[2*(u-1)+1],A=-(v-b),w=x-y,F=Math.sqrt(A*A+w*w),A/=F,w/=F,A*=p,w*=p,c.push(y-A*O,b-w*O),c.push(y+A*D,b+w*D),l||(r.cap===xr.ROUND?d+=vr(y-A*(O-D)*.5,b-w*(O-D)*.5,y-A*O,b-w*O,y+A*D,b+w*D,c,!1)+2:r.cap===xr.SQUARE&&(d+=P_(y,b,A,w,O,D,!1,c)));const W=t.indices,X=ba.epsilon*ba.epsilon;for(let j=f;j<d+f-2;++j)x=c[2*j],v=c[2*j+1],y=c[2*(j+1)],b=c[2*(j+1)+1],M=c[2*(j+2)],S=c[2*(j+2)+1],!(Math.abs(x*(b-S)+y*(S-v)+M*(v-b))<X)&&W.push(j,j+1,j+2)}(n,t)}class wh{static curveLength(t,e,i,s,r,a){const o=t-2*i+r,l=e-2*s+a,h=2*i-2*t,c=2*s-2*e,u=4*(o*o+l*l),d=4*(o*h+l*c),f=h*h+c*c,p=2*Math.sqrt(u+d+f),m=Math.sqrt(u),g=2*u*m,x=2*Math.sqrt(f),v=d/m;return(g*p+m*d*(p-x)+(4*f*u-d*d)*Math.log((2*m+v+p)/(v+x)))/(4*g)}static curveTo(t,e,i,s,r){const a=r[r.length-2],o=r[r.length-1],l=ba._segmentsCount(wh.curveLength(a,o,t,e,i,s));let h=0,c=0;for(let u=1;u<=l;++u){const d=u/l;h=a+(t-a)*d,c=o+(e-o)*d,r.push(h+(t+(i-t)*d-h)*d,c+(e+(s-e)*d-c)*d)}}}const Mh={[Fi.POLY]:vd,[Fi.CIRC]:Mo,[Fi.ELIP]:Mo,[Fi.RECT]:R_,[Fi.RREC]:I_},Md=[],So=[];class Sh{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new Sh(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class D_{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const wa=new Le,L_=class extends dg{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new hh,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let n=0;n<this.drawCalls.length;n++)this.drawCalls[n].texArray.clear(),So.push(this.drawCalls[n]);this.drawCalls.length=0;for(let n=0;n<this.batches.length;n++){const t=this.batches[n];t.reset(),Md.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(n,t=null,e=null,i=null){const s=new Sh(n,t,e,i);return this.graphicsData.push(s),this.dirty++,this}drawHole(n,t=null){if(!this.graphicsData.length)return null;const e=new Sh(n,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=i.lineStyle,i.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let n=0;n<this.graphicsData.length;++n)this.graphicsData[n].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(n){const t=this.graphicsData;for(let e=0;e<t.length;++e){const i=t[e];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(n,wa):wa.copyFrom(n),i.shape.contains(wa.x,wa.y))){let s=!1;if(i.holes)for(let r=0;r<i.holes.length;r++)if(i.holes[r].shape.contains(wa.x,wa.y)){s=!0;break}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const n=this.uvs,t=this.graphicsData;let e=null,i=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],i=e.style);for(let o=this.shapeIndex;o<t.length;o++){this.shapeIndex++;const l=t[o],h=l.fillStyle,c=l.lineStyle;Mh[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=0===d?h:c;if(!f.visible)continue;const m=this.indices.length,g=this.points.length/2;f.texture.baseTexture.wrapMode=Es.REPEAT,0===d?this.processFill(l):this.processLine(l);const x=this.points.length/2-g;0!==x&&(e&&!this._compareStyles(i,f)&&(e.end(m,g),e=null),e||(e=Md.pop()||new D_,e.begin(f,m,g),this.batches.push(e),i=f),this.addUvs(this.points,n,f.texture,g,x,f.matrix))}}const r=this.points.length/2;if(e&&e.end(this.indices.length,r),0===this.batches.length)return void(this.batchable=!0);const a=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(n,t){return!(!n||!t||n.texture.baseTexture!==t.texture.baseTexture||n.color+n.alpha!==t.color+t.alpha||!!n.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let n=0,t=this.graphicsData.length;n<t;n++){const e=this.graphicsData[n],i=e.fillStyle,s=e.lineStyle;if(i&&!i.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const n=this.batches;for(let t=0,e=n.length;t<e;t++){const i=n[t];for(let s=0;s<i.size;s++){const r=i.start+s;this.indicesUint16[r]=this.indicesUint16[r]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const n=this.batches;for(let t=0;t<n.length;t++)if(n[t].style.native)return!1;return this.points.length<2*L_.BATCHABLE_SIZE}buildDrawCalls(){let n=++fe._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),So.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let i=So.pop();i||(i=new Wu,i.texArray=new ju),i.texArray.count=0,i.start=0,i.size=0,i.type=Hn.TRIANGLES;let s=0,r=null,a=0,o=!1,l=Hn.TRIANGLES,h=0;this.drawCalls.push(i);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;o!==!!f.native&&(o=!!f.native,l=o?Hn.LINES:Hn.TRIANGLES,r=null,s=d,n++),r!==p&&(r=p,p._batchEnabled!==n&&(s===d&&(n++,s=0,i.size>0&&(i=So.pop(),i||(i=new Wu,i.texArray=new ju),this.drawCalls.push(i)),i.start=h,i.size=0,i.texArray.count=0,i.type=l),p.touched=1,p._batchEnabled=n,p._batchLocation=s,p.wrapMode=Es.REPEAT,i.texArray.elements[i.texArray.count++]=p,s++)),i.size+=u.size,h+=u.size,a=p._batchLocation,this.addColors(t,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(e,a,u.attribSize,u.attribStart)}fe._globalBatch=n,this.packAttributes()}packAttributes(){const n=this.points,t=this.uvs,e=this.colors,i=this.textureIds,s=new ArrayBuffer(3*n.length*4),r=new Float32Array(s),a=new Uint32Array(s);let o=0;for(let l=0;l<n.length/2;l++)r[o++]=n[2*l],r[o++]=n[2*l+1],r[o++]=t[2*l],r[o++]=t[2*l+1],a[o++]=e[l],r[o++]=i[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(n){n.holes.length?vd.triangulate(n,this):Mh[n.type].triangulate(n,this)}processLine(n){wd(n,this);for(let t=0;t<n.holes.length;t++)wd(n.holes[t],this)}processHoles(n){for(let t=0;t<n.length;t++){const e=n[t];Mh[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const n=this._bounds;n.clear(),n.addVertexData(this.points,0,this.points.length),n.pad(this.boundsPadding,this.boundsPadding)}transformPoints(n,t){for(let e=0;e<n.length/2;e++){const i=n[2*e],s=n[2*e+1];n[2*e]=t.a*i+t.c*s+t.tx,n[2*e+1]=t.b*i+t.d*s+t.ty}}addColors(n,t,e,i,s=0){const a=Du((t>>16)+(65280&t)+((255&t)<<16),e);n.length=Math.max(n.length,s+i);for(let o=0;o<i;o++)n[s+o]=a}addTextureIds(n,t,e,i=0){n.length=Math.max(n.length,i+e);for(let s=0;s<e;s++)n[i+s]=t}addUvs(n,t,e,i,s,r=null){let a=0;const o=t.length,l=e.frame;for(;a<s;){let c=n[2*(i+a)],u=n[2*(i+a)+1];if(r){const d=r.a*c+r.c*u+r.tx;u=r.b*c+r.d*u+r.ty,c=d}a++,t.push(c/l.width,u/l.height)}const h=e.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(t,e,o,s)}adjustUvs(n,t,e,i){const s=t.baseTexture,r=1e-6,a=e+2*i,o=t.frame,l=o.width/s.width,h=o.height/s.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(n[e]+r),f=Math.floor(n[e+1]+r);for(let p=e+2;p<a;p+=2)d=Math.min(d,Math.floor(n[p]+r)),f=Math.min(f,Math.floor(n[p+1]+r));c-=d,u-=f;for(let p=e;p<a;p+=2)n[p]=(n[p]+c)*l,n[p+1]=(n[p+1]+u)*h}};let O_=L_;O_.BATCHABLE_SIZE=100;class Th{constructor(){this.color=16777215,this.alpha=1,this.texture=Wt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Th;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Wt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Sd extends Th{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=xr.BUTT,this.join=Ds.MITER,this.miterLimit=10}clone(){const t=new Sd;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const fI=new Float32Array(3),Td={},Eh=class extends vn{constructor(n=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Th,this._lineStyle=new Sd,this._matrix=null,this._holeMode=!1,this.state=us.for2d(),this._geometry=n||new O_,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=re.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Eh(this._geometry)}set blendMode(n){this.state.blendMode=n}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(n){this._tint=n}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(n=null,t=0,e=1,i=.5,s=!1){return"number"==typeof n&&(n={width:n,color:t,alpha:e,alignment:i,native:s}),this.lineTextureStyle(n)}lineTextureStyle(n){n=Object.assign({width:0,texture:Wt.WHITE,color:n?.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:xr.BUTT,join:Ds.MITER,miterLimit:10},n),this.currentPath&&this.startPoly();const t=n.width>0&&n.alpha>0;return t?(n.matrix&&(n.matrix=n.matrix.clone(),n.matrix.invert()),Object.assign(this._lineStyle,{visible:t},n)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const n=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new pa,this.currentPath.closeStroke=!1,this.currentPath.points.push(n[t-2],n[t-1]))}else this.currentPath=new pa,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(n,t){return this.startPoly(),this.currentPath.points[0]=n,this.currentPath.points[1]=t,this}lineTo(n,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points;return(e[e.length-2]!==n||e[e.length-1]!==t)&&e.push(n,t),this}_initCurve(n=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[n,t]):this.moveTo(n,t)}quadraticCurveTo(n,t,e,i){this._initCurve();const s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),wh.curveTo(n,t,e,i,s),this}bezierCurveTo(n,t,e,i,s,r){return this._initCurve(),bh.curveTo(n,t,e,i,s,r,this.currentPath.points),this}arcTo(n,t,e,i,s){this._initCurve(n,t);const a=bd.curveTo(n,t,e,i,s,this.currentPath.points);if(a){const{cx:o,cy:l,radius:h,startAngle:c,endAngle:u,anticlockwise:d}=a;this.arc(o,l,h,c,u,d)}return this}arc(n,t,e,i,s,r=!1){if(i===s)return this;if(!r&&s<=i?s+=ql:r&&i<=s&&(i+=ql),s-i==0)return this;const o=n+Math.cos(i)*e,l=t+Math.sin(i)*e,h=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-o),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(o,l)}else this.moveTo(o,l),c=this.currentPath.points;return bd.arc(o,l,n,t,e,i,s,r,c),this}beginFill(n=0,t=1){return this.beginTextureFill({texture:Wt.WHITE,color:n,alpha:t})}beginTextureFill(n){n=Object.assign({texture:Wt.WHITE,color:16777215,alpha:1,matrix:null},n),this.currentPath&&this.startPoly();const t=n.alpha>0;return t?(n.matrix&&(n.matrix=n.matrix.clone(),n.matrix.invert()),Object.assign(this._fillStyle,{visible:t},n)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(n,t,e,i){return this.drawShape(new Ae(n,t,e,i))}drawRoundedRect(n,t,e,i,s){return this.drawShape(new Zu(n,t,e,i,s))}drawCircle(n,t,e){return this.drawShape(new Xu(n,t,e))}drawEllipse(n,t,e,i){return this.drawShape(new Yu(n,t,e,i))}drawPolygon(...n){let t,e=!0;const i=n[0];i.points?(e=i.closeStroke,t=i.points):t=Array.isArray(n[0])?n[0]:n;const s=new pa(t);return s.closeStroke=e,this.drawShape(s),this}drawShape(n){return this._holeMode?this._geometry.drawHole(n,this._matrix):this._geometry.drawShape(n,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const n=this._geometry.graphicsData;return!(1!==n.length||n[0].shape.type!==Fi.RECT||n[0].matrix||n[0].holes.length||n[0].lineStyle.visible&&n[0].lineStyle.width)}_render(n){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(n)):(n.batch.flush(),this._renderDirect(n))}_populateBatches(){const n=this._geometry,t=this.blendMode,e=n.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=n.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(n.points);for(let i=0;i<e;i++){const s=n.batches[i],r=s.style.color,a=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),o=new Float32Array(n.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),h={vertexData:a,blendMode:t,indices:new Uint16Array(n.indicesUint16.buffer,2*s.start,s.size),uvs:o,_batchRGB:ho(r),_tintRGB:r,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[i]=h}}_renderBatched(n){if(this.batches.length){n.batch.setObjectRenderer(n.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,n.plugins[this.pluginName].render(i)}}}_renderDirect(n){const t=this._resolveDirectShader(n),e=this._geometry,i=this.tint,s=this.worldAlpha,r=t.uniforms,a=e.drawCalls;r.translationMatrix=this.transform.worldTransform,r.tint[0]=(i>>16&255)/255*s,r.tint[1]=(i>>8&255)/255*s,r.tint[2]=(255&i)/255*s,r.tint[3]=s,n.shader.bind(t),n.geometry.bind(e,t),n.state.set(this.state);for(let o=0,l=a.length;o<l;o++)this._renderDrawCallDirect(n,e.drawCalls[o])}_renderDrawCallDirect(n,t){const{texArray:e,type:i,size:s,start:r}=t,a=e.count;for(let o=0;o<a;o++)n.texture.bind(e.elements[o],o);n.geometry.draw(i,s,r)}_resolveDirectShader(n){let t=this.shader;const e=this.pluginName;if(!t){if(!Td[e]){const{maxTextures:i}=n.plugins[e],s=new Int32Array(i);for(let o=0;o<i;o++)s[o]=o;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new ei,default:Pn.from({uSamplers:s},!0)};Td[e]=new Yn(n.plugins[e]._shader.program,r)}t=Td[e]}return t}_calculateBounds(){this.finishPoly();const n=this._geometry;if(!n.graphicsData.length)return;const{minX:t,minY:e,maxX:i,maxY:s}=n.bounds;this._bounds.addFrame(this.transform,t,e,i,s)}containsPoint(n){return this.worldTransform.applyInverse(n,Eh._TEMP_POINT),this._geometry.containsPoint(Eh._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const n=ho(this.tint,fI);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],i=e._batchRGB,o=(n[0]*i[0]*255<<16)+(n[1]*i[1]*255<<8)+(0|n[2]*i[2]*255);e._tintRGB=(o>>16)+(65280&o)+((255&o)<<16)}}}calculateVertices(){const n=this.transform._worldID;if(this._transformID===n)return;this._transformID=n;const t=this.transform.worldTransform,e=t.a,i=t.b,s=t.c,r=t.d,a=t.tx,o=t.ty,l=this._geometry.points,h=this.vertexData;let c=0;for(let u=0;u<l.length;u+=2){const d=l[u],f=l[u+1];h[c++]=e*d+s*f+a,h[c++]=r*f+i*d+o}}closePath(){const n=this.currentPath;return n&&(n.closeStroke=!0,this.finishPoly()),this}setMatrix(n){return this._matrix=n,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(n){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(n)}};let Ma=Eh;Ma.curves=ba,Ma._TEMP_POINT=new Le;class pI{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Ed=new Le,B_=new pa,F_=class extends vn{constructor(n,t,e,i=Hn.TRIANGLES){super(),this.geometry=n,this.shader=t,this.state=e||us.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Ft.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(n){this._geometry!==n&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=n,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(n){this.shader=n}get material(){return this.shader}set blendMode(n){this.state.blendMode=n}get blendMode(){return this.state.blendMode}set roundPixels(n){this._roundPixels!==n&&(this._transformID=-1),this._roundPixels=n}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(n){this.shader.tint=n}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(n){this.shader.texture=n}_render(n){this.shader.batchable&&this.drawMode===Hn.TRIANGLES&&this.geometry.buffers[0].data.length<2*F_.BATCHABLE_SIZE?this._renderToBatch(n):this._renderDefault(n)}_renderDefault(n){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),n.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),n.shader.bind(t),n.state.set(this.state),n.geometry.bind(this.geometry,t),n.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(n){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const i=this.material.pluginName;n.batch.setObjectRenderer(n.plugins[i]),n.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,r=s.a,a=s.b,o=s.c,l=s.d,h=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=e[2*d],p=e[2*d+1];u[2*d]=r*f+o*p+h,u[2*d+1]=a*f+l*p+c}if(this._roundPixels){const d=Ft.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=i}calculateUvs(){const n=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=n.data:(this.batchUvs||(this.batchUvs=new pI(n,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(n){if(!this.getBounds().contains(n.x,n.y))return!1;this.worldTransform.applyInverse(n,Ed);const t=this.geometry.getBuffer("aVertexPosition").data,e=B_.points,i=this.geometry.getIndex().data,s=i.length,r=4===this.drawMode?3:1;for(let a=0;a+2<s;a+=r){const o=2*i[a],l=2*i[a+1],h=2*i[a+2];if(e[0]=t[o],e[1]=t[o+1],e[2]=t[l],e[3]=t[l+1],e[4]=t[h],e[5]=t[h+1],B_.contains(Ed.x,Ed.y))return!0}return!1}destroy(n){super.destroy(n),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Ad=F_;Ad.BATCHABLE_SIZE=100;class mI extends Cs{constructor(t,e,i){super();const s=new pi(t),r=new pi(e,!0),a=new pi(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,Kt.FLOAT).addAttribute("aTextureCoord",r,2,!1,Kt.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class N_ extends Yn{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:ei.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||In.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new Lg(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){this._colorDirty&&(this._colorDirty=!1,eg(this._tint,this._alpha,this.uniforms.uColor,this.texture.baseTexture.alphaMode)),this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class U_{constructor(t,e,i){this.geometry=new Cs,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let r=t[s];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||Kt.FLOAT,offset:r.offset},e[s]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new pi(function lA(n,t=null){const e=6*n;if((t=t||new Uint16Array(e)).length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=e,e+=o.size,this.dynamicStride+=o.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new pi(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=s,s+=o.size,this.staticStride+=o.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new pi(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===Kt.UNSIGNED_BYTE,o.type,4*this.dynamicStride,4*o.offset)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===Kt.UNSIGNED_BYTE,o.type,4*this.staticStride,4*o.offset)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){const r=this.dynamicProperties[s];r.uploadFunction(t,e,i,r.type===Kt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){const r=this.staticProperties[s];r.uploadFunction(t,e,i,r.type===Kt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class k_ extends ih{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new ei,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Kt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Yn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=us.for2d()}render(t){const e=t.children,i=t._maxSize,s=t._batchSize,r=this.renderer;let a=e.length;if(0===a)return;a>i&&!t.autoResize&&(a=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const l=e[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=tg(t.blendMode,h),r.state.set(this.state);const c=r.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=function aA(n,t,e,i){return e=e||new Float32Array(4),i||void 0===i?(e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t):(e[0]=n[0],e[1]=n[1],e[2]=n[2]),e[3]=t,e}(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,h),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<a;f+=s,p+=1){let m=a-f;m>s&&(m=s),p>=o.length&&o.push(this._generateOneMoreBuffer(t));const g=o[p];g.uploadDynamic(e,f,m);const x=t._bufferUpdateIDs[p]||0;d=d||g._updateID<x,d&&(g._updateID=t._updateID,g.uploadStatic(e,f,m)),r.geometry.bind(g.geometry),c.drawElements(c.TRIANGLES,6*m,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,s=t._batchSize,r=t._properties;for(let a=0;a<i;a+=s)e.push(new U_(this.properties,r,s));return e}_generateOneMoreBuffer(t){return new U_(this.properties,t._properties,t._batchSize)}uploadVertices(t,e,i,s,r,a){let o=0,l=0,h=0,c=0;for(let u=0;u<i;++u){const d=t[e+u],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,x=f.orig;g?(l=g.x-d.anchor.x*x.width,o=l+g.width,c=g.y-d.anchor.y*x.height,h=c+g.height):(o=x.width*(1-d.anchor.x),l=x.width*-d.anchor.x,h=x.height*(1-d.anchor.y),c=x.height*-d.anchor.y),s[a]=l*p,s[a+1]=c*m,s[a+r]=o*p,s[a+r+1]=c*m,s[a+2*r]=o*p,s[a+2*r+1]=h*m,s[a+3*r]=l*p,s[a+3*r+1]=h*m,a+=4*r}}uploadPosition(t,e,i,s,r,a){for(let o=0;o<i;o++){const l=t[e+o].position;s[a]=l.x,s[a+1]=l.y,s[a+r]=l.x,s[a+r+1]=l.y,s[a+2*r]=l.x,s[a+2*r+1]=l.y,s[a+3*r]=l.x,s[a+3*r+1]=l.y,a+=4*r}}uploadRotation(t,e,i,s,r,a){for(let o=0;o<i;o++){const l=t[e+o].rotation;s[a]=l,s[a+r]=l,s[a+2*r]=l,s[a+3*r]=l,a+=4*r}}uploadUvs(t,e,i,s,r,a){for(let o=0;o<i;++o){const l=t[e+o]._texture._uvs;l?(s[a]=l.x0,s[a+1]=l.y0,s[a+r]=l.x1,s[a+r+1]=l.y1,s[a+2*r]=l.x2,s[a+2*r+1]=l.y2,s[a+3*r]=l.x3,s[a+3*r+1]=l.y3,a+=4*r):(s[a]=0,s[a+1]=0,s[a+r]=0,s[a+r+1]=0,s[a+2*r]=0,s[a+2*r+1]=0,s[a+3*r]=0,s[a+3*r+1]=0,a+=4*r)}}uploadTint(t,e,i,s,r,a){for(let o=0;o<i;++o){const l=t[e+o],h=l._texture.baseTexture.alphaMode>0,c=l.alpha,u=c<1&&h?Du(l._tintRGB,c):l._tintRGB+(255*c<<24);s[a]=u,s[a+r]=u,s[a+2*r]=u,s[a+3*r]=u,a+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}k_.extension={name:"particle",type:Pt.RendererPlugin},Yt.add(k_);var Ch=(n=>(n[n.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",n[n.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",n))(Ch||{});const Rh={willReadFrequently:!0},Ht=class{static get experimentalLetterSpacingSupported(){let n=Ht._experimentalLetterSpacingSupported;if(void 0!==n){const t=Ft.ADAPTER.getCanvasRenderingContext2D().prototype;n=Ht._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return n}constructor(n,t,e,i,s,r,a,o,l){this.text=n,this.style=t,this.width=e,this.height=i,this.lines=s,this.lineWidths=r,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=l}static measureText(n,t,e,i=Ht._canvas){e=e??t.wordWrap;const s=t.toFontString(),r=Ht.measureFont(s);0===r.fontSize&&(r.fontSize=t.fontSize,r.ascent=t.fontSize);const a=i.getContext("2d",Rh);a.font=s;const l=(e?Ht.wordWrap(n,t,i):n).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let c=0;for(let p=0;p<l.length;p++){const m=Ht._measureText(l[p],t.letterSpacing,a);h[p]=m,c=Math.max(c,m)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||r.fontSize+t.strokeThickness;let f=Math.max(d,r.fontSize+2*t.strokeThickness)+(l.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new Ht(n,t,u,f,l,h,d+t.leading,c,r)}static _measureText(n,t,e){let i=!1;Ht.experimentalLetterSpacingSupported&&(Ht.experimentalLetterSpacing?(e.letterSpacing=`${t}px`,e.textLetterSpacing=`${t}px`,i=!0):(e.letterSpacing="0px",e.textLetterSpacing="0px"));let s=e.measureText(n).width;return s>0&&(i?s-=t:s+=(Ht.graphemeSegmenter(n).length-1)*t),s}static wordWrap(n,t,e=Ht._canvas){const i=e.getContext("2d",Rh);let s=0,r="",a="";const o=Object.create(null),{letterSpacing:l,whiteSpace:h}=t,c=Ht.collapseSpaces(h),u=Ht.collapseNewlines(h);let d=!c;const f=t.wordWrapWidth+l,p=Ht.tokenize(n);for(let m=0;m<p.length;m++){let g=p[m];if(Ht.isNewline(g)){if(!u){a+=Ht.addLine(r),d=!c,r="",s=0;continue}g=" "}if(c){const v=Ht.isBreakingSpace(g),y=Ht.isBreakingSpace(r[r.length-1]);if(v&&y)continue}const x=Ht.getFromCache(g,l,o,i);if(x>f)if(""!==r&&(a+=Ht.addLine(r),r="",s=0),Ht.canBreakWords(g,t.breakWords)){const v=Ht.wordWrapSplit(g);for(let y=0;y<v.length;y++){let b=v[y],M=b,S=1;for(;v[y+S];){const w=v[y+S];if(Ht.canBreakChars(M,w,g,y,t.breakWords))break;b+=w,M=w,S++}y+=S-1;const A=Ht.getFromCache(b,l,o,i);A+s>f&&(a+=Ht.addLine(r),d=!1,r="",s=0),r+=b,s+=A}}else r.length>0&&(a+=Ht.addLine(r),r="",s=0),a+=Ht.addLine(g,!(m===p.length-1)),d=!1,r="",s=0;else x+s>f&&(d=!1,a+=Ht.addLine(r),r="",s=0),(r.length>0||!Ht.isBreakingSpace(g)||d)&&(r+=g,s+=x)}return a+=Ht.addLine(r,!1),a}static addLine(n,t=!0){return n=Ht.trimRight(n),t?`${n}\n`:n}static getFromCache(n,t,e,i){let s=e[n];return"number"!=typeof s&&(s=Ht._measureText(n,t,i)+t,e[n]=s),s}static collapseSpaces(n){return"normal"===n||"pre-line"===n}static collapseNewlines(n){return"normal"===n}static trimRight(n){if("string"!=typeof n)return"";for(let t=n.length-1;t>=0&&Ht.isBreakingSpace(n[t]);t--)n=n.slice(0,-1);return n}static isNewline(n){return"string"==typeof n&&Ht._newlines.includes(n.charCodeAt(0))}static isBreakingSpace(n,t){return"string"==typeof n&&Ht._breakingSpaces.includes(n.charCodeAt(0))}static tokenize(n){const t=[];let e="";if("string"!=typeof n)return t;for(let i=0;i<n.length;i++){const s=n[i];Ht.isBreakingSpace(s,n[i+1])||Ht.isNewline(s)?(""!==e&&(t.push(e),e=""),t.push(s)):e+=s}return""!==e&&t.push(e),t}static canBreakWords(n,t){return t}static canBreakChars(n,t,e,i,s){return!0}static wordWrapSplit(n){return Ht.graphemeSegmenter(n)}static measureFont(n){if(Ht._fonts[n])return Ht._fonts[n];const t={ascent:0,descent:0,fontSize:0},e=Ht._canvas,i=Ht._context;i.font=n;const s=Ht.METRICS_STRING+Ht.BASELINE_SYMBOL,r=Math.ceil(i.measureText(s).width);let a=Math.ceil(i.measureText(Ht.BASELINE_SYMBOL).width);const o=Math.ceil(Ht.HEIGHT_MULTIPLIER*a);if(a=a*Ht.BASELINE_MULTIPLIER|0,0===r||0===o)return Ht._fonts[n]=t,t;e.width=r,e.height=o,i.fillStyle="#f00",i.fillRect(0,0,r,o),i.font=n,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(s,0,a);const l=i.getImageData(0,0,r,o).data,h=l.length,c=4*r;let u=0,d=0,f=!1;for(u=0;u<a;++u){for(let p=0;p<c;p+=4)if(255!==l[d+p]){f=!0;break}if(f)break;d+=c}for(t.ascent=a-u,d=h-c,f=!1,u=o;u>a;--u){for(let p=0;p<c;p+=4)if(255!==l[d+p]){f=!0;break}if(f)break;d-=c}return t.descent=u-a,t.fontSize=t.ascent+t.descent,Ht._fonts[n]=t,t}static clearMetrics(n=""){n?delete Ht._fonts[n]:Ht._fonts={}}static get _canvas(){if(!Ht.__canvas){let n;try{const t=new OffscreenCanvas(0,0);if(t.getContext("2d",Rh)?.measureText)return Ht.__canvas=t,t;n=Ft.ADAPTER.createCanvas()}catch{n=Ft.ADAPTER.createCanvas()}n.width=n.height=10,Ht.__canvas=n}return Ht.__canvas}static get _context(){return Ht.__context||(Ht.__context=Ht._canvas.getContext("2d",Rh)),Ht.__context}};let Ui=Ht;Ui.METRICS_STRING="|\xc9q\xc5",Ui.BASELINE_SYMBOL="M",Ui.BASELINE_MULTIPLIER=1.4,Ui.HEIGHT_MULTIPLIER=2,Ui.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const n=new Intl.Segmenter;return t=>[...n.segment(t)].map(e=>e.segment)}return n=>[...n]})(),Ui.experimentalLetterSpacing=!1,Ui._fonts={},Ui._newlines=[10,13],Ui._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const vI=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],To=class{constructor(n){this.styleID=0,this.reset(),Rd(this,n,n)}clone(){const n={};return Rd(n,this,To.defaultStyle),new To(n)}reset(){Rd(this,To.defaultStyle,To.defaultStyle)}get align(){return this._align}set align(n){this._align!==n&&(this._align=n,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(n){this._breakWords!==n&&(this._breakWords=n,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(n){this._dropShadow!==n&&(this._dropShadow=n,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(n){this._dropShadowAlpha!==n&&(this._dropShadowAlpha=n,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(n){this._dropShadowAngle!==n&&(this._dropShadowAngle=n,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(n){this._dropShadowBlur!==n&&(this._dropShadowBlur=n,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(n){const t=Cd(n);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(n){this._dropShadowDistance!==n&&(this._dropShadowDistance=n,this.styleID++)}get fill(){return this._fill}set fill(n){const t=Cd(n);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(n){this._fillGradientType!==n&&(this._fillGradientType=n,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(n){(function bI(n,t){if(!Array.isArray(n)||!Array.isArray(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0})(this._fillGradientStops,n)||(this._fillGradientStops=n,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(n){this.fontFamily!==n&&(this._fontFamily=n,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(n){this._fontSize!==n&&(this._fontSize=n,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(n){this._fontStyle!==n&&(this._fontStyle=n,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(n){this._fontVariant!==n&&(this._fontVariant=n,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(n){this._fontWeight!==n&&(this._fontWeight=n,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(n){this._letterSpacing!==n&&(this._letterSpacing=n,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(n){this._lineHeight!==n&&(this._lineHeight=n,this.styleID++)}get leading(){return this._leading}set leading(n){this._leading!==n&&(this._leading=n,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(n){this._lineJoin!==n&&(this._lineJoin=n,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(n){this._miterLimit!==n&&(this._miterLimit=n,this.styleID++)}get padding(){return this._padding}set padding(n){this._padding!==n&&(this._padding=n,this.styleID++)}get stroke(){return this._stroke}set stroke(n){const t=Cd(n);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(n){this._strokeThickness!==n&&(this._strokeThickness=n,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(n){this._textBaseline!==n&&(this._textBaseline=n,this.styleID++)}get trim(){return this._trim}set trim(n){this._trim!==n&&(this._trim=n,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(n){this._whiteSpace!==n&&(this._whiteSpace=n,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(n){this._wordWrap!==n&&(this._wordWrap=n,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(n){this._wordWrapWidth!==n&&(this._wordWrapWidth=n,this.styleID++)}toFontString(){const n="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let i=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!vI.includes(i)&&(i=`"${i}"`),t[e]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${n} ${t.join(",")}`}};let br=To;function G_(n){return"number"==typeof n?Km(n):("string"==typeof n&&n.startsWith("0x")&&(n=n.replace("0x","#")),n)}function Cd(n){if(Array.isArray(n)){for(let t=0;t<n.length;++t)n[t]=G_(n[t]);return n}return G_(n)}function Rd(n,t,e){for(const i in e)n[i]=Array.isArray(t[i])?t[i].slice():t[i]}br.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ch.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const wI={texture:!0,children:!1,baseTexture:!0},Id=class extends xo{constructor(n,t,e){let i=!1;e||(e=Ft.ADAPTER.createCanvas(),i=!0),e.width=3,e.height=3;const s=Wt.from(e);s.orig=new Ae,s.trim=new Ae,super(s),this._ownCanvas=i,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=Id.defaultResolution??Ft.RESOLUTION,this._autoResolution=Id.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=n,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ui.experimentalLetterSpacing}static set experimentalLetterSpacing(n){De("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ui.experimentalLetterSpacing=n}updateText(n){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&n)return;this._font=this._style.toFontString();const e=this.context,i=Ui.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=i.height,a=i.lines,o=i.lineHeight,l=i.lineWidths,h=i.maxLineWidth,c=i.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i.width)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+2*t.padding)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;const f=t.dropShadow?2:1;for(let p=0;p<f;++p){const m=t.dropShadow&&0===p,g=m?Math.ceil(Math.max(1,r)+2*t.padding):0,x=g*this._resolution;if(m){e.fillStyle="black",e.strokeStyle="black";const y=t.dropShadowColor,b=ho("number"==typeof y?y:Pu(y)),M=t.dropShadowBlur*this._resolution,S=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${255*b[0]},${255*b[1]},${255*b[2]},${t.dropShadowAlpha})`,e.shadowBlur=M,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*S,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*S+x}else e.fillStyle=this._generateFillStyle(t,a,i),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let v=(o-c.fontSize)/2;o-c.fontSize<0&&(v=0);for(let y=0;y<a.length;y++)u=t.strokeThickness/2,d=t.strokeThickness/2+y*o+c.ascent+v,"right"===t.align?u+=h-l[y]:"center"===t.align&&(u+=(h-l[y])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[y],u+t.padding,d+t.padding-g,!0),t.fill&&this.drawLetterSpacing(a[y],u+t.padding,d+t.padding-g)}this.updateTexture()}drawLetterSpacing(n,t,e,i=!1){const r=this._style.letterSpacing;let a=!1;if(Ui.experimentalLetterSpacingSupported&&(Ui.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||a)return void(i?this.context.strokeText(n,t,e):this.context.fillText(n,t,e));let o=t;const l=Ui.graphemeSegmenter(n);let h=this.context.measureText(n).width,c=0;for(let u=0;u<l.length;++u){const d=l[u];i?this.context.strokeText(d,o,e):this.context.fillText(d,o,e);let f="";for(let p=u+1;p<l.length;++p)f+=l[p];c=this.context.measureText(f).width,o+=h-c+r,h=c}}updateTexture(){const n=this.canvas;if(this._style.trim){const r=function dA(n){const t=function uA(n){const{width:t,height:e}=n,i=n.getContext("2d",{willReadFrequently:!0});if(null===i)throw new TypeError("Failed to get canvas 2D context");const r=i.getImageData(0,0,t,e).data;let a=0,o=0,l=t-1,h=e-1;for(;o<e&&og(r,t,o);)++o;if(o===e)return Ou.EMPTY;for(;og(r,t,h);)--h;for(;lg(r,t,a,o,h);)++a;for(;lg(r,t,l,o,h);)--l;return++l,++h,new Ou(a,o,l,h)}(n),{width:e,height:i}=t;let s=null;if(!t.isEmpty()){const r=n.getContext("2d");if(null===r)throw new TypeError("Failed to get canvas 2D context");s=r.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}(n);r.data&&(n.width=r.width,n.height=r.height,this.context.putImageData(r.data,0,0))}const t=this._texture,e=this._style,i=e.trim?0:e.padding,s=t.baseTexture;t.trim.width=t._frame.width=n.width/this._resolution,t.trim.height=t._frame.height=n.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-2*i,t.orig.height=t._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(n.width,n.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(n){this._autoResolution&&this._resolution!==n.resolution&&(this._resolution=n.resolution,this.dirty=!0),this.updateText(!0),super._render(n)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(n,t){return this.updateText(!0),-1===this._textureID&&(n=!1),super.getBounds(n,t)}getLocalBounds(n){return this.updateText(!0),super.getLocalBounds.call(this,n)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(n,t,e){const i=n.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let s;const r=n.dropShadow?n.dropShadowDistance:0,a=n.padding||0,o=this.canvas.width/this._resolution-r-2*a,l=this.canvas.height/this._resolution-r-2*a,h=i.slice(),c=n.fillGradientStops.slice();if(!c.length){const u=h.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(h.unshift(i[0]),c.unshift(0),h.push(i[i.length-1]),c.push(1),n.fillGradientType===Ch.LINEAR_VERTICAL){s=this.context.createLinearGradient(o/2,a,o/2,l+a);const u=e.fontProperties.fontSize+n.strokeThickness;for(let d=0;d<t.length;d++){const f=e.lineHeight*(d-1)+u,p=e.lineHeight*d;let m=p;d>0&&f>p&&(m=(p+f)/2);const g=p+u,x=e.lineHeight*(d+1);let v=g;d+1<t.length&&x<g&&(v=(g+x)/2);const y=(v-m)/l;for(let b=0;b<h.length;b++){let M=0;M="number"==typeof c[b]?c[b]:b/h.length;let S=Math.min(1,Math.max(0,m/l+M*y));S=Number(S.toFixed(5)),s.addColorStop(S,h[b])}}}else{s=this.context.createLinearGradient(a,l/2,o+a,l/2);const u=h.length+1;let d=1;for(let f=0;f<h.length;f++){let p;p="number"==typeof c[f]?c[f]:d/u,s.addColorStop(p,h[f]),d++}}return s}destroy(n){"boolean"==typeof n&&(n={children:n}),n=Object.assign({},wI,n),super.destroy(n),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(n){this.updateText(!0);const t=da(this.scale.x)||1;this.scale.x=t*n/this._texture.orig.width,this._width=n}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(n){this.updateText(!0);const t=da(this.scale.y)||1;this.scale.y=t*n/this._texture.orig.height,this._height=n}get style(){return this._style}set style(n){this._style=(n=n||{})instanceof br?n:new br(n),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(n){n=String(n??""),this._text!==n&&(this._text=n,this.dirty=!0)}get resolution(){return this._resolution}set resolution(n){this._autoResolution=!1,this._resolution!==n&&(this._resolution=n,this.dirty=!0)}};let Pd=Id;Pd.defaultAutoResolution=!0;class MI{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function SI(n,t){let e=!1;if(n?._textures?.length)for(let i=0;i<n._textures.length;i++)if(n._textures[i]instanceof Wt){const s=n._textures[i].baseTexture;t.includes(s)||(t.push(s),e=!0)}return e}function TI(n,t){if(n.baseTexture instanceof fe){const e=n.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function EI(n,t){if(n._texture&&n._texture instanceof Wt){const e=n._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function AI(n,t){return t instanceof Pd&&(t.updateText(!0),!0)}function CI(n,t){if(t instanceof br){const e=t.toFontString();return Ui.measureFont(e),!0}return!1}function RI(n,t){if(n instanceof Pd){t.includes(n.style)||t.push(n.style),t.includes(n)||t.push(n);const e=n._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function II(n,t){return n instanceof br&&(t.includes(n)||t.push(n),!0)}const z_=class{constructor(n){this.limiter=new MI(z_.uploadsPerFrame),this.renderer=n,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(RI),this.registerFindHook(II),this.registerFindHook(SI),this.registerFindHook(TI),this.registerFindHook(EI),this.registerUploadHook(AI),this.registerUploadHook(CI)}upload(n){return new Promise(t=>{n&&this.add(n),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,tn.system.addOnce(this.tick,this,_a.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const n=this.queue[0];let t=!1;if(n&&!n._destroyed)for(let e=0,i=this.uploadHooks.length;e<i;e++)if(this.uploadHooks[e](this.uploadHookHelper,n)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)tn.system.addOnce(this.tick,this,_a.UTILITY);else{this.ticking=!1;const n=this.completes.slice(0);this.completes.length=0;for(let t=0,e=n.length;t<e;t++)n[t]()}}registerFindHook(n){return n&&this.addHooks.push(n),this}registerUploadHook(n){return n&&this.uploadHooks.push(n),this}add(n){for(let t=0,e=this.addHooks.length;t<e&&!this.addHooks[t](n,this.queue);t++);if(n instanceof vn)for(let t=n.children.length-1;t>=0;t--)this.add(n.children[t]);return this}destroy(){this.ticking&&tn.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Ih=z_;function H_(n,t){return t instanceof fe&&(t._glTextures[n.CONTEXT_UID]||n.texture.bind(t),!0)}function PI(n,t){if(!(t instanceof Ma))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let s=0;s<i.length;s++){const{texture:r}=i[s].style;r&&H_(n,r.baseTexture)}return e.batchable||n.geometry.bind(e,t._resolveDirectShader(n)),!0}function DI(n,t){return n instanceof Ma&&(t.push(n),!0)}Ih.uploadsPerFrame=4,Object.defineProperties(Ft,{UPLOADS_PER_FRAME:{get:()=>Ih.uploadsPerFrame,set(n){De("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ih.uploadsPerFrame=n}}});class V_ extends Ih{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(DI),this.registerUploadHook(H_),this.registerUploadHook(PI)}}V_.extension={name:"prepare",type:Pt.RendererSystem},Yt.add(V_),new Le;var X_="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Ph=new ei;class Y_ extends ih{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Cg,this.state=us.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Yn.from(X_,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Yn.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Yn.from(X_,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-r,s[1]=s[3]=-a,s[2]=s[4]=1-r,s[5]=s[7]=1-a,i.invalidate();const o=t._texture,l=o.baseTexture,h=l.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=l.isPowerOfTwo&&o.frame.width===l.width&&o.frame.height===l.height;d&&(l._glTextures[e.CONTEXT_UID]?d=l.wrapMode!==Es.CLAMP:l.wrapMode===Es.CLAMP&&(l.wrapMode=Es.REPEAT));const f=d?this.simpleShader:this.shader,p=o.width,m=o.height,g=t._width,x=t._height;Ph.set(c.a*p/g,c.b*p/x,c.c*m/g,c.d*m/x,c.tx/g,c.ty/x),Ph.invert(),d?Ph.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=Ph.toArray(!0),f.uniforms.uColor=eg(t.tint,t.worldAlpha,f.uniforms.uColor,h),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,e.shader.bind(f),e.geometry.bind(i),this.state.blendMode=tg(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Y_.extension={name:"tilingSprite",type:Pt.RendererPlugin},Yt.add(Y_);const Ao=class{constructor(n,t,e=null){this.linkedSheets=[],this._texture=n instanceof Wt?n:null,this.baseTexture=n instanceof fe?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(e||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(n=null){const{scale:t}=this.data.meta;let e=As(n,null);return null===e&&(e=parseFloat(t??"1")),1!==e&&this.baseTexture.setResolution(e),e}parse(){return new Promise(n=>{this._callback=n,this._batchIndex=0,this._frameKeys.length<=Ao.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(n){let t=n;const e=Ao.BATCH_SIZE;for(;t-n<e&&t<this._frameKeys.length;){const i=this._frameKeys[t],s=this._frames[i],r=s.frame;if(r){let a=null,o=null;const l=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,h=new Ae(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);a=s.rotated?new Ae(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new Ae(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(o=new Ae(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[i]=new Wt(this.baseTexture,a,h,o,s.rotated?2:0,s.anchor),Wt.addToCache(this.textures[i],i)}t++}}_processAnimations(){const n=this.data.animations||{};for(const t in n){this.animations[t]=[];for(let e=0;e<n[t].length;e++)this.animations[t].push(this.textures[n[t][e]])}}_parseComplete(){const n=this._callback;this._callback=null,this._batchIndex=0,n.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ao.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ao.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(n=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,n&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Ld=Ao;Ld.BATCH_SIZE=1e3;const NI=["jpg","png","jpeg","avif","webp"];function Z_(n,t,e){const i={};if(n.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[s]=t.textures[s]}),!e){const s=Bi.dirname(n[0]);t.linkedSheets.forEach((r,a)=>{const o=Z_([`${s}/${t.data.meta.related_multi_packs[a]}`],r,!0);Object.assign(i,o)})}return i}const UI={extension:Pt.Asset,cache:{test:n=>n instanceof Ld,getCacheableAssets:(n,t)=>Z_(n,t,!1)},resolver:{test:n=>{const e=n.split("?")[0].split("."),i=e.pop(),s=e.pop();return"json"===i&&NI.includes(s)},parse:n=>{const t=n.split(".");return{resolution:parseFloat(Ft.RETINA_PREFIX.exec(n)?.[1]??"1"),format:t[t.length-2],src:n}}},loader:{extension:{type:Pt.LoadParser,priority:Zn.Normal},testParse:(n,t)=>(0,Et.Z)(function*(){return".json"===Bi.extname(t.src).toLowerCase()&&!!n.frames})(),parse:(n,t,e)=>(0,Et.Z)(function*(){let i=Bi.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let s=i+n.meta.image;s=gd(s,t.src);const a=(yield e.load([s]))[s],o=new Ld(a.baseTexture,n,t.src);yield o.parse();const l=n?.meta?.related_multi_packs;if(Array.isArray(l)){const h=[];for(const u of l){if("string"!=typeof u)continue;let d=i+u;t.data?.ignoreMultiPack||(d=gd(d,t.src),h.push(e.load({src:d,data:{ignoreMultiPack:!0}})))}const c=yield Promise.all(h);o.linkedSheets=c,c.forEach(u=>{u.linkedSheets=[o].concat(o.linkedSheets.filter(d=>d!==u))})}return o})(),unload(n){n.destroy(!0)}}};Yt.add(UI);class Dh{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Lh{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const r in e){const a=e[r].match(/^[a-z]+/gm)[0],o=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in o){const c=o[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[u]=p}i[a].push(l)}const s=new Dh;return i.info.forEach(r=>s.info.push({face:r.face,size:parseInt(r.size,10)})),i.common.forEach(r=>s.common.push({lineHeight:parseInt(r.lineHeight,10)})),i.page.forEach(r=>s.page.push({id:parseInt(r.id,10),file:r.file})),i.char.forEach(r=>s.char.push({id:parseInt(r.id,10),page:parseInt(r.page,10),x:parseInt(r.x,10),y:parseInt(r.y,10),width:parseInt(r.width,10),height:parseInt(r.height,10),xoffset:parseInt(r.xoffset,10),yoffset:parseInt(r.yoffset,10),xadvance:parseInt(r.xadvance,10)})),i.kerning.forEach(r=>s.kerning.push({first:parseInt(r.first,10),second:parseInt(r.second,10),amount:parseInt(r.amount,10)})),i.distanceField.forEach(r=>s.distanceField.push({distanceRange:parseInt(r.distanceRange,10),fieldType:r.fieldType})),s}}class Od{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Dh,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)e.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<s.length;h++)e.common.push({lineHeight:parseInt(s[h].getAttribute("lineHeight"),10)});for(let h=0;h<r.length;h++)e.page.push({id:parseInt(r[h].getAttribute("id"),10)||0,file:r[h].getAttribute("file")});for(let h=0;h<a.length;h++){const c=a[h];e.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<o.length;h++)e.kerning.push({first:parseInt(o[h].getAttribute("first"),10),second:parseInt(o[h].getAttribute("second"),10),amount:parseInt(o[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)e.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return e}}class Bd{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Od.test(Ft.ADAPTER.parseXML(t))}static parse(t){return Od.parse(Ft.ADAPTER.parseXML(t))}}const Fd=[Lh,Od,Bd];function zI(n,t,e,i,s,r,a){const o=e.text,l=e.fontProperties;t.translate(i,s),t.scale(r,r);const h=a.strokeThickness/2,c=-a.strokeThickness/2;if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=function GI(n,t,e,i,s,r){const a=e.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let o;const l=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,c=n.width/i-l-2*h,u=n.height/i-l-2*h,d=a.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),e.fillGradientType===Ch.LINEAR_VERTICAL){o=t.createLinearGradient(c/2,h,c/2,u+h);let p=0;const g=(r.fontProperties.fontSize+e.strokeThickness)/u;for(let x=0;x<s.length;x++){const v=r.lineHeight*x;for(let y=0;y<d.length;y++){let b=0;b="number"==typeof f[y]?f[y]:y/d.length;let S=Math.max(p,v/u+b*g);S=Math.min(S,1),o.addColorStop(S,d[y]),p=S}}}else{o=t.createLinearGradient(h,u/2,c+h,u/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let x;x="number"==typeof f[g]?f[g]:m/p,o.addColorStop(x,d[g]),m++}}return o}(n,t,a,r,[o],e),t.strokeStyle=a.stroke,a.dropShadow){const u=a.dropShadowColor,d=ho("number"==typeof u?u:Pu(u)),f=a.dropShadowBlur*r,p=a.dropShadowDistance*r;t.shadowColor=`rgba(${255*d[0]},${255*d[1]},${255*d[2]},${a.dropShadowAlpha})`,t.shadowBlur=f,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(o,h,c+e.lineHeight-l.descent),a.fill&&t.fillText(o,h,c+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function $_(n){return Array.from?Array.from(n):n.split("")}function Oh(n){return n.codePointAt?n.codePointAt(0):n.charCodeAt(0)}const Nn=class{constructor(n,t,e){const[i]=n.info,[s]=n.common,[r]=n.page,[a]=n.distanceField,o=As(r.file),l={};this._ownsTextures=e,this.font=i.face,this.size=i.size,this.lineHeight=s.lineHeight/o,this.chars={},this.pageTextures=l;for(let h=0;h<n.page.length;h++){const{id:c,file:u}=n.page[h];l[c]=t instanceof Array?t[h]:t[u],a?.fieldType&&"none"!==a.fieldType&&(l[c].baseTexture.alphaMode=An.NO_PREMULTIPLIED_ALPHA,l[c].baseTexture.mipmap=Vn.OFF)}for(let h=0;h<n.char.length;h++){const{id:c,page:u}=n.char[h];let{x:d,y:f,width:p,height:m,xoffset:g,yoffset:x,xadvance:v}=n.char[h];d/=o,f/=o,p/=o,m/=o,g/=o,x/=o,v/=o;const y=new Ae(d+l[u].frame.x/o,f+l[u].frame.y/o,p,m);this.chars[c]={xOffset:g,yOffset:x,xAdvance:v,kerning:{},texture:new Wt(l[u].baseTexture,y),page:u}}for(let h=0;h<n.kerning.length;h++){let{first:c,second:u,amount:d}=n.kerning[h];c/=o,u/=o,d/=o,this.chars[u]&&(this.chars[u].kerning[c]=d)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(const n in this.chars)this.chars[n].texture.destroy(),this.chars[n].texture=null;for(const n in this.pageTextures)this._ownsTextures&&this.pageTextures[n].destroy(!0),this.pageTextures[n]=null;this.chars=null,this.pageTextures=null}static install(n,t,e){let i;if(n instanceof Dh)i=n;else{const r=function kI(n){for(let t=0;t<Fd.length;t++)if(Fd[t].test(n))return Fd[t];return null}(n);if(!r)throw new Error("Unrecognized data format for font.");i=r.parse(n)}t instanceof Wt&&(t=[t]);const s=new Nn(i,t,e);return Nn.available[s.font]=s,s}static uninstall(n){const t=Nn.available[n];if(!t)throw new Error(`No font found named '${n}'`);t.destroy(),delete Nn.available[n]}static from(n,t,e){if(!n)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:s,resolution:r,textureWidth:a,textureHeight:o,...l}=Object.assign({},Nn.defaultOptions,e),h=function HI(n){"string"==typeof n&&(n=[n]);const t=[];for(let e=0,i=n.length;e<i;e++){const s=n[e];if(Array.isArray(s)){if(2!==s.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const r=s[0].charCodeAt(0),a=s[1].charCodeAt(0);if(a<r)throw new Error("[BitmapFont]: Invalid character range.");for(let o=r,l=a;o<=l;o++)t.push(String.fromCharCode(o))}else t.push(...$_(s))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(i),c=t instanceof br?t:new br(t),u=a,d=new Dh;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let m,g,x,f=0,p=0,v=0;const y=[],b=[];for(let S=0;S<h.length;S++){m||(m=Ft.ADAPTER.createCanvas(),m.width=a,m.height=o,g=m.getContext("2d"),x=new fe(m,{resolution:r,...l}),y.push(x),b.push(new Wt(x)),d.page.push({id:b.length-1,file:""}));const A=h[S],w=Ui.measureText(A,c,!1,m),T=w.width,C=Math.ceil(w.height),F=Math.ceil(("italic"===c.fontStyle?2:1)*T);if(p>=o-C*r){if(0===p)throw new Error(`[BitmapFont] textureHeight ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${A}')`);--S,m=null,g=null,x=null,p=0,f=0,v=0;continue}if(v=Math.max(C+w.fontProperties.descent,v),F*r+f>=u){if(0===f)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${A}')`);--S,p+=v*r,p=Math.ceil(p),f=0,v=0;continue}zI(m,g,w,f,p,r,c);const Y=Oh(w.text);d.char.push({id:Y,page:b.length-1,x:f/r,y:p/r,width:F,height:C,xoffset:0,yoffset:0,xadvance:T-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(F+2*s)*r,f=Math.ceil(f)}for(let S=0,A=h.length;S<A;S++){const w=h[S];for(let T=0;T<A;T++){const C=h[T],F=g.measureText(w).width,Y=g.measureText(C).width,D=g.measureText(w+C).width-(F+Y);D&&d.kerning.push({first:Oh(w),second:Oh(C),amount:D})}}const M=new Nn(d,b,!0);return void 0!==Nn.available[n]&&Nn.uninstall(n),Nn.available[n]=M,M}};let en=Nn;en.ALPHA=[["a","z"],["A","Z"]," "],en.NUMERIC=[["0","9"]],en.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],en.ASCII=[[" ","~"]],en.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Nn.ALPHANUMERIC},en.available={};const q_=[],j_=[],J_=[],K_=class extends vn{constructor(n,t={}){super(),this._tint=16777215;const{align:e,tint:i,maxWidth:s,letterSpacing:r,fontName:a,fontSize:o}=Object.assign({},K_.styleDefaults,t);if(!en.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=i,this._font=void 0,this._fontName=a,this._fontSize=o,this.text=n,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new Rs(()=>{this.dirty=!0},this,0,0),this._roundPixels=Ft.ROUND_PIXELS,this.dirty=!0,this._resolution=Ft.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const n=en.available[this._fontName],t=this.fontSize,e=t/n.size,i=new Le,s=[],r=[],a=[],l=$_(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*n.size/t,c="none"===n.distanceFieldType?q_:j_;let u=null,d=0,f=0,p=0,m=-1,g=0,x=0,v=0,y=0;for(let C=0;C<l.length;C++){const F=l[C],Y=Oh(F);if(/(?:\s)/.test(F)&&(m=C,g=d,y++),"\r"===F||"\n"===F){r.push(d),a.push(-1),f=Math.max(f,d),++p,++x,i.x=0,i.y+=n.lineHeight,u=null,y=0;continue}const O=n.chars[Y];if(!O)continue;u&&O.kerning[u]&&(i.x+=O.kerning[u]);const D=J_.pop()||{texture:Wt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Le};D.texture=O.texture,D.line=p,D.charCode=Y,D.position.x=Math.round(i.x+O.xOffset+this._letterSpacing/2),D.position.y=Math.round(i.y+O.yOffset),D.prevSpaces=y,s.push(D),d=D.position.x+Math.max(O.xAdvance-O.xOffset,O.texture.orig.width),i.x+=O.xAdvance+this._letterSpacing,v=Math.max(v,O.yOffset+O.texture.height),u=Y,-1!==m&&h>0&&i.x>h&&(++x,ua(s,1+m-x,1+C-m),C=m,m=-1,r.push(g),a.push(s.length>0?s[s.length-1].prevSpaces:0),f=Math.max(f,g),p++,i.x=0,i.y+=n.lineHeight,u=null,y=0)}const b=l[l.length-1];"\r"!==b&&"\n"!==b&&(/(?:\s)/.test(b)&&(d=g),r.push(d),f=Math.max(f,d),a.push(-1));const M=[];for(let C=0;C<=p;C++){let F=0;"right"===this._align?F=f-r[C]:"center"===this._align?F=(f-r[C])/2:"justify"===this._align&&(F=a[C]<0?0:(f-r[C])/a[C]),M.push(F)}const S=s.length,A={},w=[],T=this._activePagesMeshData;c.push(...T);for(let C=0;C<S;C++){const F=s[C].texture,Y=F.baseTexture.uid;if(!A[Y]){let O=c.pop();if(!O){const W=new mI;let X,j;"none"===n.distanceFieldType?(X=new N_(Wt.EMPTY),j=re.NORMAL):(X=new N_(Wt.EMPTY,{program:In.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),j=re.NORMAL_NPM);const $=new Ad(W,X);$.blendMode=j,O={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:$,vertices:null,uvs:null,indices:null}}O.index=0,O.indexCount=0,O.vertexCount=0,O.uvsCount=0,O.total=0;const{_textureCache:D}=this;D[Y]=D[Y]||new Wt(F.baseTexture),O.mesh.texture=D[Y],O.mesh.tint=this._tint,w.push(O),A[Y]=O}A[Y].total++}for(let C=0;C<T.length;C++)w.includes(T[C])||this.removeChild(T[C].mesh);for(let C=0;C<w.length;C++)w[C].mesh.parent!==this&&this.addChild(w[C].mesh);this._activePagesMeshData=w;for(const C in A){const F=A[C],Y=F.total;if(!(F.indices?.length>6*Y)||F.vertices.length<2*Ad.BATCHABLE_SIZE)F.vertices=new Float32Array(8*Y),F.uvs=new Float32Array(8*Y),F.indices=new Uint16Array(6*Y);else{const D=F.vertices;for(let W=4*F.total*2;W<D.length;W++)D[W]=0}F.mesh.size=6*Y}for(let C=0;C<S;C++){const F=s[C];let Y=F.position.x+M[F.line]*("justify"===this._align?F.prevSpaces:1);this._roundPixels&&(Y=Math.round(Y));const O=Y*e,D=F.position.y*e,W=F.texture,X=A[W.baseTexture.uid],j=W.frame,$=W._uvs,et=X.index++;X.indices[6*et+0]=0+4*et,X.indices[6*et+1]=1+4*et,X.indices[6*et+2]=2+4*et,X.indices[6*et+3]=0+4*et,X.indices[6*et+4]=2+4*et,X.indices[6*et+5]=3+4*et,X.vertices[8*et+0]=O,X.vertices[8*et+1]=D,X.vertices[8*et+2]=O+j.width*e,X.vertices[8*et+3]=D,X.vertices[8*et+4]=O+j.width*e,X.vertices[8*et+5]=D+j.height*e,X.vertices[8*et+6]=O,X.vertices[8*et+7]=D+j.height*e,X.uvs[8*et+0]=$.x0,X.uvs[8*et+1]=$.y0,X.uvs[8*et+2]=$.x1,X.uvs[8*et+3]=$.y1,X.uvs[8*et+4]=$.x2,X.uvs[8*et+5]=$.y2,X.uvs[8*et+6]=$.x3,X.uvs[8*et+7]=$.y3}this._textWidth=f*e,this._textHeight=(i.y+n.lineHeight)*e;for(const C in A){const F=A[C];if(0!==this.anchor.x||0!==this.anchor.y){let W=0;const X=this._textWidth*this.anchor.x,j=this._textHeight*this.anchor.y;for(let $=0;$<F.total;$++)F.vertices[W++]-=X,F.vertices[W++]-=j,F.vertices[W++]-=X,F.vertices[W++]-=j,F.vertices[W++]-=X,F.vertices[W++]-=j,F.vertices[W++]-=X,F.vertices[W++]-=j}this._maxLineHeight=v*e;const Y=F.mesh.geometry.getBuffer("aVertexPosition"),O=F.mesh.geometry.getBuffer("aTextureCoord"),D=F.mesh.geometry.getIndex();Y.data=F.vertices,O.data=F.uvs,D.data=F.indices,Y.update(),O.update(),D.update()}for(let C=0;C<s.length;C++)J_.push(s[C]);this._font=n,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(n){this._autoResolution&&this._resolution!==n.resolution&&(this._resolution=n.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:i}=en.available[this._fontName];if("none"!==e){const{a:s,b:r,c:a,d:o}=this.worldTransform,l=Math.sqrt(s*s+r*r),h=Math.sqrt(a*a+o*o),c=(Math.abs(l)+Math.abs(h))/2,u=this.fontSize/i,d=n._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(n)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const n=en.available[this._fontName];if(!n)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==n&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(n){if(this._tint!==n){this._tint=n;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=n}}get align(){return this._align}set align(n){this._align!==n&&(this._align=n,this.dirty=!0)}get fontName(){return this._fontName}set fontName(n){if(!en.available[n])throw new Error(`Missing BitmapFont "${n}"`);this._fontName!==n&&(this._fontName=n,this.dirty=!0)}get fontSize(){return this._fontSize??en.available[this._fontName].size}set fontSize(n){this._fontSize!==n&&(this._fontSize=n,this.dirty=!0)}get anchor(){return this._anchor}set anchor(n){"number"==typeof n?this._anchor.set(n):this._anchor.copyFrom(n)}get text(){return this._text}set text(n){n=String(n??""),this._text!==n&&(this._text=n,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(n){this._maxWidth!==n&&(this._maxWidth=n,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(n){this._letterSpacing!==n&&(this._letterSpacing=n,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(n){n!==this._roundPixels&&(this._roundPixels=n,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(n){this._autoResolution=!1,this._resolution!==n&&(this._resolution=n,this.dirty=!0)}destroy(n){const{_textureCache:t}=this,i="none"===en.available[this._fontName].distanceFieldType?q_:j_;i.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>t[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=Wt.EMPTY});for(const s in t)t[s].destroy(),delete t[s];this._font=null,this._textureCache=null,super.destroy(n)}};K_.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const YI=[".xml",".fnt"],ZI={extension:{type:Pt.LoadParser,priority:Zn.Normal},test:n=>YI.includes(Bi.extname(n).toLowerCase()),testParse:n=>(0,Et.Z)(function*(){return Lh.test(n)||Bd.test(n)})(),parse:(n,t,e)=>(0,Et.Z)(function*(){const i=Lh.test(n)?Lh.parse(n):Bd.parse(n),{src:s}=t,{page:r}=i,a=[];for(let h=0;h<r.length;++h){const c=r[h].file;let u=Bi.join(Bi.dirname(s),c);u=gd(u,s),a.push(u)}const o=yield e.load(a),l=a.map(h=>o[h]);return en.install(i,l,!0)})(),load:(n,t)=>(0,Et.Z)(function*(){return(yield Ft.ADAPTER.fetch(n)).text()})(),unload(n){n.destroy()}};Yt.add(ZI);var Bh=ot(3905),Q_=ot(9037);const $I=["pixiContainer"];let t0=(()=>{class n{constructor(e,i,s){this.bsModalRef=e,this.warehouseService=i,this.store=s,this.title="",this.positionTypeBins=[],this.positionTypeDropDown=[],this.positionTypeSelected=void 0,this.accessSideDropdown=[{text:"Up",value:0},{text:"Right",value:1},{text:"Down",value:2},{text:"Left",value:3}],this.app=new dh({width:350,height:350,backgroundColor:15527148,antialias:!0})}ngAfterViewInit(){this.pixiContainer.nativeElement.appendChild(this.app.view)}ngOnInit(){this.loadPositionTypeBins(),this.createTypeForm()}onSubmit(){if(!this.positionTypeSelected)return;const e=this.typeForm.value;e.totalDepth=this.positionTypeSelected.totalDepth,e.totalFront=this.positionTypeSelected.totalFront,this.store.dispatch((n=>({type:Im.n.SetCurrentPositionTypeBin,payload:{currentPositionTypeBin:n}}))(e)),this.gameInstance.SendMessage("JavaScriptMessager","HandleSpawnMode","true"),this.closeModal()}closeModal(){this.bsModalRef.hide()}drawPreview(){if(!this.positionTypeSelected)return;this.app.stage.removeChildren();let e=100*this.positionTypeSelected.totalFront,i=100*this.positionTypeSelected.totalDepth;for(let a=1;a<=5&&(e>=this.app.view.width||i>=this.app.view.height);a++)e/=a,i/=a;const s=[this.app.view.width/2-e/2,this.app.view.height/2-i/2],r=new Ma;r.lineStyle(2,0,1),r.beginFill(16439685),r.drawRect(s[0],s[1],e,i),r.endFill(),this.app.stage.addChild(r)}createTypeForm(){this.typeForm=new pt.cw({positionTypeDescription:new pt.NI("",[pt.kI.required]),pickingAccess:new pt.NI("0",[pt.kI.required]),rowCount:new pt.NI("1",[pt.kI.required]),columnCount:new pt.NI("1",[pt.kI.required,pt.kI.min(1)]),stepByColumn:new pt.NI("1",[pt.kI.required,pt.kI.min(1)]),stepByRow:new pt.NI("1",[pt.kI.required,pt.kI.min(1)]),stepByRowSize:new pt.NI("0",[pt.kI.required,pt.kI.min(0)]),stepByColumnSize:new pt.NI("0",[pt.kI.required,pt.kI.min(0)])}),this.typeForm.get("positionTypeDescription")?.valueChanges.subscribe(e=>{this.positionTypeSelected=this.positionTypeBins.find(i=>i.positionTypeDescription===e),this.drawPreview()})}loadPositionTypeBins(){var e=this;return(0,Et.Z)(function*(){try{e.positionTypeBins=yield(0,Bh.z)(e.warehouseService.loadPositionTypeBins()),e.positionTypeBins.forEach(i=>{e.positionTypeDropDown.push({text:i.positionTypeDescription,value:i.positionTypeDescription})}),e.positionTypeSelected=e.positionTypeBins[0],e.drawPreview(),e.typeForm.get("positionTypeDescription")?.setValue(e.positionTypeDropDown[0].value)}catch(i){console.error(i)}})()}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(lr.UZ),_.Y36(hr),_.Y36(Vl.yh))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-modal-select-type-address"]],viewQuery:function(e,i){if(1&e&&_.Gf($I,7),2&e){let s;_.iGM(s=_.CRH())&&(i.pixiContainer=s.first)}},inputs:{title:"title",gameInstance:"gameInstance"},decls:25,vars:3,consts:[[1,"modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"grid-layout"],[1,"ui","form",3,"formGroup","ngSubmit"],["label","Type","formControlName","positionTypeDescription",3,"dropdown"],["label","Access Side","formControlName","pickingAccess",3,"dropdown"],["label","Rows","type","number","formControlName","rowCount"],["label","Column","type","number","formControlName","columnCount"],["label","Step by Column","type","number","formControlName","stepByColumn"],["label","Step by Row","type","number","formControlName","stepByRow"],["label","Step by Row Size (cm)","type","number","formControlName","stepByRowSize"],["label","Step by Column Size (cm)","type","number","formControlName","stepByColumnSize"],["type","submit",1,"ui","button","primary","space-between-file"],[2,"display","flex","flex-direction","row-reverse","align-content","baseline","flex-wrap","wrap"],["pixiContainer",""]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),_._uU(4,"Attendance"),_.qZA(),_.TgZ(5,"button",4),_.NdJ("click",function(){return i.closeModal()}),_.TgZ(6,"span",5),_._uU(7,"\xd7"),_.qZA()()(),_.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"form",8),_.NdJ("ngSubmit",function(){return i.onSubmit()}),_._UZ(12,"app-selection-dropdown",9)(13,"app-selection-dropdown",10)(14,"app-text-input",11)(15,"app-text-input",12)(16,"app-text-input",13)(17,"app-text-input",14)(18,"app-text-input",15)(19,"app-text-input",16),_.TgZ(20,"button",17),_._uU(21," Save "),_.qZA()()(),_.TgZ(22,"div",18),_._UZ(23,"div",null,19),_.qZA()()()()()),2&e&&(_.xp6(11),_.Q6J("formGroup",i.typeForm),_.xp6(1),_.Q6J("dropdown",i.positionTypeDropDown),_.xp6(1),_.Q6J("dropdown",i.accessSideDropdown))},dependencies:[pt._Y,pt.JJ,pt.JL,pt.sg,pt.u,_u,Q_.d],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),n})();var $n=ot(1314),e0=ot(7528),Ls=ot(7579),qI=ot(9770),Fh=ot(5698),i0=ot(8675),Nd=ot(2362),Os=ot(8491),Sa=ot(5727),Nh=ot(559);function jI(n,t){}class Ud{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.closeOnNavigation=!0}}const n0=[(0,be.SB)("void, exit",(0,be.oB)({opacity:0,transform:"scale(0.7)"})),(0,be.SB)("enter",(0,be.oB)({transform:"none"})),(0,be.eR)("* => enter",(0,be.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,be.oB)({transform:"none",opacity:1}))),(0,be.eR)("* => void, * => exit",(0,be.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,be.oB)({opacity:0})))],JI={dialogContainer:(0,be.X$)("dialogContainer",n0),slideDialog:(0,be.X$)("slideDialog",n0)};function s0(){throw Error("Attempting to attach dialog content after content is already attached")}let r0=(()=>{class n extends $n.en{constructor(e,i,s,r,a){super(),this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=s,this._document=r,this._config=a,this._elementFocusedBeforeDialogWasOpened=null,this._state="enter",this._animationStateChanged=new _.vpe,this._ariaLabelledBy=null}attachComponentPortal(e){return this._portalOutlet.hasAttached()&&s0(),this._savePreviouslyFocusedElement(),this._portalOutlet.attachComponentPortal(e)}attachTemplatePortal(e){return this._portalOutlet.hasAttached()&&s0(),this._savePreviouslyFocusedElement(),this._portalOutlet.attachTemplatePortal(e)}_trapFocus(){this._focusTrap||(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)),this._config.autoFocus&&this._focusTrap.focusInitialElementWhenReady()}_restoreFocus(){const e=this._elementFocusedBeforeDialogWasOpened;this._config.restoreFocus&&e&&"function"==typeof e.focus&&e.focus(),this._focusTrap&&this._focusTrap.destroy()}_savePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=this._document.activeElement,this._elementRef.nativeElement.focus&&Promise.resolve().then(()=>this._elementRef.nativeElement.focus()))}_onAnimationDone(e){"enter"===e.toState?this._trapFocus():"exit"===e.toState&&this._restoreFocus(),this._animationStateChanged.emit(e)}_onAnimationStart(e){this._animationStateChanged.emit(e)}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(Nh.qV),_.Y36(_.sBO),_.Y36(ee.K0,8),_.Y36(Ud))},n.\u0275cmp=_.Xpm({type:n,selectors:[["mat-dialog-container"]],viewQuery:function(e,i){if(1&e&&_.Gf($n.Pl,5),2&e){let s;_.iGM(s=_.CRH())&&(i._portalOutlet=s.first)}},hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&_.WFA("@dialogContainer.start",function(r){return i._onAnimationStart(r)})("@dialogContainer.done",function(r){return i._onAnimationDone(r)}),2&e&&(_.uIk("id",i._id)("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),_.d8E("@dialogContainer",i._state))},features:[_.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&_.YNc(0,jI,0,0,"ng-template",0)},dependencies:[$n.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}@media (-ms-high-contrast:active){.mat-dialog-container{outline:solid 1px}}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button+.mat-button,.mat-dialog-actions .mat-button+.mat-raised-button,.mat-dialog-actions .mat-raised-button+.mat-button,.mat-dialog-actions .mat-raised-button+.mat-raised-button{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button+.mat-button,[dir=rtl] .mat-dialog-actions .mat-button+.mat-raised-button,[dir=rtl] .mat-dialog-actions .mat-raised-button+.mat-button,[dir=rtl] .mat-dialog-actions .mat-raised-button+.mat-raised-button{margin-left:0;margin-right:8px}"],encapsulation:2,data:{animation:[JI.dialogContainer]}}),n})(),KI=0;class Uh{constructor(t,e,i,s="mat-dialog-"+KI++){this._overlayRef=t,this._containerInstance=e,this.id=s,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new Ls.x,this._afterClosed=new Ls.x,this._beforeClosed=new Ls.x,e._id=s,e._animationStateChanged.pipe((0,ro.h)(r=>"done"===r.phaseName&&"enter"===r.toState),(0,Fh.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe((0,ro.h)(r=>"done"===r.phaseName&&"exit"===r.toState),(0,Fh.q)(1)).subscribe(()=>this._overlayRef.dispose()),t.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),t.keydownEvents().pipe((0,ro.h)(r=>r.keyCode===e0.hY&&!this.disableClose)).subscribe(()=>this.close())}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe((0,ro.h)(e=>"start"===e.phaseName),(0,Fh.q)(1)).subscribe(()=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._overlayRef.detachBackdrop()}),this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened.asObservable()}afterClosed(){return this._afterClosed.asObservable()}beforeClosed(){return this._beforeClosed.asObservable()}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(t){let e=this._getPositionStrategy();return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(t="",e=""){return this._getPositionStrategy().width(t).height(e),this._overlayRef.updatePosition(),this}addPanelClass(t){return this._overlayRef.addPanelClass(t),this}removePanelClass(t){return this._overlayRef.removePanelClass(t),this}afterOpen(){return this.afterOpened()}beforeClose(){return this.beforeClosed()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}const QI=new _.OlP("MatDialogData"),tP=new _.OlP("mat-dialog-default-options"),a0=new _.OlP("mat-dialog-scroll-strategy"),iP={provide:a0,deps:[Os.aV],useFactory:function eP(n){return()=>n.scrollStrategies.block()}};let kh=(()=>{class n{constructor(e,i,s,r,a,o,l){this._overlay=e,this._injector=i,this._location=s,this._defaultOptions=r,this._parentDialog=o,this._overlayContainer=l,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Ls.x,this._afterOpenedAtThisLevel=new Ls.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,qI.P)(()=>this.openDialogs.length?this._afterAllClosed:this._afterAllClosed.pipe((0,i0.O)(void 0))),this._scrollStrategy=a}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}get afterOpen(){return this.afterOpened}get _afterAllClosed(){const e=this._parentDialog;return e?e._afterAllClosed:this._afterAllClosedAtThisLevel}open(e,i){if(i=function nP(n,t){return Object.assign({},t,n)}(i,this._defaultOptions||new Ud),i.id&&this.getDialogById(i.id))throw Error(`Dialog with id "${i.id}" exists already. The dialog id must be unique.`);const s=this._createOverlay(i),r=this._attachDialogContainer(s,i),a=this._attachDialogContent(e,r,s,i);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(a),a.afterClosed().subscribe(()=>this._removeOpenDialog(a)),this.afterOpened.next(a),a}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(e){const i=this._getOverlayConfig(e);return this._overlay.create(i)}_getOverlayConfig(e){const i=new Os.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachDialogContainer(e,i){const r=new $n.nK(i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,new WeakMap([[Ud,i]])),a=new $n.C5(r0,i.viewContainerRef,r);return e.attach(a).instance}_attachDialogContent(e,i,s,r){const a=new Uh(s,i,this._location,r.id);if(r.hasBackdrop&&s.backdropClick().subscribe(()=>{a.disableClose||a.close()}),e instanceof _.Rgc)i.attachTemplatePortal(new $n.UE(e,null,{$implicit:r.data,dialogRef:a}));else{const o=this._createInjector(r,a,i),l=i.attachComponentPortal(new $n.C5(e,void 0,o));a.componentInstance=l.instance}return a.updateSize(r.width,r.height).updatePosition(r.position),a}_createInjector(e,i,s){const r=e&&e.viewContainerRef&&e.viewContainerRef.injector,a=new WeakMap([[r0,s],[QI,e.data],[Uh,i]]);return e.direction&&(!r||!r.get(Nd.Is,null))&&a.set(Nd.Is,{value:e.direction,change:(0,Xt.of)()}),new $n.nK(r||this._injector,a)}_removeOpenDialog(e){const i=this.openDialogs.indexOf(e);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,r)=>{s?r.setAttribute("aria-hidden",s):r.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._afterAllClosed.next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let s=i.length-1;s>-1;s--){let r=i[s];r!==e&&"SCRIPT"!==r.nodeName&&"STYLE"!==r.nodeName&&!r.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(r,r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden","true"))}}}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){return new(e||n)(_.LFG(Os.aV),_.LFG(_.zs3),_.LFG(ee.Ye,8),_.LFG(tP,8),_.LFG(a0),_.LFG(n,12),_.LFG(Os.Xj))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac}),n})(),rP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({providers:[kh,iP],imports:[ee.ez,Os.U8,$n.eL,Sa.BQ,Sa.BQ]}),n})();var oi=(()=>(function(n){n.isCameraMode="isCameraMode",n.isSpawnMode="isSpawnMode",n.isSelectionMode="isSelectionMode",n.isDragMode="isDragMode",n.isMetrics="isMetrics",n.isHeatMapFlow2DMode="isHeatMapFlow2DMode",n.isHeatMapPerAddress2DMode="isHeatMapPerAddress2DMode",n.isFlyMode="isFlyMode",n.isHeatMapPerAddress3DMode="isHeatMapPerAddress3DMode",n.isMiscellaneousMode="isMiscellaneousMode"}(oi||(oi={})),oi))();const aP=["pixiContainer"];let oP=(()=>{class n{constructor(e,i,s){this.bsModalRef=e,this.warehouseService=i,this.store=s,this.title="",this.app=new dh({width:350,height:350,backgroundColor:15527148,antialias:!0}),this.miscellanousDropdown=[]}ngAfterViewInit(){this.pixiContainer.nativeElement.appendChild(this.app.view)}ngOnInit(){this.createMiscellaneousTypeForm()}onSubmit(){}closeModal(){this.bsModalRef.hide()}createMiscellaneousTypeForm(){this.miscellaneousForm=new pt.cw({miscellaneousType:new pt.NI("",[pt.kI.required]),sizeX:new pt.NI("0",[pt.kI.required,pt.kI.min(0)]),sizeY:new pt.NI("0",[pt.kI.required,pt.kI.min(0)]),rotation:new pt.NI("")}),this.miscellaneousForm.get("rotation")?.valueChanges.subscribe(e=>{})}drawPreview(){if(!this.miscellaneousTypeSelected)return;let e=100*this.miscellaneousTypeSelected.sizeX,i=100*this.miscellaneousTypeSelected.sizeY;for(let a=1;a<=5&&(e>=this.app.view.width||i>=this.app.view.height);a++)e/=a,i/=a;const s=[this.app.view.width/2-e/2,this.app.view.height/2-i/2],r=new Ma;r.lineStyle(2,0,1),r.beginFill(16439685),r.drawRect(s[0],s[1],e,i),r.endFill(),this.app.stage.addChild(r)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(lr.UZ),_.Y36(hr),_.Y36(Vl.yh))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-modal-select-miscellaneous-type"]],viewQuery:function(e,i){if(1&e&&_.Gf(aP,7),2&e){let s;_.iGM(s=_.CRH())&&(i.pixiContainer=s.first)}},inputs:{title:"title",gameInstance:"gameInstance"},decls:25,vars:2,consts:[[1,"modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","dialog-static-name",1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[1,"grid-layout"],[1,"ui","form",3,"formGroup","ngSubmit"],["label","Type","formControlName","miscellaneousType",3,"dropdown"],["label","Size X (m)","type","number","formControlName","sizeX"],["label","Size Y (m)","type","number","formControlName","sizeY"],[2,"margin","2.5%"],[1,"ui","checkbox"],["type","checkbox","name","example","formControlName","rotation"],["type","submit",1,"ui","button","primary","space-between-file"],[2,"display","flex","flex-direction","row-reverse","align-content","baseline","flex-wrap","wrap"],["pixiContainer",""]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),_._uU(4,"Attendance"),_.qZA(),_.TgZ(5,"button",4),_.NdJ("click",function(){return i.closeModal()}),_.TgZ(6,"span",5),_._uU(7,"\xd7"),_.qZA()()(),_.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"form",8),_.NdJ("ngSubmit",function(){return i.onSubmit()}),_._UZ(12,"app-selection-dropdown",9)(13,"app-text-input",10)(14,"app-text-input",11),_.TgZ(15,"div",12)(16,"div",13),_._UZ(17,"input",14),_.TgZ(18,"label"),_._uU(19,"Is Rotate"),_.qZA()()(),_.TgZ(20,"button",15),_._uU(21," Save "),_.qZA()()(),_.TgZ(22,"div",16),_._UZ(23,"div",null,17),_.qZA()()()()()),2&e&&(_.xp6(11),_.Q6J("formGroup",i.miscellaneousForm),_.xp6(1),_.Q6J("dropdown",i.miscellanousDropdown))},dependencies:[pt._Y,pt.Wl,pt.JJ,pt.JL,pt.sg,pt.u,_u,Q_.d],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),n})();class qn{static handleCameraModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleCamera",e.toString())}static handleDragModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleDragMode",e.toString())}static handleSelectionModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleSelectionMode",e.toString())}static handleSpawnModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleSpawnMode",e.toString())}static handleMetricModeGameInstance(t,e){t.SendMessage("JavaScriptMessager","HandleMeasures",e.toString())}static handleHeatMapFlow2D(t,e){t.SendMessage("JavaScriptMessager","HandleHeatMapFlow2D",e.toString())}static handleHeatMapPerAddress2D(t,e){t.SendMessage("JavaScriptMessager","HandleHeatMapPerAddress2D",e.toString())}static handleFlyMode(t,e){t.SendMessage("EventSystem","HandleFlyMode",e.toString())}static handleHeatMapPerAddress3D(t,e){console.log(new Error("Method not implemented."))}static handleMiscellaneous(t,e){}}var $i=(()=>(function(n){n.None="None",n.Picks="picks",n.CasesPicked="casespicked",n.Restocks="restocks",n.OutOfStocks="outofstock",n.HeatMap="heatMap"}($i||($i={})),$i))(),kd=ot(4151),l0=ot(6909),Gh=ot(1481),lP=ot(8980),cn=ot(7217),Re=ot(4943);const hP={provide:pt.JU,useExisting:(0,_.Gpc)(()=>h0),multi:!0};let h0=(()=>{class n extends cn.Ay{constructor(e,i,s,r,a,o,l,h){super(e,i,s,r,l,h),this._watcherHelper=r,this._idh=a,this.touched=c=>{},this._createEventEmitters([{subscribe:"change",emit:"onChange"},{subscribe:"closed",emit:"onClosed"},{subscribe:"contentReady",emit:"onContentReady"},{subscribe:"copy",emit:"onCopy"},{subscribe:"cut",emit:"onCut"},{subscribe:"disposing",emit:"onDisposing"},{subscribe:"enterKey",emit:"onEnterKey"},{subscribe:"focusIn",emit:"onFocusIn"},{subscribe:"focusOut",emit:"onFocusOut"},{subscribe:"initialized",emit:"onInitialized"},{subscribe:"input",emit:"onInput"},{subscribe:"keyDown",emit:"onKeyDown"},{subscribe:"keyUp",emit:"onKeyUp"},{subscribe:"opened",emit:"onOpened"},{subscribe:"optionChanged",emit:"onOptionChanged"},{subscribe:"paste",emit:"onPaste"},{subscribe:"valueChanged",emit:"onValueChanged"},{emit:"acceptCustomValueChange"},{emit:"accessKeyChange"},{emit:"activeStateEnabledChange"},{emit:"adaptivityEnabledChange"},{emit:"applyButtonTextChange"},{emit:"applyValueModeChange"},{emit:"buttonsChange"},{emit:"calendarOptionsChange"},{emit:"cancelButtonTextChange"},{emit:"dateOutOfRangeMessageChange"},{emit:"dateSerializationFormatChange"},{emit:"deferRenderingChange"},{emit:"disabledChange"},{emit:"disabledDatesChange"},{emit:"displayFormatChange"},{emit:"dropDownButtonTemplateChange"},{emit:"dropDownOptionsChange"},{emit:"elementAttrChange"},{emit:"focusStateEnabledChange"},{emit:"heightChange"},{emit:"hintChange"},{emit:"hoverStateEnabledChange"},{emit:"inputAttrChange"},{emit:"intervalChange"},{emit:"invalidDateMessageChange"},{emit:"isValidChange"},{emit:"labelChange"},{emit:"labelModeChange"},{emit:"maxChange"},{emit:"maxLengthChange"},{emit:"minChange"},{emit:"nameChange"},{emit:"openedChange"},{emit:"openOnFieldClickChange"},{emit:"pickerTypeChange"},{emit:"placeholderChange"},{emit:"readOnlyChange"},{emit:"rtlEnabledChange"},{emit:"showAnalogClockChange"},{emit:"showClearButtonChange"},{emit:"showDropDownButtonChange"},{emit:"spellcheckChange"},{emit:"stylingModeChange"},{emit:"tabIndexChange"},{emit:"textChange"},{emit:"typeChange"},{emit:"useMaskBehaviorChange"},{emit:"validationErrorChange"},{emit:"validationErrorsChange"},{emit:"validationMessageModeChange"},{emit:"validationStatusChange"},{emit:"valueChange"},{emit:"valueChangeEventChange"},{emit:"visibleChange"},{emit:"widthChange"},{emit:"onBlur"}]),this._idh.setHost(this),o.setHost(this)}get acceptCustomValue(){return this._getOption("acceptCustomValue")}set acceptCustomValue(e){this._setOption("acceptCustomValue",e)}get accessKey(){return this._getOption("accessKey")}set accessKey(e){this._setOption("accessKey",e)}get activeStateEnabled(){return this._getOption("activeStateEnabled")}set activeStateEnabled(e){this._setOption("activeStateEnabled",e)}get adaptivityEnabled(){return this._getOption("adaptivityEnabled")}set adaptivityEnabled(e){this._setOption("adaptivityEnabled",e)}get applyButtonText(){return this._getOption("applyButtonText")}set applyButtonText(e){this._setOption("applyButtonText",e)}get applyValueMode(){return this._getOption("applyValueMode")}set applyValueMode(e){this._setOption("applyValueMode",e)}get buttons(){return this._getOption("buttons")}set buttons(e){this._setOption("buttons",e)}get calendarOptions(){return this._getOption("calendarOptions")}set calendarOptions(e){this._setOption("calendarOptions",e)}get cancelButtonText(){return this._getOption("cancelButtonText")}set cancelButtonText(e){this._setOption("cancelButtonText",e)}get dateOutOfRangeMessage(){return this._getOption("dateOutOfRangeMessage")}set dateOutOfRangeMessage(e){this._setOption("dateOutOfRangeMessage",e)}get dateSerializationFormat(){return this._getOption("dateSerializationFormat")}set dateSerializationFormat(e){this._setOption("dateSerializationFormat",e)}get deferRendering(){return this._getOption("deferRendering")}set deferRendering(e){this._setOption("deferRendering",e)}get disabled(){return this._getOption("disabled")}set disabled(e){this._setOption("disabled",e)}get disabledDates(){return this._getOption("disabledDates")}set disabledDates(e){this._setOption("disabledDates",e)}get displayFormat(){return this._getOption("displayFormat")}set displayFormat(e){this._setOption("displayFormat",e)}get dropDownButtonTemplate(){return this._getOption("dropDownButtonTemplate")}set dropDownButtonTemplate(e){this._setOption("dropDownButtonTemplate",e)}get dropDownOptions(){return this._getOption("dropDownOptions")}set dropDownOptions(e){this._setOption("dropDownOptions",e)}get elementAttr(){return this._getOption("elementAttr")}set elementAttr(e){this._setOption("elementAttr",e)}get focusStateEnabled(){return this._getOption("focusStateEnabled")}set focusStateEnabled(e){this._setOption("focusStateEnabled",e)}get height(){return this._getOption("height")}set height(e){this._setOption("height",e)}get hint(){return this._getOption("hint")}set hint(e){this._setOption("hint",e)}get hoverStateEnabled(){return this._getOption("hoverStateEnabled")}set hoverStateEnabled(e){this._setOption("hoverStateEnabled",e)}get inputAttr(){return this._getOption("inputAttr")}set inputAttr(e){this._setOption("inputAttr",e)}get interval(){return this._getOption("interval")}set interval(e){this._setOption("interval",e)}get invalidDateMessage(){return this._getOption("invalidDateMessage")}set invalidDateMessage(e){this._setOption("invalidDateMessage",e)}get isValid(){return this._getOption("isValid")}set isValid(e){this._setOption("isValid",e)}get label(){return this._getOption("label")}set label(e){this._setOption("label",e)}get labelMode(){return this._getOption("labelMode")}set labelMode(e){this._setOption("labelMode",e)}get max(){return this._getOption("max")}set max(e){this._setOption("max",e)}get maxLength(){return this._getOption("maxLength")}set maxLength(e){this._setOption("maxLength",e)}get min(){return this._getOption("min")}set min(e){this._setOption("min",e)}get name(){return this._getOption("name")}set name(e){this._setOption("name",e)}get opened(){return this._getOption("opened")}set opened(e){this._setOption("opened",e)}get openOnFieldClick(){return this._getOption("openOnFieldClick")}set openOnFieldClick(e){this._setOption("openOnFieldClick",e)}get pickerType(){return this._getOption("pickerType")}set pickerType(e){this._setOption("pickerType",e)}get placeholder(){return this._getOption("placeholder")}set placeholder(e){this._setOption("placeholder",e)}get readOnly(){return this._getOption("readOnly")}set readOnly(e){this._setOption("readOnly",e)}get rtlEnabled(){return this._getOption("rtlEnabled")}set rtlEnabled(e){this._setOption("rtlEnabled",e)}get showAnalogClock(){return this._getOption("showAnalogClock")}set showAnalogClock(e){this._setOption("showAnalogClock",e)}get showClearButton(){return this._getOption("showClearButton")}set showClearButton(e){this._setOption("showClearButton",e)}get showDropDownButton(){return this._getOption("showDropDownButton")}set showDropDownButton(e){this._setOption("showDropDownButton",e)}get spellcheck(){return this._getOption("spellcheck")}set spellcheck(e){this._setOption("spellcheck",e)}get stylingMode(){return this._getOption("stylingMode")}set stylingMode(e){this._setOption("stylingMode",e)}get tabIndex(){return this._getOption("tabIndex")}set tabIndex(e){this._setOption("tabIndex",e)}get text(){return this._getOption("text")}set text(e){this._setOption("text",e)}get type(){return this._getOption("type")}set type(e){this._setOption("type",e)}get useMaskBehavior(){return this._getOption("useMaskBehavior")}set useMaskBehavior(e){this._setOption("useMaskBehavior",e)}get validationError(){return this._getOption("validationError")}set validationError(e){this._setOption("validationError",e)}get validationErrors(){return this._getOption("validationErrors")}set validationErrors(e){this._setOption("validationErrors",e)}get validationMessageMode(){return this._getOption("validationMessageMode")}set validationMessageMode(e){this._setOption("validationMessageMode",e)}get validationStatus(){return this._getOption("validationStatus")}set validationStatus(e){this._setOption("validationStatus",e)}get value(){return this._getOption("value")}set value(e){this._setOption("value",e)}get valueChangeEvent(){return this._getOption("valueChangeEvent")}set valueChangeEvent(e){this._setOption("valueChangeEvent",e)}get visible(){return this._getOption("visible")}set visible(e){this._setOption("visible",e)}get width(){return this._getOption("width")}set width(e){this._setOption("width",e)}change(e){}get buttonsChildren(){return this._getOption("buttons")}set buttonsChildren(e){this.setChildren("buttons",e)}_createInstance(e,i){return new lP.Z(e,i)}writeValue(e){this.eventHelper.lockedValueChangeEvent=!0,this.value=e,this.eventHelper.lockedValueChangeEvent=!1}setDisabledState(e){this.disabled=e}registerOnChange(e){this.change=e}registerOnTouched(e){this.touched=e}_createWidget(e){super._createWidget(e),this.instance.on("focusOut",i=>{this.eventHelper.fireNgEvent("onBlur",[i])})}ngOnDestroy(){this._destroyWidget()}ngOnChanges(e){super.ngOnChanges(e),this.setupChanges("buttons",e),this.setupChanges("disabledDates",e),this.setupChanges("validationErrors",e)}setupChanges(e,i){e in this._optionsToUpdate||this._idh.setup(e,i)}ngDoCheck(){this._idh.doCheck("buttons"),this._idh.doCheck("disabledDates"),this._idh.doCheck("validationErrors"),this._watcherHelper.checkWatchers(),super.ngDoCheck(),super.clearChangedOptions()}_setOption(e,i){let s=this._idh.setupSingle(e,i),r=null!==this._idh.getChanges(e,i);(s||r)&&super._setOption(e,i)}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(_.SBq),_.Y36(_.R0b),_.Y36(cn._5),_.Y36(cn._h),_.Y36(cn.i9),_.Y36(cn.al),_.Y36(Gh.ki),_.Y36(_.Lbi))},n.\u0275cmp=_.Xpm({type:n,selectors:[["dx-date-box"]],contentQueries:function(e,i,s){if(1&e&&_.Suo(s,Re.k4o,4),2&e){let r;_.iGM(r=_.CRH())&&(i.buttonsChildren=r)}},hostBindings:function(e,i){1&e&&_.NdJ("valueChange",function(r){return i.change(r)})("onBlur",function(r){return i.touched(r)})},inputs:{acceptCustomValue:"acceptCustomValue",accessKey:"accessKey",activeStateEnabled:"activeStateEnabled",adaptivityEnabled:"adaptivityEnabled",applyButtonText:"applyButtonText",applyValueMode:"applyValueMode",buttons:"buttons",calendarOptions:"calendarOptions",cancelButtonText:"cancelButtonText",dateOutOfRangeMessage:"dateOutOfRangeMessage",dateSerializationFormat:"dateSerializationFormat",deferRendering:"deferRendering",disabled:"disabled",disabledDates:"disabledDates",displayFormat:"displayFormat",dropDownButtonTemplate:"dropDownButtonTemplate",dropDownOptions:"dropDownOptions",elementAttr:"elementAttr",focusStateEnabled:"focusStateEnabled",height:"height",hint:"hint",hoverStateEnabled:"hoverStateEnabled",inputAttr:"inputAttr",interval:"interval",invalidDateMessage:"invalidDateMessage",isValid:"isValid",label:"label",labelMode:"labelMode",max:"max",maxLength:"maxLength",min:"min",name:"name",opened:"opened",openOnFieldClick:"openOnFieldClick",pickerType:"pickerType",placeholder:"placeholder",readOnly:"readOnly",rtlEnabled:"rtlEnabled",showAnalogClock:"showAnalogClock",showClearButton:"showClearButton",showDropDownButton:"showDropDownButton",spellcheck:"spellcheck",stylingMode:"stylingMode",tabIndex:"tabIndex",text:"text",type:"type",useMaskBehavior:"useMaskBehavior",validationError:"validationError",validationErrors:"validationErrors",validationMessageMode:"validationMessageMode",validationStatus:"validationStatus",value:"value",valueChangeEvent:"valueChangeEvent",visible:"visible",width:"width"},outputs:{onChange:"onChange",onClosed:"onClosed",onContentReady:"onContentReady",onCopy:"onCopy",onCut:"onCut",onDisposing:"onDisposing",onEnterKey:"onEnterKey",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onInitialized:"onInitialized",onInput:"onInput",onKeyDown:"onKeyDown",onKeyUp:"onKeyUp",onOpened:"onOpened",onOptionChanged:"onOptionChanged",onPaste:"onPaste",onValueChanged:"onValueChanged",acceptCustomValueChange:"acceptCustomValueChange",accessKeyChange:"accessKeyChange",activeStateEnabledChange:"activeStateEnabledChange",adaptivityEnabledChange:"adaptivityEnabledChange",applyButtonTextChange:"applyButtonTextChange",applyValueModeChange:"applyValueModeChange",buttonsChange:"buttonsChange",calendarOptionsChange:"calendarOptionsChange",cancelButtonTextChange:"cancelButtonTextChange",dateOutOfRangeMessageChange:"dateOutOfRangeMessageChange",dateSerializationFormatChange:"dateSerializationFormatChange",deferRenderingChange:"deferRenderingChange",disabledChange:"disabledChange",disabledDatesChange:"disabledDatesChange",displayFormatChange:"displayFormatChange",dropDownButtonTemplateChange:"dropDownButtonTemplateChange",dropDownOptionsChange:"dropDownOptionsChange",elementAttrChange:"elementAttrChange",focusStateEnabledChange:"focusStateEnabledChange",heightChange:"heightChange",hintChange:"hintChange",hoverStateEnabledChange:"hoverStateEnabledChange",inputAttrChange:"inputAttrChange",intervalChange:"intervalChange",invalidDateMessageChange:"invalidDateMessageChange",isValidChange:"isValidChange",labelChange:"labelChange",labelModeChange:"labelModeChange",maxChange:"maxChange",maxLengthChange:"maxLengthChange",minChange:"minChange",nameChange:"nameChange",openedChange:"openedChange",openOnFieldClickChange:"openOnFieldClickChange",pickerTypeChange:"pickerTypeChange",placeholderChange:"placeholderChange",readOnlyChange:"readOnlyChange",rtlEnabledChange:"rtlEnabledChange",showAnalogClockChange:"showAnalogClockChange",showClearButtonChange:"showClearButtonChange",showDropDownButtonChange:"showDropDownButtonChange",spellcheckChange:"spellcheckChange",stylingModeChange:"stylingModeChange",tabIndexChange:"tabIndexChange",textChange:"textChange",typeChange:"typeChange",useMaskBehaviorChange:"useMaskBehaviorChange",validationErrorChange:"validationErrorChange",validationErrorsChange:"validationErrorsChange",validationMessageModeChange:"validationMessageModeChange",validationStatusChange:"validationStatusChange",valueChange:"valueChange",valueChangeEventChange:"valueChangeEventChange",visibleChange:"visibleChange",widthChange:"widthChange",onBlur:"onBlur"},features:[_._Bn([cn._5,cn._h,hP,cn.al,cn.i9]),_.qOj,_.TTD],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),cP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[[Re.idP,Re.UxI,Re.sRG,Re.o0O,Re.ggs,Re.IOm,Re.kOw,Re.weU,Re.D_l,Re.JxK,Re.zZW,Re.ynY,Re.lgR,Re.sni,Re.waX,Re.pxS,Re.pGy,cn.Lz,cn.ie,Gh.Cu],Re.idP,Re.UxI,Re.sRG,Re.o0O,Re.ggs,Re.IOm,Re.kOw,Re.weU,Re.D_l,Re.JxK,Re.zZW,Re.ynY,Re.lgR,Re.sni,Re.waX,Re.pxS,Re.pGy,cn.ie]}),n})();function uP(n,t){if(1&n&&(_.TgZ(0,"mat-option",22),_._uU(1),_.qZA()),2&n){const e=t.$implicit;_.Q6J("value",e.value),_.xp6(1),_.hij(" ",e.text," ")}}function dP(n,t){if(1&n){const e=_.EpF();_.ynx(0),_.TgZ(1,"div",1)(2,"div",2),_._uU(3,"3D"),_.qZA(),_.TgZ(4,"div",13)(5,"div",9),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.handleFlyMode())}),_.TgZ(6,"div",5),_._uU(7,"Fly Mode"),_.qZA(),_.TgZ(8,"div",6),_._UZ(9,"i",14),_.qZA()(),_._UZ(10,"div")(11,"div"),_.TgZ(12,"div",15),_._uU(13,"a"),_.qZA(),_._UZ(14,"div")(15,"div"),_.qZA()(),_.TgZ(16,"div",16)(17,"div",17),_._uU(18," Indicators "),_.qZA(),_.TgZ(19,"div",3)(20,"form",18)(21,"mat-form-field",19)(22,"mat-label"),_._uU(23,"Address View"),_.qZA(),_.TgZ(24,"mat-select",20),_.YNc(25,uP,2,2,"mat-option",21),_.qZA()()()()(),_.BQk()}if(2&n){const e=_.oxw();_.xp6(5),_.Q6J("ngClass",e.warehouseController.isFlyMode.isEnable?"red":""),_.xp6(15),_.Q6J("formGroup",e.formDropdown),_.xp6(5),_.Q6J("ngForOf",e.indicatorTypesDropdown)}}function fP(n,t){if(1&n&&(_.TgZ(0,"mat-option",22),_._uU(1),_.qZA()),2&n){const e=t.$implicit;_.Q6J("value",e.value),_.xp6(1),_.hij(" ",e.text," ")}}function pP(n,t){if(1&n){const e=_.EpF();_.ynx(0),_.TgZ(1,"div",32)(2,"div",33),_._uU(3,"Start"),_.qZA(),_.TgZ(4,"div",34)(5,"dx-date-box",35),_.NdJ("onValueChanged",function(s){_.CHM(e);const r=_.oxw(2);return _.KtG(r.onDateChange(!0,s))}),_.qZA()()(),_.TgZ(6,"div",32)(7,"div",33),_._uU(8,"End"),_.qZA(),_.TgZ(9,"div",34)(10,"dx-date-box",35),_.NdJ("onValueChanged",function(s){_.CHM(e);const r=_.oxw(2);return _.KtG(r.onDateChange(!1,s))}),_.qZA()()(),_.BQk()}}function mP(n,t){if(1&n){const e=_.EpF();_.ynx(0),_.TgZ(1,"div",1)(2,"div",2),_._uU(3,"Address"),_.qZA(),_.TgZ(4,"div",3)(5,"div",4),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.openAddressTypeModal())}),_.TgZ(6,"div",5),_._uU(7,"Select Adress"),_.qZA(),_.TgZ(8,"div",6),_._UZ(9,"i",23),_.qZA()(),_.TgZ(10,"div",9),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.handleSpawnMode())}),_.TgZ(11,"div",5),_._uU(12,"Place"),_.qZA(),_.TgZ(13,"div",6),_._UZ(14,"i",24),_.qZA()(),_.TgZ(15,"div",9),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.handleSelectionMode())}),_.TgZ(16,"div",5),_._uU(17,"Selection"),_.qZA(),_.TgZ(18,"div",6),_._UZ(19,"i",25),_.qZA()(),_.TgZ(20,"div",9),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.handleDragMode())}),_.TgZ(21,"div",5),_._uU(22,"Drag and Drop"),_.qZA(),_.TgZ(23,"div",6),_._UZ(24,"i",26),_.qZA()(),_.TgZ(25,"div",9),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.handleMetrics())}),_.TgZ(26,"div",5),_._uU(27,"Metrics"),_.qZA(),_.TgZ(28,"div",6),_._UZ(29,"i",27),_.qZA()(),_.TgZ(30,"div",28),_.NdJ("click",function(){_.CHM(e);const s=_.oxw();return _.KtG(s.handleRemove())}),_.TgZ(31,"div",5),_._uU(32,"Remove"),_.qZA(),_.TgZ(33,"div",6),_._UZ(34,"i",29),_.qZA()()()(),_.TgZ(35,"div",16)(36,"div",17),_._uU(37," Indicators "),_.qZA(),_.TgZ(38,"div",3)(39,"form",18)(40,"div",30)(41,"mat-form-field",31)(42,"mat-label"),_._uU(43,"Address View"),_.qZA(),_.TgZ(44,"mat-select",20),_.YNc(45,fP,2,2,"mat-option",21),_.qZA()(),_.TgZ(46,"div"),_.YNc(47,pP,11,0,"ng-container",12),_.qZA()()()()(),_.BQk()}if(2&n){const e=_.oxw();_.xp6(10),_.Q6J("ngClass",e.warehouseController.isSpawnMode.isEnable?"red":""),_.xp6(5),_.Q6J("ngClass",e.warehouseController.isSelectionMode.isEnable?"red":""),_.xp6(5),_.Q6J("ngClass",e.warehouseController.isDragMode.isEnable?"red":""),_.xp6(5),_.Q6J("ngClass",e.warehouseController.isMetrics.isEnable?"red":""),_.xp6(14),_.Q6J("formGroup",e.formDropdown),_.xp6(6),_.Q6J("ngForOf",e.indicatorTypesDropdown),_.xp6(2),_.Q6J("ngIf","None"!==e.indicatorSelected)}}let gP=(()=>{class n{constructor(e,i,s){this.warehouseService=e,this.http=i,this.modalService=s,this.items=["Address","Miscellaneous"],this.expandedIndex=0,this.addresses=[],this.isNewPointsSelected=!1,this.indicatorTypesDropdown=[{text:"None",value:$i.None},{text:"Picks",value:$i.Picks},{text:"Cases Picked",value:$i.CasesPicked},{text:"Restocks",value:$i.Restocks},{text:"Out of Stocks",value:$i.OutOfStocks},{text:"Heat Map",value:$i.HeatMap}],this.indicatorSelected=$i.None,this.startDate=new Date,this.endDate=new Date}ngOnInit(){window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=e=>{const i=JSON.parse(e);i.forEach(s=>delete s.id),this.warehouseService.saveAddresess(i).subscribe()},window.unityEvents.load2D=()=>{const e=JSON.stringify(this.addresses);this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",e)},window.unityEvents.onKeyboardArrowsDownChange=e=>{this.formDropdown.get("selectIndicatorDropdown")?.setValue(e)},this.warehouseController={isCameraMode:{isEnable:!0,action:qn.handleCameraModeGameInstance},isDragMode:{isEnable:!1,action:qn.handleDragModeGameInstance},isSelectionMode:{isEnable:!1,action:qn.handleSelectionModeGameInstance},isSpawnMode:{isEnable:!1,action:qn.handleSpawnModeGameInstance},isMetrics:{isEnable:!1,action:qn.handleMetricModeGameInstance},isHeatMapFlow2DMode:{isEnable:!1,action:qn.handleHeatMapFlow2D},isHeatMapPerAddress2DMode:{isEnable:!1,action:qn.handleHeatMapPerAddress2D},isFlyMode:{isEnable:!1,action:qn.handleFlyMode},isHeatMapPerAddress3DMode:{isEnable:!1,action:qn.handleHeatMapPerAddress3D},isMiscellaneousMode:{isEnable:!1,action:qn.handleMiscellaneous}},this.initFormControl()}initFormControl(){this.formDropdown=new pt.cw({selectIndicatorDropdown:new pt.NI("None"),selectScenarioDropdown:new pt.NI("current")}),this.formDropdown.get("selectIndicatorDropdown")?.valueChanges.subscribe(e=>{this.switchMenu?this.handleHeatMapPerAddress3D(e):this.indicatorSelected=e})}load2DAreaPicking(){this.warehouseService.loadAddresses(),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",i)}),this.http.get("assets/points.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapFlow",i)})}openAddressTypeModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(t0,{class:"modal-lg",initialState:{title:"Address Type",gameInstance:this.gameInstance}})}openMiscellaneousTypeModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(oP,{class:"modal-lg",initialState:{title:"Miscellaneous",gameInstance:this.gameInstance}})}handleCamera(){this.handleWarehouseControl([oi.isCameraMode],[])}handleSpawnMode(){this.handleWarehouseControl([oi.isSpawnMode],[oi.isSelectionMode,oi.isDragMode])}handleSelectionMode(){this.handleWarehouseControl([oi.isSelectionMode],[oi.isSpawnMode,oi.isDragMode,oi.isCameraMode])}handleDragMode(){this.handleWarehouseControl([oi.isDragMode],[oi.isCameraMode,oi.isSpawnMode])}handleMetrics(){this.handleWarehouseControl([oi.isMetrics],[oi.isSelectionMode,oi.isDragMode])}handleHeatMapFlow2D(){this.warehouseService.loadHeatMapFlow2D(this.startDate,this.endDate).subscribe(e=>{const i=JSON.stringify(e);this.isNewPointsSelected=!1,this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapFlow",i),this.handleWarehouseControl([oi.isHeatMapFlow2DMode],[oi.isSelectionMode,oi.isDragMode])})}handleFlyMode(){this.handleWarehouseControl([oi.isFlyMode],[])}handleHeatMapPerAddress3D(e){this.handleWarehouseControl([oi.isHeatMapPerAddress3DMode],[]),"None"===e?this.gameInstance.SendMessage("EventSystem","DisableHeatMapPerAddress3D"):this.gameInstance.SendMessage("EventSystem","LoadHeatMapPerAddress3D",e)}handleMiscellaneous(){this.handleWarehouseControl([oi.isMiscellaneousMode],[]),this.gameInstance.SendMessage("JavaScriptMessager","ClearMiscellaneous"),this.warehouseController.isMiscellaneousMode.isEnable?this.http.get("assets/miscellaneousLayoutParcial.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",i)}):this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",i)})}onDateChange(e,i){const s=i.value;switch(e?this.startDate=s:this.endDate=s,this.indicatorSelected){case $i.CasesPicked:break;case $i.HeatMap:this.handleHeatMapFlow2D()}}handleRemove(){this.gameInstance.SendMessage("JavaScriptMessager","HandleRemove")}saveAddressToDB(){this.gameInstance.SendMessage("JavaScriptMessager","SaveAddressToDB")}handleWarehouseControl(e,i){for(var s in this.warehouseController)e.includes(s)&&(console.log("b"),this.warehouseController[s].isEnable=!this.warehouseController[s].isEnable,this.warehouseController[s].action(this.gameInstance,this.warehouseController[s].isEnable)),i.includes(s)&&(this.warehouseController[s].isEnable=!1,this.warehouseController[s].action(this.gameInstance,this.warehouseController[s].isEnable))}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(hr),_.Y36(Hl.eN),_.Y36(lr.tT))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-warehouse-menu"]],inputs:{gameInstance:"gameInstance",switchMenu:"switchMenu"},decls:29,vars:6,consts:[[2,"background-color","white","width","100%",3,"ngClass"],[1,"div-menu-style"],[1,"label-bottom",2,"position","relative"],[1,"div-button-style"],["tabindex","0",1,"ui","vertical","animated","button",3,"click"],[1,"hidden","content"],[1,"visible","content"],[1,"world","icon"],[1,"save","icon"],["tabindex","0",1,"ui","vertical","animated","button",3,"ngClass","click"],[1,"camera","icon"],[1,"th","icon"],[4,"ngIf"],[1,"div-button-style",2,"grid-template-columns","50% 50%"],[1,"paper","plane","icon"],[2,"color","azure"],[1,"div-menu-style",2,"grid-template-columns","100%"],[1,"label-bottom",2,"position","relative","bottom","-1%"],[3,"formGroup"],["appearance","fill",2,"width","300%"],["formControlName","selectIndicatorDropdown"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"plus","icon"],[1,"object","ungroup","icon"],[1,"mouse","pointer","icon"],[1,"hand","rock","icon"],[1,"align","left","icon"],["tabindex","0",1,"ui","vertical","animated","yellow","button",3,"click"],[1,"trash","alternate","icon"],[2,"display","grid","grid-template-columns","100% 150%","column-gap","15px"],["appearance","fill",2,"width","100%"],[1,"dx-field"],[1,"dx-field-label"],[1,"dx-field-value"],["type","date",3,"onValueChanged"]],template:function(e,i){1&e&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2),_._uU(3,"Master"),_.qZA(),_.TgZ(4,"div",3)(5,"div",4),_.NdJ("click",function(){return i.load2DAreaPicking()}),_.TgZ(6,"div",5),_._uU(7,"Load 2D"),_.qZA(),_.TgZ(8,"div",6),_._UZ(9,"i",7),_.qZA()(),_.TgZ(10,"div",4),_.NdJ("click",function(){return i.saveAddressToDB()}),_.TgZ(11,"div",5),_._uU(12,"Save"),_.qZA(),_.TgZ(13,"div",6),_._UZ(14,"i",8),_.qZA()(),_.TgZ(15,"div",9),_.NdJ("click",function(){return i.handleCamera()}),_.TgZ(16,"div",5),_._uU(17),_.qZA(),_.TgZ(18,"div",6),_._UZ(19,"i",10),_.qZA()(),_.TgZ(20,"div",9),_.NdJ("click",function(){return i.handleMiscellaneous()}),_.TgZ(21,"div",5),_._uU(22,"Miscellaneous"),_.qZA(),_.TgZ(23,"div",6),_._UZ(24,"i",11),_.qZA()(),_._UZ(25,"div")(26,"div"),_.qZA()(),_.YNc(27,dP,26,3,"ng-container",12),_.YNc(28,mP,48,7,"ng-container",12),_.qZA()),2&e&&(_.Q6J("ngClass",i.switchMenu?"grid-layout-menu-2":"grid-layout-menu-3"),_.xp6(15),_.Q6J("ngClass",i.warehouseController.isCameraMode.isEnable?"red":""),_.xp6(2),_.hij(" Camera is ",i.warehouseController.isCameraMode.isEnable?"enable":"disable"," "),_.xp6(3),_.Q6J("ngClass",i.warehouseController.isMiscellaneousMode.isEnable?"red":""),_.xp6(7),_.Q6J("ngIf",i.switchMenu),_.xp6(1),_.Q6J("ngIf",!i.switchMenu))},dependencies:[ee.mk,ee.sg,ee.O5,pt._Y,pt.JJ,pt.JL,pt.sg,pt.u,kd.KE,kd.hX,l0.gD,Sa.ey,h0],styles:[".grid-layout-menu-3[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;margin-left:10px;display:grid;grid-template-columns:20% 30% 27%;column-gap:15px}.grid-layout-menu-2[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;margin-left:10px;display:grid;grid-template-columns:20% 10% 15% 15%;column-gap:15px}.div-menu-style[_ngcontent-%COMP%]{border:1px solid lightgray;display:grid;border-radius:20px}.div-button-style[_ngcontent-%COMP%]{margin:10px;display:grid;grid-row-gap:2.5px;grid-template-columns:33% 33% 33%;grid-template-rows:50% 50%}.green[_ngcontent-%COMP%]{background-color:green}.red[_ngcontent-%COMP%]{background-color:red}.label-bottom[_ngcontent-%COMP%]{align-items:center;display:inherit;flex-direction:column;background-color:#d3d3d3;border-radius:20px 20px 0 0;font-weight:700;text-align:center}"]}),n})(),_P=(()=>{class n{constructor(e){var i=this;this.warehouseService=e,this.isReady=!1,this.progress=0,this.gameInstanceEvent=new _.vpe,this.switchMenuEvent=new _.vpe,this.switchMenu=!1,window.unityEvents||(window.unityEvents={}),window.unityEvents.load3D=(0,Et.Z)(function*(){const s=yield(0,Bh.z)(i.warehouseService.load3dAddresses());console.log(s);const r=yield(0,Bh.z)(i.warehouseService.loadStaticMiscellaneousType()),a=yield(0,Bh.z)(i.warehouseService.loadStaticIndicators());i.localGameInstance.SendMessage("EventSystem","LoadIndicatorData",JSON.stringify(a)),i.localGameInstance.SendMessage("EventSystem","LoadAddress",JSON.stringify(s)),i.localGameInstance.SendMessage("EventSystem","LoadMiscellaneous",JSON.stringify(r))})}ngOnDestroy(){}ngOnInit(){const e=window.UnityLoader;this.unityInstance=e.instantiate("unityContainer","assets/build/Build/build.json",{onProgress:(i,s)=>{this.isReady=!0,this.localGameInstance=i,this.gameInstanceEvent.emit({gameInstance:this.localGameInstance}),this.localGameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false")}}),window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=i=>{const s=JSON.parse(i);s.forEach(r=>delete r.id),this.warehouseService.saveAddresess(s).subscribe()}}Load3D(){this.switchMenu=!this.switchMenu,this.switchMenuEvent.emit({switchMenu:this.switchMenu}),this.switchMenu?this.localGameInstance.SendMessage("JavaScriptMessager","Load3DScene"):this.localGameInstance.SendMessage("EventSystem","Load2DScene")}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(hr))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-warehouse-unity"]],outputs:{gameInstanceEvent:"gameInstanceEvent",switchMenuEvent:"switchMenuEvent"},decls:3,vars:1,consts:[[1,"button",3,"click"],["id","unityContainer",1,"unity-container"]],template:function(e,i){1&e&&(_.TgZ(0,"button",0),_.NdJ("click",function(){return i.Load3D()}),_._uU(1),_.qZA(),_._UZ(2,"div",1)),2&e&&(_.xp6(1),_.hij(" ",i.switchMenu?"2D":"3D","\n"))},styles:[".unity-container[_ngcontent-%COMP%], .unity-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{background-color:#000;height:94vh;margin:auto!important}.button[_ngcontent-%COMP%]{position:absolute;width:80px;height:30px;margin-top:1%;right:0;border-radius:10px;margin-right:1%;z-index:10;background:lightgrey;border:1px solid lightgrey}"]}),n})();const yP=[{path:"",component:(()=>{class n{constructor(e,i,s,r,a){this.http=e,this.modalService=i,this.store=s,this.warehouseService=r,this.dialog=a,this.progress=0,this.isReady=!1,this.warehouseStore=this.store.select(o=>o.warehouse),this.addresses2d=[]}ngOnInit(){this.warehouseStore.subscribe(e=>{this.gameInstance?.SendMessage("JavaScriptMessager","RecvJsonWithAddressDim",JSON.stringify(e.currentPositionTypeBin)),this.gameInstance?.SendMessage("JavaScriptMessager","HandleKeyboard","false")}),this.warehouseStore.subscribe(({addresses:e})=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadAddresses",i)}),window.unityEvents||(window.unityEvents={}),window.unityEvents.saveEvent=e=>{const i=JSON.parse(e);i.forEach(s=>delete s.id),this.warehouseService.saveAddresess(i).subscribe()},window.unityEvents.onClick2DAddress=e=>{this.bsModalRef=this.modalService.show(Mu,{class:"modal-lg",initialState:{title:"Address Detail",id:e}})}}onClickCreate2D(){this.warehouseService.loadAddresses(),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{const i=JSON.stringify(e);console.log(i),this.gameInstance.SendMessage("JavaScriptMessager","LoadMiscellaneous",i)})}onClickLoadHeatMapFlowData(){this.http.get("assets/points.json").subscribe(e=>{const i=JSON.stringify(e);this.gameInstance.SendMessage("JavaScriptMessager","LoadHeatMapFlow",i)})}openModal(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(t0,{class:"modal-lg",initialState:{title:"Area Picking"}})}openModalDev(){this.gameInstance.SendMessage("JavaScriptMessager","HandleKeyboard","false"),this.bsModalRef=this.modalService.show(Mu,{class:"modal-lg",initialState:{title:"Address Detail"}})}onSave(){this.gameInstance.SendMessage("JavaScriptMessager","SaveAddressToDB")}onClickCreate3D(){this.http.get("assets/address_3d.json").subscribe(e=>{e.forEach(i=>{i.hostName="",(0,_.X6Q)()&&(i.hostName="http://localhost:5003")}),this.gameInstance.SendMessage("EventSystem","LoadAddress",JSON.stringify(e))}),this.http.get("assets/miscellaneousLayout.json").subscribe(e=>{this.gameInstance.SendMessage("EventSystem","LoadMiscellaneous",JSON.stringify(e))})}setGameInstance(e){this.gameInstance=e.gameInstance}setSwitch(e){this.switchMenu=e.switchMenu}openDialog(){this.dialog.open(Mu).afterClosed().subscribe(i=>{console.log(`Dialog result: ${i}`)})}}return n.\u0275fac=function(e){return new(e||n)(_.Y36(Hl.eN),_.Y36(lr.tT),_.Y36(Vl.yh),_.Y36(hr),_.Y36(kh))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-warehouse"]],decls:4,vars:2,consts:[[1,"grid-layout-main"],[3,"gameInstance","switchMenu"],[3,"gameInstanceEvent","switchMenuEvent"]],template:function(e,i){1&e&&(_.TgZ(0,"div")(1,"div",0),_._UZ(2,"app-warehouse-menu",1),_.TgZ(3,"app-warehouse-unity",2),_.NdJ("gameInstanceEvent",function(r){return i.setGameInstance(r)})("switchMenuEvent",function(r){return i.setSwitch(r)}),_.qZA()()()),2&e&&(_.xp6(2),_.Q6J("gameInstance",i.gameInstance)("switchMenu",i.switchMenu))},dependencies:[gP,_P],styles:[".grid-layout-main[_ngcontent-%COMP%]{display:grid;height:100vh;width:100vw}.grid-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:50% 50%}canvas[_ngcontent-%COMP%]{border:1px solid black}"]}),n})()}];let xP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[ni.Bz.forChild(yP),ni.Bz]}),n})();var vP=ot(5349),bP=ot(3390),wP=ot(2171),MP=ot(2643),Gd=ot(7507),zd=ot(6142),SP=ot(9841),TP=ot(3101),EP=ot(3268);function c0(n,t,e){return e?c0(n,t).pipe((0,EP.Z)(e)):new Pe.y(i=>{const s=(...a)=>i.next(1===a.length?a[0]:a),r=n(s);return(0,xu.m)(t)?()=>t(s,r):void 0})}var Ta=ot(2722);const u0=new Set;let Ea;class jn{constructor(t){this.platform=t,this._matchMedia=this.platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):CP}matchMedia(t){return this.platform.WEBKIT&&function AP(n){if(!u0.has(n))try{Ea||(Ea=document.createElement("style"),Ea.setAttribute("type","text/css"),document.head.appendChild(Ea)),Ea.sheet&&(Ea.sheet.insertRule(`@media ${n} {.fx-query-test{ }}`,0),u0.add(n))}catch(t){console.error(t)}}(t),this._matchMedia(t)}}function CP(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}jn.\u0275fac=function(t){return new(t||jn)(_.LFG(zd.t4))},jn.\u0275prov=_.Yz7({token:jn,factory:jn.\u0275fac,providedIn:"root"}),jn.ngInjectableDef=(0,_.Ez6)({factory:function(){return new jn((0,_.f3M)(zd.t4))},token:jn,providedIn:"root"});class ps{constructor(t,e){this.mediaMatcher=t,this.zone=e,this._queries=new Map,this._destroySubject=new Ls.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return d0((0,Gd.Eq)(t)).some(i=>this._registerQuery(i).mql.matches)}observe(t){const i=d0((0,Gd.Eq)(t)).map(s=>this._registerQuery(s).observable);return(0,SP.a)(i).pipe((0,bu.b)(0,TP.E),(0,ye.U)(s=>{const r={matches:!1,breakpoints:{}};return s.forEach(a=>{r.matches=r.matches||a.matches,r.breakpoints[a.query]=a.matches}),r}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const e=this.mediaMatcher.matchMedia(t);let i;const r={observable:c0(a=>{i=o=>this.zone.run(()=>a(o)),e.addListener(i)},()=>e.removeListener(i)).pipe((0,i0.O)(e),(0,ye.U)(a=>({query:t,matches:a.matches})),(0,Ta.R)(this._destroySubject)),mql:e};return this._queries.set(t,r),r}}function d0(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}ps.\u0275fac=function(t){return new(t||ps)(_.LFG(jn),_.LFG(_.R0b))},ps.\u0275prov=_.Yz7({token:ps,factory:ps.\u0275fac,providedIn:"root"}),ps.ngInjectableDef=(0,_.Ez6)({factory:function(){return new ps((0,_.f3M)(jn),(0,_.f3M)(_.R0b))},token:ps,providedIn:"root"}),ot(1719);const m0=new _.OlP("mat-tooltip-default-options",{providedIn:"root",factory:function FP(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),g0={showDelay:0,hideDelay:0,touchGestures:"auto",position:"before",touchendHideDelay:0,disableTooltipInteractivity:!0};let UP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({providers:[lr.tT,hr,{provide:m0,useValue:g0}],imports:[ee.ez,xP,vP.m,lr.zk,kd.lN,bP.c,l0.LD,cP,pt.UX,wP.XD,MP.Ps,cn.ie,rP,nS]}),n})()},5469:ci=>{"use strict";function me(P,G,N){N=N||2;var ut,Ct,xt,ce,yt,Bt,ge,nt=G&&G.length,ht=nt?G[0]*N:P.length,k=ot(P,0,ht,N,!0),H=[];if(!k||k.next===k.prev)return H;if(nt&&(k=function Jt(P,G,N,nt){var k,H,xt,ht=[];for(k=0,H=G.length;k<H;k++)(xt=ot(P,G[k]*nt,k<H-1?G[k+1]*nt:P.length,nt,!1))===xt.next&&(xt.steiner=!0),ht.push(Di(xt));for(ht.sort(Xt),k=0;k<ht.length;k++)N=he(ht[k],N);return N}(P,G,k,N)),P.length>80*N){ut=xt=P[0],Ct=ce=P[1];for(var ie=N;ie<ht;ie+=N)(yt=P[ie])<ut&&(ut=yt),(Bt=P[ie+1])<Ct&&(Ct=Bt),yt>xt&&(xt=yt),Bt>ce&&(ce=Bt);ge=0!==(ge=Math.max(xt-ut,ce-Ct))?32767/ge:0}return ni(k,H,N,ut,Ct,ge,0),H}function ot(P,G,N,nt,ht){var k,H;if(ht===li(P,G,N,nt)>0)for(k=G;k<N;k+=nt)H=We(k,P[k],P[k+1],H);else for(k=N-nt;k>=G;k-=nt)H=We(k,P[k],P[k+1],H);return H&&Li(H,H.next)&&(Ue(H),H=H.next),H}function ee(P,G){if(!P)return P;G||(G=P);var nt,N=P;do{if(nt=!1,N.steiner||!Li(N,N.next)&&0!==Ce(N.prev,N,N.next))N=N.next;else{if(Ue(N),(N=G=N.prev)===N.next)break;nt=!0}}while(nt||N!==G);return G}function ni(P,G,N,nt,ht,k,H){if(P){!H&&k&&function Ee(P,G,N,nt){var ht=P;do{0===ht.z&&(ht.z=Vt(ht.x,ht.y,G,N,nt)),ht.prevZ=ht.prev,ht.nextZ=ht.next,ht=ht.next}while(ht!==P);ht.prevZ.nextZ=null,ht.prevZ=null,function ze(P){var G,N,nt,ht,k,H,ut,Ct,xt=1;do{for(N=P,P=null,k=null,H=0;N;){for(H++,nt=N,ut=0,G=0;G<xt&&(ut++,nt=nt.nextZ);G++);for(Ct=xt;ut>0||Ct>0&&nt;)0!==ut&&(0===Ct||!nt||N.z<=nt.z)?(ht=N,N=N.nextZ,ut--):(ht=nt,nt=nt.nextZ,Ct--),k?k.nextZ=ht:P=ht,ht.prevZ=k,k=ht;N=nt}k.nextZ=null,xt*=2}while(H>1)}(ht)}(P,nt,ht,k);for(var Ct,xt,ut=P;P.prev!==P.next;)if(Ct=P.prev,xt=P.next,k?pt(P,nt,ht,k):_(P))G.push(Ct.i/N|0),G.push(P.i/N|0),G.push(xt.i/N|0),Ue(P),P=xt.next,ut=xt.next;else if((P=xt)===ut){H?1===H?ni(P=ye(ee(P),G,N),G,N,nt,ht,k,2):2===H&&xe(P,G,N,nt,ht,k):ni(ee(P),G,N,nt,ht,k,1);break}}}function _(P){var G=P.prev,N=P,nt=P.next;if(Ce(G,N,nt)>=0)return!1;for(var ht=G.x,k=N.x,H=nt.x,ut=G.y,Ct=N.y,xt=nt.y,ce=ht<k?ht<H?ht:H:k<H?k:H,yt=ut<Ct?ut<xt?ut:xt:Ct<xt?Ct:xt,Bt=ht>k?ht>H?ht:H:k>H?k:H,ge=ut>Ct?ut>xt?ut:xt:Ct>xt?Ct:xt,ie=nt.next;ie!==G;){if(ie.x>=ce&&ie.x<=Bt&&ie.y>=yt&&ie.y<=ge&&ui(ht,ut,k,Ct,H,xt,ie.x,ie.y)&&Ce(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function pt(P,G,N,nt){var ht=P.prev,k=P,H=P.next;if(Ce(ht,k,H)>=0)return!1;for(var ut=ht.x,Ct=k.x,xt=H.x,ce=ht.y,yt=k.y,Bt=H.y,ge=ut<Ct?ut<xt?ut:xt:Ct<xt?Ct:xt,ie=ce<yt?ce<Bt?ce:Bt:yt<Bt?yt:Bt,Xe=ut>Ct?ut>xt?ut:xt:Ct>xt?Ct:xt,Ye=ce>yt?ce>Bt?ce:Bt:yt>Bt?yt:Bt,Ke=Vt(ge,ie,G,N,nt),je=Vt(Xe,Ye,G,N,nt),le=P.prevZ,de=P.nextZ;le&&le.z>=Ke&&de&&de.z<=je;){if(le.x>=ge&&le.x<=Xe&&le.y>=ie&&le.y<=Ye&&le!==ht&&le!==H&&ui(ut,ce,Ct,yt,xt,Bt,le.x,le.y)&&Ce(le.prev,le,le.next)>=0||(le=le.prevZ,de.x>=ge&&de.x<=Xe&&de.y>=ie&&de.y<=Ye&&de!==ht&&de!==H&&ui(ut,ce,Ct,yt,xt,Bt,de.x,de.y)&&Ce(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;le&&le.z>=Ke;){if(le.x>=ge&&le.x<=Xe&&le.y>=ie&&le.y<=Ye&&le!==ht&&le!==H&&ui(ut,ce,Ct,yt,xt,Bt,le.x,le.y)&&Ce(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;de&&de.z<=je;){if(de.x>=ge&&de.x<=Xe&&de.y>=ie&&de.y<=Ye&&de!==ht&&de!==H&&ui(ut,ce,Ct,yt,xt,Bt,de.x,de.y)&&Ce(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function ye(P,G,N){var nt=P;do{var ht=nt.prev,k=nt.next.next;!Li(ht,k)&&zi(ht,nt,nt.next,k)&&J(ht,k)&&J(k,ht)&&(G.push(ht.i/N|0),G.push(nt.i/N|0),G.push(k.i/N|0),Ue(nt),Ue(nt.next),nt=P=k),nt=nt.next}while(nt!==P);return ee(nt)}function xe(P,G,N,nt,ht,k){var H=P;do{for(var ut=H.next.next;ut!==H.prev;){if(H.i!==ut.i&&He(H,ut)){var Ct=q(H,ut);return H=ee(H,H.next),Ct=ee(Ct,Ct.next),ni(H,G,N,nt,ht,k,0),void ni(Ct,G,N,nt,ht,k,0)}ut=ut.next}H=H.next}while(H!==P)}function Xt(P,G){return P.x-G.x}function he(P,G){var N=function Pe(P,G){var H,N=G,nt=P.x,ht=P.y,k=-1/0;do{if(ht<=N.y&&ht>=N.next.y&&N.next.y!==N.y){var ut=N.x+(ht-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(ut<=nt&&ut>k&&(k=ut,H=N.x<N.next.x?N:N.next,ut===nt))return H}N=N.next}while(N!==G);if(!H)return null;var Bt,Ct=H,xt=H.x,ce=H.y,yt=1/0;N=H;do{nt>=N.x&&N.x>=xt&&nt!==N.x&&ui(ht<ce?nt:k,ht,xt,ce,ht<ce?k:nt,ht,N.x,N.y)&&(Bt=Math.abs(ht-N.y)/(nt-N.x),J(N,P)&&(Bt<yt||Bt===yt&&(N.x>H.x||N.x===H.x&&Et(H,N)))&&(H=N,yt=Bt)),N=N.next}while(N!==Ct);return H}(P,G);if(!N)return G;var nt=q(N,P);return ee(nt,nt.next),ee(N,N.next)}function Et(P,G){return Ce(P.prev,P,G.prev)<0&&Ce(G.next,P,P.next)<0}function Vt(P,G,N,nt,ht){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P=(P-N)*ht|0)|P<<8))|P<<4))|P<<2))|P<<1))|(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G=(G-nt)*ht|0)|G<<8))|G<<4))|G<<2))|G<<1))<<1}function Di(P){var G=P,N=P;do{(G.x<N.x||G.x===N.x&&G.y<N.y)&&(N=G),G=G.next}while(G!==P);return N}function ui(P,G,N,nt,ht,k,H,ut){return(ht-H)*(G-ut)>=(P-H)*(k-ut)&&(P-H)*(nt-ut)>=(N-H)*(G-ut)&&(N-H)*(k-ut)>=(ht-H)*(nt-ut)}function He(P,G){return P.next.i!==G.i&&P.prev.i!==G.i&&!function fn(P,G){var N=P;do{if(N.i!==P.i&&N.next.i!==P.i&&N.i!==G.i&&N.next.i!==G.i&&zi(N,N.next,P,G))return!0;N=N.next}while(N!==P);return!1}(P,G)&&(J(P,G)&&J(G,P)&&function Me(P,G){var N=P,nt=!1,ht=(P.x+G.x)/2,k=(P.y+G.y)/2;do{N.y>k!=N.next.y>k&&N.next.y!==N.y&&ht<(N.next.x-N.x)*(k-N.y)/(N.next.y-N.y)+N.x&&(nt=!nt),N=N.next}while(N!==P);return nt}(P,G)&&(Ce(P.prev,P,G.prev)||Ce(P,G.prev,G))||Li(P,G)&&Ce(P.prev,P,P.next)>0&&Ce(G.prev,G,G.next)>0)}function Ce(P,G,N){return(G.y-P.y)*(N.x-G.x)-(G.x-P.x)*(N.y-G.y)}function Li(P,G){return P.x===G.x&&P.y===G.y}function zi(P,G,N,nt){var ht=Ai(Ce(P,G,N)),k=Ai(Ce(P,G,nt)),H=Ai(Ce(N,nt,P)),ut=Ai(Ce(N,nt,G));return!!(ht!==k&&H!==ut||0===ht&&bi(P,N,G)||0===k&&bi(P,nt,G)||0===H&&bi(N,P,nt)||0===ut&&bi(N,G,nt))}function bi(P,G,N){return G.x<=Math.max(P.x,N.x)&&G.x>=Math.min(P.x,N.x)&&G.y<=Math.max(P.y,N.y)&&G.y>=Math.min(P.y,N.y)}function Ai(P){return P>0?1:P<0?-1:0}function J(P,G){return Ce(P.prev,P,P.next)<0?Ce(P,G,P.next)>=0&&Ce(P,P.prev,G)>=0:Ce(P,G,P.prev)<0||Ce(P,P.next,G)<0}function q(P,G){var N=new wi(P.i,P.x,P.y),nt=new wi(G.i,G.x,G.y),ht=P.next,k=G.prev;return P.next=G,G.prev=P,N.next=ht,ht.prev=N,nt.next=N,N.prev=nt,k.next=nt,nt.prev=k,nt}function We(P,G,N,nt){var ht=new wi(P,G,N);return nt?(ht.next=nt.next,ht.prev=nt,nt.next.prev=ht,nt.next=ht):(ht.prev=ht,ht.next=ht),ht}function Ue(P){P.next.prev=P.prev,P.prev.next=P.next,P.prevZ&&(P.prevZ.nextZ=P.nextZ),P.nextZ&&(P.nextZ.prevZ=P.prevZ)}function wi(P,G,N){this.i=P,this.x=G,this.y=N,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function li(P,G,N,nt){for(var ht=0,k=G,H=N-nt;k<N;k+=nt)ht+=(P[H]-P[k])*(P[k+1]+P[H+1]),H=k;return ht}ci.exports=me,ci.exports.default=me,me.deviation=function(P,G,N,nt){var ht=G&&G.length,H=Math.abs(li(P,0,ht?G[0]*N:P.length,N));if(ht)for(var ut=0,Ct=G.length;ut<Ct;ut++)H-=Math.abs(li(P,G[ut]*N,ut<Ct-1?G[ut+1]*N:P.length,N));var yt=0;for(ut=0;ut<nt.length;ut+=3){var Bt=nt[ut]*N,ge=nt[ut+1]*N,ie=nt[ut+2]*N;yt+=Math.abs((P[Bt]-P[ie])*(P[ge+1]-P[Bt+1])-(P[Bt]-P[ge])*(P[ie+1]-P[Bt+1]))}return 0===H&&0===yt?0:Math.abs((yt-H)/H)},me.flatten=function(P){for(var G=P[0][0].length,N={vertices:[],holes:[],dimensions:G},nt=0,ht=0;ht<P.length;ht++){for(var k=0;k<P[ht].length;k++)for(var H=0;H<G;H++)N.vertices.push(P[ht][k][H]);ht>0&&N.holes.push(nt+=P[ht-1].length)}return N}},2005:ci=>{"use strict";var me=Object.prototype.hasOwnProperty,ot="~";function ee(){}function ni(xe,Jt,Xt){this.fn=xe,this.context=Jt,this.once=Xt||!1}function _(xe,Jt,Xt,he,Pe){if("function"!=typeof Xt)throw new TypeError("The listener must be a function");var Et=new ni(Xt,he||xe,Pe),Ee=ot?ot+Jt:Jt;return xe._events[Ee]?xe._events[Ee].fn?xe._events[Ee]=[xe._events[Ee],Et]:xe._events[Ee].push(Et):(xe._events[Ee]=Et,xe._eventsCount++),xe}function pt(xe,Jt){0==--xe._eventsCount?xe._events=new ee:delete xe._events[Jt]}function ye(){this._events=new ee,this._eventsCount=0}Object.create&&(ee.prototype=Object.create(null),(new ee).__proto__||(ot=!1)),ye.prototype.eventNames=function(){var Xt,he,Jt=[];if(0===this._eventsCount)return Jt;for(he in Xt=this._events)me.call(Xt,he)&&Jt.push(ot?he.slice(1):he);return Object.getOwnPropertySymbols?Jt.concat(Object.getOwnPropertySymbols(Xt)):Jt},ye.prototype.listeners=function(Jt){var he=this._events[ot?ot+Jt:Jt];if(!he)return[];if(he.fn)return[he.fn];for(var Pe=0,Et=he.length,Ee=new Array(Et);Pe<Et;Pe++)Ee[Pe]=he[Pe].fn;return Ee},ye.prototype.listenerCount=function(Jt){var he=this._events[ot?ot+Jt:Jt];return he?he.fn?1:he.length:0},ye.prototype.emit=function(Jt,Xt,he,Pe,Et,Ee){var ze=ot?ot+Jt:Jt;if(!this._events[ze])return!1;var ui,He,Vt=this._events[ze],Di=arguments.length;if(Vt.fn){switch(Vt.once&&this.removeListener(Jt,Vt.fn,void 0,!0),Di){case 1:return Vt.fn.call(Vt.context),!0;case 2:return Vt.fn.call(Vt.context,Xt),!0;case 3:return Vt.fn.call(Vt.context,Xt,he),!0;case 4:return Vt.fn.call(Vt.context,Xt,he,Pe),!0;case 5:return Vt.fn.call(Vt.context,Xt,he,Pe,Et),!0;case 6:return Vt.fn.call(Vt.context,Xt,he,Pe,Et,Ee),!0}for(He=1,ui=new Array(Di-1);He<Di;He++)ui[He-1]=arguments[He];Vt.fn.apply(Vt.context,ui)}else{var Li,Ce=Vt.length;for(He=0;He<Ce;He++)switch(Vt[He].once&&this.removeListener(Jt,Vt[He].fn,void 0,!0),Di){case 1:Vt[He].fn.call(Vt[He].context);break;case 2:Vt[He].fn.call(Vt[He].context,Xt);break;case 3:Vt[He].fn.call(Vt[He].context,Xt,he);break;case 4:Vt[He].fn.call(Vt[He].context,Xt,he,Pe);break;default:if(!ui)for(Li=1,ui=new Array(Di-1);Li<Di;Li++)ui[Li-1]=arguments[Li];Vt[He].fn.apply(Vt[He].context,ui)}}return!0},ye.prototype.on=function(Jt,Xt,he){return _(this,Jt,Xt,he,!1)},ye.prototype.once=function(Jt,Xt,he){return _(this,Jt,Xt,he,!0)},ye.prototype.removeListener=function(Jt,Xt,he,Pe){var Et=ot?ot+Jt:Jt;if(!this._events[Et])return this;if(!Xt)return pt(this,Et),this;var Ee=this._events[Et];if(Ee.fn)Ee.fn===Xt&&(!Pe||Ee.once)&&(!he||Ee.context===he)&&pt(this,Et);else{for(var ze=0,Vt=[],Di=Ee.length;ze<Di;ze++)(Ee[ze].fn!==Xt||Pe&&!Ee[ze].once||he&&Ee[ze].context!==he)&&Vt.push(Ee[ze]);Vt.length?this._events[Et]=1===Vt.length?Vt[0]:Vt:pt(this,Et)}return this},ye.prototype.removeAllListeners=function(Jt){var Xt;return Jt?this._events[Xt=ot?ot+Jt:Jt]&&pt(this,Xt):(this._events=new ee,this._eventsCount=0),this},ye.prototype.off=ye.prototype.removeListener,ye.prototype.addListener=ye.prototype.on,ye.prefixed=ot,ye.EventEmitter=ye,ci.exports=ye},516:ci=>{"use strict";function me(ot,ee){return Object.prototype.hasOwnProperty.call(ot,ee)}ci.exports=function(ot,ee,ni,_){ni=ni||"=";var pt={};if("string"!=typeof ot||0===ot.length)return pt;var ye=/\+/g;ot=ot.split(ee=ee||"&");var xe=1e3;_&&"number"==typeof _.maxKeys&&(xe=_.maxKeys);var Jt=ot.length;xe>0&&Jt>xe&&(Jt=xe);for(var Xt=0;Xt<Jt;++Xt){var Et,Ee,ze,Vt,he=ot[Xt].replace(ye,"%20"),Pe=he.indexOf(ni);Pe>=0?(Et=he.substr(0,Pe),Ee=he.substr(Pe+1)):(Et=he,Ee=""),ze=decodeURIComponent(Et),Vt=decodeURIComponent(Ee),me(pt,ze)?Array.isArray(pt[ze])?pt[ze].push(Vt):pt[ze]=[pt[ze],Vt]:pt[ze]=Vt}return pt}},5776:ci=>{"use strict";var me=function(ot){switch(typeof ot){case"string":return ot;case"boolean":return ot?"true":"false";case"number":return isFinite(ot)?ot:"";default:return""}};ci.exports=function(ot,ee,ni,_){return ee=ee||"&",ni=ni||"=",null===ot&&(ot=void 0),"object"==typeof ot?Object.keys(ot).map(function(pt){var ye=encodeURIComponent(me(pt))+ni;return Array.isArray(ot[pt])?ot[pt].map(function(xe){return ye+encodeURIComponent(me(xe))}).join(ee):ye+encodeURIComponent(me(ot[pt]))}).join(ee):_?encodeURIComponent(me(_))+ni+encodeURIComponent(me(ot)):""}},7137:(ci,me,ot)=>{"use strict";me.decode=me.parse=ot(516),me.encode=me.stringify=ot(5776)},1308:function(ci,me,ot){var ee;ci=ot.nmd(ci),function(ni){"object"==typeof global&&global;var xe,Jt=2147483647,ui=/^xn--/,He=/[^\x20-\x7E]/,Ce=/[\x2E\u3002\uFF0E\uFF61]/g,Li={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},bi=Math.floor,Ai=String.fromCharCode;function J(k){throw RangeError(Li[k])}function Me(k,H){for(var ut=k.length,Ct=[];ut--;)Ct[ut]=H(k[ut]);return Ct}function q(k,H){var ut=k.split("@"),Ct="";return ut.length>1&&(Ct=ut[0]+"@",k=ut[1]),Ct+Me((k=k.replace(Ce,".")).split("."),H).join(".")}function We(k){for(var xt,ce,H=[],ut=0,Ct=k.length;ut<Ct;)(xt=k.charCodeAt(ut++))>=55296&&xt<=56319&&ut<Ct?56320==(64512&(ce=k.charCodeAt(ut++)))?H.push(((1023&xt)<<10)+(1023&ce)+65536):(H.push(xt),ut--):H.push(xt);return H}function Ue(k){return Me(k,function(H){var ut="";return H>65535&&(ut+=Ai((H-=65536)>>>10&1023|55296),H=56320|1023&H),ut+Ai(H)}).join("")}function wi(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:36}function li(k,H){return k+22+75*(k<26)-((0!=H)<<5)}function P(k,H,ut){var Ct=0;for(k=ut?bi(k/700):k>>1,k+=bi(k/H);k>455;Ct+=36)k=bi(k/35);return bi(Ct+36*k/(k+38))}function G(k){var Ct,Bt,ge,ie,Xe,Ye,Ke,je,le,de,H=[],ut=k.length,xt=0,ce=128,yt=72;for((Bt=k.lastIndexOf("-"))<0&&(Bt=0),ge=0;ge<Bt;++ge)k.charCodeAt(ge)>=128&&J("not-basic"),H.push(k.charCodeAt(ge));for(ie=Bt>0?Bt+1:0;ie<ut;){for(Xe=xt,Ye=1,Ke=36;ie>=ut&&J("invalid-input"),((je=wi(k.charCodeAt(ie++)))>=36||je>bi((Jt-xt)/Ye))&&J("overflow"),xt+=je*Ye,!(je<(le=Ke<=yt?1:Ke>=yt+26?26:Ke-yt));Ke+=36)Ye>bi(Jt/(de=36-le))&&J("overflow"),Ye*=de;yt=P(xt-Xe,Ct=H.length+1,0==Xe),bi(xt/Ct)>Jt-ce&&J("overflow"),ce+=bi(xt/Ct),xt%=Ct,H.splice(xt++,0,ce)}return Ue(H)}function N(k){var H,ut,Ct,xt,ce,yt,Bt,ge,ie,Xe,Ye,je,le,de,Jn,Ke=[];for(je=(k=We(k)).length,H=128,ut=0,ce=72,yt=0;yt<je;++yt)(Ye=k[yt])<128&&Ke.push(Ai(Ye));for(Ct=xt=Ke.length,xt&&Ke.push("-");Ct<je;){for(Bt=Jt,yt=0;yt<je;++yt)(Ye=k[yt])>=H&&Ye<Bt&&(Bt=Ye);for(Bt-H>bi((Jt-ut)/(le=Ct+1))&&J("overflow"),ut+=(Bt-H)*le,H=Bt,yt=0;yt<je;++yt)if((Ye=k[yt])<H&&++ut>Jt&&J("overflow"),Ye==H){for(ge=ut,ie=36;!(ge<(Xe=ie<=ce?1:ie>=ce+26?26:ie-ce));ie+=36)Ke.push(Ai(li(Xe+(Jn=ge-Xe)%(de=36-Xe),0))),ge=bi(Jn/de);Ke.push(Ai(li(ge,0))),ce=P(ut,le,Ct==xt),ut=0,++Ct}++ut,++H}return Ke.join("")}xe={version:"1.3.2",ucs2:{decode:We,encode:Ue},decode:G,encode:N,toASCII:function ht(k){return q(k,function(H){return He.test(H)?"xn--"+N(H):H})},toUnicode:function nt(k){return q(k,function(H){return ui.test(H)?G(H.slice(4).toLowerCase()):H})}},void 0!==(ee=function(){return xe}.call(me,ot,me,ci))&&(ci.exports=ee)}()},8762:(ci,me,ot)=>{"use strict";var ni=ot(1308),_=ot(796);function pt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}me.Qc=zi,me.DB=function Ai(J,Me){return zi(J,!1,!0).resolve(Me)},me.WU=function bi(J){return _.isString(J)&&(J=zi(J)),J instanceof pt?J.format():pt.prototype.format.call(J)};var ye=/^([a-z0-9.+-]+:)/i,xe=/:[0-9]*$/,Jt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,he=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Pe=["'"].concat(he),Et=["%","/","?",";","#"].concat(Pe),Ee=["/","?","#"],Vt=/^[+a-z0-9A-Z_-]{0,63}$/,Di=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ui={javascript:!0,"javascript:":!0},He={javascript:!0,"javascript:":!0},Ce={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Li=ot(7137);function zi(J,Me,q){if(J&&_.isObject(J)&&J instanceof pt)return J;var We=new pt;return We.parse(J,Me,q),We}pt.prototype.parse=function(J,Me,q){if(!_.isString(J))throw new TypeError("Parameter 'url' must be a string, not "+typeof J);var We=J.indexOf("?"),Ue=-1!==We&&We<J.indexOf("#")?"?":"#",wi=J.split(Ue);wi[0]=wi[0].replace(/\\/g,"/");var P=J=wi.join(Ue);if(P=P.trim(),!q&&1===J.split("#").length){var G=Jt.exec(P);if(G)return this.path=P,this.href=P,this.pathname=G[1],G[2]?(this.search=G[2],this.query=Me?Li.parse(this.search.substr(1)):this.search.substr(1)):Me&&(this.search="",this.query={}),this}var N=ye.exec(P);if(N){var nt=(N=N[0]).toLowerCase();this.protocol=nt,P=P.substr(N.length)}if(q||N||P.match(/^\/\/[^@\/]+@[^@\/]+/)){var ht="//"===P.substr(0,2);ht&&(!N||!He[N])&&(P=P.substr(2),this.slashes=!0)}if(!He[N]&&(ht||N&&!Ce[N])){for(var k=-1,H=0;H<Ee.length;H++)-1!==(ut=P.indexOf(Ee[H]))&&(-1===k||ut<k)&&(k=ut);var Ct,xt;for(-1!==(xt=-1===k?P.lastIndexOf("@"):P.lastIndexOf("@",k))&&(Ct=P.slice(0,xt),P=P.slice(xt+1),this.auth=decodeURIComponent(Ct)),k=-1,H=0;H<Et.length;H++){var ut;-1!==(ut=P.indexOf(Et[H]))&&(-1===k||ut<k)&&(k=ut)}-1===k&&(k=P.length),this.host=P.slice(0,k),P=P.slice(k),this.parseHost(),this.hostname=this.hostname||"";var ce="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ce)for(var yt=this.hostname.split(/\./),Bt=(H=0,yt.length);H<Bt;H++){var ge=yt[H];if(ge&&!ge.match(Vt)){for(var ie="",Xe=0,Ye=ge.length;Xe<Ye;Xe++)ge.charCodeAt(Xe)>127?ie+="x":ie+=ge[Xe];if(!ie.match(Vt)){var Ke=yt.slice(0,H),je=yt.slice(H+1),le=ge.match(Di);le&&(Ke.push(le[1]),je.unshift(le[2])),je.length&&(P="/"+je.join(".")+P),this.hostname=Ke.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),ce||(this.hostname=ni.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,ce&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==P[0]&&(P="/"+P))}if(!ui[nt])for(H=0,Bt=Pe.length;H<Bt;H++){var Bs=Pe[H];if(-1!==P.indexOf(Bs)){var Aa=encodeURIComponent(Bs);Aa===Bs&&(Aa=escape(Bs)),P=P.split(Bs).join(Aa)}}var Ca=P.indexOf("#");-1!==Ca&&(this.hash=P.substr(Ca),P=P.slice(0,Ca));var Er=P.indexOf("?");return-1!==Er?(this.search=P.substr(Er),this.query=P.substr(Er+1),Me&&(this.query=Li.parse(this.query)),P=P.slice(0,Er)):Me&&(this.search="",this.query={}),P&&(this.pathname=P),Ce[nt]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},pt.prototype.format=function(){var J=this.auth||"";J&&(J=(J=encodeURIComponent(J)).replace(/%3A/i,":"),J+="@");var Me=this.protocol||"",q=this.pathname||"",We=this.hash||"",Ue=!1,wi="";this.host?Ue=J+this.host:this.hostname&&(Ue=J+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(Ue+=":"+this.port)),this.query&&_.isObject(this.query)&&Object.keys(this.query).length&&(wi=Li.stringify(this.query));var li=this.search||wi&&"?"+wi||"";return Me&&":"!==Me.substr(-1)&&(Me+=":"),this.slashes||(!Me||Ce[Me])&&!1!==Ue?(Ue="//"+(Ue||""),q&&"/"!==q.charAt(0)&&(q="/"+q)):Ue||(Ue=""),We&&"#"!==We.charAt(0)&&(We="#"+We),li&&"?"!==li.charAt(0)&&(li="?"+li),Me+Ue+(q=q.replace(/[?#]/g,function(P){return encodeURIComponent(P)}))+(li=li.replace("#","%23"))+We},pt.prototype.resolve=function(J){return this.resolveObject(zi(J,!1,!0)).format()},pt.prototype.resolveObject=function(J){if(_.isString(J)){var Me=new pt;Me.parse(J,!1,!0),J=Me}for(var q=new pt,We=Object.keys(this),Ue=0;Ue<We.length;Ue++){var wi=We[Ue];q[wi]=this[wi]}if(q.hash=J.hash,""===J.href)return q.href=q.format(),q;if(J.slashes&&!J.protocol){for(var li=Object.keys(J),P=0;P<li.length;P++){var G=li[P];"protocol"!==G&&(q[G]=J[G])}return Ce[q.protocol]&&q.hostname&&!q.pathname&&(q.path=q.pathname="/"),q.href=q.format(),q}if(J.protocol&&J.protocol!==q.protocol){if(!Ce[J.protocol]){for(var N=Object.keys(J),nt=0;nt<N.length;nt++){var ht=N[nt];q[ht]=J[ht]}return q.href=q.format(),q}if(q.protocol=J.protocol,J.host||He[J.protocol])q.pathname=J.pathname;else{for(var Bt=(J.pathname||"").split("/");Bt.length&&!(J.host=Bt.shift()););J.host||(J.host=""),J.hostname||(J.hostname=""),""!==Bt[0]&&Bt.unshift(""),Bt.length<2&&Bt.unshift(""),q.pathname=Bt.join("/")}return q.search=J.search,q.query=J.query,q.host=J.host||"",q.auth=J.auth,q.hostname=J.hostname||J.host,q.port=J.port,(q.pathname||q.search)&&(q.path=(q.pathname||"")+(q.search||"")),q.slashes=q.slashes||J.slashes,q.href=q.format(),q}var ut=q.pathname&&"/"===q.pathname.charAt(0),Ct=J.host||J.pathname&&"/"===J.pathname.charAt(0),xt=Ct||ut||q.host&&J.pathname,ce=xt,yt=q.pathname&&q.pathname.split("/")||[],ge=(Bt=J.pathname&&J.pathname.split("/")||[],q.protocol&&!Ce[q.protocol]);if(ge&&(q.hostname="",q.port=null,q.host&&(""===yt[0]?yt[0]=q.host:yt.unshift(q.host)),q.host="",J.protocol&&(J.hostname=null,J.port=null,J.host&&(""===Bt[0]?Bt[0]=J.host:Bt.unshift(J.host)),J.host=null),xt=xt&&(""===Bt[0]||""===yt[0])),Ct)q.host=J.host||""===J.host?J.host:q.host,q.hostname=J.hostname||""===J.hostname?J.hostname:q.hostname,q.search=J.search,q.query=J.query,yt=Bt;else if(Bt.length)yt||(yt=[]),yt.pop(),yt=yt.concat(Bt),q.search=J.search,q.query=J.query;else if(!_.isNullOrUndefined(J.search))return ge&&(q.hostname=q.host=yt.shift(),(ie=!!(q.host&&q.host.indexOf("@")>0)&&q.host.split("@"))&&(q.auth=ie.shift(),q.host=q.hostname=ie.shift())),q.search=J.search,q.query=J.query,(!_.isNull(q.pathname)||!_.isNull(q.search))&&(q.path=(q.pathname?q.pathname:"")+(q.search?q.search:"")),q.href=q.format(),q;if(!yt.length)return q.pathname=null,q.path=q.search?"/"+q.search:null,q.href=q.format(),q;for(var Xe=yt.slice(-1)[0],Ye=(q.host||J.host||yt.length>1)&&("."===Xe||".."===Xe)||""===Xe,Ke=0,je=yt.length;je>=0;je--)"."===(Xe=yt[je])?yt.splice(je,1):".."===Xe?(yt.splice(je,1),Ke++):Ke&&(yt.splice(je,1),Ke--);if(!xt&&!ce)for(;Ke--;Ke)yt.unshift("..");xt&&""!==yt[0]&&(!yt[0]||"/"!==yt[0].charAt(0))&&yt.unshift(""),Ye&&"/"!==yt.join("/").substr(-1)&&yt.push("");var ie,le=""===yt[0]||yt[0]&&"/"===yt[0].charAt(0);return ge&&(q.hostname=q.host=le?"":yt.length?yt.shift():"",(ie=!!(q.host&&q.host.indexOf("@")>0)&&q.host.split("@"))&&(q.auth=ie.shift(),q.host=q.hostname=ie.shift())),(xt=xt||q.host&&yt.length)&&!le&&yt.unshift(""),yt.length?q.pathname=yt.join("/"):(q.pathname=null,q.path=null),(!_.isNull(q.pathname)||!_.isNull(q.search))&&(q.path=(q.pathname?q.pathname:"")+(q.search?q.search:"")),q.auth=J.auth||q.auth,q.slashes=q.slashes||J.slashes,q.href=q.format(),q},pt.prototype.parseHost=function(){var J=this.host,Me=xe.exec(J);Me&&(":"!==(Me=Me[0])&&(this.port=Me.substr(1)),J=J.substr(0,J.length-Me.length)),J&&(this.hostname=J)}},796:ci=>{"use strict";ci.exports={isString:function(me){return"string"==typeof me},isObject:function(me){return"object"==typeof me&&null!==me},isNull:function(me){return null===me},isNullOrUndefined:function(me){return null==me}}}}]);