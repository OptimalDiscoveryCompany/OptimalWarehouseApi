using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Core.Dtos.Point;
using Core.Entities;
using Core.Interfaces;
using Core.Interfaces.Services;
using Core.Specification.PointSpecification;

namespace Infrastructure.Services
{
    public class PointService : IPointService
    {
        private readonly IUnitOfWork _unitOfWork;

        public PointService(IUnitOfWork unitOfWork)
        {
            _unitOfWork = unitOfWork;
        }

        public async Task<IReadOnlyList<PointDto>> ListPointsByDateRangeAsync(DateTime start, DateTime end)
        {
            var spec = new FilterPointByDateRange(start, end);
            var points = await _unitOfWork.Repository<TPickingAddressPoint>().ListAsync(spec);

            var pointsDto = new List<PointDto>();
            foreach (var point in points)
            {
                pointsDto.Add(new PointDto
                    {
                        Id = point.Id,
                        Position = new Vector3(point.X, point.Y, point.Z)
                    }
                );
            }

            return pointsDto;
        }
    }
}